<div id="Hyperbolic_Functions">
<div class="head">
<h1>Theory Hyperbolic_Functions</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Introduction›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Poincar\'e disc is a model of hyperbolic geometry. That fact has been
a mathematical folklore for more than 100 years. However, up to the
best of our knowledge, fully precise, formal proofs of this fact are
lacking. In this paper we present a formalization of the Poincar\'e disc model
in Isabelle/HOL, introduce its basic notions (h-points, h-lines,
h-congruence, h-isometries, h-betweenness) and prove that it models
Tarski's axioms except for Euclid's axiom. We shown that is satisfies
the negation of Euclid's axiom, and, moreover, the existence of
limiting parallels axiom. The model is defined within the extended
complex plane, which has been described quite precisely by
Schwerdfeger~\cite{schwerdtfeger} and formalized in the previous work
of the first two authors~\cite{amai-complexplane}.›</span></span> 

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Related work.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In 1840 Lobachevsky~\cite{lobachevsky1840geometrische} published developments
about non-Euclidean geometry. Hyperbolic
geometry is studied through many of its models. The concept of a
projective disc model was introduced by Klein while Poincar\'e
investigated the half-plane model proposed by Liouville and Beltrami
and primarily studied the isometries of the hyperbolic plane that
preserve orientation. In this paper, we focus on the formalization of
the latter.

Regarding non-Euclidean geometry, Makarios showed the
independence of Euclid's axiom~\cite{makarios}. He did so by
formalizing that the Klein--Beltrami model is a model of Tarski's
axioms at the exception of Euclid's axiom. Latter Coghetto formalized 
the Klein-Beltrami model within Mizar~\cite{coghetto2018klein1,coghetto2018klein2}.
›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Background theories›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Hyperbolic Functions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section hyperbolic cosine and hyperbolic sine functions are introduced and some of their
properties needed for further development are proved.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Hyperbolic_Functions
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a> <a href="../Complex_Geometry/More_Complex.html">Complex_Geometry.More_Complex</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="Hyperbolic_Functions-cosh_arcosh"><span class="command">lemma</span></span> cosh_arcosh <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh <span class="main">(</span>arcosh <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms
  <span class="keyword1"><span class="command">have</span></span>  **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> one_le_power real_sqrt_ge_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span>sqrt<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> add_divide_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> <span class="main">(</span>sqrt<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> nonzero_mult_div_cancel_right<span class="main">[</span><span class="operator">OF</span> *<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> arcosh_real_def<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> cosh_def 
    <span class="keyword1"><span class="command">using</span></span> ln_div<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> **
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Hyperbolic_Functions-arcosh_ge_0"><span class="command">lemma</span></span> arcosh_ge_0 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"arcosh <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> arcosh_def assms ln_ge_zero powr_ge_pzero<span class="main">)</span>

<span class="keyword1" id="Hyperbolic_Functions-arcosh_eq_0_iff"><span class="command">lemma</span></span> arcosh_eq_0_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"arcosh <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> cosh_arcosh <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1" id="Hyperbolic_Functions-arcosh_eq_iff"><span class="command">lemma</span></span> arcosh_eq_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"arcosh <span class="free">x</span> <span class="main">=</span> arcosh <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> cosh_arcosh <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword1" id="Hyperbolic_Functions-cosh_gt_1"><span class="command">lemma</span></span> cosh_gt_1 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh <span class="free">x</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms cosh_real_strict_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


<span class="keyword1" id="Hyperbolic_Functions-cosh_eq_iff"><span class="command">lemma</span></span> cosh_eq_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh <span class="free">x</span> <span class="main">=</span> cosh <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>


<span class="keyword1" id="Hyperbolic_Functions-arcosh_mono"><span class="command">lemma</span></span> arcosh_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"arcosh <span class="free">x</span> <span class="main">≥</span> arcosh <span class="free">y</span> <span class="main">⟷</span> <span class="free">x</span> <span class="main">≥</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> arcosh_ge_0 cosh_arcosh cosh_real_nonneg_less_iff<span class="main">)</span>


<span class="keyword1" id="Hyperbolic_Functions-arcosh_add"><span class="command">lemma</span></span> arcosh_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"arcosh <span class="free">x</span> <span class="main">+</span> arcosh <span class="free">y</span> <span class="main">=</span> arcosh <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_le_cancel_left1<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
  <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">y</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">*</span>sqrt<span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">+</span><span class="free">y</span><span class="main">*</span>sqrt<span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>sqrt<span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span><span class="main">+</span>sqrt<span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> real_sqrt_pow2<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> power_mult_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> real_sqrt_pow2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">y</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> power_mult_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> real_sqrt_pow2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">y</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">unfolding</span></span> power2_sum
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_mult power_mult_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="free">y</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free">y</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> power2_eq_iff_nonneg<span class="main">[</span><span class="operator">OF</span> 2 real_sqrt_ge_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> arcosh_real_def<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> arcosh_real_def<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> arcosh_real_def<span class="main"><span class="main">[</span></span><span class="operator">OF</span> **<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> ln_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> one_le_power real_sqrt_ge_zero<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> one_le_power real_sqrt_ge_zero<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_mult<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Hyperbolic_Functions-arcosh_double"><span class="command">lemma</span></span> arcosh_double<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> arcosh <span class="free">x</span> <span class="main">=</span> arcosh <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> arcosh_add arcosh_mono assms one_power2 power2_eq_square real_sqrt_abs<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Tarski">
<div class="head">
<h1>Theory Tarski</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Tarski axioms›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section we introduce axioms of Tarski \cite{tarski} trough a series of locales.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Tarski
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The first locale assumes all Tarski axioms except for the Euclid's axiom and the continuity
axiom and corresponds to absolute geometry.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> TarskiAbsolute <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">cong</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">betw</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> <span class="tfree">'p</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cong_reflexive<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">cong</span> <span class="free">x</span> <span class="free">y</span> <span class="free">y</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cong_transitive<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cong</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="free">u</span> <span class="main">∧</span> <span class="free">cong</span> <span class="free">x</span> <span class="free">y</span> <span class="free">v</span> <span class="free">w</span> <span class="main">⟶</span> <span class="free">cong</span> <span class="free">z</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> cong_identity<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">cong</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="free">z</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> segment_construction<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="free">betw</span> <span class="free">x</span> <span class="free">y</span> <span class="bound">z</span> <span class="main">∧</span> <span class="free">cong</span> <span class="free">y</span> <span class="bound">z</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> five_segment<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">betw</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">∧</span> <span class="free">betw</span> <span class="free">x'</span> <span class="free">y'</span> <span class="free">z'</span> <span class="main">∧</span> <span class="free">cong</span> <span class="free">x</span> <span class="free">y</span> <span class="free">x'</span> <span class="free">y'</span> <span class="main">∧</span> <span class="free">cong</span> <span class="free">y</span> <span class="free">z</span> <span class="free">y'</span> <span class="free">z'</span> <span class="main">∧</span> <span class="free">cong</span> <span class="free">x</span> <span class="free">u</span> <span class="free">x'</span> <span class="free">u'</span> <span class="main">∧</span> <span class="free">cong</span> <span class="free">y</span> <span class="free">u</span> <span class="free">y'</span> <span class="free">u'</span> <span class="main">⟶</span> <span class="free">cong</span> <span class="free">z</span> <span class="free">u</span> <span class="free">z'</span> <span class="free">u'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> betw_identity<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="free">betw</span> <span class="free">x</span> <span class="free">y</span> <span class="free">x</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> Pasch<span class="main">:</span>           <span class="quoted"><span class="quoted">"<span class="free">betw</span> <span class="free">x</span> <span class="free">u</span> <span class="free">z</span> <span class="main">∧</span> <span class="free">betw</span> <span class="free">y</span> <span class="free">v</span> <span class="free">z</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="free">betw</span> <span class="free">u</span> <span class="bound">a</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">betw</span> <span class="free">x</span> <span class="bound">a</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> lower_dimension<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> <span class="main">¬</span> <span class="free">betw</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">betw</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">a</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">betw</span> <span class="bound">c</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> upper_dimension<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">cong</span> <span class="free">x</span> <span class="free">u</span> <span class="free">x</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">cong</span> <span class="free">y</span> <span class="free">u</span> <span class="free">y</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">cong</span> <span class="free">z</span> <span class="free">u</span> <span class="free">z</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">⟶</span> <span class="free">betw</span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">∨</span> <span class="free">betw</span> <span class="free">y</span> <span class="free">z</span> <span class="free">x</span> <span class="main">∨</span> <span class="free">betw</span> <span class="free">z</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following definitions are used to specify axioms in the following locales.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Point $p$ is on line $ab$.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">on_line</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">on_line</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> <span class="free">betw</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∨</span> <span class="free">betw</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∨</span> <span class="free">betw</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Point $p$ is on ray $ab$.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">on_ray</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">on_ray</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> <span class="free">betw</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∨</span> <span class="free">betw</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Point $p$ is inside angle $abc$.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">in_angle</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">in_angle</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free">betw</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> on_ray <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Ray $r_ar_b$ meets the line $l_al_b$.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ray_meets_line</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ray_meets_line</span> <span class="free"><span class="bound"><span class="entity">ra</span></span></span> <span class="free"><span class="bound"><span class="entity">rb</span></span></span> <span class="free"><span class="bound"><span class="entity">la</span></span></span> <span class="free"><span class="bound"><span class="entity">lb</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> on_ray <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">ra</span></span></span> <span class="free"><span class="bound"><span class="entity">rb</span></span></span> <span class="main">∧</span> on_line <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">la</span></span></span> <span class="free"><span class="bound"><span class="entity">lb</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The second locales adds the negation of Euclid's axiom and limiting parallels and corresponds
to hyperbolic geometry.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> TarskiHyperbolic <span class="main">=</span> TarskiAbsolute <span class="main">+</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> euclid_negation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">t</span><span class="main">.</span> <span class="free">betw</span> <span class="bound">a</span> <span class="bound">d</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">betw</span> <span class="bound">b</span> <span class="bound">d</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="free">betw</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">betw</span> <span class="bound">a</span> <span class="bound">c</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">betw</span> <span class="bound">x</span> <span class="bound">t</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> limiting_parallels<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> on_line <span class="free">a</span> <span class="free">x1</span> <span class="free">x2</span> <span class="main">⟹</span> 
      <span class="main">(</span><span class="main">∃</span> <span class="bound">a1</span> <span class="bound">a2</span><span class="main">.</span> <span class="main">¬</span> on_line <span class="free">a</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="main">∧</span>
                <span class="main">¬</span> ray_meets_line <span class="free">a</span> <span class="bound">a1</span> <span class="free">x1</span> <span class="free">x2</span> <span class="main">∧</span>
                <span class="main">¬</span> ray_meets_line <span class="free">a</span> <span class="bound">a2</span> <span class="free">x1</span> <span class="free">x2</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∀</span> <span class="bound">a'</span><span class="main">.</span> in_angle <span class="bound">a'</span> <span class="bound">a1</span> <span class="free">a</span> <span class="bound">a2</span> <span class="main">⟶</span> ray_meets_line <span class="free">a</span> <span class="bound">a'</span> <span class="free">x1</span> <span class="free">x2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The third locale adds the continuity axiom and corresponds to elementary hyperbolic geometry.›</span></span>
<span class="keyword1"><span class="command">locale</span></span> ElementaryTarskiHyperbolic <span class="main">=</span> TarskiHyperbolic <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> continuity<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">y</span><span class="main">.</span> <span class="free">φ</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">ψ</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">betw</span> <span class="bound">a</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">y</span><span class="main">.</span> <span class="free">φ</span> <span class="bound">x</span> <span class="main">∧</span> <span class="free">ψ</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="free">betw</span> <span class="bound">x</span> <span class="bound">b</span> <span class="bound">y</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Poincare_Lines">
<div class="head">
<h1>Theory Poincare_Lines</h1>
</div>
<pre class="source"><span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹H-lines in the Poincar\'e model›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">theory</span></span> Poincare_Lines
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../Complex_Geometry/Unit_Circle_Preserving_Moebius.html">Complex_Geometry.Unit_Circle_Preserving_Moebius</a> <a href="../Complex_Geometry/Circlines_Angle.html">Complex_Geometry.Circlines_Angle</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition and basic properties of h-lines›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹H-lines in the Poincar\'e model are either line segments passing trough the origin or
segments (within the unit disc) of circles that are perpendicular to the unit circle. Algebraically
these are circlines that are represented by Hermitean matrices of
the form
$$H = \left(
 \begin{array}{cc}
 A &amp; B\\
 \overline{B} &amp; A
 \end{array}
\right),$$
for $A \in \mathbb{R}$, and $B \in \mathbb{C}$, and $|B|^2 &gt; A^2$,
where the circline equation is the usual one: $z^*Hz = 0$, for homogenous coordinates $z$.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_poincare_line_cmat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">is_poincare_line_cmat</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⟷</span>
             <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">,</span> <span class="bound">C</span><span class="main">,</span> <span class="bound">D</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span>
               <span class="keyword1">in</span> hermitean <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">,</span> <span class="bound">C</span><span class="main">,</span> <span class="bound">D</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">A</span> <span class="main">=</span> <span class="bound">D</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="bound">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="bound">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> is_poincare_line_clmat <span class="main">::</span> <span class="quoted"><span class="quoted">"circline_mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">is_poincare_line_cmat</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We introduce the predicate that checks if a given complex matrix is a matrix of a h-line in
the Poincar\'e model, and then by means of the lifting package lift it to the type of non-zero
Hermitean matrices, and then to circlines (that are equivalence classes of such matrices).›</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> is_poincare_line <span class="main">::</span> <span class="quoted"><span class="quoted">"circline <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">is_poincare_line_clmat</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H1</span> <span class="skolem">H2</span> <span class="main">::</span> <span class="quoted">complex_mat</span>
  <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H1</span> <span class="main">∧</span> <span class="skolem">H1</span> <span class="main">≠</span> mat_zero"</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H2</span> <span class="main">∧</span> <span class="skolem">H2</span> <span class="main">≠</span> mat_zero"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="skolem">H1</span> <span class="skolem">H2</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H1</span> <span class="main">⟷</span> is_poincare_line_cmat <span class="skolem">H2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hh
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">H2</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult power_mult_distrib<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines-is_poincare_line_mk_circline"><span class="command">lemma</span></span> is_poincare_line_mk_circline<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">,</span> <span class="free">D</span><span class="main">)</span> <span class="main">∈</span> hermitean_nonzero"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>mk_circline <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">∧</span> <span class="free">A</span> <span class="main">=</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Abstract characterisation of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">is_poincare_line</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> predicate: H-lines in the Poincar\'e
model are real circlines (circlines with the negative determinant) perpendicular to the unit
circle.›</span></span>

<span class="keyword1" id="Poincare_Lines-is_poincare_line_iff"><span class="command">lemma</span></span> is_poincare_line_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span> <span class="main">⟷</span> circline_type <span class="free">H</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">∧</span> perpendicular <span class="free">H</span> unit_circle"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> perpendicular_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">H</span> <span class="main">≠</span> mat_zero"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> cnj <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hh * hermitean_elems
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">A</span> <span class="main">=</span> Re <span class="skolem">D</span> <span class="main">∧</span> cmod <span class="skolem">A</span> <span class="main">*</span> cmod <span class="skolem">A</span> <span class="main">&lt;</span> cmod <span class="skolem">B</span> <span class="main">*</span> cmod <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">(</span>Re <span class="skolem">A</span> <span class="main">*</span> Re <span class="skolem">D</span> <span class="main">&lt;</span> Re <span class="skolem">B</span> <span class="main">*</span> Re <span class="skolem">B</span> <span class="main">+</span> Im <span class="skolem">B</span> <span class="main">*</span> Im <span class="skolem">B</span> <span class="main">∧</span> <span class="main">(</span>Re <span class="skolem">D</span> <span class="main">=</span> Re <span class="skolem">A</span> <span class="main">∨</span> Re <span class="skolem">A</span> <span class="main">*</span> Re <span class="skolem">D</span> <span class="main">=</span> Re <span class="skolem">B</span> <span class="main">*</span> Re <span class="skolem">B</span> <span class="main">+</span> Im <span class="skolem">B</span> <span class="main">*</span> Im <span class="skolem">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> cmod_power2 power2_eq_square zero_power2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H</span> <span class="main">⟷</span>
         circline_type_cmat <span class="skolem">H</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> cos_angle_cmat <span class="main">(</span>of_circline_cmat <span class="skolem">H</span><span class="main">)</span> unit_circle_cmat <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * **
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_1_neg complex_eq_if_Re_eq cmod_square power2_eq_square <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> pos_oriented_cmat_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">x_axis</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is an h-line.›</span></span>
<span class="keyword1" id="Poincare_Lines-is_poincare_line_x_axis"><span class="command">lemma</span></span> is_poincare_line_x_axis <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_poincare_line x_axis"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">unit_circle</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is not an h-line.›</span></span>
<span class="keyword1" id="Poincare_Lines-not_is_poincare_line_unit_circle"><span class="command">lemma</span></span> not_is_poincare_line_unit_circle <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_poincare_line unit_circle"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Collinear points›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Points are collinear if they all belong to an h-line. ›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poincare_collinear</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_homo set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poincare_collinear</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> is_poincare_line <span class="bound">p</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">⊆</span> circline_set <span class="bound">p</span><span class="main">)</span>"</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹H-lines and inversion›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Every h-line in the Poincar\'e model contains the inverse (wrt.~the unit circle) of each of its
points (note that at most one of them belongs to the unit disc).›</span></span>
<span class="keyword1" id="Poincare_Lines-is_poincare_line_inverse_point"><span class="command">lemma</span></span> is_poincare_line_inverse_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">u</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> is_poincare_line_iff circline_set_def perpendicular_def inversion_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">H</span> <span class="main">≠</span> mat_zero"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> vec_zero"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
         aa<span class="main">:</span> <span class="quoted"><span class="quoted">"circline_type_cmat <span class="skolem">H</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span> <span class="main">∧</span> cos_angle_cmat <span class="main">(</span>of_circline_cmat <span class="skolem">H</span><span class="main">)</span> unit_circle_cmat <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"on_circline_cmat_cvec <span class="skolem">H</span> <span class="skolem">u</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> cnj <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * hh hermitean_elems
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">D</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> aa<span class="main">(</span>1<span class="main">)</span> * <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">D</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> pos_oriented_cmat_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex.expand <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"on_circline_cmat_cvec <span class="skolem">H</span> <span class="main">(</span>conjugate_cvec <span class="main">(</span>reciprocal_cvec <span class="skolem">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> aa<span class="main">(</span>2<span class="main">)</span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Every h-line in the Poincar\'e model and is invariant under unit circle inversion.›</span></span>

<span class="keyword1" id="Poincare_Lines-circline_inversion_poincare_line"><span class="command">lemma</span></span> circline_inversion_poincare_line<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"circline_inversion <span class="free">H</span> <span class="main">=</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms is_poincare_line_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> circline_type_neg_card_gt3<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>inversion <span class="skolem">u</span><span class="main">,</span> inversion <span class="skolem">v</span><span class="main">,</span> inversion <span class="skolem">w</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="main">(</span>circline_inversion <span class="free">H</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">{</span>inversion <span class="skolem">u</span><span class="main">,</span> inversion <span class="skolem">v</span><span class="main">,</span> inversion <span class="skolem">w</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_poincare_line_inverse_point<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> * unique_circline_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inversion <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"inversion <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"inversion <span class="skolem">w</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_subset inversion_involution<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Classification of h-lines into Euclidean segments and circles›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If an h-line contains zero, than it also contains infinity (the inverse point of zero) and is by
definition an Euclidean line.›</span></span>
<span class="keyword1" id="Poincare_Lines-is_poincare_line_trough_zero_trough_infty"><span class="command">lemma</span></span> is_poincare_line_trough_zero_trough_infty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_poincare_line_inverse_point<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Poincare_Lines-is_poincare_line_trough_zero_is_line"><span class="command">lemma</span></span> is_poincare_line_trough_zero_is_line<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_line <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> inf_in_circline_set is_poincare_line_trough_zero_trough_infty
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If an h-line does not contain zero, than it also does not contain infinity (the inverse point of
zero) and is by definition an Euclidean circle.›</span></span>
<span class="keyword1" id="Poincare_Lines-is_poincare_line_not_trough_zero_not_trough_infty"><span class="command">lemma</span></span> is_poincare_line_not_trough_zero_not_trough_infty <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∉</span> circline_set <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∉</span> circline_set <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> is_poincare_line_inverse_point<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Poincare_Lines-is_poincare_line_not_trough_zero_is_circle"><span class="command">lemma</span></span> is_poincare_line_not_trough_zero_is_circle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∉</span> circline_set <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_circle <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> inf_in_circline_set is_poincare_line_not_trough_zero_not_trough_infty
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Points on h-line›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Each h-line in the Poincar\'e model contains at least two different points within the unit
disc.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹First we prove an auxiliary lemma.›</span></span>
<span class="keyword1" id="Poincare_Lines-ex_is_poincare_line_points'"><span class="command">lemma</span></span> ex_is_poincare_line_points'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> i12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> unit_circle_set"</span></span>
               <span class="quoted"><span class="quoted">"<span class="free">i2</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> unit_circle_set"</span></span>
               <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">≠</span> <span class="free">i2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> unit_circle_set"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">b</span> <span class="main">≠</span> <span class="free">i1</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="free">i2</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> inversion <span class="free">a</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">a</span> <span class="main">∉</span> unit_circle_set"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∉</span> unit_circle_set›</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> unit_circle_set_def circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inversion_id_iff_on_unit_circle inversion_involution mem_Collect_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> inversion <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∉</span> unit_circle_set›</span></span> inversion_id_iff_on_unit_circle<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> unit_circle_set_def circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">i1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">i2</span>"</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">a</span> <span class="main">≠</span> <span class="free">i1</span>"</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">a</span> <span class="main">≠</span> <span class="free">i2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹inversion <span class="free">a</span> <span class="main">∉</span> unit_circle_set›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> cr2<span class="main">:</span> <span class="quoted"><span class="quoted">"cross_ratio <span class="skolem">b</span> <span class="free">i1</span> <span class="free">a</span> <span class="free">i2</span> <span class="main">=</span> of_complex <span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i1</span> <span class="main">≠</span> <span class="free">i2</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_cross_ratio<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i1</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">i2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> distinct_b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="free">i1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="free">i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i1</span> <span class="main">≠</span> <span class="free">i2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">i1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">i2</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex1_cross_ratio<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i1</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">i2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> cross_ratio_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i1</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">i2</span></span><span class="main">]</span> cross_ratio_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i1</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">i2</span></span><span class="main">]</span> cross_ratio_inf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i1</span></span> <span class="quoted"><span class="free">i2</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> cr2
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms four_points_on_circline_iff_cross_ratio_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="free">i1</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">i2</span></span><span class="main">]</span> cr2
    <span class="keyword1"><span class="command">using</span></span> unique_circline_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i1</span></span> <span class="quoted"><span class="free">i2</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> inversion <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">i1</span> <span class="main">=</span> <span class="free">i1</span>"</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">i2</span> <span class="main">=</span> <span class="free">i2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i12
      <span class="keyword1"><span class="command">unfolding</span></span> unit_circle_set_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="main">(</span>inversion <span class="free">a</span><span class="main">)</span> <span class="free">i1</span> <span class="free">a</span> <span class="free">i2</span> <span class="main">=</span> cross_ratio <span class="free">a</span> <span class="free">i1</span> <span class="main">(</span>inversion <span class="free">a</span><span class="main">)</span> <span class="free">i2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * cross_ratio_inversion<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">i1</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">i2</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">i1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="free">i2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i1</span> <span class="main">≠</span> <span class="free">i2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="free">i1</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> four_points_on_circline_iff_cross_ratio_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">b</span></span> <span class="quoted"><span class="free">i1</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">i2</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> i12 distinct_b conjugate_id_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cross_ratio <span class="skolem">b</span> <span class="free">i1</span> <span class="free">a</span> <span class="free">i2</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> i12 a <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> circline_set <span class="free">H</span>›</span></span>            
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cross_ratio <span class="main">(</span>inversion <span class="free">a</span><span class="main">)</span> <span class="free">i1</span> <span class="free">a</span> <span class="free">i2</span> <span class="main">≠</span> of_complex <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cross_ratio_commute_13<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inversion <span class="free">a</span>"</span></span> <span class="quoted"><span class="free">i1</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">i2</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> reciprocal_id_iff
      <span class="keyword1"><span class="command">using</span></span> of_complex_inj
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> * cr2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="free">i1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="free">i2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="free">a</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Now we can prove the statement.›</span></span>
<span class="keyword1" id="Poincare_Lines-ex_is_poincare_line_points"><span class="command">lemma</span></span> ex_is_poincare_line_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">∧</span> <span class="main">{</span><span class="bound">u</span><span class="main">,</span> <span class="bound">v</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms is_poincare_line_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> circline_type_neg_card_gt3<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">{</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">}</span> <span class="main">⊆</span> unit_circle_set"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unique_circline_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms insert_subset not_is_poincare_line_unit_circle unit_circle_set_def<span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≠</span> unit_circle"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> unit_circle_set_def
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="skolem">v</span> <span class="main">∈</span> unit_disc<span class="main">)</span> <span class="main">∨</span>
                <span class="main">(</span><span class="skolem">u</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="skolem">w</span> <span class="main">∈</span> unit_disc<span class="main">)</span> <span class="main">∨</span>
                <span class="main">(</span><span class="skolem">v</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="skolem">w</span> <span class="main">∈</span> unit_disc<span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> inversion <span class="bound">b</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∉</span> unit_circle_set <span class="main">∧</span> <span class="bound">b</span> <span class="main">∉</span> unit_circle_set"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span> <span class="main">∈</span> unit_circle_set <span class="main">∧</span> <span class="skolem">v</span> <span class="main">∈</span> unit_circle_set<span class="main">)</span> <span class="main">∨</span>
                  <span class="main">(</span><span class="skolem">u</span> <span class="main">∈</span> unit_circle_set <span class="main">∧</span> <span class="skolem">w</span> <span class="main">∈</span> unit_circle_set<span class="main">)</span> <span class="main">∨</span>
                  <span class="main">(</span><span class="skolem">v</span> <span class="main">∈</span> unit_circle_set <span class="main">∧</span> <span class="skolem">w</span> <span class="main">∈</span> unit_circle_set<span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">∈</span> unit_circle_set <span class="main">∩</span> circline_set <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">∈</span> unit_circle_set <span class="main">∩</span> circline_set <span class="free">H</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> unit_circle_set"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">{</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">}</span> <span class="main">⊆</span> unit_circle_set›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">i1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> inversion <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ex_is_poincare_line_points'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i1</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="skolem">i2</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∉</span> unit_circle_set"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="free">H</span> <span class="main">≠</span> unit_circle›</span></span> unique_circline_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i1</span></span> <span class="quoted"><span class="skolem">i2</span></span> <span class="quoted"><span class="skolem">b</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> unit_circle_set_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">∈</span> circline_set <span class="free">H</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">b</span> <span class="main">≠</span> inversion <span class="skolem">a</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≠</span> <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∉</span> unit_circle_set"</span></span>  
                    <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∉</span> unit_circle_set"</span></span>
                    <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">≠</span> <span class="skolem">g</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> *
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> inversion <span class="skolem">g</span>"</span></span><span class="main">)</span>   
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> *
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> unit_circle_set"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">=</span> inversion <span class="skolem">g</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> cr2<span class="main">:</span> <span class="quoted"><span class="quoted">"cross_ratio <span class="skolem">m</span> <span class="skolem">h</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="main">=</span> of_complex <span class="numeral">2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ex_cross_ratio<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> * <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">≠</span> <span class="skolem">g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">≠</span> <span class="skolem">f</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">≠</span> <span class="skolem">g</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="skolem">h</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="skolem">g</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">≠</span> <span class="skolem">f</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">≠</span> <span class="skolem">g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">≠</span> <span class="skolem">g</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> ex1_cross_ratio<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> cross_ratio_0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> cross_ratio_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> cross_ratio_inf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">g</span></span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> cr2
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> four_points_on_circline_iff_cross_ratio_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span> cr2
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">≠</span> <span class="skolem">f</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">≠</span> <span class="skolem">g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">≠</span> <span class="skolem">g</span>›</span></span> *
            <span class="keyword1"><span class="command">using</span></span> unique_circline_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">g</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> unit_circle_set"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≠</span> <span class="skolem">f</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≠</span> <span class="skolem">g</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">=</span> inversion <span class="skolem">g</span>›</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> circline_set <span class="free">H</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">h</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> inversion <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ex_is_poincare_line_points'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">h</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span> * <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> circline_set <span class="free">H</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∈</span> unit_circle_set›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≠</span> <span class="skolem">h</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> unit_circle_set"</span></span>
              <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="free">H</span> <span class="main">≠</span> unit_circle›</span></span> unique_circline_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">h</span></span><span class="main">]</span> 
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">≠</span> <span class="skolem">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> unit_circle_set›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∈</span> unit_circle_set›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> circline_set <span class="free">H</span>›</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> unit_circle_set_def
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> circline_set <span class="free">H</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="skolem">f</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> inversion <span class="skolem">f</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> inversion <span class="skolem">b</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> unit_circle_set"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∉</span> unit_circle_set"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∉</span> unit_circle_set <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x'</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> unit_disc <span class="main">∧</span> <span class="main">(</span><span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∨</span> <span class="bound">x'</span> <span class="main">=</span> inversion <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> unit_circle_set"</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x'</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> unit_disc <span class="main">∧</span> <span class="main">(</span><span class="bound">x'</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">∨</span> <span class="bound">x'</span> <span class="main">=</span> inversion <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> x
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc_compl"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x  in_on_out_univ<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ounit_circle"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> unit_circle_set_def unit_disc_def unit_disc_compl_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inversion <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span>
          <span class="keyword1"><span class="command">using</span></span> inversion_unit_disc_compl
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> is_poincare_line_inverse_point<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> x
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="skolem"><span class="skolem">b'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∨</span> <span class="skolem">a'</span> <span class="main">=</span> inversion <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b'</span> <span class="main">=</span> <span class="skolem">b</span> <span class="main">∨</span> <span class="skolem">b'</span> <span class="main">=</span> inversion <span class="skolem">b</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ab
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≠</span> <span class="skolem">b'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> inversion <span class="skolem">b</span>›</span></span> ** *
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inversion_involution<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹H-line uniqueness›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹There is no more than one h-line that contains two different h-points (in the disc).›</span></span>
<span class="keyword1" id="Poincare_Lines-unique_is_poincare_line"><span class="command">lemma</span></span> unique_is_poincare_line<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pl<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">l1</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">l2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> on_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="free">l1</span> <span class="main">∩</span> circline_set <span class="free">l2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l1</span> <span class="main">=</span> <span class="free">l2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> inversion <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> inversion <span class="free">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_disc
    <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> on_l
    <span class="keyword1"><span class="command">using</span></span> unique_circline_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_poincare_line_inverse_point<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l1</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> is_poincare_line_inverse_point<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">l2</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> pl
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                                                                            
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For the rest of our formalization it is often useful to consider points on h-lines that are not
within the unit disc. Many lemmas in the rest of this section will have such generalizations.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹There is no more than one h-line that contains two different and not mutually inverse points
(not necessary in the unit disc).›</span></span>
<span class="keyword1" id="Poincare_Lines-unique_is_poincare_line_general"><span class="command">lemma</span></span> unique_is_poincare_line_general<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> different<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> inversion <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pl<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">l1</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">l2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> on_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="free">l1</span> <span class="main">∩</span> circline_set <span class="free">l2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">l1</span> <span class="main">=</span> <span class="free">l2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> inversion <span class="free">u</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> unique_circline_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> is_poincare_line_inverse_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> inversion <span class="free">v</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> unique_circline_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">using</span></span> is_poincare_line_inverse_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"on_circline unit_circle <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"on_circline unit_circle <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">u</span> <span class="main">≠</span> inversion <span class="free">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">v</span> <span class="main">≠</span> inversion <span class="free">v</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inversion_id_iff_on_unit_circle
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> pl on_l <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u1</span> <span class="skolem">u2</span> <span class="skolem">v1</span> <span class="skolem">v2</span> <span class="skolem">A1</span> <span class="skolem">B1</span> <span class="skolem">C1</span> <span class="skolem">D1</span> <span class="skolem">A2</span> <span class="skolem">B2</span> <span class="skolem">C2</span> <span class="skolem">D2</span> <span class="main">::</span> <span class="quoted">complex</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="var"><span class="quoted"><span class="var">?H1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">A1</span><span class="main">,</span> <span class="skolem">B1</span><span class="main">,</span> <span class="skolem">C1</span><span class="main">,</span> <span class="skolem">D1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?H2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">A2</span><span class="main">,</span> <span class="skolem">B2</span><span class="main">,</span> <span class="skolem">C2</span><span class="main">,</span> <span class="skolem">D2</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">≠</span> vec_zero"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">≠</span> vec_zero"</span></span>
        <span class="quoted"><span class="quoted">"on_circline_cmat_cvec unit_circle_cmat <span class="var">?u</span>"</span></span> <span class="quoted"><span class="quoted">"on_circline_cmat_cvec unit_circle_cmat <span class="var">?v</span>"</span></span> 
        <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="var">?H1</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="var">?H2</span>"</span></span>
        <span class="quoted"><span class="quoted">"hermitean <span class="var">?H1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="main">≠</span> mat_zero"</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="var">?H2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="main">≠</span> mat_zero"</span></span>
        <span class="quoted"><span class="quoted">"on_circline_cmat_cvec <span class="var">?H1</span> <span class="var">?u</span>"</span></span> <span class="quoted"><span class="quoted">"on_circline_cmat_cvec <span class="var">?H1</span> <span class="var">?v</span>"</span></span>
        <span class="quoted"><span class="quoted">"on_circline_cmat_cvec <span class="var">?H2</span> <span class="var">?u</span>"</span></span> <span class="quoted"><span class="quoted">"on_circline_cmat_cvec <span class="var">?H2</span> <span class="var">?v</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A1</span> <span class="main">=</span> <span class="skolem">D1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A2</span> <span class="main">=</span> <span class="skolem">D2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main">=</span> cnj <span class="skolem">B1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C2</span> <span class="main">=</span> cnj <span class="skolem">B2</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A1</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_poincare_line_cmat <span class="var">?H1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_poincare_line_cmat <span class="var">?H2</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹hermitean <span class="var">?H1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H1</span> <span class="main">≠</span> mat_zero›</span></span> <span class="quoted"><span class="quoted">‹hermitean <span class="var">?H2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H2</span> <span class="main">≠</span> mat_zero›</span></span>
        <span class="keyword1"><span class="command">using</span></span> hermitean_elems
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>1-4<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"cor <span class="main">(</span><span class="main">(</span>Re <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span><span class="main">(</span>Im <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹on_circline_cmat_cvec unit_circle_cmat <span class="var">?u</span>›</span></span> uv
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_real_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> complex_mult_cnj<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def mult.commute<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

      <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"cor <span class="main">(</span><span class="main">(</span>Re <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span><span class="main">(</span>Im <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹on_circline_cmat_cvec unit_circle_cmat <span class="var">?v</span>›</span></span> uv
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> of_real_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> complex_mult_cnj<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def mult.commute<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

      <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">A1</span> <span class="main">*</span> <span class="main">(</span>cor <span class="main">(</span><span class="main">(</span>Re <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span><span class="main">(</span>Im <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span>Re <span class="skolem">B1</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span>Im <span class="skolem">B1</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">A2</span> <span class="main">*</span> <span class="main">(</span>cor <span class="main">(</span><span class="main">(</span>Re <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span><span class="main">(</span>Im <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span>Re <span class="skolem">B2</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span>Im <span class="skolem">B2</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">A1</span> <span class="main">*</span> <span class="main">(</span>cor <span class="main">(</span><span class="main">(</span>Re <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span><span class="main">(</span>Im <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span>Re <span class="skolem">B1</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span>Im <span class="skolem">B1</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">A2</span> <span class="main">*</span> <span class="main">(</span>cor <span class="main">(</span><span class="main">(</span>Re <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span><span class="main">(</span>Im <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span>Re <span class="skolem">B2</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span>Im <span class="skolem">B2</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> circline_equation_quadratic_equation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A1</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span>"</span></span> <span class="quoted"><span class="skolem">B1</span></span> <span class="quoted"><span class="skolem">D1</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">u1</span> <span class="main">/</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B1</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">B1</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> circline_equation_quadratic_equation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A2</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span>"</span></span> <span class="quoted"><span class="skolem">B2</span></span> <span class="quoted"><span class="skolem">D2</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">u1</span> <span class="main">/</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B2</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">B2</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> circline_equation_quadratic_equation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A1</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span>"</span></span> <span class="quoted"><span class="skolem">B1</span></span> <span class="quoted"><span class="skolem">D1</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">v1</span> <span class="main">/</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B1</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">B1</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> circline_equation_quadratic_equation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A2</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span>"</span></span> <span class="quoted"><span class="skolem">B2</span></span> <span class="quoted"><span class="skolem">D2</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">v1</span> <span class="main">/</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B2</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">B2</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹on_circline_cmat_cvec <span class="var">?H1</span> <span class="var">?u</span>›</span></span> <span class="quoted"><span class="quoted">‹on_circline_cmat_cvec <span class="var">?H2</span> <span class="var">?u</span>›</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹on_circline_cmat_cvec <span class="var">?H1</span> <span class="var">?v</span>›</span></span> <span class="quoted"><span class="quoted">‹on_circline_cmat_cvec <span class="var">?H2</span> <span class="var">?v</span>›</span></span> 
        <span class="keyword1"><span class="command">using</span></span> ** uv
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">hence</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">A1</span> <span class="main">+</span> cor <span class="main">(</span>Re <span class="skolem">B1</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span>Re <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span>Im <span class="skolem">B1</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span>Im <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">A1</span> <span class="main">+</span> cor <span class="main">(</span>Re <span class="skolem">B1</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span>Re <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span>Im <span class="skolem">B1</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span>Im <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">A2</span> <span class="main">+</span> cor <span class="main">(</span>Re <span class="skolem">B2</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span>Re <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span>Im <span class="skolem">B2</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span>Im <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">A2</span> <span class="main">+</span> cor <span class="main">(</span>Re <span class="skolem">B2</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span>Re <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> cor <span class="main">(</span>Im <span class="skolem">B2</span><span class="main">)</span> <span class="main">*</span> cor<span class="main">(</span>Im <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> u v
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span> <span class="operator">algebra</span><span class="main"><span class="keyword3">+</span></span>

      <span class="keyword1"><span class="command">hence</span></span> 
        <span class="quoted"><span class="quoted">"cor <span class="main">(</span>Re <span class="skolem">A1</span> <span class="main">+</span> Re <span class="skolem">B1</span> <span class="main">*</span> Re <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span> <span class="main">+</span> Im <span class="skolem">B1</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"cor <span class="main">(</span>Re <span class="skolem">A2</span> <span class="main">+</span> Re <span class="skolem">B2</span> <span class="main">*</span> Re <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span> <span class="main">+</span> Im <span class="skolem">B2</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"cor <span class="main">(</span>Re <span class="skolem">A1</span> <span class="main">+</span> Re <span class="skolem">B1</span> <span class="main">*</span> Re <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span> <span class="main">+</span> Im <span class="skolem">B1</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"cor <span class="main">(</span>Re <span class="skolem">A2</span> <span class="main">+</span> Re <span class="skolem">B2</span> <span class="main">*</span> Re <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span> <span class="main">+</span> Im <span class="skolem">B2</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A2</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

      <span class="keyword1"><span class="command">hence</span></span> 
        <span class="quoted"><span class="quoted">"Re <span class="skolem">A1</span> <span class="main">+</span> Re <span class="skolem">B1</span> <span class="main">*</span> Re <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span> <span class="main">+</span> Im <span class="skolem">B1</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"Re <span class="skolem">A1</span> <span class="main">+</span> Re <span class="skolem">B1</span> <span class="main">*</span> Re <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span> <span class="main">+</span> Im <span class="skolem">B1</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"Re <span class="skolem">A2</span> <span class="main">+</span> Re <span class="skolem">B2</span> <span class="main">*</span> Re <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span> <span class="main">+</span> Im <span class="skolem">B2</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="quoted"><span class="quoted">"Re <span class="skolem">A2</span> <span class="main">+</span> Re <span class="skolem">B2</span> <span class="main">*</span> Re <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span> <span class="main">+</span> Im <span class="skolem">B2</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> of_real_eq_0_iff 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

      <span class="keyword1"><span class="command">moreover</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span> <span class="main">≠</span> Re<span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span> <span class="main">∨</span> Im<span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span> <span class="main">≠</span> Im<span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span> <span class="main">=</span> <span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> complex_eqI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> uv <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span><span class="main">(</span>1<span class="main">)</span> <span class="quoted">"*"</span><span class="main">(</span>2<span class="main">)</span> complex_cvec_eq_mix<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> *<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">moreover</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">A1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> Re <span class="skolem">B1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> Im <span class="skolem">B1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H1</span> <span class="main">≠</span> mat_zero›</span></span> **
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_cnj_zero complex_of_real_Re mat_zero_def of_real_0<span class="main">)</span>

      <span class="keyword1"><span class="command">ultimately</span></span>

      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        k<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">A2</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> Re <span class="skolem">A1</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B2</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> Re <span class="skolem">B1</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">B2</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> Im <span class="skolem">B1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> linear_system_homogenous_3_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> Re <span class="main">(</span><span class="skolem">u1</span> <span class="main">/</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">+</span> Im <span class="main">(</span><span class="skolem">u1</span> <span class="main">/</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">z</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">u1</span><span class="main">/</span><span class="skolem">u2</span><span class="main">)</span>"</span></span> 
                                              <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="main">1</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> Re <span class="main">(</span><span class="skolem">v1</span> <span class="main">/</span> <span class="skolem">v2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">+</span> Im <span class="main">(</span><span class="skolem">v1</span> <span class="main">/</span> <span class="skolem">v2</span><span class="main">)</span> <span class="main">*</span> <span class="bound">z</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">v1</span><span class="main">/</span><span class="skolem">v2</span><span class="main">)</span>"</span></span>
                                              <span class="quoted"><span class="quoted">"Re <span class="skolem">A2</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B2</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">B2</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">A1</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B1</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">B1</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">A2</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> Re <span class="skolem">B2</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> Im <span class="skolem">B2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?H2</span> <span class="main">≠</span> mat_zero›</span></span> **
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_cnj_zero complex_of_real_Re mat_zero_def of_real_0<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> k
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="var">?H1</span> <span class="var">?H2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ** k <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex.expand<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The only h-line that goes trough zero and a non-zero point on the x-axis is the x-axis.›</span></span>
<span class="keyword1" id="Poincare_Lines-is_poincare_line_0_real_is_x_axis"><span class="command">lemma</span></span> is_poincare_line_0_real_is_x_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="free">l</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> circline_set <span class="free">l</span> <span class="main">∩</span> circline_set x_axis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> x_axis"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> is_poincare_line_trough_zero_trough_infty<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> unique_circline_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The only h-line that goes trough zero and a non-zero point on the y-axis is the y-axis.›</span></span>
<span class="keyword1" id="Poincare_Lines-is_poincare_line_0_imag_is_y_axis"><span class="command">lemma</span></span> is_poincare_line_0_imag_is_y_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="free">l</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> circline_set <span class="free">l</span> <span class="main">∩</span> circline_set y_axis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> y_axis"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> is_poincare_line_trough_zero_trough_infty<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> unique_circline_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹H-isometries preserve h-lines›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\emph{H-isometries} are defined as homographies (actions of Möbius transformations) and
antihomographies (compositions of actions of Möbius transformations with conjugation) that fix the
unit disc (map it onto itself). They also map h-lines onto h-lines›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We prove a bit more general lemma that states that all Möbius transformations that fix the
unit circle (not necessary the unit disc) map h-lines onto h-lines›</span></span>
<span class="keyword1" id="Poincare_Lines-unit_circle_fix_preserve_is_poincare_line"><span class="command">lemma</span></span> unit_circle_fix_preserve_is_poincare_line <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_circle_fix <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>moebius_circline <span class="free">M</span> <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> is_poincare_line_iff
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_ocircline <span class="free">M</span> <span class="main">(</span>of_circline <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?U'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_ocircline <span class="free">M</span> ounit_circle"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> ++<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_circle_fix <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"perpendicular <span class="free">H</span> unit_circle"</span></span>
  <span class="keyword1"><span class="command">have</span></span> ounit<span class="main">:</span> <span class="quoted"><span class="quoted">"ounit_circle <span class="main">=</span> moebius_ocircline <span class="free">M</span> ounit_circle <span class="main">∨</span>
               ounit_circle <span class="main">=</span> moebius_ocircline <span class="free">M</span> <span class="main">(</span>opposite_ocircline ounit_circle<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ++<span class="main">(</span>1<span class="main">)</span> unit_circle_fix_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_of_ocircline moebius_circline_ocircline<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"perpendicular <span class="main">(</span>moebius_circline <span class="free">M</span> <span class="free">H</span><span class="main">)</span> unit_circle"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pos_oriented <span class="var">?H'</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"of_circline <span class="main">(</span>of_ocircline <span class="var">?H'</span><span class="main">)</span> <span class="main">=</span> <span class="var">?H'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> of_circline_of_ocircline_pos_oriented
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> ounit <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"ounit_circle <span class="main">=</span> moebius_ocircline <span class="free">M</span> ounit_circle"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> ++ 
        <span class="keyword1"><span class="command">unfolding</span></span> perpendicular_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> moebius_circline_ocircline<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> **<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"ounit_circle <span class="main">=</span> moebius_ocircline <span class="free">M</span> <span class="main">(</span>opposite_ocircline ounit_circle<span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> ++
        <span class="keyword1"><span class="command">unfolding</span></span> perpendicular_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> moebius_circline_ocircline<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> **<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"of_circline <span class="main">(</span>of_ocircline <span class="var">?H'</span><span class="main">)</span> <span class="main">=</span> opposite_ocircline <span class="var">?H'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_circline_of_ocircline pos_oriented_of_circline<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> ounit <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"ounit_circle <span class="main">=</span> moebius_ocircline <span class="free">M</span> ounit_circle"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> ++
        <span class="keyword1"><span class="command">unfolding</span></span> perpendicular_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> moebius_circline_ocircline<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> **<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"ounit_circle <span class="main">=</span> moebius_ocircline <span class="free">M</span> <span class="main">(</span>opposite_ocircline ounit_circle<span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> ++
        <span class="keyword1"><span class="command">unfolding</span></span> perpendicular_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> moebius_circline_ocircline<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> **<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Poincare_Lines-unit_circle_fix_preserve_is_poincare_line_iff"><span class="command">lemma</span></span> unit_circle_fix_preserve_is_poincare_line_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_circle_fix <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>moebius_circline <span class="free">M</span> <span class="free">H</span><span class="main">)</span> <span class="main">⟷</span> is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> unit_circle_fix_preserve_is_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> unit_circle_fix_preserve_is_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_inv <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_circline <span class="free">M</span> <span class="free">H</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> unit_circle_fix_preserve_is_poincare_line<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Since h-lines are preserved by transformations that fix the unit circle, so is collinearity.›</span></span>
<span class="keyword1" id="Poincare_Lines-unit_disc_fix_preserve_poincare_collinear"><span class="command">lemma</span></span> unit_disc_fix_preserve_poincare_collinear <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_circle_fix <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def                                                    
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"moebius_circline <span class="free">M</span> <span class="improper">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Poincare_Lines-unit_disc_fix_preserve_poincare_collinear_iff"><span class="command">lemma</span></span> unit_disc_fix_preserve_poincare_collinear_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_circle_fix <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> poincare_collinear <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_preserve_poincare_collinear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_preserve_poincare_collinear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_inv <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="main">`</span> <span class="free">A</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> unit_disc_fix_preserve_poincare_collinear<span class="main">)</span>

<span class="keyword1" id="Poincare_Lines-unit_disc_fix_preserve_poincare_collinear3"><span class="command">lemma</span></span> unit_disc_fix_preserve_poincare_collinear3 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span>moebius_pt <span class="free">M</span> <span class="free">u</span><span class="main">,</span> moebius_pt <span class="free">M</span> <span class="free">v</span><span class="main">,</span> moebius_pt <span class="free">M</span> <span class="free">w</span><span class="main">}</span> <span class="main">⟷</span>
         poincare_collinear <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms unit_disc_fix_preserve_poincare_collinear_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">}</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Conjugation is also an h-isometry and it preserves h-lines.›</span></span>
<span class="keyword1" id="Poincare_Lines-is_poincare_line_conjugate_circline"><span class="command">lemma</span></span> is_poincare_line_conjugate_circline <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>conjugate_circline <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_cnj_def hermitean_def mat_adj_def<span class="main">)</span>

<span class="keyword1" id="Poincare_Lines-is_poincare_line_conjugate_circline_iff"><span class="command">lemma</span></span> is_poincare_line_conjugate_circline_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>conjugate_circline <span class="free">H</span><span class="main">)</span> <span class="main">⟷</span> is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_poincare_line_conjugate_circline<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"conjugate_circline <span class="free">H</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Since h-lines are preserved by conjugation, so is collinearity.›</span></span>
<span class="keyword1" id="Poincare_Lines-conjugate_preserve_poincare_collinear"><span class="command">lemma</span></span> conjugate_preserve_poincare_collinear <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">(</span>conjugate <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"conjugate_circline <span class="improper">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Poincare_Lines-conjugate_conjugate"><span class="command">lemma</span></span> conjugate_conjugate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"conjugate <span class="main">`</span> conjugate <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>

<span class="keyword1" id="Poincare_Lines-conjugate_preserve_poincare_collinear_iff"><span class="command">lemma</span></span> conjugate_preserve_poincare_collinear_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">(</span>conjugate <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> poincare_collinear <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conjugate_preserve_poincare_collinear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">A</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> conjugate_preserve_poincare_collinear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"conjugate <span class="main">`</span> <span class="free">A</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> conjugate_preserve_poincare_collinear<span class="main">)</span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Mapping h-lines to x-axis›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Each h-line in the Poincar\'e model can be mapped onto the x-axis (by a unit-disc preserving
Möbius transformation).›</span></span>
<span class="keyword1" id="Poincare_Lines-ex_unit_disc_fix_is_poincare_line_to_x_axis"><span class="command">lemma</span></span> ex_unit_disc_fix_is_poincare_line_to_x_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">M</span><span class="main">.</span> unit_disc_fix <span class="bound">M</span> <span class="main">∧</span> moebius_circline <span class="bound">M</span> <span class="free">l</span> <span class="main">=</span> x_axis"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_is_poincare_line_points
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">u</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v</span> <span class="main">∈</span> positive_x_axis"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_unit_disc_fix_to_zero_positive_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">}</span> <span class="main">⊆</span> circline_set x_axis"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> positive_x_axis_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>›</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> moebius_pt_neq_I<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span>
    <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_discI
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_poincare_line <span class="free">l</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="free">l</span>›</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_poincare_line_0_real_is_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_circline <span class="skolem">M</span> <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹When proving facts about h-lines, without loss of generality it can be assumed that h-line is
the x-axis (if the property being proved is invariant under Möbius transformations that fix the
unit disc).›</span></span>

<span class="keyword1" id="Poincare_Lines-wlog_line_x_axis"><span class="command">lemma</span></span> wlog_line_x_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> is_line<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x_axis<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> x_axis"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> preserves<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">M</span><span class="main">.</span> <span class="main">⟦</span>unit_disc_fix <span class="bound">M</span><span class="main">;</span> <span class="free">P</span> <span class="main">(</span>moebius_circline <span class="bound">M</span> <span class="free">H</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> ex_unit_disc_fix_is_poincare_line_to_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Construction of the h-line between the two given points›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Next we show how to construct the (unique) h-line between the two given points in the Poincar\'e model›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Geometrically, h-line can be constructed by finding the inverse point of one of the two points and 
by constructing the circle (or line) trough it and the two given points.

Algebraically, for two given points $u$ and $v$ in $\mathbb{C}$, the h-line matrix coefficients can
be $A = i\cdot(u\overline{v}-v\overline{u})$ and $B = i\cdot(v(|u|^2+1) - u(|v|^2+1))$.

We need to extend this to homogenous coordinates. There are several degenerate cases.

 - If $\{z, w\} = \{0_h, \infty_h\}$ then there is no unique h-line (any line trough zero is an h-line).

 - If z and w are mutually inverse, then the construction fails (both geometric and algebraic).

 - If z and w are different points on the unit circle, then the standard construction fails (only geometric).

 - None of this problematic cases occur when z and w are inside the unit disc.

We express the construction algebraically, and construct the Hermitean circline matrix for the two
points given in homogenous coordinates. It works correctly in all cases except when the two points
are the same or are mutually inverse.
›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_poincare_line_cmat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real <span class="main">⇒</span> complex <span class="main">⇒</span> complex_mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">mk_poincare_line_cmat</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">(</span>cor <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">,</span> cnj <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">,</span> cor <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Poincare_Lines-mk_poincare_line_cmat_zero_iff"><span class="command">lemma</span></span> mk_poincare_line_cmat_zero_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"mk_poincare_line_cmat <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> mat_zero <span class="main">⟷</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Poincare_Lines-mk_poincare_line_cmat_hermitean"><span class="command">lemma</span></span> mk_poincare_line_cmat_hermitean
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"hermitean <span class="main">(</span>mk_poincare_line_cmat <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Poincare_Lines-mk_poincare_line_cmat_scale"><span class="command">lemma</span></span> mk_poincare_line_cmat_scale<span class="main">:</span>
  <span class="quoted"><span class="quoted">"cor <span class="free">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> mk_poincare_line_cmat <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> mk_poincare_line_cmat <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poincare_line_cvec_cmat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_vec <span class="main">⇒</span> complex_vec <span class="main">⇒</span> complex_mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">poincare_line_cvec_cmat</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">=</span>
            <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">z1</span><span class="main">,</span> <span class="bound">z2</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">;</span>
                 <span class="main">(</span><span class="bound">w1</span><span class="main">,</span> <span class="bound">w2</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">;</span>
                 <span class="bound">nom</span> <span class="main">=</span> <span class="bound">w1</span><span class="main">*</span>cnj <span class="bound">w2</span><span class="main">*</span><span class="main">(</span><span class="bound">z1</span><span class="main">*</span>cnj <span class="bound">z1</span> <span class="main">+</span> <span class="bound">z2</span><span class="main">*</span>cnj <span class="bound">z2</span><span class="main">)</span> <span class="main">-</span> <span class="bound">z1</span><span class="main">*</span>cnj <span class="bound">z2</span><span class="main">*</span><span class="main">(</span><span class="bound">w1</span><span class="main">*</span>cnj <span class="bound">w1</span> <span class="main">+</span> <span class="bound">w2</span><span class="main">*</span>cnj <span class="bound">w2</span><span class="main">)</span><span class="main">;</span>
                 <span class="bound">den</span> <span class="main">=</span> <span class="bound">z1</span><span class="main">*</span>cnj <span class="bound">z2</span><span class="main">*</span>cnj <span class="bound">w1</span><span class="main">*</span><span class="bound">w2</span> <span class="main">-</span> <span class="bound">w1</span><span class="main">*</span>cnj <span class="bound">w2</span><span class="main">*</span>cnj <span class="bound">z1</span><span class="main">*</span><span class="bound">z2</span>
              <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">den</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span>
                    mk_poincare_line_cmat <span class="main">(</span>Re<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="bound">den</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="bound">nom</span><span class="main">)</span>
                 <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">z1</span><span class="main">*</span>cnj <span class="bound">z2</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span>
                    mk_poincare_line_cmat <span class="main">0</span> <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="bound">z1</span><span class="main">*</span>cnj <span class="bound">z2</span><span class="main">)</span>
                 <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="bound">w1</span><span class="main">*</span>cnj <span class="bound">w2</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span>
                    mk_poincare_line_cmat <span class="main">0</span> <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="bound">w1</span><span class="main">*</span>cnj <span class="bound">w2</span><span class="main">)</span>
                 <span class="keyword1">else</span>
                    mk_poincare_line_cmat <span class="main">0</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Poincare_Lines-poincare_line_cvec_cmat_AeqD"><span class="command">lemma</span></span> poincare_line_cvec_cmat_AeqD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poincare_line_cvec_cmat <span class="free">z</span> <span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">,</span> <span class="free">D</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="free">D</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

<span class="keyword1" id="Poincare_Lines-poincare_line_cvec_cmat_hermitean"><span class="command">lemma</span></span> poincare_line_cvec_cmat_hermitean <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="main">(</span>poincare_line_cvec_cmat <span class="free">z</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">w</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mk_poincare_line_cmat_def<span class="main">)</span>

<span class="keyword1" id="Poincare_Lines-poincare_line_cvec_cmat_nonzero"><span class="command">lemma</span></span> poincare_line_cvec_cmat_nonzero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> vec_zero"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> vec_zero"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"poincare_line_cvec_cmat <span class="free">z</span> <span class="free">w</span> <span class="main">≠</span> mat_zero"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="skolem"><span class="skolem">z2</span></span> <span class="skolem"><span class="skolem">w1</span></span> <span class="skolem"><span class="skolem">w2</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z1</span><span class="main">,</span> <span class="skolem">z2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">w1</span><span class="main">,</span> <span class="skolem">w2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">w</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?den</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span><span class="main">*</span>cnj <span class="skolem">z2</span><span class="main">*</span>cnj <span class="skolem">w1</span><span class="main">*</span><span class="skolem">w2</span> <span class="main">-</span> <span class="skolem">w1</span><span class="main">*</span>cnj <span class="skolem">w2</span><span class="main">*</span>cnj <span class="skolem">z1</span><span class="main">*</span><span class="skolem">z2</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?den</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span><span class="var">?den</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?den</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_i_not_zero complex_surj mult_eq_0_iff zero_complex.code<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mk_poincare_line_cmat_def mat_zero_def <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_poincare_line_cmat_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> mk_poincare_line_cmat_def mat_zero_def <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mk_poincare_line_cmat_zero_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> poincare_line_hcoords_clmat <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_homo_coords <span class="main">⇒</span> complex_homo_coords <span class="main">⇒</span> circline_mat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">poincare_line_cvec_cmat</span>
  <span class="keyword1"><span class="command">using</span></span> poincare_line_cvec_cmat_hermitean poincare_line_cvec_cmat_nonzero
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lift_definition</span></span> poincare_line <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_homo <span class="main">⇒</span> complex_homo <span class="main">⇒</span> circline"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">poincare_line_hcoords_clmat</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">za</span> <span class="skolem">zb</span> <span class="skolem">wa</span> <span class="skolem">wb</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">za</span> <span class="main">≠</span> vec_zero"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zb</span> <span class="main">≠</span> vec_zero"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wa</span> <span class="main">≠</span> vec_zero"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wb</span> <span class="main">≠</span> vec_zero"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">za</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">zb</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wa</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">wb</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">za1</span></span> <span class="skolem"><span class="skolem">za2</span></span> <span class="skolem"><span class="skolem">zb1</span></span> <span class="skolem"><span class="skolem">zb2</span></span> <span class="skolem"><span class="skolem">wa1</span></span> <span class="skolem"><span class="skolem">wa2</span></span> <span class="skolem"><span class="skolem">wb1</span></span> <span class="skolem"><span class="skolem">wb2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">za1</span><span class="main">,</span> <span class="skolem">za2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">za</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">zb1</span><span class="main">,</span> <span class="skolem">zb2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">zb</span>"</span></span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">wa1</span><span class="main">,</span> <span class="skolem">wa2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">wa</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">wb1</span><span class="main">,</span> <span class="skolem">wb2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">wb</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">za</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">zb</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">wa</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">wb</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">kz</span></span> <span class="skolem"><span class="skolem">kw</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">kz</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kw</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zb1</span> <span class="main">=</span> <span class="skolem">kz</span> <span class="main">*</span> <span class="skolem">za1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zb2</span> <span class="main">=</span> <span class="skolem">kz</span> <span class="main">*</span> <span class="skolem">za2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wb1</span> <span class="main">=</span> <span class="skolem">kw</span> <span class="main">*</span> <span class="skolem">wa1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wb2</span> <span class="main">=</span> <span class="skolem">kw</span> <span class="main">*</span> <span class="skolem">wa2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">za</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">zb</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">wa</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">wb</span>›</span></span> *<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nom</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">z1</span> <span class="bound">z2</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">.</span> <span class="bound">w1</span><span class="main">*</span>cnj <span class="bound">w2</span><span class="main">*</span><span class="main">(</span><span class="bound">z1</span><span class="main">*</span>cnj <span class="bound">z1</span> <span class="main">+</span> <span class="bound">z2</span><span class="main">*</span>cnj <span class="bound">z2</span><span class="main">)</span> <span class="main">-</span> <span class="bound">z1</span><span class="main">*</span>cnj <span class="bound">z2</span><span class="main">*</span><span class="main">(</span><span class="bound">w1</span><span class="main">*</span>cnj <span class="bound">w1</span> <span class="main">+</span> <span class="bound">w2</span><span class="main">*</span>cnj <span class="bound">w2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?den</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">z1</span> <span class="bound">z2</span> <span class="bound">w1</span> <span class="bound">w2</span><span class="main">.</span> <span class="bound">z1</span><span class="main">*</span>cnj <span class="bound">z2</span><span class="main">*</span>cnj <span class="bound">w1</span><span class="main">*</span><span class="bound">w2</span> <span class="main">-</span> <span class="bound">w1</span><span class="main">*</span>cnj <span class="bound">w2</span><span class="main">*</span>cnj <span class="bound">z1</span><span class="main">*</span><span class="bound">z2</span>"</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="main">(</span>poincare_line_cvec_cmat <span class="skolem">za</span> <span class="skolem">wa</span><span class="main">)</span>
                         <span class="main">(</span>poincare_line_cvec_cmat <span class="skolem">zb</span> <span class="skolem">wb</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
            poincare_line_cvec_cmat <span class="main">(</span><span class="skolem">zb1</span><span class="main">,</span> <span class="skolem">zb2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">wb1</span><span class="main">,</span> <span class="skolem">wb2</span><span class="main">)</span> <span class="main">=</span> cor <span class="bound">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> poincare_line_cvec_cmat <span class="main">(</span><span class="skolem">za1</span><span class="main">,</span> <span class="skolem">za2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">wa1</span><span class="main">,</span> <span class="skolem">wa2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?den</span> <span class="skolem">za1</span> <span class="skolem">za2</span> <span class="skolem">wa1</span> <span class="skolem">wa2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?den</span> <span class="skolem">zb1</span> <span class="skolem">zb2</span> <span class="skolem">wb1</span> <span class="skolem">wb2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> **
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">kz</span> <span class="main">*</span> cnj <span class="skolem">kz</span> <span class="main">*</span> <span class="skolem">kw</span> <span class="main">*</span> cnj <span class="skolem">kw</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> **
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cor <span class="main">(</span>Re <span class="var">?k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?k</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹cor <span class="main">(</span>Re <span class="var">?k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?k</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_real_0<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> arg1<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?den</span> <span class="skolem">zb1</span> <span class="skolem">zb2</span> <span class="skolem">wb1</span> <span class="skolem">wb2</span><span class="main">)</span> <span class="main">=</span> Re <span class="var">?k</span> <span class="main">*</span> Re <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?den</span> <span class="skolem">za1</span> <span class="skolem">za2</span> <span class="skolem">wa1</span> <span class="skolem">wa2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> **<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Re_mult_real<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?k</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> f<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">Re</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">have</span></span> arg2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?nom</span> <span class="skolem">zb1</span> <span class="skolem">zb2</span> <span class="skolem">wb1</span> <span class="skolem">wb2</span> <span class="main">=</span> <span class="var">?k</span> <span class="main">*</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?nom</span> <span class="skolem">za1</span> <span class="skolem">za2</span> <span class="skolem">wa1</span> <span class="skolem">wa2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> **
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mk_poincare_line_cmat <span class="main">(</span>Re <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="var">?den</span> <span class="skolem">zb1</span> <span class="skolem">zb2</span> <span class="skolem">wb1</span> <span class="skolem">wb2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="var">?nom</span> <span class="skolem">zb1</span> <span class="skolem">zb2</span> <span class="skolem">wb1</span> <span class="skolem">wb2</span><span class="main">)</span> <span class="main">=</span>
            cor <span class="main">(</span>Re <span class="var">?k</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> mk_poincare_line_cmat <span class="main">(</span>Re <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="var">?den</span> <span class="skolem">za1</span> <span class="skolem">za2</span> <span class="skolem">wa1</span> <span class="skolem">wa2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">*</span><span class="var">?nom</span> <span class="skolem">za1</span> <span class="skolem">za2</span> <span class="skolem">wa1</span> <span class="skolem">wa2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cor <span class="main">(</span>Re <span class="var">?k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?k</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?k</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> mk_poincare_line_cmat_scale<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> arg1<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> arg2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="quoted"><span class="quoted">‹cor <span class="main">(</span>Re <span class="var">?k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?k</span>›</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den</span> <span class="skolem">za1</span> <span class="skolem">za2</span> <span class="skolem">wa1</span> <span class="skolem">wa2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den</span> <span class="skolem">zb1</span> <span class="skolem">zb2</span> <span class="skolem">wb1</span> <span class="skolem">wb2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹cor <span class="main">(</span>Re <span class="var">?k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?k</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Re <span class="var">?k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?den</span> <span class="skolem">zb1</span> <span class="skolem">zb2</span> <span class="skolem">wb1</span> <span class="skolem">wb2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> **
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">za1</span><span class="main">*</span>cnj <span class="skolem">za2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zb1</span><span class="main">*</span>cnj <span class="skolem">zb2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> **
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">kz</span> <span class="main">*</span> cnj <span class="skolem">kz</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?k</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> **
          <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">za1</span> <span class="main">*</span> cnj <span class="skolem">za2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">zb1</span> <span class="main">*</span> cnj <span class="skolem">zb2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="var">?den</span> <span class="skolem">za1</span> <span class="skolem">za2</span> <span class="skolem">wa1</span> <span class="skolem">wa2</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den</span> <span class="skolem">zb1</span> <span class="skolem">zb2</span> <span class="skolem">wb1</span> <span class="skolem">wb2</span> <span class="main">=</span> <span class="main">0</span>›</span></span> **
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">kz</span> <span class="main">*</span> cnj <span class="skolem">kz</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex.expand<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">zb1</span> <span class="main">*</span> cnj <span class="skolem">zb2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> **
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">wa1</span> <span class="main">*</span> cnj <span class="skolem">wa2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wb1</span><span class="main">*</span>cnj <span class="skolem">wb2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> **
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">kw</span> <span class="main">*</span> cnj <span class="skolem">kw</span>"</span></span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?k</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> **
            <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="skolem">za1</span> <span class="main">*</span> cnj <span class="skolem">za2</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>›</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">wa1</span> <span class="main">*</span> cnj <span class="skolem">wa2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">wb1</span> <span class="main">*</span> cnj <span class="skolem">wb2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="var">?den</span> <span class="skolem">za1</span> <span class="skolem">za2</span> <span class="skolem">wa1</span> <span class="skolem">wa2</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den</span> <span class="skolem">zb1</span> <span class="skolem">zb2</span> <span class="skolem">wb1</span> <span class="skolem">wb2</span> <span class="main">=</span> <span class="main">0</span>›</span></span> **
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">kw</span> <span class="main">*</span> cnj <span class="skolem">kw</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
               <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex.expand<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">wb1</span> <span class="main">*</span> cnj <span class="skolem">wb2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> **
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="skolem">za1</span> <span class="main">*</span> cnj <span class="skolem">za2</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">zb1</span> <span class="main">*</span> cnj <span class="skolem">zb2</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="skolem">wa1</span> <span class="main">*</span> cnj <span class="skolem">wa2</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">wb1</span> <span class="main">*</span> cnj <span class="skolem">wb2</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="var">?den</span> <span class="skolem">za1</span> <span class="skolem">za2</span> <span class="skolem">wa1</span> <span class="skolem">wa2</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den</span> <span class="skolem">zb1</span> <span class="skolem">zb2</span> <span class="skolem">wb1</span> <span class="skolem">wb2</span> <span class="main">=</span> <span class="main">0</span>›</span></span> **
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Correctness of the construction›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For finite points, our definition matches the classic algebraic definition for points in
$\mathbb{C}$ (given in ordinary, not homogenous coordinates).›</span></span>
<span class="keyword1" id="Poincare_Lines-poincare_line_non_homogenous"><span class="command">lemma</span></span> poincare_line_non_homogenous<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> inversion <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">u'</span> <span class="main">=</span> to_complex <span class="free">u</span><span class="main">;</span>  <span class="bound">v'</span> <span class="main">=</span> to_complex <span class="free">v</span><span class="main">;</span>
             <span class="bound">A</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="bound">u'</span> <span class="main">*</span> cnj <span class="bound">v'</span> <span class="main">-</span> <span class="bound">v'</span> <span class="main">*</span> cnj <span class="bound">u'</span><span class="main">)</span><span class="main">;</span>
             <span class="bound">B</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="bound">v'</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>cmod <span class="bound">u'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="bound">u'</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>cmod <span class="bound">v'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
          <span class="keyword1">in</span> poincare_line <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> mk_circline <span class="bound">A</span> <span class="bound">B</span> <span class="main">(</span>cnj <span class="bound">B</span><span class="main">)</span> <span class="bound">A</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> unit_disc_def disc_def inversion_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u1</span> <span class="skolem">u2</span> <span class="skolem">v1</span> <span class="skolem">v2</span>
  <span class="keyword3"><span class="command">assume</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">≠</span> vec_zero"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span> <span class="main">≠</span> vec_zero"</span></span> 
             <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>v</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>            
             <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> conjugate_cvec <span class="main">(</span>reciprocal_cvec <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex_cvec <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex_cvec <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="var">?u</span> <span class="main">*</span> cnj <span class="var">?v</span> <span class="main">-</span> <span class="var">?v</span> <span class="main">*</span> cnj <span class="var">?u</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="var">?v</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>cor <span class="main">(</span>cmod <span class="var">?u</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?u</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>cor <span class="main">(</span>cmod <span class="var">?v</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span>cnj <span class="var">?v</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>cor <span class="main">(</span>cmod <span class="var">?u</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> cnj <span class="var">?u</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>cor <span class="main">(</span>cmod <span class="var">?v</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?D</span></span></span> <span class="main">=</span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?A</span><span class="main">,</span> <span class="var">?B</span><span class="main">,</span> <span class="var">?C</span><span class="main">,</span> <span class="var">?D</span><span class="main">)</span>"</span></span>


  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?den</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span> <span class="main">*</span> cnj <span class="skolem">v1</span> <span class="main">*</span> <span class="skolem">v2</span> <span class="main">-</span> <span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v2</span> <span class="main">*</span> cnj <span class="skolem">u1</span> <span class="main">*</span> <span class="skolem">u2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> uv                                                    
    <span class="keyword1"><span class="command">using</span></span> inf_cvec_z2_zero_iff 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span>cnj <span class="skolem">v2</span><span class="main">,</span> cnj <span class="skolem">v1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> uv<span class="main">(</span>6<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cnj <span class="skolem">v2</span><span class="main">,</span> cnj <span class="skolem">v1</span><span class="main">)</span> <span class="main">≠</span> vec_zero"</span></span>
    <span class="keyword1"><span class="command">using</span></span> uv<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">v1</span> <span class="main">≠</span> <span class="skolem">u2</span> <span class="main">*</span> cnj <span class="skolem">v2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">*</span> <span class="skolem">v2</span> <span class="main">≠</span> <span class="skolem">u2</span> <span class="main">*</span> <span class="skolem">v1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> uv<span class="main">(</span>5<span class="main">)</span> uv<span class="main">(</span>1<span class="main">)</span> uv<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_cvec_eq_mix 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="main">(</span>poincare_line_cvec_cmat <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">)</span>
                         <span class="main">(</span>mk_circline_cmat <span class="var">?A</span> <span class="var">?B</span> <span class="var">?C</span> <span class="var">?D</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nom</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u1</span> <span class="main">+</span> <span class="skolem">u2</span> <span class="main">*</span> cnj <span class="skolem">u2</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v1</span> <span class="main">+</span> <span class="skolem">v2</span> <span class="main">*</span> cnj <span class="skolem">v2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mk_poincare_line_cmat <span class="main">(</span>Re <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?den</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?nom</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="var">?H</span> <span class="var">?H'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u2</span> <span class="main">*</span> cnj <span class="skolem">v2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v2</span> <span class="main">*</span> cnj <span class="skolem">u2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cor <span class="main">(</span>Re <span class="var">?k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?k</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?den</span><span class="main">)</span> <span class="main">=</span> Re <span class="var">?k</span> <span class="main">*</span> <span class="var">?A</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> cnj <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?den</span> <span class="main">=</span>  cnj <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?den</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?den</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cor <span class="main">(</span>Re <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?den</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?den</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cor <span class="main">(</span>Re <span class="var">?k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?k</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?nom</span> <span class="main">=</span> Re <span class="var">?k</span>  <span class="main">*</span> <span class="var">?B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cor <span class="main">(</span>Re <span class="var">?k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u2</span> <span class="main">≠</span>  <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> complex_mult_cnj_cmod<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?k</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹cor <span class="main">(</span>Re <span class="var">?k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?k</span>›</span></span> of_real_0<span class="main">)</span>

      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Re <span class="var">?k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_line_cvec_cmat <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?H'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_line_cvec_cmat_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"hermitean <span class="var">?H'</span> <span class="main">∧</span> <span class="var">?H'</span> <span class="main">≠</span> mat_zero"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mk_poincare_line_cmat_hermitean poincare_line_cvec_cmat_nonzero uv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> uv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="var">?H</span> <span class="main">∧</span> <span class="var">?H</span> <span class="main">≠</span> mat_zero"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹circline_eq_cmat <span class="var">?H</span> <span class="var">?H'</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> circline_eq_cmat_hermitean_nonzero<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?H'</span></span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span><span class="main">]</span> symp_circline_eq_cmat
      <span class="keyword1"><span class="command">unfolding</span></span> symp_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mk_circline_cmat <span class="var">?A</span> <span class="var">?B</span> <span class="var">?C</span> <span class="var">?D</span> <span class="main">=</span> <span class="var">?H</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">ultimately</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="main">(</span>mk_circline_cmat <span class="var">?A</span> <span class="var">?B</span> <span class="var">?C</span> <span class="var">?D</span><span class="main">)</span>
                           <span class="main">(</span>poincare_line_cvec_cmat <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> symp_circline_eq_cmat
      <span class="keyword1"><span class="command">unfolding</span></span> symp_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">u2</span> <span class="main">*</span> cnj <span class="skolem">u2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">v2</span> <span class="main">-</span> <span class="skolem">u1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">v2</span> <span class="main">*</span> cnj <span class="skolem">v2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">u2</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cd</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">v1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">u2</span> <span class="main">*</span> cnj <span class="skolem">u2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> cnj <span class="skolem">v2</span> <span class="main">-</span> cnj <span class="skolem">u1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v1</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">v2</span> <span class="main">*</span> cnj <span class="skolem">v2</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> cnj <span class="skolem">u2</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="var">?d</span> <span class="main">=</span> <span class="var">?cd</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span> <span class="main">/</span> <span class="skolem">v2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cnj <span class="skolem">u1</span> <span class="main">/</span> cnj <span class="skolem">u2</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">/</span> <span class="skolem">u2</span> <span class="main">-</span> <span class="skolem">v1</span> <span class="main">/</span> <span class="skolem">v2</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">=</span> <span class="var">?d1</span> <span class="main">*</span> <span class="var">?d2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?d1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="var">?d1</span> <span class="main">=</span> <span class="var">?d1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> *
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nom</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mk_poincare_line_cmat <span class="main">0</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?nom</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="var">?H</span> <span class="var">?H'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>

        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span><span class="main">)</span> <span class="main">/</span> <span class="var">?d</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?k</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span><span class="main">(</span><span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span><span class="main">)</span> <span class="main">/</span> <span class="var">?d2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u2</span> <span class="main">*</span> cnj <span class="skolem">u2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">*</span><span class="skolem">u2</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">u1</span><span class="main">*</span><span class="skolem">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>

            <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span><span class="main">)</span> <span class="main">/</span> <span class="var">?d2</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="var">?rhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">v1</span> <span class="main">*</span> <span class="skolem">u2</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">u1</span> <span class="main">*</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">v1</span> <span class="main">*</span> <span class="skolem">u2</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">u1</span> <span class="main">*</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span><span class="skolem">u2</span> <span class="main">*</span> cnj <span class="skolem">u2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u2</span> <span class="main">*</span> cnj <span class="skolem">u2</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">ultimately</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>

            <span class="keyword1"><span class="command">ultimately</span></span> 

            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> ** <span class="quoted"><span class="quoted">‹is_real <span class="var">?d1</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_cnj_divide divide_divide_eq_left' eq_cnj_iff_real<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="var">?k</span> <span class="main">=</span> <span class="var">?k</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?k</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?k</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex.expand zero_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span> <span class="main">=</span> <span class="var">?k</span> <span class="main">*</span> <span class="var">?d</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">moreover</span></span>

        <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">u1</span> <span class="main">*</span> <span class="skolem">u2</span> <span class="main">=</span> cnj <span class="var">?k</span> <span class="main">*</span> cnj <span class="var">?d</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_cnj_cnj complex_cnj_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">u1</span> <span class="main">*</span> <span class="skolem">u2</span> <span class="main">=</span> <span class="var">?k</span> <span class="main">*</span> <span class="var">?cd</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cnj <span class="var">?k</span> <span class="main">=</span> <span class="var">?k</span>›</span></span> <span class="quoted"><span class="quoted">‹cnj <span class="var">?d</span> <span class="main">=</span> <span class="var">?cd</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

        <span class="keyword1"><span class="command">ultimately</span></span>

        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">~</span> <span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> complex_mult_cnj_cmod<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">u1</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> complex_mult_cnj_cmod<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">v1</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> complex_mult_cnj_cmod<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">u2</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> complex_mult_cnj_cmod<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">v2</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide norm_mult norm_divide<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Re <span class="var">?k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">moreover</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_line_cvec_cmat <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?H'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> poincare_line_cvec_cmat_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

      <span class="keyword1"><span class="command">moreover</span></span>

      <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"hermitean <span class="var">?H'</span> <span class="main">∧</span> <span class="var">?H'</span> <span class="main">≠</span> mat_zero"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mk_poincare_line_cmat_hermitean poincare_line_cvec_cmat_nonzero uv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> uv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="var">?H</span> <span class="main">∧</span> <span class="var">?H</span> <span class="main">≠</span> mat_zero"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹circline_eq_cmat <span class="var">?H</span> <span class="var">?H'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> circline_eq_cmat_hermitean_nonzero<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?H'</span></span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span><span class="main">]</span> symp_circline_eq_cmat
        <span class="keyword1"><span class="command">unfolding</span></span> symp_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mk_circline_cmat <span class="var">?A</span> <span class="var">?B</span> <span class="var">?C</span> <span class="var">?D</span> <span class="main">=</span> <span class="var">?H</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">ultimately</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="main">(</span>mk_circline_cmat <span class="var">?A</span> <span class="var">?B</span> <span class="var">?C</span> <span class="var">?D</span><span class="main">)</span>
                             <span class="main">(</span>poincare_line_cvec_cmat <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> symp_circline_eq_cmat
        <span class="keyword1"><span class="command">unfolding</span></span> symp_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span>  False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nom</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v2</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"mk_poincare_line_cmat <span class="main">0</span> <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?nom</span><span class="main">)</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="var">?H</span> <span class="var">?H'</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v2</span><span class="main">)</span> <span class="main">/</span> <span class="var">?d</span>"</span></span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?k</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span><span class="main">(</span><span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v2</span><span class="main">)</span> <span class="main">/</span> <span class="var">?d2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v2</span> <span class="main">*</span> cnj <span class="skolem">v2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="skolem">u1</span><span class="main">*</span><span class="skolem">v2</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">u2</span><span class="main">*</span><span class="skolem">v1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>

            <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v2</span><span class="main">)</span> <span class="main">/</span> <span class="var">?d2</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="var">?rhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span><span class="skolem">u1</span> <span class="main">*</span> <span class="skolem">v2</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">u2</span> <span class="main">*</span> <span class="skolem">v1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u1</span> <span class="main">*</span> <span class="skolem">v2</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">u2</span> <span class="main">*</span> <span class="skolem">v1</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span>                            
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span><span class="skolem">v2</span> <span class="main">*</span> cnj <span class="skolem">v2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v2</span> <span class="main">*</span> cnj <span class="skolem">v2</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">ultimately</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>

            <span class="keyword1"><span class="command">ultimately</span></span> 

            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> ** <span class="quoted"><span class="quoted">‹is_real <span class="var">?d1</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_cnj_divide divide_divide_eq_left' eq_cnj_iff_real<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="var">?k</span> <span class="main">=</span> <span class="var">?k</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?k</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?k</span>›</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex.expand zero_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v2</span> <span class="main">=</span> <span class="var">?k</span> <span class="main">*</span> <span class="var">?d</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">moreover</span></span>

        <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">v1</span> <span class="main">*</span> <span class="skolem">v2</span> <span class="main">=</span> cnj <span class="var">?k</span> <span class="main">*</span> cnj <span class="var">?d</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_cnj_cnj complex_cnj_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">v1</span> <span class="main">*</span> <span class="skolem">v2</span> <span class="main">=</span> <span class="var">?k</span> <span class="main">*</span> <span class="var">?cd</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cnj <span class="var">?k</span> <span class="main">=</span> <span class="var">?k</span>›</span></span> <span class="quoted"><span class="quoted">‹cnj <span class="var">?d</span> <span class="main">=</span> <span class="var">?cd</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

        <span class="keyword1"><span class="command">ultimately</span></span>

        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">~</span> <span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?k</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> complex_mult_cnj_cmod<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">u1</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> complex_mult_cnj_cmod<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">v1</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> complex_mult_cnj_cmod<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">u2</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> complex_mult_cnj_cmod<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">v2</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide norm_mult norm_divide<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Re <span class="var">?k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">moreover</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_line_cvec_cmat <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span> <span class="main">=</span> <span class="var">?H'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v1</span> <span class="main">*</span> cnj <span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> poincare_line_cvec_cmat_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

        <span class="keyword1"><span class="command">moreover</span></span>

        <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"hermitean <span class="var">?H'</span> <span class="main">∧</span> <span class="var">?H'</span> <span class="main">≠</span> mat_zero"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mk_poincare_line_cmat_hermitean poincare_line_cvec_cmat_nonzero uv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> uv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="var">?H</span> <span class="main">∧</span> <span class="var">?H</span> <span class="main">≠</span> mat_zero"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹circline_eq_cmat <span class="var">?H</span> <span class="var">?H'</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> circline_eq_cmat_hermitean_nonzero<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?H'</span></span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span><span class="main">]</span> symp_circline_eq_cmat
          <span class="keyword1"><span class="command">unfolding</span></span> symp_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"mk_circline_cmat <span class="var">?A</span> <span class="var">?B</span> <span class="var">?C</span> <span class="var">?D</span> <span class="main">=</span> <span class="var">?H</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">ultimately</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="main">(</span>mk_circline_cmat <span class="var">?A</span> <span class="var">?B</span> <span class="var">?C</span> <span class="var">?D</span><span class="main">)</span>
                               <span class="main">(</span>poincare_line_cvec_cmat <span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> symp_circline_eq_cmat
          <span class="keyword1"><span class="command">unfolding</span></span> symp_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">u1</span> <span class="main">*</span> cnj <span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> uv
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>                    
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Our construction (in homogenous coordinates) always yields an h-line that contain two starting
points (this also holds for all degenerate cases except when points are the same).›</span></span>
<span class="keyword1" id="Poincare_Lines-poincare_line"><span class="command">lemma</span></span> poincare_line <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"on_circline <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span> <span class="free">z</span>"</span></span>
        <span class="quoted"><span class="quoted">"on_circline <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"on_circline <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span> <span class="free">z</span> <span class="main">∧</span> on_circline <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> vz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> vec_zero"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> vec_zero"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="skolem"><span class="skolem">z2</span></span> <span class="skolem"><span class="skolem">w1</span></span> <span class="skolem"><span class="skolem">w2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    zw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z1</span><span class="main">,</span> <span class="skolem">z2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">w1</span><span class="main">,</span> <span class="skolem">w2</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">w</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?den</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span><span class="main">*</span>cnj <span class="skolem">z2</span><span class="main">*</span>cnj <span class="skolem">w1</span><span class="main">*</span><span class="skolem">w2</span> <span class="main">-</span> <span class="skolem">w1</span><span class="main">*</span>cnj <span class="skolem">w2</span><span class="main">*</span>cnj <span class="skolem">z1</span><span class="main">*</span><span class="skolem">z2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"cor <span class="main">(</span>Re <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?den</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?den</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="var">?den</span> <span class="main">=</span> <span class="main">-</span><span class="var">?den</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_imag <span class="var">?den</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq_minus_cnj_iff_imag<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?den</span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?den</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"on_circline_cmat_cvec <span class="main">(</span>poincare_line_cvec_cmat <span class="skolem">z</span> <span class="skolem">w</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">∧</span>
          on_circline_cmat_cvec <span class="main">(</span>poincare_line_cvec_cmat <span class="skolem">z</span> <span class="skolem">w</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_line_cvec_cmat_def mk_poincare_line_cmat_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> zw<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Let_def prod.case
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"on_circline <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"on_circline <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines-poincare_line_circline_set"><span class="command">lemma</span></span> poincare_line_circline_set <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹When the points are different, the constructed line matrix always has a negative determinant›</span></span>
<span class="keyword1" id="Poincare_Lines-poincare_line_type"><span class="command">lemma</span></span> poincare_line_type<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"circline_type <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">b</span> <span class="main">∧</span> <span class="main">{</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">z</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">w</span></span></span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">z</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">w</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> circline_type<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">z</span> <span class="free">w</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> circline_type_pos_card_eq0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">z</span> <span class="free">w</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> circline_type_zero_card_eq1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">z</span> <span class="free">w</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The constructed line is an h-line in the Poincar\'e model (in all cases when the two points are
different)›</span></span>
<span class="keyword1" id="Poincare_Lines-is_poincare_line_poincare_line"><span class="command">lemma</span></span> is_poincare_line_poincare_line <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> poincare_line_type<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main">]</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> vz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> vec_zero"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> vec_zero"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_line_cvec_cmat <span class="skolem">z</span> <span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poincare_line_cvec_cmat <span class="skolem">z</span> <span class="skolem">w</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"circline_type_cmat <span class="main">(</span>poincare_line_cvec_cmat <span class="skolem">z</span> <span class="skolem">w</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="main">(</span>poincare_line_cvec_cmat <span class="skolem">z</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> vz *
    <span class="keyword1"><span class="command">using</span></span> poincare_line_cvec_cmat_hermitean<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_line_cvec_cmat_nonzero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_line_cvec_cmat_AeqD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="skolem">B</span></span> <span class="quoted"><span class="skolem">C</span></span> <span class="quoted"><span class="skolem">D</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> hermitean_elems<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">A</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">D</span></span></span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> cmod_power2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">D</span></span><span class="main">]</span> cmod_power2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">C</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> is_poincare_line_cmat_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> poincare_line_cvec_cmat_def <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_1_neg power2_eq_square<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹When the points are different, the constructed h-line between two points also contains their inverses›</span></span>
<span class="keyword1" id="Poincare_Lines-poincare_line_inversion"><span class="command">lemma</span></span> poincare_line_inversion<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"on_circline <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span>inversion <span class="free">z</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"on_circline <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span> <span class="main">(</span>inversion <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> is_poincare_line_poincare_line<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">≠</span> <span class="free">w</span>›</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> is_poincare_line_inverse_point
  <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹When the points are different, the onstructed h-line between two points contains the inverse of its every point›</span></span>
<span class="keyword1" id="Poincare_Lines-poincare_line_inversion_full"><span class="command">lemma</span></span> poincare_line_inversion_full<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"on_circline <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"on_circline <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>inversion <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_poincare_line_inverse_point<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">u</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> is_poincare_line_poincare_line<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span><span class="main">]</span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Existence of h-lines›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹There is an h-line trough every point in the Poincar\'e model›</span></span>
<span class="keyword1" id="Poincare_Lines-ex_poincare_line_one_point"><span class="command">lemma</span></span> ex_poincare_line_one_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> is_poincare_line <span class="bound">l</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">∈</span> circline_set <span class="bound">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"x_axis"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines-poincare_collinear_singleton"><span class="command">lemma</span></span> poincare_collinear_singleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="free">u</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> ex_poincare_line_one_point<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_collinear_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹There is an h-line trough every two points in the Poincar\'e model›</span></span>
<span class="keyword1" id="Poincare_Lines-ex_poincare_line_two_points"><span class="command">lemma</span></span> ex_poincare_line_two_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">l</span><span class="main">.</span> is_poincare_line <span class="bound">l</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">∈</span> circline_set <span class="bound">l</span> <span class="main">∧</span> <span class="free">w</span> <span class="main">∈</span> circline_set <span class="bound">l</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"poincare_line <span class="free">z</span> <span class="free">w</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1" id="Poincare_Lines-poincare_collinear_doubleton"><span class="command">lemma</span></span> poincare_collinear_doubleton <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> ex_poincare_line_one_point<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> ex_poincare_line_two_points<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_collinear_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Uniqueness of h-lines›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The only h-line between two points is the one obtained by the line-construction.›</span></span> 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First we show this only for two different points inside the disc.›</span></span>
<span class="keyword1" id="Poincare_Lines-unique_poincare_line"><span class="command">lemma</span></span> unique_poincare_line<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> on_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> circline_set <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> circline_set <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> poincare_line <span class="free">u</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> unique_is_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">u</span> <span class="free">v</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The assumption that the points are inside the disc can be relaxed.›</span></span>
<span class="keyword1" id="Poincare_Lines-unique_poincare_line_general"><span class="command">lemma</span></span> unique_poincare_line_general<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> inversion <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> on_l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> circline_set <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> circline_set <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> poincare_line <span class="free">u</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> unique_is_poincare_line_general<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">u</span> <span class="free">v</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The explicit line construction enables us to prove that there exists a unique h-line through any
given two h-points (uniqueness part was already shown earlier).›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹First we show this only for two different points inside the disc.›</span></span>
<span class="keyword1" id="Poincare_Lines-ex1_poincare_line"><span class="command">lemma</span></span> ex1_poincare_line<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">l</span><span class="main">.</span> is_poincare_line <span class="bound">l</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">∈</span> circline_set <span class="bound">l</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∈</span> circline_set <span class="bound">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex1I<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">u</span> <span class="free">v</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="var">?l</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">∈</span> circline_set <span class="var">?l</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∈</span> circline_set <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="skolem">l</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">∈</span> circline_set <span class="skolem">l</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∈</span> circline_set <span class="skolem">l</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> poincare_line <span class="free">u</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unique_poincare_line assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The assumption that the points are in the disc can be relaxed.›</span></span>
<span class="keyword1" id="Poincare_Lines-ex1_poincare_line_general"><span class="command">lemma</span></span> ex1_poincare_line_general<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> inversion <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">l</span><span class="main">.</span> is_poincare_line <span class="bound">l</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">∈</span> circline_set <span class="bound">l</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∈</span> circline_set <span class="bound">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex1I<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">u</span> <span class="free">v</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="var">?l</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">∈</span> circline_set <span class="var">?l</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∈</span> circline_set <span class="var">?l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="skolem">l</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">∈</span> circline_set <span class="skolem">l</span> <span class="main">∧</span> <span class="free">v</span> <span class="main">∈</span> circline_set <span class="skolem">l</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> poincare_line <span class="free">u</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unique_poincare_line_general assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Some consequences of line uniqueness›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹H-line $uv$ is the same as the h-line $vu$.›</span></span>
<span class="keyword1" id="Poincare_Lines-poincare_line_sym"><span class="command">lemma</span></span> poincare_line_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> poincare_line <span class="free">v</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">v</span> <span class="free">u</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Poincare_Lines-poincare_line_sym_general"><span class="command">lemma</span></span> poincare_line_sym_general<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> inversion <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> poincare_line <span class="free">v</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> unique_poincare_line_general<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">v</span> <span class="free">u</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Each h-line is the h-line constructed out of its two arbitrary different points.›</span></span>
<span class="keyword1" id="Poincare_Lines-ex_poincare_line_points"><span class="command">lemma</span></span> ex_poincare_line_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">∧</span> <span class="free">H</span> <span class="main">=</span> poincare_line <span class="bound">u</span> <span class="bound">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> ex_is_poincare_line_points
  <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">H</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If an h-line contains two different points on x-axis/y-axis then it is the x-axis/y-axis.›</span></span>
<span class="keyword1" id="Poincare_Lines-poincare_line_0_real_is_x_axis"><span class="command">lemma</span></span> poincare_line_0_real_is_x_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> circline_set x_axis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">x</span> <span class="main">=</span> x_axis"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> is_poincare_line_0_real_is_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Poincare_Lines-poincare_line_0_imag_is_y_axis"><span class="command">lemma</span></span> poincare_line_0_imag_is_y_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> circline_set y_axis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">y</span> <span class="main">=</span> y_axis"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> is_poincare_line_0_imag_is_y_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Poincare_Lines-poincare_line_x_axis"><span class="command">lemma</span></span> poincare_line_x_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> circline_set x_axis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> circline_set x_axis"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> x_axis"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> unique_poincare_line
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Poincare_Lines-poincare_line_minus_one_one"><span class="command">lemma</span></span> poincare_line_minus_one_one <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="main">(</span>of_complex <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="main">1</span><span class="main">)</span> <span class="main">=</span> x_axis"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="main">(</span>of_complex <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span>  <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="main">1</span><span class="main">)</span> <span class="main">=</span> poincare_line <span class="main">(</span>of_complex <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_poincare_line_poincare_line is_poincare_line_trough_zero_trough_infty not_zero_on_unit_circle of_complex_inj of_complex_one one_neq_neg_one one_on_unit_circle poincare_line_0_real_is_x_axis poincare_line_circline_set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> reciprocal_involution reciprocal_one reciprocal_zero unique_circline_01inf'<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> poincare_line_0_real_is_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Transformations of constructed lines›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Unit dics preserving Möbius transformations preserve the h-line construction›</span></span>
<span class="keyword1" id="Poincare_Lines-unit_disc_fix_preserve_poincare_line"><span class="command">lemma</span></span> unit_disc_fix_preserve_poincare_line <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> moebius_circline <span class="free">M</span> <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> unique_poincare_line<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="free">u</span> <span class="main">≠</span> moebius_pt <span class="free">M</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="free">u</span> <span class="main">∈</span> circline_set <span class="main">(</span>moebius_circline <span class="free">M</span> <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="free">v</span> <span class="main">∈</span> circline_set <span class="main">(</span>moebius_circline <span class="free">M</span> <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
    <span class="keyword1"><span class="command">using</span></span> moebius_circline<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">u</span> <span class="free">v</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unit_circle_fix <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>moebius_circline <span class="free">M</span> <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unit_circle_fix_preserve_is_poincare_line assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2-3<span class="main">)</span> unit_disc_fix_iff<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Conjugate preserve the h-line construction›</span></span>
<span class="keyword1" id="Poincare_Lines-conjugate_preserve_poincare_line"><span class="command">lemma</span></span> conjugate_preserve_poincare_line <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="main">(</span>conjugate <span class="free">u</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="free">v</span><span class="main">)</span> <span class="main">=</span> conjugate_circline <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="free">u</span> <span class="main">≠</span> conjugate <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugate_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="free">u</span> <span class="main">∈</span> circline_set <span class="main">(</span>conjugate_circline <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"conjugate <span class="free">v</span> <span class="main">∈</span> circline_set <span class="main">(</span>conjugate_circline <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>conjugate_circline <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_poincare_line_poincare_line<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"conjugate <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"conjugate_circline <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Collinear points and h-lines›</span></span>

<span class="keyword1" id="Poincare_Lines-poincare_collinear3_poincare_line_general"><span class="command">lemma</span></span> poincare_collinear3_poincare_line_general<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">a1</span><span class="main">,</span> <span class="free">a2</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="main">≠</span> <span class="free">a2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="main">≠</span> inversion <span class="free">a2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">a1</span> <span class="free">a2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> poincare_collinear_def unique_poincare_line_general
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Poincare_Lines-poincare_line_poincare_collinear3_general"><span class="command">lemma</span></span> poincare_line_poincare_collinear3_general<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">a1</span> <span class="free">a2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="main">≠</span> <span class="free">a2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">a1</span><span class="main">,</span> <span class="free">a2</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"poincare_line <span class="free">a1</span> <span class="free">a2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  

<span class="keyword1" id="Poincare_Lines-poincare_collinear3_poincare_lines_equal_general"><span class="command">lemma</span></span> poincare_collinear3_poincare_lines_equal_general<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">a1</span><span class="main">,</span> <span class="free">a2</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">a2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> inversion <span class="free">a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> inversion <span class="free">a2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">a</span> <span class="free">a1</span> <span class="main">=</span> poincare_line <span class="free">a</span> <span class="free">a2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> unique_poincare_line_general<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">a2</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">a</span> <span class="free">a1</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_commute poincare_collinear3_poincare_line_general<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Points collinear with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1" id="Poincare_Lines-poincare_collinear_zero_iff"><span class="command">lemma</span></span> poincare_collinear_zero_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">y'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">z'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">y'</span> <span class="main">≠</span> <span class="free">z'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> of_complex <span class="free">y'</span><span class="main">,</span> of_complex <span class="free">z'</span><span class="main">}</span> <span class="main">⟷</span>
         <span class="free">y'</span><span class="main">*</span>cnj <span class="free">z'</span> <span class="main">=</span> cnj <span class="free">y'</span><span class="main">*</span><span class="free">z'</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">y'</span> <span class="main">≠</span> of_complex <span class="free">z'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> of_complex_inj
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="main">(</span>of_complex <span class="free">y'</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="free">z'</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="free">y'</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">z'</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹of_complex <span class="free">y'</span> <span class="main">≠</span> of_complex <span class="free">z'</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mix</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">y'</span> <span class="main">*</span> cnj <span class="free">z'</span> <span class="main">-</span> cnj <span class="free">y'</span> <span class="main">*</span> <span class="free">z'</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?mix</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?mix</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y'</span> <span class="main">*</span> cnj <span class="free">z'</span> <span class="main">=</span> cnj <span class="free">y'</span> <span class="main">*</span> <span class="free">z'</span> <span class="main">⟷</span> Re <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?mix</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> complex.expand<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?mix</span>"</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_i_not_zero eq_iff_diff_eq_0 mult_eq_0_iff zero_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y'</span> <span class="main">≠</span> <span class="free">z'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Re_complex_of_real Re_mult_real Im_complex_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹of_complex <span class="free">y'</span> <span class="main">≠</span> of_complex <span class="free">z'</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
      <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"poincare_line <span class="main">(</span>of_complex <span class="free">y'</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="free">z'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines-poincare_collinear_zero_polar_form"><span class="command">lemma</span></span> poincare_collinear_zero_polar_form<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> of_complex <span class="free">x</span><span class="main">,</span> of_complex <span class="free">y</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">y</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">φ</span> <span class="bound">rx</span> <span class="bound">ry</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> cor <span class="bound">rx</span> <span class="main">*</span> cis <span class="bound">φ</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">=</span> cor <span class="bound">ry</span> <span class="main">*</span> cis <span class="bound">φ</span> <span class="main">∧</span> <span class="bound">rx</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">ry</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="skolem"><span class="skolem">φ'</span></span> <span class="skolem"><span class="skolem">rx</span></span> <span class="skolem"><span class="skolem">ry</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    polar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> cor <span class="skolem">rx</span> <span class="main">*</span> cis <span class="skolem">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">φ'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">=</span> arg <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ'</span> <span class="main">=</span> arg <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cmod_cis<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rx</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ry</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">y</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">x</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
    <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
    <span class="keyword1"><span class="command">using</span></span> of_complex_zero_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cnj <span class="free">x</span> <span class="main">*</span> <span class="free">y</span> <span class="main">=</span> <span class="free">x</span> <span class="main">*</span> cnj <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cis<span class="main">(</span><span class="skolem">φ'</span> <span class="main">-</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">=</span> cis<span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">φ'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> polar <span class="quoted"><span class="quoted">‹<span class="skolem">rx</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cis_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="skolem">φ'</span> <span class="main">-</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cis_diff_cis_opposite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ'</span> <span class="main">-</span> <span class="skolem">φ</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ'</span> <span class="main">-</span> <span class="skolem">φ</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> pi"</span></span>
    <span class="keyword1"><span class="command">using</span></span> sin_zero_iff_int2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ'</span> <span class="main">-</span> <span class="skolem">φ</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ'</span> <span class="main">=</span> <span class="skolem">φ</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> pi"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"even <span class="skolem">k</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">k'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> evenE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cis <span class="skolem">φ</span> <span class="main">=</span> cis <span class="skolem">φ'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * cos_periodic_int sin_periodic_int
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cis.ctr <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> polar <span class="quoted"><span class="quoted">‹<span class="skolem">rx</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">rx</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ry</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">k'</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> oddE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cis <span class="skolem">φ</span> <span class="main">=</span> <span class="main">-</span> cis <span class="skolem">φ'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * cos_periodic_int sin_periodic_int
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cis.ctr complex_minus <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> polar <span class="quoted"><span class="quoted">‹<span class="skolem">rx</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">rx</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">ry</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Poincare_Lines_Ideal_Points">
<div class="head">
<h1>Theory Poincare_Lines_Ideal_Points</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Poincare_Lines_Ideal_Points
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Poincare_Lines.html">Poincare_Lines</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Ideal points of h-lines›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="comment1">(* TODO: Introduce ideal points for the oriented circline - 
   it would be a list, not a set of two points *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹\emph{Ideal points} of an h-line are points where the h-line intersects the unit disc.›</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Calculation of ideal points›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We decided to define ideal points constructively, i.e., we calculate the coordinates of ideal
points for a given h-line explicitly. Namely, if the h-line is determined by $A$ and $B$, the two
intersection points are $$\frac{B}{|B|^2}\left(-A \pm i\cdot \sqrt{|B|^2 - A^2}\right).$$›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">calc_ideal_point1_cvec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex <span class="main">⇒</span> complex_vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">calc_ideal_point1_cvec</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">discr</span> <span class="main">=</span> Re <span class="main">(</span><span class="main">(</span>cmod <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="keyword1">in</span>
         <span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">*</span>sqrt<span class="main">(</span><span class="bound">discr</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>cmod <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">calc_ideal_point2_cvec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex <span class="main">⇒</span> complex_vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">calc_ideal_point2_cvec</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">discr</span> <span class="main">=</span> Re <span class="main">(</span><span class="main">(</span>cmod <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="keyword1">in</span>
         <span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span>sqrt<span class="main">(</span><span class="bound">discr</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>cmod <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">calc_ideal_points_cmat_cvec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_mat <span class="main">⇒</span> complex_vec set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">calc_ideal_points_cmat_cvec</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">if</span> is_poincare_line_cmat <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="keyword1">then</span>
        <span class="keyword1">let</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">,</span> <span class="bound">C</span><span class="main">,</span> <span class="bound">D</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span>
         <span class="keyword1">in</span> <span class="main">{</span>calc_ideal_point1_cvec <span class="bound">A</span> <span class="bound">B</span><span class="main">,</span> calc_ideal_point2_cvec <span class="bound">A</span> <span class="bound">B</span><span class="main">}</span>
     <span class="keyword1">else</span>
        <span class="main">{</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> calc_ideal_points_clmat_hcoords <span class="main">::</span> <span class="quoted"><span class="quoted">"circline_mat <span class="main">⇒</span> complex_homo_coords set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">calc_ideal_points_cmat_cvec</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> calc_ideal_points <span class="main">::</span> <span class="quoted"><span class="quoted">"circline <span class="main">⇒</span> complex_homo set"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">calc_ideal_points_clmat_hcoords</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H1</span> <span class="skolem">H2</span>
  <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H1</span> <span class="main">∧</span> <span class="skolem">H1</span> <span class="main">≠</span> mat_zero"</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H2</span> <span class="main">∧</span> <span class="skolem">H2</span> <span class="main">≠</span> mat_zero"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A1</span></span> <span class="skolem"><span class="skolem">B1</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">D1</span></span> <span class="skolem"><span class="skolem">A2</span></span> <span class="skolem"><span class="skolem">B2</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="skolem"><span class="skolem">D2</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A1</span><span class="main">,</span> <span class="skolem">B1</span><span class="main">,</span> <span class="skolem">C1</span><span class="main">,</span> <span class="skolem">D1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A2</span><span class="main">,</span> <span class="skolem">B2</span><span class="main">,</span> <span class="skolem">C2</span><span class="main">,</span> <span class="skolem">D2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">H2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="skolem">H1</span> <span class="skolem">H2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H2</span> <span class="main">=</span> cor <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">H1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"rel_set <span class="keyword1">(≈<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="main">(</span>calc_ideal_points_cmat_cvec <span class="skolem">H1</span><span class="main">)</span> <span class="main">(</span>calc_ideal_points_cmat_cvec <span class="skolem">H2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H1</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> k * hermitean_mult_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">H1</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> hh
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square norm_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="main">*</span> cmod <span class="skolem">B1</span> <span class="main">*</span> <span class="main">(</span><span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="main">*</span> cmod <span class="skolem">B1</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">*</span> Re <span class="skolem">D1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> Re <span class="skolem">D1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         <span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="main">*</span> sqrt<span class="main">(</span>cmod <span class="skolem">B1</span> <span class="main">*</span> cmod <span class="skolem">B1</span> <span class="main">-</span> Re <span class="skolem">D1</span> <span class="main">*</span> Re <span class="skolem">D1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="main">*</span> cmod <span class="skolem">B1</span> <span class="main">*</span> <span class="main">(</span><span class="main">¦</span><span class="skolem">k</span><span class="main">¦</span> <span class="main">*</span> cmod <span class="skolem">B1</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">k</span> <span class="main">*</span> Re <span class="skolem">D1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> Re <span class="skolem">D1</span><span class="main">)</span> <span class="main">=</span>
            <span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>cmod <span class="skolem">B1</span> <span class="main">*</span> cmod <span class="skolem">B1</span> <span class="main">-</span> Re <span class="skolem">D1</span> <span class="main">*</span> Re <span class="skolem">D1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_poincare_line_cmat <span class="skolem">H1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_poincare_line_cmat <span class="skolem">H2</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * k
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square rel_set_def norm_mult<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>cor <span class="skolem">k</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> **<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>cor <span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main"><span class="hidden">⇧</span><sup>2</sup></span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> **<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>cor <span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main"><span class="hidden">⇧</span><sup>2</sup></span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> **<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>cor <span class="skolem">k</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> **<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>cor <span class="skolem">k</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> **<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>cor <span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main"><span class="hidden">⇧</span><sup>2</sup></span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> **<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>cor <span class="skolem">k</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> notE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>cor <span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main"><span class="hidden">⇧</span><sup>2</sup></span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> **<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> **<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_poincare_line_cmat <span class="skolem">H2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> k * hermitean_mult_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">H1</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> hh
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square norm_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"rel_set <span class="keyword1">(≈<span class="hidden">⇩</span><sub>v</sub>)</span> <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> <span class="main">{</span><span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rel_set_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_poincare_line_cmat <span class="skolem">H1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> is_poincare_line_cmat <span class="skolem">H2</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Correctness of the calculation›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We show that for every h-line its two calculated ideal points are different and are on the
intersection of that line and the unit circle.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Calculated ideal points are on the unit circle›</span></span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-calc_ideal_point_1_unit"><span class="command">lemma</span></span> calc_ideal_point_1_unit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z1</span><span class="main">,</span> <span class="free">z2</span><span class="main">)</span> <span class="main">=</span> calc_ideal_point1_cvec <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">*</span> cnj <span class="free">z1</span> <span class="main">=</span> <span class="free">z2</span> <span class="main">*</span> cnj <span class="free">z2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?discr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?discr</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_power2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">B</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free">A</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">*</span>sqrt<span class="main">(</span><span class="var">?discr</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> cnj <span class="main">(</span><span class="free">B</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free">A</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">*</span>sqrt<span class="main">(</span><span class="var">?discr</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> cor <span class="main">(</span>abs <span class="var">?discr</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">A</span>›</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?discr</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span><span class="main">]</span> complex_of_real_Re<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹is_real <span class="free">A</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> cnj <span class="main">(</span><span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_cnj_complex_of_real complex_mult_cnj_cmod
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-calc_ideal_point_2_unit"><span class="command">lemma</span></span> calc_ideal_point_2_unit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z1</span><span class="main">,</span> <span class="free">z2</span><span class="main">)</span> <span class="main">=</span> calc_ideal_point2_cvec <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">*</span> cnj <span class="free">z1</span> <span class="main">=</span> <span class="free">z2</span> <span class="main">*</span> cnj <span class="free">z2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?discr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?discr</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_power2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">B</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free">A</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span>sqrt<span class="main">(</span><span class="var">?discr</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> cnj <span class="main">(</span><span class="free">B</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free">A</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span>sqrt<span class="main">(</span><span class="var">?discr</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> cor <span class="main">(</span>abs <span class="var">?discr</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">A</span>›</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?discr</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span><span class="main">]</span> complex_of_real_Re<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹is_real <span class="free">A</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> cnj <span class="main">(</span><span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_cnj_complex_of_real complex_mult_cnj_cmod
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-calc_ideal_points_on_unit_circle"><span class="command">lemma</span></span> calc_ideal_points_on_unit_circle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">z</span> <span class="main">∈</span> calc_ideal_points <span class="free">H</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> circline_set unit_circle"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">H</span> <span class="main">≠</span> mat_zero"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">z1</span><span class="main">,</span> <span class="bound">z2</span><span class="main">)</span> <span class="main">∈</span> calc_ideal_points_cmat_cvec <span class="skolem">H</span><span class="main">.</span> <span class="bound">z1</span> <span class="main">*</span> cnj <span class="bound">z1</span> <span class="main">=</span> <span class="bound">z2</span> <span class="main">*</span> cnj <span class="bound">z2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hermitean_elems<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">A</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">D</span></span></span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> calc_ideal_points_cmat_cvec_def
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_point_1_unit<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="skolem">B</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_point_2_unit<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="skolem">B</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> hh *
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"calc_ideal_point1_cvec <span class="skolem">A</span> <span class="skolem">B</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"calc_ideal_point2_cvec <span class="skolem">A</span> <span class="skolem">B</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> calc_ideal_point1_cvec_def calc_ideal_point2_cvec_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>calc_ideal_points_cmat_cvec <span class="skolem">H</span><span class="main">)</span> <span class="main">(</span>on_circline_cmat_cvec unit_circle_cmat<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> on_circline_cmat_cvec_unit
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> on_circline_cmat_cvec_def calc_ideal_points_cmat_cvec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Calculated ideal points are on the h-line›</span></span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-calc_ideal_point1_sq"><span class="command">lemma</span></span> calc_ideal_point1_sq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z1</span><span class="main">,</span> <span class="free">z2</span><span class="main">)</span> <span class="main">=</span> calc_ideal_point1_cvec <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">*</span> cnj <span class="free">z1</span> <span class="main">+</span> <span class="free">z2</span> <span class="main">*</span> cnj <span class="free">z2</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?discr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?discr</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_power2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">*</span> cnj <span class="free">z1</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">A</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span>sqrt<span class="main">(</span><span class="var">?discr</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free">A</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">*</span>sqrt<span class="main">(</span><span class="var">?discr</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="var">?discr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹is_real <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?discr</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">*</span> cnj <span class="free">z1</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span><span class="main">]</span> complex_of_real_Re<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹is_real <span class="free">A</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_mult_cnj_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z2</span> <span class="main">*</span> cnj <span class="free">z2</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-calc_ideal_point2_sq"><span class="command">lemma</span></span> calc_ideal_point2_sq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z1</span><span class="main">,</span> <span class="free">z2</span><span class="main">)</span> <span class="main">=</span> calc_ideal_point2_cvec <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">*</span> cnj <span class="free">z1</span> <span class="main">+</span> <span class="free">z2</span> <span class="main">*</span> cnj <span class="free">z2</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?discr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?discr</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_power2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">*</span> cnj <span class="free">z1</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span><span class="free">A</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span>sqrt<span class="main">(</span><span class="var">?discr</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="free">A</span> <span class="main">-</span> <span class="keyword1">𝗂</span><span class="main">*</span>sqrt<span class="main">(</span><span class="var">?discr</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="var">?discr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹is_real <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?discr</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">*</span> cnj <span class="free">z1</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span><span class="main">]</span> complex_of_real_Re<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹is_real <span class="free">A</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_mult_cnj_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z2</span> <span class="main">*</span> cnj <span class="free">z2</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-calc_ideal_point1_mix"><span class="command">lemma</span></span> calc_ideal_point1_mix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z1</span><span class="main">,</span> <span class="free">z2</span><span class="main">)</span> <span class="main">=</span> calc_ideal_point1_cvec <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">*</span> cnj <span class="free">z1</span> <span class="main">*</span> <span class="free">z2</span> <span class="main">+</span> cnj <span class="free">B</span> <span class="main">*</span> <span class="free">z1</span> <span class="main">*</span> cnj <span class="free">z2</span> <span class="main">=</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">A</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">*</span>cnj <span class="free">z1</span> <span class="main">+</span> cnj <span class="free">B</span><span class="main">*</span><span class="free">z1</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span><span class="free">A</span><span class="main">*</span><span class="free">B</span><span class="main">*</span>cnj <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="free">z2</span> <span class="main">=</span> <span class="free">z2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">*</span>cnj <span class="free">z1</span><span class="main">*</span><span class="free">z2</span> <span class="main">+</span> cnj <span class="free">B</span><span class="main">*</span><span class="free">z1</span><span class="main">*</span>cnj <span class="free">z2</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span><span class="main">*</span>cnj <span class="free">z1</span> <span class="main">+</span> cnj <span class="free">B</span><span class="main">*</span><span class="free">z1</span><span class="main">)</span><span class="main">*</span><span class="free">z2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">*</span>cnj <span class="free">z1</span><span class="main">*</span><span class="free">z2</span> <span class="main">+</span> cnj <span class="free">B</span><span class="main">*</span><span class="free">z1</span><span class="main">*</span>cnj <span class="free">z2</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span><span class="free">A</span><span class="main">*</span><span class="main">(</span><span class="free">B</span><span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span><span class="main">*</span><span class="free">z2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span><span class="free">A</span><span class="main">*</span><span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> complex_mult_cnj_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-calc_ideal_point2_mix"><span class="command">lemma</span></span> calc_ideal_point2_mix<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z1</span><span class="main">,</span> <span class="free">z2</span><span class="main">)</span> <span class="main">=</span> calc_ideal_point2_cvec <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">*</span> cnj <span class="free">z1</span> <span class="main">*</span> <span class="free">z2</span> <span class="main">+</span> cnj <span class="free">B</span> <span class="main">*</span> <span class="free">z1</span> <span class="main">*</span> cnj <span class="free">z2</span> <span class="main">=</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="free">A</span> <span class="main">*</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> "</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">*</span>cnj <span class="free">z1</span> <span class="main">+</span> cnj <span class="free">B</span><span class="main">*</span><span class="free">z1</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span><span class="free">A</span><span class="main">*</span><span class="free">B</span><span class="main">*</span>cnj <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cnj <span class="free">z2</span> <span class="main">=</span> <span class="free">z2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">*</span>cnj <span class="free">z1</span><span class="main">*</span><span class="free">z2</span> <span class="main">+</span> cnj <span class="free">B</span><span class="main">*</span><span class="free">z1</span><span class="main">*</span>cnj <span class="free">z2</span> <span class="main">=</span> <span class="main">(</span><span class="free">B</span><span class="main">*</span>cnj <span class="free">z1</span> <span class="main">+</span> cnj <span class="free">B</span><span class="main">*</span><span class="free">z1</span><span class="main">)</span><span class="main">*</span><span class="free">z2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">*</span>cnj <span class="free">z1</span><span class="main">*</span><span class="free">z2</span> <span class="main">+</span> cnj <span class="free">B</span><span class="main">*</span><span class="free">z1</span><span class="main">*</span>cnj <span class="free">z2</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span><span class="free">A</span><span class="main">*</span><span class="main">(</span><span class="free">B</span><span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span><span class="main">*</span><span class="free">z2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">-</span><span class="numeral">2</span><span class="main">*</span><span class="free">A</span><span class="main">*</span><span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> complex_mult_cnj_cmod<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-calc_ideal_point1_on_circline"><span class="command">lemma</span></span> calc_ideal_point1_on_circline<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z1</span><span class="main">,</span> <span class="free">z2</span><span class="main">)</span> <span class="main">=</span> calc_ideal_point1_cvec <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">*</span><span class="free">z1</span><span class="main">*</span>cnj <span class="free">z1</span> <span class="main">+</span> <span class="free">B</span><span class="main">*</span>cnj <span class="free">z1</span><span class="main">*</span><span class="free">z2</span> <span class="main">+</span> cnj <span class="free">B</span><span class="main">*</span><span class="free">z1</span><span class="main">*</span>cnj <span class="free">z2</span> <span class="main">+</span> <span class="free">A</span><span class="main">*</span><span class="free">z2</span><span class="main">*</span>cnj <span class="free">z2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="free">A</span> <span class="main">*</span> <span class="main">(</span><span class="free">z1</span> <span class="main">*</span> cnj <span class="free">z1</span> <span class="main">+</span> <span class="free">z2</span> <span class="main">*</span> cnj <span class="free">z2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">z1</span> <span class="main">*</span> <span class="free">z2</span> <span class="main">+</span> cnj <span class="free">B</span> <span class="main">*</span> <span class="free">z1</span> <span class="main">*</span> cnj <span class="free">z2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="free">A</span><span class="main">*</span><span class="main">(</span><span class="free">B</span><span class="main">*</span>cnj <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">2</span><span class="main">*</span><span class="free">A</span><span class="main">*</span><span class="main">(</span><span class="free">B</span><span class="main">*</span>cnj <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_point1_sq<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_point1_mix<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-calc_ideal_point2_on_circline"><span class="command">lemma</span></span> calc_ideal_point2_on_circline<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z1</span><span class="main">,</span> <span class="free">z2</span><span class="main">)</span> <span class="main">=</span> calc_ideal_point2_cvec <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">*</span><span class="free">z1</span><span class="main">*</span>cnj <span class="free">z1</span> <span class="main">+</span> <span class="free">B</span><span class="main">*</span>cnj <span class="free">z1</span><span class="main">*</span><span class="free">z2</span> <span class="main">+</span> cnj <span class="free">B</span><span class="main">*</span><span class="free">z1</span><span class="main">*</span>cnj <span class="free">z2</span> <span class="main">+</span> <span class="free">A</span><span class="main">*</span><span class="free">z2</span><span class="main">*</span>cnj <span class="free">z2</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="free">A</span> <span class="main">*</span> <span class="main">(</span><span class="free">z1</span> <span class="main">*</span> cnj <span class="free">z1</span> <span class="main">+</span> <span class="free">z2</span> <span class="main">*</span> cnj <span class="free">z2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">B</span> <span class="main">*</span> cnj <span class="free">z1</span> <span class="main">*</span> <span class="free">z2</span> <span class="main">+</span> cnj <span class="free">B</span> <span class="main">*</span> <span class="free">z1</span> <span class="main">*</span> cnj <span class="free">z2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="free">A</span><span class="main">*</span><span class="main">(</span><span class="free">B</span><span class="main">*</span>cnj <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="main">-</span><span class="numeral">2</span><span class="main">*</span><span class="free">A</span><span class="main">*</span><span class="main">(</span><span class="free">B</span><span class="main">*</span>cnj <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_point2_sq<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_point2_mix<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-calc_ideal_points_on_circline"><span class="command">lemma</span></span> calc_ideal_points_on_circline<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">z</span> <span class="main">∈</span> calc_ideal_points <span class="free">H</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">H</span> <span class="main">≠</span> mat_zero"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z11</span></span> <span class="skolem"><span class="skolem">z12</span></span> <span class="skolem"><span class="skolem">z21</span></span> <span class="skolem"><span class="skolem">z22</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z11</span><span class="main">,</span> <span class="skolem">z12</span><span class="main">)</span> <span class="main">=</span> calc_ideal_point1_cvec <span class="skolem">A</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z21</span><span class="main">,</span> <span class="skolem">z22</span><span class="main">)</span> <span class="main">=</span> calc_ideal_point2_cvec <span class="skolem">A</span> <span class="skolem">B</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"calc_ideal_point1_cvec <span class="skolem">A</span> <span class="skolem">B</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"calc_ideal_point2_cvec <span class="skolem">A</span> <span class="skolem">B</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">z1</span><span class="main">,</span> <span class="bound">z2</span><span class="main">)</span> <span class="main">∈</span> calc_ideal_points_cmat_cvec <span class="skolem">H</span><span class="main">.</span> <span class="skolem">A</span><span class="main">*</span><span class="bound">z1</span><span class="main">*</span>cnj <span class="bound">z1</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">*</span>cnj <span class="bound">z1</span><span class="main">*</span><span class="bound">z2</span> <span class="main">+</span> <span class="skolem">C</span><span class="main">*</span><span class="bound">z1</span><span class="main">*</span>cnj <span class="bound">z2</span> <span class="main">+</span> <span class="skolem">D</span><span class="main">*</span><span class="bound">z2</span><span class="main">*</span>cnj <span class="bound">z2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * ** hh
    <span class="keyword1"><span class="command">using</span></span> hermitean_elems<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">A</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">D</span></span></span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_point1_on_circline<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z11</span></span> <span class="quoted"><span class="skolem">z12</span></span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="skolem">B</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_point2_on_circline<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z21</span></span> <span class="quoted"><span class="skolem">z22</span></span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="skolem">B</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> calc_ideal_point1_cvec_def calc_ideal_point2_cvec_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Ball <span class="main">(</span>calc_ideal_points_cmat_cvec <span class="skolem">H</span><span class="main">)</span> <span class="main">(</span>on_circline_cmat_cvec <span class="skolem">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> on_circline_cmat_cvec_circline_equation *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> on_circline_cmat_cvec_def calc_ideal_points_cmat_cvec_def <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Calculated ideal points of an h-line are different›</span></span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-calc_ideal_points_cvec_different"><span class="command">lemma</span></span> calc_ideal_points_cvec_different <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>calc_ideal_point1_cvec <span class="free">A</span> <span class="free">B</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> calc_ideal_point2_cvec <span class="free">A</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def<span class="main">)</span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-calc_ideal_points_different"><span class="command">lemma</span></span> calc_ideal_points_different<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">i1</span> <span class="main">∈</span> <span class="main">(</span>calc_ideal_points <span class="free">H</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">i2</span> <span class="main">∈</span> <span class="main">(</span>calc_ideal_points <span class="free">H</span><span class="main">)</span><span class="main">.</span> <span class="bound">i1</span> <span class="main">≠</span> <span class="bound">i2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">H</span> <span class="main">≠</span> mat_zero"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hh hermitean_elems <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i1</span><span class="main">∈</span>calc_ideal_points_cmat_cvec <span class="skolem">H</span><span class="main">.</span> <span class="main">∃</span><span class="bound">i2</span><span class="main">∈</span>calc_ideal_points_cmat_cvec <span class="skolem">H</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">i1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="bound">i2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * hh calc_ideal_points_cvec_different<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="skolem">B</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"calc_ideal_point1_cvec <span class="skolem">A</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"calc_ideal_point2_cvec <span class="skolem">A</span> <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-two_calc_ideal_points"><span class="command">lemma</span></span> two_calc_ideal_points <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>                
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>calc_ideal_points <span class="free">H</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="main">∈</span> calc_ideal_points <span class="free">H</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">y</span> <span class="main">∈</span> calc_ideal_points <span class="free">H</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">z</span> <span class="main">∈</span> calc_ideal_points <span class="free">H</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">∨</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">H</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> calc_ideal_point1_cvec_def calc_ideal_point2_cvec_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"calc_ideal_points <span class="free">H</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_points_different<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Ideal points›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we give a genuine definition of ideal points -- these are the intersections of the h-line with the unit circle›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">ideal_points</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"circline <span class="main">⇒</span> complex_homo set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ideal_points</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> circline_intersection <span class="free"><span class="bound"><span class="entity">H</span></span></span> unit_circle"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Ideal points are on the unit circle and on the h-line›</span></span>
<span class="keyword1" id="Poincare_Lines_Ideal_Points-ideal_points_on_unit_circle"><span class="command">lemma</span></span> ideal_points_on_unit_circle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">z</span> <span class="main">∈</span> ideal_points <span class="free">H</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> circline_set unit_circle"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_points_def circline_intersection_def circline_set_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-ideal_points_on_circline"><span class="command">lemma</span></span> ideal_points_on_circline<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">z</span> <span class="main">∈</span> ideal_points <span class="free">H</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ideal_points_def circline_intersection_def circline_set_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For each h-line there are exactly two ideal points›</span></span>
<span class="keyword1" id="Poincare_Lines_Ideal_Points-two_ideal_points"><span class="command">lemma</span></span> two_ideal_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>ideal_points <span class="free">H</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≠</span> unit_circle"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms not_is_poincare_line_unit_circle
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?int</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"circline_intersection <span class="free">H</span> unit_circle"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">∈</span> <span class="var">?int</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">∈</span> <span class="var">?int</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_points_on_circline<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_points_on_unit_circle<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_points_different<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> circline_intersection_def circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ideal_points_def
    <span class="keyword1"><span class="command">using</span></span> circline_intersection_at_most_2_points<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">H</span> <span class="main">≠</span> unit_circle›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> card_geq_2_iff_contains_2_elems<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?int</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹They are exactly the two points that our calculation finds›</span></span>
<span class="keyword1" id="Poincare_Lines_Ideal_Points-ideal_points_unique"><span class="command">lemma</span></span> ideal_points_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="free">H</span> <span class="main">=</span> calc_ideal_points <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"calc_ideal_points <span class="free">H</span> <span class="main">⊆</span> ideal_points <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_points_on_circline<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_points_on_unit_circle<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> ideal_points_def circline_intersection_def circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≠</span> unit_circle"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_is_poincare_line_unit_circle assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>ideal_points <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> circline_intersection_at_most_2_points<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted">unit_circle</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> ideal_points_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> card_subset_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ideal_points <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"calc_ideal_points <span class="free">H</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> two_calc_ideal_points<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> two_ideal_points<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For each h-line we can obtain two different ideal points›</span></span>
<span class="keyword1" id="Poincare_Lines_Ideal_Points-obtain_ideal_points"><span class="command">lemma</span></span> obtain_ideal_points<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">i1</span> <span class="free">i2</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">≠</span> <span class="free">i2</span>"</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="free">H</span> <span class="main">=</span> <span class="main">{</span><span class="free">i1</span><span class="main">,</span> <span class="free">i2</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> two_ideal_points<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> card_eq_2_iff_doubleton<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ideal_points <span class="free">H</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Ideal points of each h-line constructed from two points in the disc are different than those two points›</span></span>
<span class="keyword1" id="Poincare_Lines_Ideal_Points-ideal_points_different"><span class="command">lemma</span></span> ideal_points_different<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">i1</span><span class="main">,</span> <span class="free">i2</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">≠</span> <span class="free">i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">i1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">i1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">i2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">∈</span> ocircline_set ounit_circle"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i2</span> <span class="main">∈</span> ocircline_set ounit_circle"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> ideal_points_on_unit_circle is_poincare_line_poincare_line
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">i1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">i1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">i2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> disc_inter_ocircline_set<span class="main">[</span><span class="operator">of</span> <span class="quoted">ounit_circle</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> unit_disc_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">≠</span> <span class="free">i2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> doubleton_eq_iff is_poincare_line_poincare_line obtain_ideal_points<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹H-line is uniquely determined by its ideal points›</span></span>
<span class="keyword1" id="Poincare_Lines_Ideal_Points-ideal_points_line_unique"><span class="command">lemma</span></span> ideal_points_line_unique<span class="main">:</span>        
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="free">H</span> <span class="main">=</span> <span class="main">{</span><span class="free">i1</span><span class="main">,</span> <span class="free">i2</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> poincare_line <span class="free">i1</span> <span class="free">i2</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> calc_ideal_points_on_unit_circle circline_set_def ex_poincare_line_points ideal_points_different<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ideal_points_on_circline ideal_points_unique insertI1 insert_commute inversion_unit_circle mem_Collect_eq unique_poincare_line_general<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Ideal points of some special h-lines›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Ideal points of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">x_axis</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1" id="Poincare_Lines_Ideal_Points-ideal_points_x_axis"><span class="command">lemma</span></span> ideal_points_x_axis
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_points x_axis <span class="main">=</span> <span class="main">{</span>of_complex <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> of_complex <span class="main">1</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> ideal_points_unique<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"calc_ideal_points_clmat_hcoords x_axis_clmat <span class="main">=</span> <span class="main">{</span>of_complex_hcoords <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> of_complex_hcoords <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"calc_ideal_points x_axis <span class="main">=</span> <span class="main">{</span>of_complex <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> of_complex <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> calc_ideal_points.abs_eq of_complex.abs_eq x_axis_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Ideal points are proportional vectors only if h-line is a line segment passing trough zero›</span></span>
<span class="keyword1" id="Poincare_Lines_Ideal_Points-ideal_points_proportional"><span class="command">lemma</span></span> ideal_points_proportional<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="free">H</span> <span class="main">=</span> <span class="main">{</span><span class="free">i1</span><span class="main">,</span> <span class="free">i2</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"to_complex <span class="free">i1</span> <span class="main">=</span> cor <span class="free">k</span> <span class="main">*</span> to_complex <span class="free">i2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">≠</span> <span class="free">i2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ideal_points <span class="free">H</span> <span class="main">=</span> <span class="main">{</span><span class="free">i1</span><span class="main">,</span> <span class="free">i2</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_poincare_line <span class="free">H</span>›</span></span> ex_poincare_line_points ideal_points_different<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">∈</span> circline_set unit_circle"</span></span> <span class="quoted"><span class="quoted">"<span class="free">i2</span> <span class="main">∈</span> circline_set unit_circle"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms calc_ideal_points_on_unit_circle ideal_points_unique 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span>cor <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹to_complex <span class="free">i1</span> <span class="main">=</span> cor <span class="free">k</span> <span class="main">*</span> to_complex <span class="free">i2</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> circline_set_unit_circle imageE mem_Collect_eq mult.right_neutral norm_mult to_complex_of_complex unit_circle_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹to_complex <span class="free">i1</span> <span class="main">=</span> cor <span class="free">k</span> <span class="main">*</span> to_complex <span class="free">i2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i1</span> <span class="main">≠</span> <span class="free">i2</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i1</span> <span class="main">∈</span> circline_set unit_circle›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i2</span> <span class="main">∈</span> circline_set unit_circle›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span> mult_cancel_right1 norm_of_real not_inf_on_unit_circle'' of_complex_to_complex of_real_1<span class="main">)</span> 

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i1</span> <span class="main">∈</span> calc_ideal_points <span class="free">H</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">i2</span> <span class="main">∈</span> calc_ideal_points <span class="free">H</span><span class="main">.</span> is_poincare_line <span class="free">H</span> <span class="main">∧</span> <span class="bound">i1</span> <span class="main">≠</span> <span class="bound">i2</span> <span class="main">∧</span> to_complex <span class="bound">i1</span> <span class="main">=</span> <span class="main">-</span> to_complex <span class="bound">i2</span> <span class="main">⟶</span> 
           <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="skolem">B</span> <span class="skolem">C</span> <span class="skolem">D</span> <span class="skolem">i11</span> <span class="skolem">i12</span> <span class="skolem">i21</span> <span class="skolem">i22</span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span><span class="quoted"><span class="quoted">"hermitean <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span> <span class="main">≠</span> mat_zero"</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> line<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i11</span><span class="main">,</span> <span class="skolem">i12</span><span class="main">)</span> <span class="main">∈</span> calc_ideal_points_cmat_cvec <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> i2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i21</span><span class="main">,</span> <span class="skolem">i22</span><span class="main">)</span> <span class="main">∈</span> calc_ideal_points_cmat_cvec <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">i11</span><span class="main">,</span> <span class="skolem">i12</span><span class="main">)</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">i21</span><span class="main">,</span> <span class="skolem">i22</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> opposite<span class="main">:</span> <span class="quoted"><span class="quoted">"to_complex_cvec <span class="main">(</span><span class="skolem">i11</span><span class="main">,</span> <span class="skolem">i12</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> to_complex_cvec <span class="main">(</span><span class="skolem">i21</span><span class="main">,</span> <span class="skolem">i22</span><span class="main">)</span>"</span></span>


    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?discr</span></span></span> <span class="main">=</span>  <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span>cmod <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?den</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">D</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?discr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">D</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?discr</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i11</span> <span class="main">=</span> <span class="var">?i1</span> <span class="main">∨</span> <span class="skolem">i11</span> <span class="main">=</span> <span class="var">?i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i12</span> <span class="main">=</span> <span class="var">?den</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">i21</span> <span class="main">=</span> <span class="var">?i1</span> <span class="main">∨</span> <span class="skolem">i21</span> <span class="main">=</span> <span class="var">?i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i22</span> <span class="main">=</span> <span class="var">?den</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> i1 i2 H line
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i11</span> <span class="main">=</span> <span class="var">?i1</span> <span class="main">∧</span> <span class="skolem">i21</span> <span class="main">=</span> <span class="var">?i2</span> <span class="main">∨</span> <span class="skolem">i11</span> <span class="main">=</span> <span class="var">?i2</span> <span class="main">∧</span> <span class="skolem">i21</span> <span class="main">=</span> <span class="var">?i1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="skolem">i11</span><span class="main">,</span> <span class="skolem">i12</span><span class="main">)</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="main">(</span><span class="skolem">i21</span><span class="main">,</span> <span class="skolem">i22</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> line
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i11</span> <span class="main">=</span> <span class="main">-</span> <span class="skolem">i21</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> opposite <span class="quoted"><span class="quoted">‹<span class="skolem">i12</span> <span class="main">=</span> <span class="var">?den</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i22</span> <span class="main">=</span> <span class="var">?den</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nonzero_neg_divide_eq_eq2<span class="main">)</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i1</span> <span class="main">=</span> <span class="main">-</span> <span class="var">?i2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_inverse<span class="main">)</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"on_circline_cmat_cvec <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>v</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> calc_ideal_points_different ideal_points_unique
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Transformations of ideal points›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Möbius transformations that fix the unit disc when acting on h-lines map their ideal points to ideal points.›</span></span>
<span class="keyword1" id="Poincare_Lines_Ideal_Points-ideal_points_moebius_circline"><span class="command">lemma</span></span> ideal_points_moebius_circline <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"unit_circle_fix <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="main">(</span>moebius_circline <span class="free">M</span> <span class="free">H</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>moebius_pt <span class="free">M</span><span class="main">)</span> <span class="main">`</span> <span class="main">(</span>ideal_points <span class="free">H</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I'</span> <span class="main">=</span> <span class="var">?M</span> <span class="main">`</span> <span class="var">?I</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> obtain_ideal_points<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mi1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">i1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mi2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">i2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mi1</span> <span class="main">∈</span> <span class="var">?M</span> <span class="main">`</span> <span class="main">(</span>circline_set <span class="free">H</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="var">?Mi2</span> <span class="main">∈</span> <span class="var">?M</span> <span class="main">`</span> <span class="main">(</span>circline_set <span class="free">H</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="var">?Mi1</span> <span class="main">∈</span> <span class="var">?M</span> <span class="main">`</span> <span class="main">(</span>circline_set unit_circle<span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="var">?Mi2</span> <span class="main">∈</span> <span class="var">?M</span> <span class="main">`</span> <span class="main">(</span>circline_set unit_circle<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">unfolding</span></span> ideal_points_def circline_intersection_def circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mi1</span> <span class="main">∈</span> <span class="var">?I'</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="var">?Mi2</span> <span class="main">∈</span> <span class="var">?I'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unit_circle_fix_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> ideal_points_def circline_intersection_def circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mem_Collect_eq moebius_circline<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mi1</span> <span class="main">≠</span> <span class="var">?Mi2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_moebius_pt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> *
    <span class="keyword1"><span class="command">using</span></span> moebius_pt_invert <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>moebius_circline <span class="free">M</span> <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms unit_circle_fix_preserve_is_poincare_line
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I'</span> <span class="main">=</span> <span class="main">{</span><span class="var">?Mi1</span><span class="main">,</span> <span class="var">?Mi2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> two_ideal_points<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_circline <span class="free">M</span> <span class="free">H</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> card_eq_2_doubleton<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?I'</span></span></span> <span class="var"><span class="quoted"><span class="var">?Mi1</span></span></span> <span class="var"><span class="quoted"><span class="var">?Mi2</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-ideal_points_poincare_line_moebius"><span class="command">lemma</span></span> ideal_points_poincare_line_moebius <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="free">M</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">i1</span><span class="main">,</span> <span class="free">i2</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="main">(</span>poincare_line <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>moebius_pt <span class="free">M</span> <span class="free">i1</span><span class="main">,</span> moebius_pt <span class="free">M</span> <span class="free">i2</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Conjugation also maps ideal points to ideal points›</span></span>
<span class="keyword1" id="Poincare_Lines_Ideal_Points-ideal_points_conjugate"><span class="command">lemma</span></span> ideal_points_conjugate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="main">(</span>conjugate_circline <span class="free">H</span><span class="main">)</span> <span class="main">=</span> conjugate <span class="main">`</span> <span class="main">(</span>ideal_points <span class="free">H</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I'</span> <span class="main">=</span> <span class="var">?M</span> <span class="main">`</span> <span class="var">?I</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> obtain_ideal_points<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mi1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">i1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mi2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">i2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mi1</span> <span class="main">∈</span> <span class="var">?M</span> <span class="main">`</span> <span class="main">(</span>circline_set <span class="free">H</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="var">?Mi2</span> <span class="main">∈</span> <span class="var">?M</span> <span class="main">`</span> <span class="main">(</span>circline_set <span class="free">H</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="var">?Mi1</span> <span class="main">∈</span> <span class="var">?M</span> <span class="main">`</span> <span class="main">(</span>circline_set unit_circle<span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="var">?Mi2</span> <span class="main">∈</span> <span class="var">?M</span> <span class="main">`</span> <span class="main">(</span>circline_set unit_circle<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">unfolding</span></span> ideal_points_def circline_intersection_def circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>                                   
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mi1</span> <span class="main">∈</span> <span class="var">?I'</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="var">?Mi2</span> <span class="main">∈</span> <span class="var">?I'</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ideal_points_def circline_intersection_def circline_set_def
    <span class="keyword1"><span class="command">using</span></span> circline_set_conjugate_circline circline_set_def conjugate_unit_circle_set 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mi1</span> <span class="main">≠</span> <span class="var">?Mi2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugate_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>conjugate_circline <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?I'</span> <span class="main">=</span> <span class="main">{</span><span class="var">?Mi1</span><span class="main">,</span> <span class="var">?Mi2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> two_ideal_points<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"conjugate_circline <span class="free">H</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> card_eq_2_doubleton<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?I'</span></span></span> <span class="var"><span class="quoted"><span class="var">?Mi1</span></span></span> <span class="var"><span class="quoted"><span class="var">?Mi2</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Ideal_Points-ideal_points_poincare_line_conjugate"><span class="command">lemma</span></span> ideal_points_poincare_line_conjugate <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span><span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">i1</span><span class="main">,</span> <span class="free">i2</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="main">(</span>poincare_line <span class="main">(</span>conjugate <span class="free">u</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>conjugate <span class="free">i1</span><span class="main">,</span> conjugate <span class="free">i2</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Poincare_Distance">
<div class="head">
<h1>Theory Poincare_Distance</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Poincare_Distance
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Poincare_Lines_Ideal_Points.html">Poincare_Lines_Ideal_Points</a> <a href="Hyperbolic_Functions.html">Hyperbolic_Functions</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹H-distance in the Poincar\'e model›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Informally, the \emph{h-distance} between the two h-points is defined as the absolute value of
the logarithm of the cross ratio between those two points and the two ideal points.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Re_cross_ratio</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Re_cross_ratio</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">≡</span> Re <span class="main">(</span>to_complex <span class="main">(</span>cross_ratio <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">calc_poincare_distance</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_homo <span class="main">⇒</span> complex_homo <span class="main">⇒</span> complex_homo <span class="main">⇒</span> complex_homo <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">calc_poincare_distance</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i2</span></span></span> <span class="main">=</span> abs <span class="main">(</span>ln <span class="main">(</span>Re_cross_ratio <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">i1</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">i2</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poincare_distance_pred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_homo <span class="main">⇒</span> complex_homo <span class="main">⇒</span> real <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">poincare_distance_pred</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">⟷</span>
            <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i1</span> <span class="bound">i2</span><span class="main">.</span> ideal_points <span class="main">(</span>poincare_line <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i1</span><span class="main">,</span> <span class="bound">i2</span><span class="main">}</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">=</span> calc_poincare_distance <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="bound">i1</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">i2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poincare_distance</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_homo <span class="main">⇒</span> complex_homo <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poincare_distance</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">d</span><span class="main">.</span> poincare_distance_pred <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="bound">d</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We shown that the described cross-ratio is always finite,
positive real number.›</span></span>
<span class="keyword1" id="Poincare_Distance-distance_cross_ratio_real_positive"><span class="command">lemma</span></span> distance_cross_ratio_real_positive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i1</span> <span class="bound">i2</span><span class="main">.</span> ideal_points <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i1</span><span class="main">,</span> <span class="bound">i2</span><span class="main">}</span> <span class="main">⟶</span> 
                  cross_ratio <span class="free">u</span> <span class="bound">i1</span> <span class="free">v</span> <span class="bound">i2</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∧</span> is_real <span class="main">(</span>to_complex <span class="main">(</span>cross_ratio <span class="free">u</span> <span class="bound">i1</span> <span class="free">v</span> <span class="bound">i2</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> Re_cross_ratio <span class="free">u</span> <span class="bound">i1</span> <span class="free">v</span> <span class="bound">i2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">u</span> <span class="free">v</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_positive_x_axis<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">≠</span> of_complex <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="main">1</span> <span class="main">≠</span> of_complex <span class="skolem">x</span>"</span></span>
        <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> circline_set x_axis"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_complex_inj<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">≠</span> of_complex <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">≠</span> of_complex <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> of_complex_zero_iff zero_neq_neg_one<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> ****<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_inverse eq_iff_diff_eq_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> x_axis"</span></span>
    <span class="keyword1"><span class="command">using</span></span> **
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_line_0_real_is_x_axis<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * ** *** ****
    <span class="keyword1"><span class="command">using</span></span> cross_ratio_not_inf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> cross_ratio_not_inf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> cross_ratio_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> cross_ratio_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_line_0_real_is_x_axis doubleton_eq_iff circline_set_x_axis<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cross_ratio<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Re_complex_div_gt_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> mult_neg_neg<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?Mu</span> <span class="var">?Mv</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i1</span> <span class="skolem">i2</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cross_ratio <span class="skolem">u</span> <span class="skolem">i1</span> <span class="skolem">v</span> <span class="skolem">i2</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_points <span class="main">(</span>poincare_line <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ideal_points_different<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>2-3<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i1</span></span></span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i2</span></span></span></span></span></span></span></span></span></span><span class="main">]</span> ** <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span> <span class="main">∧</span> is_real <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span> <span class="main">∧</span> <span class="var">?cr</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * **
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">i1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">i2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> ideal_points_poincare_line_moebius<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">M</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">u</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">v</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i1</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cr</span> <span class="main">=</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">⟹</span> False"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Next we can show that for every different points from the unit disc there is exactly one number
that satisfies the h-distance predicate.›</span></span>
<span class="keyword1" id="Poincare_Distance-distance_unique"><span class="command">lemma</span></span> distance_unique<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">d</span><span class="main">.</span> poincare_distance_pred <span class="free">u</span> <span class="free">v</span> <span class="bound">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>"</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> obtain_ideal_points<span class="main">[</span><span class="operator">OF</span> is_poincare_line_poincare_line<span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"calc_poincare_distance <span class="free">u</span> <span class="skolem">i1</span> <span class="free">v</span> <span class="skolem">i2</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ex1I<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_distance_pred <span class="free">u</span> <span class="free">v</span> <span class="var">?d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> calc_poincare_distance_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i1'</span> <span class="skolem">i2'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1'</span><span class="main">,</span> <span class="skolem">i2'</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i1'</span> <span class="main">=</span> <span class="skolem">i1</span> <span class="main">∧</span> <span class="skolem">i2'</span> <span class="main">=</span> <span class="skolem">i2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">i1'</span> <span class="main">=</span> <span class="skolem">i2</span> <span class="main">∧</span> <span class="skolem">i2'</span> <span class="main">=</span> <span class="skolem">i1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> doubleton_eq_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i1</span></span> <span class="quoted"><span class="skolem">i2</span></span> <span class="quoted"><span class="skolem">i1'</span></span> <span class="quoted"><span class="skolem">i2'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> all_different<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="skolem">i1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="skolem">i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="skolem">i1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="skolem">i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="skolem">i1'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="skolem">i2'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="skolem">i1'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="skolem">i2'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ideal_points_different<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i1</span></span></span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">i2</span></span></span></span></span></span></span></span></span></span><span class="main">]</span> * ** <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"calc_poincare_distance <span class="free">u</span> <span class="skolem">i1</span> <span class="free">v</span> <span class="skolem">i2</span> <span class="main">=</span> calc_poincare_distance <span class="free">u</span> <span class="skolem">i1'</span> <span class="free">v</span> <span class="skolem">i2'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">u</span> <span class="skolem">i1</span> <span class="free">v</span> <span class="skolem">i2</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">u</span> <span class="skolem">i1'</span> <span class="free">v</span> <span class="skolem">i2'</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span>"</span></span>
             <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?cr'</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="var">?cr'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> False distance_cross_ratio_real_positive<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">]</span> * **
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> **
          <span class="keyword1"><span class="command">using</span></span> cross_ratio_not_zero cross_ratio_not_inf all_different
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">subst</span> cross_ratio_commute_24<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> reciprocal_real<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_div<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poincare_distance_pred <span class="free">u</span> <span class="free">v</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="var">?d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Distance-poincare_distance_satisfies_pred"><span class="command">lemma</span></span> poincare_distance_satisfies_pred <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance_pred <span class="free">u</span> <span class="free">v</span> <span class="main">(</span>poincare_distance <span class="free">u</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> distance_unique<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> theI'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poincare_distance_pred <span class="free">u</span> <span class="free">v</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Poincare_Distance-poincare_distance_I"><span class="command">lemma</span></span> poincare_distance_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">i1</span><span class="main">,</span> <span class="free">i2</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> calc_poincare_distance <span class="free">u</span> <span class="free">i1</span> <span class="free">v</span> <span class="free">i2</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> poincare_distance_satisfies_pred<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Poincare_Distance-poincare_distance_refl"><span class="command">lemma</span></span> poincare_distance_refl <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">u</span> <span class="free">u</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> poincare_distance_satisfies_pred<span class="main">[</span><span class="operator">OF</span> assms assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Unit disc preserving Möbius transformations preserve h-distance. ›</span></span>
<span class="keyword1" id="Poincare_Distance-unit_disc_fix_preserve_poincare_distance"><span class="command">lemma</span></span> unit_disc_fix_preserve_poincare_distance <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="free">u</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_iff<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_points <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> obtain_ideal_points<span class="main"><span class="main">[</span></span><span class="operator">OF</span> is_poincare_line_poincare_line<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mi1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="skolem">i1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mi2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="skolem">i2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Mu</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mv</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Mu</span> <span class="main">≠</span> <span class="var">?Mv</span>"</span></span>   
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> calc_poincare_distance <span class="free">u</span> <span class="skolem">i1</span> <span class="free">v</span> <span class="skolem">i2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_I<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span> *<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unit_circle_fix <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> ++<span class="main">:</span> <span class="quoted"><span class="quoted">"ideal_points <span class="main">(</span>poincare_line <span class="var">?Mu</span> <span class="var">?Mv</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="var">?Mi1</span><span class="main">,</span> <span class="var">?Mi2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span> assms *
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="var">?Mu</span> <span class="var">?Mv</span> <span class="main">=</span> calc_poincare_distance <span class="var">?Mu</span> <span class="var">?Mi1</span> <span class="var">?Mv</span> <span class="var">?Mi2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> poincare_distance_I<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ** *** ++<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"calc_poincare_distance <span class="var">?Mu</span> <span class="var">?Mi1</span> <span class="var">?Mv</span> <span class="var">?Mi2</span> <span class="main">=</span> calc_poincare_distance <span class="free">u</span> <span class="skolem">i1</span> <span class="free">v</span> <span class="skolem">i2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ideal_points_different<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span></span></span>2-3<span class="main"><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free"><span class="free"><span class="free">u</span></span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main"><span class="main">≠</span></span></span></span></span> <span class="free"><span class="free"><span class="free"><span class="free"><span class="free">v</span></span></span></span></span>›</span></span></span></span></span></span> *<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> calc_poincare_distance_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> moebius_preserve_cross_ratio<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Knowing ideal points for x-axis, we can easily explicitly calculate distances.›</span></span>
<span class="keyword1" id="Poincare_Distance-poincare_distance_x_axis_x_axis"><span class="command">lemma</span></span> poincare_distance_x_axis_x_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> circline_set x_axis"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> circline_set x_axis"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">x</span> <span class="free">y</span> <span class="main">=</span>
            <span class="main">(</span><span class="keyword1">let</span> <span class="bound">x'</span> <span class="main">=</span> to_complex <span class="free">x</span><span class="main">;</span> <span class="bound">y'</span> <span class="main">=</span> to_complex <span class="free">y</span>
              <span class="keyword1">in</span> abs <span class="main">(</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">y'</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">y'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> of_complex <span class="skolem">x'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> of_complex <span class="skolem">y'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">∈</span> unit_disc›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">x'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">y'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">∈</span> unit_disc›</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> unit_disc_iff_cmod_lt_1<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">≠</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">y'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> **
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.left_cancel add_neg_numeral_special<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1-2<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> unit_disc_iff_cmod_lt_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"to_complex <span class="free">x</span>"</span></span><span class="main">]</span> * ** <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">+</span> <span class="skolem">y'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> x_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_line_x_axis<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="main">(</span>poincare_line <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>of_complex <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> of_complex <span class="main">1</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> calc_poincare_distance <span class="free">x</span> <span class="main">(</span>of_complex <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span> <span class="main">(</span>of_complex <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_distance_I assms <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> abs <span class="main">(</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">x'</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x'</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y'</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹cmod <span class="skolem">x'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">y'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.commute minus_diff_eq minus_divide_divide mult_minus_left mult_minus_right to_complex_of_complex<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Distance-poincare_distance_zero_x_axis"><span class="command">lemma</span></span> poincare_distance_zero_x_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> circline_set x_axis"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">x'</span> <span class="main">=</span> to_complex <span class="free">x</span> <span class="keyword1">in</span> abs <span class="main">(</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> poincare_distance_x_axis_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

<span class="keyword1" id="Poincare_Distance-poincare_distance_zero"><span class="command">lemma</span></span> poincare_distance_zero<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">x'</span> <span class="main">=</span> to_complex <span class="free">x</span> <span class="keyword1">in</span> abs <span class="main">(</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> cmod <span class="bound">x'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> cmod <span class="bound">x'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">x</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_rotation_to_positive_x_axis<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">φ</span> <span class="skolem">u</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>moebius_pt <span class="main">(</span>moebius_rotation <span class="skolem">φ</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_preserve_poincare_distance<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_rotation <span class="skolem">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_distance_zero_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_x_axis cmod_eq_Re complex_is_Real_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Distance-poincare_distance_zero_opposite"><span class="command">lemma</span></span> poincare_distance_zero_opposite <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="main">(</span><span class="main">-</span> <span class="free">z</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="main">-</span><span class="free">z</span><span class="main">)</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_zero<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_zero<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Distance explicit formula›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Instead of the h-distance itself, very frequently its hyperbolic cosine is analyzed.›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">cosh_dist</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> cosh <span class="main">(</span>poincare_distance <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Poincare_Distance-cosh_poincare_distance_cross_ratio_average"><span class="command">lemma</span></span> cosh_poincare_distance_cross_ratio_average<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">i1</span><span class="main">,</span> <span class="free">i2</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">u</span> <span class="free">v</span> <span class="main">=</span>
           <span class="main">(</span><span class="main">(</span>Re_cross_ratio <span class="free">u</span> <span class="free">i1</span> <span class="free">v</span> <span class="free">i2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Re_cross_ratio <span class="free">v</span> <span class="free">i1</span> <span class="free">u</span> <span class="free">i2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">u</span> <span class="free">i1</span> <span class="free">v</span> <span class="free">i2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?crRe</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cr</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?crRe</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> distance_cross_ratio_real_positive<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span><span class="main">]</span> assms<span class="main">(</span>4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cr</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">u</span> <span class="free">i1</span> <span class="free">v</span> <span class="free">i2</span> <span class="main">=</span> of_complex <span class="skolem">cr</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cr</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">cr</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">cr</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">u</span> <span class="free">i1</span> <span class="free">v</span> <span class="free">i2</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> to_complex_of_complex zero_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">using</span></span> assms cross_ratio_commute_13<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">i1</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">i2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_I<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> calc_poincare_distance_def cosh_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">cr</span> <span class="main">≥</span> <span class="main">1</span>"</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_div<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span> exp_minus <span class="dynamic"><span class="dynamic">field_simps</span></span> Re_divide power2_eq_square complex.expand<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poincare_distance_formula'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">poincare_distance_formula'</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>cmod <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="free"><span class="bound"><span class="entity">u</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Next we show that the following formula expresses h-distance between any two h-points (note
that the ideal points do not figure anymore).›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poincare_distance_formula</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">poincare_distance_formula</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> arcosh <span class="main">(</span>poincare_distance_formula' <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Poincare_Distance-blaschke_preserve_distance_formula"><span class="command">lemma</span></span> blaschke_preserve_distance_formula <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">k</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance_formula <span class="main">(</span>to_complex <span class="main">(</span>moebius_pt <span class="main">(</span>blaschke <span class="free">k</span><span class="main">)</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_complex <span class="main">(</span>moebius_pt <span class="main">(</span>blaschke <span class="free">k</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         poincare_distance_formula <span class="main">(</span>to_complex <span class="free">u</span><span class="main">)</span> <span class="main">(</span>to_complex <span class="free">v</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">=</span> to_complex <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">=</span> to_complex <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">u'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">v'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="free">k</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms *
    <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nu</span></span> <span class="skolem"><span class="skolem">du</span></span> <span class="skolem"><span class="skolem">nv</span></span> <span class="skolem"><span class="skolem">dv</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">kk</span></span> <span class="skolem"><span class="skolem">ddu</span></span> <span class="skolem"><span class="skolem">ddv</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nu</span> <span class="main">=</span> <span class="skolem">u'</span> <span class="main">-</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">du</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> cnj <span class="free">k</span> <span class="main">*</span><span class="skolem">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">=</span> <span class="skolem">v'</span> <span class="main">-</span> <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dv</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> cnj <span class="free">k</span> <span class="main">*</span> <span class="skolem">v'</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> <span class="skolem">u'</span> <span class="main">-</span> <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ddu</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">u'</span><span class="main">*</span>cnj <span class="skolem">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ddv</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="skolem">v'</span><span class="main">*</span>cnj <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kk</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="free">k</span><span class="main">*</span>cnj <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">nu</span><span class="main">*</span><span class="skolem">dv</span> <span class="main">-</span> <span class="skolem">nv</span><span class="main">*</span><span class="skolem">du</span> <span class="main">=</span> <span class="skolem">d</span><span class="main">*</span><span class="skolem">kk</span>"</span></span>                          
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> **<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ddu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">du</span><span class="main">*</span>cnj <span class="skolem">du</span> <span class="main">-</span> <span class="skolem">nu</span><span class="main">*</span>cnj <span class="skolem">nu</span> <span class="main">=</span> <span class="skolem">ddu</span><span class="main">*</span><span class="skolem">kk</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> **<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ddv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">dv</span><span class="main">*</span>cnj <span class="skolem">dv</span> <span class="main">-</span> <span class="skolem">nv</span><span class="main">*</span>cnj <span class="skolem">nv</span> <span class="main">=</span> <span class="skolem">ddv</span><span class="main">*</span><span class="skolem">kk</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> **<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">du</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">1</span> <span class="main">-</span> cnj <span class="free">k</span> <span class="main">*</span> <span class="skolem">u'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">du</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> cnj <span class="free">k</span> <span class="main">*</span> <span class="skolem">u'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span>cnj <span class="free">k</span> <span class="main">*</span> <span class="skolem">u'</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="free">k</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">u'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cmod <span class="free">k</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">u'</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dv</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">1</span> <span class="main">-</span> cnj <span class="free">k</span> <span class="main">*</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">dv</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> cnj <span class="free">k</span> <span class="main">*</span> <span class="skolem">v'</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span>cnj <span class="free">k</span> <span class="main">*</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="free">k</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">v'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cmod <span class="free">k</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">kk</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">k</span> <span class="main">*</span> cnj <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">kk</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="free">k</span> <span class="main">*</span> cnj <span class="free">k</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">k</span> <span class="main">*</span> cnj <span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="free">k</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cmod <span class="free">k</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"cmod <span class="free">k</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> complex_mod_sqrt_Re_mult_cnj <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">note</span></span> nz <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">du</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">dv</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">kk</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>


  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">nu</span> <span class="main">/</span> <span class="skolem">du</span> <span class="main">-</span> <span class="skolem">nv</span> <span class="main">/</span> <span class="skolem">dv</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">nu</span><span class="main">*</span><span class="skolem">dv</span> <span class="main">-</span> <span class="skolem">nv</span><span class="main">*</span><span class="skolem">du</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span> <span class="main">*</span> <span class="skolem">dv</span><span class="main">)</span>"</span></span>              
    <span class="keyword1"><span class="command">using</span></span> nz
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>                               
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="skolem">nu</span><span class="main">/</span><span class="skolem">du</span> <span class="main">-</span> <span class="skolem">nv</span><span class="main">/</span><span class="skolem">dv</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> cmod <span class="main">(</span><span class="main">(</span><span class="skolem">d</span><span class="main">*</span><span class="skolem">kk</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span><span class="main">*</span><span class="skolem">dv</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cnj <span class="main">(</span><span class="main">(</span><span class="skolem">d</span><span class="main">*</span><span class="skolem">kk</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span><span class="main">*</span><span class="skolem">dv</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> complex_mod_mult_cnj<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> d<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cmod <span class="main">(</span><span class="main">(</span><span class="skolem">d</span><span class="main">*</span>cnj <span class="skolem">d</span><span class="main">*</span><span class="skolem">kk</span><span class="main">*</span><span class="skolem">kk</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span><span class="main">*</span>cnj <span class="skolem">du</span><span class="main">*</span><span class="skolem">dv</span><span class="main">*</span>cnj <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> norm_mult norm_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> cmod <span class="main">(</span><span class="main">(</span><span class="skolem">d</span><span class="main">*</span>cnj <span class="skolem">d</span><span class="main">*</span><span class="skolem">kk</span><span class="main">*</span><span class="skolem">kk</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span><span class="main">*</span>cnj <span class="skolem">du</span><span class="main">*</span><span class="skolem">dv</span><span class="main">*</span>cnj <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>                                                                           

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>cmod <span class="skolem">nu</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>cmod <span class="skolem">du</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>cmod <span class="skolem">nv</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>cmod <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span>
        <span class="main">(</span><span class="main">1</span> <span class="main">-</span> cmod<span class="main">(</span><span class="main">(</span><span class="skolem">nu</span> <span class="main">*</span> cnj <span class="skolem">nu</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span> <span class="main">*</span> cnj <span class="skolem">du</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> cmod<span class="main">(</span><span class="main">(</span><span class="skolem">nv</span> <span class="main">*</span> cnj <span class="skolem">nv</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">dv</span> <span class="main">*</span> cnj <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> norm_divide complex_mod_mult_cnj power_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cmod<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">du</span><span class="main">*</span>cnj <span class="skolem">du</span> <span class="main">-</span> <span class="skolem">nu</span><span class="main">*</span>cnj <span class="skolem">nu</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span> <span class="main">*</span> cnj <span class="skolem">du</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">dv</span><span class="main">*</span>cnj <span class="skolem">dv</span> <span class="main">-</span> <span class="skolem">nv</span><span class="main">*</span>cnj <span class="skolem">nv</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">dv</span> <span class="main">*</span> cnj <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">/</span> cnj <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">/</span> cnj <span class="free">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">u'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">v'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="free">k</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False norm_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="free">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="free">k</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">nu</span><span class="main">/</span><span class="skolem">du</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">nv</span><span class="main">/</span><span class="skolem">dv</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> **<span class="main">(</span>1-4<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_discI<span class="main">[</span><span class="operator">OF</span> blaschke_unit_disc_fix<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹cmod <span class="free">k</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> unit_disc›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u'</span> <span class="main">=</span> to_complex <span class="free">u</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_discI<span class="main">[</span><span class="operator">OF</span> blaschke_unit_disc_fix<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹cmod <span class="free">k</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> unit_disc›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">=</span> to_complex <span class="free">v</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> unit_disc›</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> unit_disc›</span></span>
      <span class="keyword1"><span class="command">using</span></span> moebius_pt_blaschke<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="skolem">u'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> moebius_pt_blaschke<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="skolem">nu</span><span class="main">/</span><span class="skolem">du</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="skolem">nv</span><span class="main">/</span><span class="skolem">dv</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">nu</span> <span class="main">*</span> cnj <span class="skolem">nu</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span> <span class="main">*</span> cnj <span class="skolem">du</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>  <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">nv</span> <span class="main">*</span> cnj <span class="skolem">nv</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">dv</span> <span class="main">*</span> cnj <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_mod_mult_cnj norm_divide power_divide<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span><span class="skolem">nu</span> <span class="main">*</span> cnj <span class="skolem">nu</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span> <span class="main">*</span> cnj <span class="skolem">du</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span><span class="skolem">nv</span> <span class="main">*</span> cnj <span class="skolem">nv</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">dv</span> <span class="main">*</span> cnj <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">nu</span> <span class="main">*</span> cnj <span class="skolem">nu</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span> <span class="main">*</span> cnj <span class="skolem">du</span><span class="main">)</span>"</span></span><span class="main">]</span>      
      <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">nv</span> <span class="main">*</span> cnj <span class="skolem">nv</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">dv</span> <span class="main">*</span> cnj <span class="skolem">dv</span><span class="main">)</span>"</span></span><span class="main">]</span>      
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>          
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">nu</span> <span class="main">*</span> cnj <span class="skolem">nu</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span> <span class="main">*</span> cnj <span class="skolem">du</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>  <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">nv</span> <span class="main">*</span> cnj <span class="skolem">nv</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">dv</span> <span class="main">*</span> cnj <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">du</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">dv</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> complex_mult_cnj_cmod
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">ultimately</span></span>                           
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> cmod <span class="main">(</span><span class="skolem">nu</span> <span class="main">*</span> cnj <span class="skolem">nu</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span> <span class="main">*</span> cnj <span class="skolem">du</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cmod <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">nu</span> <span class="main">*</span> cnj <span class="skolem">nu</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span> <span class="main">*</span> cnj <span class="skolem">du</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> cmod <span class="main">(</span><span class="skolem">nv</span> <span class="main">*</span> cnj <span class="skolem">nv</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">dv</span> <span class="main">*</span> cnj <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cmod <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">nv</span> <span class="main">*</span> cnj <span class="skolem">nv</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">dv</span> <span class="main">*</span> cnj <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span>"</span></span>     
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> nz
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_divide_distrib norm_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>    
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cmod<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">ddu</span> <span class="main">*</span> <span class="skolem">kk</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span> <span class="main">*</span> cnj <span class="skolem">du</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ddv</span> <span class="main">*</span> <span class="skolem">kk</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">dv</span> <span class="main">*</span> cnj <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ddu<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> ddv<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cmod<span class="main">(</span><span class="main">(</span><span class="skolem">ddu</span><span class="main">*</span><span class="skolem">ddv</span><span class="main">*</span><span class="skolem">kk</span><span class="main">*</span><span class="skolem">kk</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span><span class="main">*</span>cnj <span class="skolem">du</span><span class="main">*</span><span class="skolem">dv</span><span class="main">*</span>cnj <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">=</span> cmod<span class="main">(</span><span class="main">(</span><span class="skolem">ddu</span><span class="main">*</span><span class="skolem">ddv</span><span class="main">*</span><span class="skolem">kk</span><span class="main">*</span><span class="skolem">kk</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span><span class="main">*</span>cnj <span class="skolem">du</span><span class="main">*</span><span class="skolem">dv</span><span class="main">*</span>cnj <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">/</span> <span class="var">?rhs</span> <span class="main">=</span>
       cmod <span class="main">(</span><span class="main">(</span><span class="skolem">d</span><span class="main">*</span>cnj <span class="skolem">d</span><span class="main">*</span><span class="skolem">kk</span><span class="main">*</span><span class="skolem">kk</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span><span class="main">*</span>cnj <span class="skolem">du</span><span class="main">*</span><span class="skolem">dv</span><span class="main">*</span>cnj <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> cmod<span class="main">(</span><span class="main">(</span><span class="skolem">ddu</span><span class="main">*</span><span class="skolem">ddv</span><span class="main">*</span><span class="skolem">kk</span><span class="main">*</span><span class="skolem">kk</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="skolem">du</span><span class="main">*</span>cnj <span class="skolem">du</span><span class="main">*</span><span class="skolem">dv</span><span class="main">*</span>cnj <span class="skolem">dv</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> 2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> cmod <span class="main">(</span><span class="main">(</span><span class="skolem">d</span><span class="main">*</span>cnj <span class="skolem">d</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">ddu</span><span class="main">*</span><span class="skolem">ddv</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nz <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult norm_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>cmod <span class="skolem">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">u'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">v'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="skolem">u'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="skolem">v'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">u'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">v'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">u'</span> <span class="main">*</span> cnj <span class="skolem">u'</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">u'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">v'</span> <span class="main">*</span> cnj <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">v'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re cmod_power2 power2_eq_square<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> nz
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"**"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"**"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> norm_divide norm_mult power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">/</span> <span class="var">?rhs</span> <span class="main">=</span> <span class="main">(</span>cmod <span class="skolem">d</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">u'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">v'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="free">k</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">/</span> cnj <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≠</span> <span class="main">1</span> <span class="main">/</span> cnj <span class="free">k</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="free">k</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> unit_disc›</span></span> * <span class="quoted"><span class="quoted">‹<span class="free">k</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> ** <span class="quoted"><span class="quoted">‹<span class="skolem">kk</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> nz
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> * ** 3
    <span class="keyword1"><span class="command">using</span></span> moebius_pt_blaschke<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="skolem">u'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> moebius_pt_blaschke<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">k</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_divide<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹To prove the equivalence between the h-distance definition and the distance formula, we shall
employ the without loss of generality principle. Therefore, we must show that the distance formula
is preserved by h-isometries.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Rotation preserve <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">poincare_distance_formula</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1" id="Poincare_Distance-rotation_preserve_distance_formula"><span class="command">lemma</span></span> rotation_preserve_distance_formula <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance_formula <span class="main">(</span>to_complex <span class="main">(</span>moebius_pt <span class="main">(</span>moebius_rotation <span class="free">φ</span><span class="main">)</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_complex <span class="main">(</span>moebius_pt <span class="main">(</span>moebius_rotation <span class="free">φ</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         poincare_distance_formula <span class="main">(</span>to_complex <span class="free">u</span><span class="main">)</span> <span class="main">(</span>to_complex <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Unit disc fixing Möbius preserve <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">poincare_distance_formula</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1" id="Poincare_Distance-unit_disc_fix_preserve_distance_formula"><span class="command">lemma</span></span> unit_disc_fix_preserve_distance_formula <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance_formula <span class="main">(</span>to_complex <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">u</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>to_complex <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
         poincare_distance_formula <span class="main">(</span>to_complex <span class="free">u</span><span class="main">)</span> <span class="main">(</span>to_complex <span class="free">v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="free">u</span> <span class="free">v</span> <span class="free">M</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">u</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="var">?P'</span> <span class="bound">u</span> <span class="bound">v</span> <span class="free">M</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">M</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_unit_disc_fix<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">k</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>blaschke <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> blaschke_preserve_distance_formula
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">φ</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>moebius_rotation <span class="skolem">φ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rotation_preserve_distance_formula
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M1</span> <span class="skolem">M2</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">M1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">M2</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> u11<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M1</span>"</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M2</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span><span class="skolem">M1</span> <span class="main">+</span> <span class="skolem">M2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> poincare_distance_formula_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The equivalence between the two h-distance representations.›</span></span>
<span class="keyword1" id="Poincare_Distance-poincare_distance_formula"><span class="command">lemma</span></span> poincare_distance_formula<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> poincare_distance_formula <span class="main">(</span>to_complex <span class="free">u</span><span class="main">)</span> <span class="main">(</span>to_complex <span class="free">v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">u</span> <span class="free">v</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_x_axis<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span>  <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> circline_set x_axis"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * cmod_eq_Re
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_x_axis<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">¦</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_distance_zero_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">=</span> <span class="main">¦</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> divide_nonneg_nonneg norm_ge_zero power_le_one zero_le_power2<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> arcosh_real_gt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="var">?x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">=</span> arcosh <span class="var">?x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ln <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> norm_not_less_zero one_power2 power2_eq_imp_eq power_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>       
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main">)</span>
          <span class="keyword1"><span class="command">unfolding</span></span> power_divide
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> divide_diff_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> arcosh_real_def<span class="main"><span class="main">[</span></span><span class="operator">OF</span> arcosh_real_gt<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> real_sqrt_divide<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> real_sqrt_mult<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ln <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add_divide_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ln <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> cmod <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>      
        <span class="keyword1"><span class="command">using</span></span> square_diff_square_factored<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">x</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">¦</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> complex_is_Real_iff
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> <span class="main">-</span> ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ln_div<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span> * <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_is_Real_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> cmod <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> cmod <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ln <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> Re <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> cmod_eq_Re <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> Re <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Re_divide_real eq_iff_diff_eq_0 minus_complex.simps one_complex.simps plus_complex.simps<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">finally</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>1-3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> poincare_distance_formula_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Some additional properties proved easily using the distance formula.›</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">poincare_distance</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is symmetric.›</span></span>
<span class="keyword1" id="Poincare_Distance-poincare_distance_sym"><span class="command">lemma</span></span> poincare_distance_sym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> poincare_distance <span class="free">v</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute norm_minus_commute<span class="main">)</span>

<span class="keyword1" id="Poincare_Distance-poincare_distance_formula'_ge_1"><span class="command">lemma</span></span> poincare_distance_formula'_ge_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> poincare_distance_formula' <span class="main">(</span>to_complex <span class="free">u</span><span class="main">)</span> <span class="main">(</span>to_complex <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> unit_disc_cmod_square_lt_1<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> unit_disc_cmod_square_lt_1<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">poincare_distance</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is non-negative.›</span></span>
<span class="keyword1" id="Poincare_Distance-poincare_distance_ge0"><span class="command">lemma</span></span> poincare_distance_ge0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">u</span> <span class="free">v</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula'_ge_1
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula_def
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula'_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> arcosh_ge_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1" id="Poincare_Distance-cosh_dist"><span class="command">lemma</span></span> cosh_dist<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh_dist <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> poincare_distance_formula' <span class="main">(</span>to_complex <span class="free">u</span><span class="main">)</span> <span class="main">(</span>to_complex <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> poincare_distance_formula'_ge_1<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">poincare_distance</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>  is zero only if the two points are equal.›</span></span>
<span class="keyword1" id="Poincare_Distance-poincare_distance_eq_0_iff"><span class="command">lemma</span></span> poincare_distance_eq_0_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula'_ge_1<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> unit_disc_cmod_square_lt_1<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> unit_disc_cmod_square_lt_1<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula_def
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula'_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> arcosh_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">assumption</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_disc_to_complex_inj<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Conjugate preserve <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">poincare_distance_formula</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1" id="Poincare_Distance-conjugate_preserve_poincare_distance"><span class="command">lemma</span></span> conjugate_preserve_poincare_distance <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>conjugate <span class="free">u</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="free">v</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="free">u</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> of_complex <span class="skolem">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> of_complex <span class="skolem">v'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"conjugate <span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">OF</span> **<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_cnj_diff complex_mod_cnj conjugate_of_complex poincare_distance_def poincare_distance_formula'_def poincare_distance_formula_def to_complex_of_complex<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Existence and uniqueness of points with a given distance›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1" id="Poincare_Distance-ex_x_axis_poincare_distance_negative'"><span class="command">lemma</span></span> ex_x_axis_poincare_distance_negative'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">d</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="free">d</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> exp <span class="free">d</span><span class="main">)</span>
          <span class="keyword1">in</span> is_real <span class="bound">z</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span> <span class="main">∧</span>
              of_complex <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> of_complex <span class="bound">z</span> <span class="main">∈</span> circline_set x_axis <span class="main">∧</span>
              poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="free">d</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> one_le_exp_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> exp <span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="free">d</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> exp <span class="free">d</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹exp <span class="free">d</span> <span class="main">≥</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_nonpos_nonneg<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> exp_gt_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">d</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> divide_less_eq_1_neg nonzero_minus_divide_right<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"abs <span class="var">?z</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?z</span> <span class="main">≤</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="var">?z</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> norm_of_real<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="var">?z</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="var">?z</span> <span class="main">∈</span> circline_set x_axis"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?z</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?z</span><span class="main">)</span> <span class="main">=</span> exp <span class="free">d</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="var">?z</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> exp <span class="free">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">+</span> exp <span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> add_divide_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="var">?z</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> exp <span class="free">d</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> exp <span class="free">d</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">+</span> exp <span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> diff_divide_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">+</span> exp <span class="free">d</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_zero_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="var">?z</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">d</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹exp <span class="free">d</span> <span class="main">≥</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Distance-ex_x_axis_poincare_distance_negative"><span class="command">lemma</span></span> ex_x_axis_poincare_distance_negative<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> is_real <span class="bound">z</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span> <span class="main">∧</span>
              of_complex <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> of_complex <span class="bound">z</span> <span class="main">∈</span> circline_set x_axis <span class="main">∧</span>
              poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">z</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> ex_x_axis_poincare_distance_negative'<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> Let_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For each real number $d$ there is exactly one point on the positive x-axis such that h-distance
between 0 and that point is $d$.›</span></span>
<span class="keyword1" id="Poincare_Distance-unique_x_axis_poincare_distance_negative"><span class="command">lemma</span></span> unique_x_axis_poincare_distance_negative<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">z</span><span class="main">.</span> is_real <span class="bound">z</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span> <span class="main">∧</span>
              poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">z</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">z</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> exp <span class="free">d</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> exp <span class="free">d</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_x_axis_poincare_distance_negative'<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">z'</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">z'</span> <span class="main">⟶</span> <span class="bound">z'</span> <span class="main">=</span> <span class="var">?z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x'</span><span class="main">.</span> <span class="main">¦</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">x'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">x'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> is_real <span class="bound">x</span> <span class="main">∧</span> Re <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span> <span class="main">∧</span> Re <span class="bound">x</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∘</span> of_complex<span class="main">)</span> <span class="var">?A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> comp_inj_on<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on of_complex <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> of_complex_inj
        <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span>poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">)</span> <span class="main">(</span>of_complex <span class="main">`</span> <span class="var">?A</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?f</span> <span class="main">(</span>of_complex <span class="main">`</span> <span class="var">?A</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> inj_on_cong<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">`</span> <span class="var">?A</span> <span class="main">=</span>
                 <span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> circline_set x_axis <span class="main">∧</span> Re <span class="main">(</span>to_complex <span class="bound">z</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re circline_set_x_axis<span class="main">)</span>

        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> of_complex <span class="main">`</span> <span class="var">?A</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?B</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> *
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="var">?g</span> <span class="main">∘</span> to_complex<span class="main">)</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> poincare_distance_zero_x_axis
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"to_complex <span class="main">`</span> of_complex <span class="main">`</span> <span class="var">?A</span> <span class="main">=</span> <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> image_iff<span class="main">)</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="var">?g</span> <span class="main">∘</span> to_complex<span class="main">)</span> <span class="main">(</span>of_complex <span class="main">`</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> comp_inj_on<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"inj_on to_complex <span class="main">(</span>of_complex <span class="main">`</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?g</span> <span class="var">?A</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
            <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">y</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span>"</span></span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> div_reals<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">-</span><span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">+</span><span class="skolem">x</span>"</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">y</span>›</span></span> div_reals<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">-</span><span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">+</span><span class="skolem">y</span>"</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">≤</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Re_divide_real <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> Re <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span>›</span></span> complex_eq_if_Re_eq hh<span class="main">(</span>1<span class="main">)</span> hh<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≥</span> Re <span class="main">(</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> hh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Re_divide_real arg_0_iff hh<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_divide_eq_1_pos one_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> plus_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>            

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">y</span> <span class="main">≤</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> Re_divide_real <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> Re <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span>›</span></span> complex_eq_if_Re_eq hh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≥</span> Re <span class="main">(</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> hh <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Re_divide_real arg_0_iff hh le_divide_eq_1_pos one_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> plus_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> hh
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> complex_eq_if_Re_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>            
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="var">?g</span> <span class="main">(</span>to_complex <span class="main">`</span> of_complex <span class="main">`</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> *
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="var">?z</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> inj_on_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Distance-ex_x_axis_poincare_distance_positive"><span class="command">lemma</span></span> ex_x_axis_poincare_distance_positive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> is_real <span class="bound">z</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span>
              of_complex <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> of_complex <span class="bound">z</span> <span class="main">∈</span> circline_set x_axis <span class="main">∧</span>
              poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> is_real <span class="bound">z</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="var">?P</span> <span class="bound">z</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_x_axis_poincare_distance_negative<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">z</span> <span class="main">∈</span> circline_set x_axis"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span> <span class="main">∧</span> Re <span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="var">?P</span> <span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * **
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_x_axis<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Distance-unique_x_axis_poincare_distance_positive"><span class="command">lemma</span></span> unique_x_axis_poincare_distance_positive<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">z</span><span class="main">.</span> is_real <span class="bound">z</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span>
               poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="bound">z</span><span class="main">)</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">z</span><span class="main">.</span> is_real <span class="bound">z</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="var">?P</span> <span class="bound">z</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unique_x_axis_poincare_distance_negative<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">z</span> <span class="main">∈</span> circline_set x_axis"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re circline_set_x_axis<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span> <span class="main">∧</span> Re <span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="var">?P</span> <span class="main">(</span><span class="main">-</span><span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * **
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z'</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">z'</span> <span class="main">∧</span> Re <span class="skolem">z'</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="skolem">z'</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="var">?P</span> <span class="skolem">z'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span><span class="main">-</span><span class="skolem">z'</span><span class="main">)</span> <span class="main">∧</span> Re <span class="main">(</span><span class="main">-</span><span class="skolem">z'</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="main">(</span><span class="main">-</span><span class="skolem">z'</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span> <span class="main">∧</span> <span class="var">?P</span> <span class="main">(</span><span class="main">-</span><span class="skolem">z'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_x_axis cmod_eq_Re<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">z'</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> unique_x_axis_poincare_distance_negative<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">=</span> <span class="main">-</span><span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Equal distance implies that segments are isometric - this means that congruence could be
defined either by two segments having the same distance or by requiring existence of an isometry
that maps one segment to the other.›</span></span>
<span class="keyword1" id="Poincare_Distance-poincare_distance_eq_ex_moebius"><span class="command">lemma</span></span> poincare_distance_eq_ex_moebius<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> poincare_distance <span class="free">u'</span> <span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">M</span><span class="main">.</span> unit_disc_fix <span class="bound">M</span> <span class="main">∧</span> moebius_pt <span class="bound">M</span> <span class="free">u</span> <span class="main">=</span> <span class="free">u'</span> <span class="main">∧</span> moebius_pt <span class="bound">M</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v'</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="free">u</span> <span class="free">v</span> <span class="free">u'</span> <span class="free">v'</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms poincare_distance_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u'</span></span> <span class="quoted"><span class="free">v'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_disc_fix_transitive<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">u'</span> <span class="bound">v'</span><span class="main">.</span> <span class="free">u</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">∧</span> <span class="bound">u'</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">v'</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_distance <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> poincare_distance <span class="bound">u'</span> <span class="bound">v'</span> <span class="main">⟶</span>
                 <span class="var">?P'</span> <span class="bound">u'</span> <span class="bound">v'</span> <span class="free">u</span> <span class="free">v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">u</span> <span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_positive_x_axis<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> circline_set x_axis"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u'</span> <span class="skolem">v'</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">≠</span> of_complex <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="skolem">u'</span> <span class="skolem">v'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">≠</span> <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="skolem">u'</span> <span class="skolem">v'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_ge0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> M<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">u'</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v'</span> <span class="main">∈</span> positive_x_axis"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ex_unit_disc_fix_to_zero_positive_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> in_disc
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Mv'</span></span> <span class="keyword2"><span class="keyword">where</span></span> Mv'<span class="main">:</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v'</span> <span class="main">=</span> of_complex <span class="skolem">Mv'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v'</span>"</span></span><span class="main">]</span> in_disc unit_disc_fix_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_eqI inf_notin_unit_disc<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v'</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">Mv'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">Mv'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">Mv'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> M Mv' of_complex_inj <span class="quoted"><span class="quoted">‹moebius_pt <span class="skolem">M</span> <span class="skolem">v'</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> positive_x_axis_def circline_set_x_axis
        <span class="keyword1"><span class="command">using</span></span> cmod_eq_Re
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">fastforce</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="skolem">u'</span> <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> M<span class="main">(</span>1<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> in_disc
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> M<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Mv'</span> <span class="main">=</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="skolem">u'</span> <span class="skolem">v'</span>›</span></span> Mv'
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="skolem">u'</span> <span class="skolem">v'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> unique_x_axis_poincare_distance_positive<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poincare_distance <span class="skolem">u'</span> <span class="skolem">v'</span>"</span></span><span class="main">]</span>
          <span class="quoted"><span class="quoted">‹poincare_distance <span class="skolem">u'</span> <span class="skolem">v'</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">Mv'</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">Mv'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">Mv'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> positive_x_axis_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="skolem">u'</span> <span class="skolem">v'</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> M Mv'
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Mu</span> <span class="main">≠</span> <span class="var">?Mv</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mu</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mv</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u'</span> <span class="skolem">v'</span>
      <span class="keyword3"><span class="command">assume</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">=</span> poincare_distance <span class="skolem">u'</span> <span class="skolem">v'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="var">?Mu</span> <span class="var">?Mv</span> <span class="main">=</span> poincare_distance <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M'</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M'</span> <span class="skolem">u'</span> <span class="main">=</span> <span class="var">?Mu</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M'</span> <span class="skolem">v'</span> <span class="main">=</span> <span class="var">?Mv</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 2 3 4
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="skolem">M</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">M'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="var">?M</span> <span class="main">∧</span> moebius_pt <span class="var">?M</span> <span class="skolem">u'</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">∧</span> moebius_pt <span class="var">?M</span> <span class="skolem">v'</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 5 <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_moebius_comp<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_moebius_inv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">M</span><span class="main">.</span> unit_disc_fix <span class="bound">M</span> <span class="main">∧</span> moebius_pt <span class="bound">M</span> <span class="skolem">u'</span> <span class="main">=</span> <span class="skolem">u</span> <span class="main">∧</span> moebius_pt <span class="bound">M</span> <span class="skolem">v'</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span> <span class="main">∧</span> moebius_pt <span class="skolem">M</span> <span class="free">u'</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∧</span> moebius_pt <span class="skolem">M</span> <span class="free">v'</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="main">(</span><span class="main">-</span><span class="skolem">M</span><span class="main">)</span> <span class="main">∧</span> moebius_pt <span class="main">(</span><span class="main">-</span><span class="skolem">M</span><span class="main">)</span> <span class="free">u</span> <span class="main">=</span> <span class="free">u'</span> <span class="main">∧</span> moebius_pt <span class="main">(</span><span class="main">-</span><span class="skolem">M</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_moebius_inv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Distance-unique_midpoint_x_axis"><span class="command">lemma</span></span> unique_midpoint_x_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">z</span><span class="main">.</span> <span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="bound">z</span> <span class="main">∧</span> Re <span class="bound">z</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> is_real <span class="bound">z</span> <span class="main">∧</span> poincare_distance <span class="main">(</span>of_complex <span class="bound">z</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="free">x</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="main">(</span>of_complex <span class="bound">z</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="free">y</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">z</span><span class="main">.</span> <span class="var">?R</span> <span class="bound">z</span> <span class="main">(</span>of_complex <span class="free">x</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="free">y</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">∃!</span> <span class="bound">z</span><span class="main">.</span> <span class="var">?R</span> <span class="bound">z</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="bound">x</span> <span class="main">∧</span> Re <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> is_real <span class="bound">x</span> <span class="main">∧</span> of_complex <span class="bound">x</span> <span class="main">≠</span> <span class="var">?y</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="main">(</span>of_complex <span class="bound">x</span><span class="main">)</span> <span class="var">?y</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">(</span>of_complex <span class="free">y</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_real_zero<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="var">?y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> y
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x
        <span class="keyword1"><span class="command">using</span></span> complex_neq_0
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span><span class="main">.</span> <span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">⟶</span> 
                 <span class="main">(</span>poincare_distance <span class="main">(</span>of_complex <span class="main">(</span>cor <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="var">?x</span> <span class="main">=</span> poincare_distance <span class="main">(</span>of_complex <span class="main">(</span>cor <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">⟷</span>
                 <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">a</span> <span class="main">+</span> Re <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="main">::</span> <span class="quoted">real</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span>cor <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> unit_disc"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">⟷</span>
              <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> Re <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cancel_comm_monoid_add_class.diff_cancel diff_eq_diff_less less_numeral_extra<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> power2_eq_1_iff right_minus_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> divide_cancel_right divide_divide_eq_left mult.commute<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="skolem">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> x
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> power2_eq_1_iff<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_eq_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="skolem">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">a</span><span class="main">*</span>Re <span class="skolem">x</span> <span class="main">+</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_diff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> Re <span class="skolem">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> Re <span class="skolem">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> Re <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute mult.left_commute power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arcosh <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> arcosh <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="var">?lhs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> x mult_left_cancel<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">::</span>real"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span> <span class="main">-</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> arcosh_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> square_le_1<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="main">(</span>cor <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="main">(</span>of_complex <span class="main">(</span>cor <span class="skolem">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">⟷</span>
              <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">+</span> Re <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_distance_formula cmod_eq_Re<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?x</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> sqrt<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span>"</span></span>        
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?a</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>                                                       
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> power2_eq_1_iff square_le_1<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?a</span><span class="main">¦</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> x
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> Re <span class="skolem">x</span> <span class="main">&lt;</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> real_less_rsqrt <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>›</span></span>           
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Re <span class="skolem">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>Re <span class="skolem">x</span><span class="main">*</span>Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comm_semiring_class.distrib mult.commute mult_2_right mult_less_0_iff one_add_one zero_less_double_add_iff_zero_less_single_add<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> Re <span class="skolem">x</span> <span class="main">&lt;</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> real_less_rsqrt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="var">?a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="var">?a</span> <span class="main">*</span> <span class="var">?a</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?a</span> <span class="main">+</span> Re <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="main">(</span>cor <span class="var">?a</span><span class="main">)</span> <span class="main">∧</span> Re <span class="main">(</span>cor <span class="var">?a</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> is_real <span class="var">?a</span> <span class="main">∧</span> poincare_distance <span class="main">(</span>of_complex <span class="var">?a</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="main">(</span>of_complex <span class="var">?a</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> *
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
        <span class="keyword3"><span class="command">assume</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">z</span> <span class="main">∧</span> Re <span class="skolem">z</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> is_real <span class="skolem">z</span> <span class="main">∧</span>
               poincare_distance <span class="main">(</span>of_complex <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="main">(</span>of_complex <span class="skolem">z</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">*</span> Re <span class="skolem">z</span> <span class="main">*</span> Re <span class="skolem">z</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">z</span> <span class="main">+</span> Re <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span>"</span></span><span class="main">]</span> x
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">moreover</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> Re <span class="skolem">x</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="skolem">x</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> Re <span class="skolem">x</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> sqrt<span class="main">(</span><span class="numeral">4</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="skolem">x</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> real_sqrt_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="skolem">x</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?a</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="skolem">x</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="skolem">x</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> mult_divide_mult_cancel_left<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="skolem">x</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?b</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="skolem">x</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="skolem">x</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> mult_divide_mult_cancel_left<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">∨</span> Re <span class="skolem">z</span> <span class="main">=</span> <span class="var">?b</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> discriminant_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span>"</span></span><span class="main">]</span> discrim_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>power2_eq_square<span class="main">)</span>    
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="var">?b</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> x
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> real_less_rsqrt
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>      
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span><span class="main">*</span>Re <span class="skolem">x</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>Re <span class="skolem">x</span><span class="main">*</span>Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comm_semiring_class.distrib mult.commute mult_2_right mult_less_0_iff one_add_one zero_less_double_add_iff_zero_less_single_add<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">-</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span> <span class="main">-</span> Re <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> real_less_rsqrt
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span> <span class="main">∨</span> <span class="var">?b</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">=</span> <span class="var">?a</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">z</span> <span class="main">=</span> <span class="var">?a</span> <span class="main">∨</span> Re <span class="skolem">z</span> <span class="main">=</span> <span class="var">?b</span>›</span></span> **
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="var">?a</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ** complex_of_real_Re
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">u</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="main">(</span>blaschke <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="var">?Mu</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>                                    
      <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x cmod_eq_Re
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mx</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> blaschke_unit_disc_fix<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_discI
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mx</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> circline_set x_axis"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mx</span> <span class="main">∈</span> circline_set x_axis"</span></span>
        <span class="keyword1"><span class="command">using</span></span> blaschke_real_preserve_x_axis<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="main">(</span>to_complex <span class="var">?Mx</span><span class="main">)</span> <span class="main">∧</span> Re <span class="main">(</span>to_complex <span class="var">?Mx</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> is_real <span class="main">(</span>to_complex <span class="var">?Mx</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Mx</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Mx</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mx</span> <span class="main">≠</span> <span class="var">?Mu</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">u</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?Mx</span> <span class="var">?Mu</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"to_complex <span class="var">?Mx</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="var">?Mx</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Mz</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="skolem">Mz</span> <span class="var">?Mx</span> <span class="var">?Mu</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">Mz</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">Mz</span> <span class="main">∈</span> circline_set x_axis"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?R</span> <span class="skolem">Mz</span> <span class="var">?Mx</span> <span class="var">?Mu</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> cmod_eq_Re 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Minv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">(</span>blaschke <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="var">?Minv</span> <span class="main">(</span>of_complex <span class="skolem">Mz</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">Mz</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∈</span> circline_set x_axis"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">Mz</span> <span class="main">∈</span> circline_set x_axis›</span></span>
        <span class="keyword1"><span class="command">using</span></span> blaschke_real_preserve_x_axis <span class="quoted"><span class="quoted">‹is_real <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> z1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="main">(</span>to_complex <span class="var">?z</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?z</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="var">?z</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?z</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
      
      <span class="keyword1"><span class="command">have</span></span> z2<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_distance <span class="var">?z</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="var">?z</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?R</span> <span class="skolem">Mz</span> <span class="var">?Mx</span> <span class="var">?Mu</span>›</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?z</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> blaschke_preserve_distance_formula blaschke_unit_disc_fix moebius_pt_comp_inv_right poincare_distance_formula uminus_moebius_def unit_disc_fix_discI unit_disc_iff_cmod_lt_1<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">(</span>to_complex <span class="var">?z</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> z1 z2 <span class="quoted"><span class="quoted">‹<span class="var">?z</span> <span class="main">∈</span> unit_disc›</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z'</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="skolem">z'</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">z'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">z'</span> <span class="main">∈</span> circline_set x_axis"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mz'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">(</span>of_complex <span class="skolem">z'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mz'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mz'</span> <span class="main">∈</span> circline_set x_axis"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">z'</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">z'</span> <span class="main">∈</span> circline_set x_axis›</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">a</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span>  blaschke_unit_disc_fix unit_disc_fix_discI
          <span class="keyword1"><span class="command">using</span></span> blaschke_real_preserve_x_axis circline_set_x_axis
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="main">(</span>to_complex <span class="var">?Mz'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?Mz'</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="var">?Mz'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="var">?Mz'</span> <span class="var">?Mx</span> <span class="main">=</span> poincare_distance <span class="var">?Mz'</span> <span class="var">?Mu</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?R</span> <span class="skolem">z'</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">u</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">z'</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> unit_disc›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="main">(</span>to_complex <span class="var">?Mz'</span><span class="main">)</span> <span class="var">?Mx</span> <span class="var">?Mu</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Mz'</span> <span class="main">∈</span> unit_disc›</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?Mz'</span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mz'</span> <span class="main">=</span> of_complex <span class="skolem">Mz</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?P</span> <span class="var">?Mx</span> <span class="var">?Mu</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?R</span> <span class="skolem">Mz</span> <span class="var">?Mx</span> <span class="var">?Mu</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹moebius_pt <span class="main">(</span>blaschke <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="skolem">z'</span><span class="main">)</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">Mz</span> <span class="main">∈</span> unit_disc›</span></span> to_complex_of_complex unit_disc_to_complex_inj<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">=</span> to_complex <span class="var">?z</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> moebius_pt_invert<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> to_complex_of_complex<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Triangle inequality›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1" id="Poincare_Distance-poincare_distance_formula_zero_sum"><span class="command">lemma</span></span> poincare_distance_formula_zero_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">u</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">+</span> poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">v</span> <span class="main">=</span>
         <span class="main">(</span><span class="keyword1">let</span> <span class="bound">u'</span> <span class="main">=</span> cmod <span class="main">(</span>to_complex <span class="free">u</span><span class="main">)</span><span class="main">;</span> <span class="bound">v'</span> <span class="main">=</span> cmod <span class="main">(</span>to_complex <span class="free">v</span><span class="main">)</span>
           <span class="keyword1">in</span> arcosh <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="bound">v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">*</span> <span class="bound">u'</span> <span class="main">*</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="bound">v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">=</span> to_complex <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">=</span> to_complex <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> uv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> of_complex <span class="skolem">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> of_complex <span class="skolem">v'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> uv assms inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">u'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?v'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">v'</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unit_disc_cmod_square_lt_1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">∈</span> unit_disc›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> unit_disc_cmod_square_lt_1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> unit_disc›</span></span><span class="main">]</span> uv
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">thm</span></span> arcosh_add
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arcosh <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> arcosh <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        arcosh <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">*</span> <span class="var">?u'</span> <span class="main">*</span> <span class="var">?v'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"arcosh <span class="var">?ll</span> <span class="main">+</span> arcosh <span class="var">?rr</span> <span class="main">=</span> arcosh <span class="var">?r</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> arcosh_add<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ll</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?rr</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> disc
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"arcosh <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
                  sqrt <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
          arcosh <span class="var">?r</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"arcosh <span class="var">?l</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> disc
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> add_divide_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> disc
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> add_divide_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
               <span class="main">(</span><span class="numeral">4</span>  <span class="main">*</span> <span class="var">?u'</span> <span class="main">*</span> <span class="var">?v'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?u'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?v'</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="var">?s</span> <span class="main">=</span> <span class="var">?t</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?s</span> <span class="main">=</span> <span class="var">?t</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> disc
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add_divide_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> power_divide<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> divide_diff_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> disc
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> disc
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">subst</span> add_divide_distrib<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> uv' assms
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Distance-poincare_distance_triangle_inequality"><span class="command">lemma</span></span> poincare_distance_triangle_inequality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">u</span> <span class="free">v</span> <span class="main">+</span> poincare_distance <span class="free">v</span> <span class="free">w</span> <span class="main">≥</span> poincare_distance <span class="free">u</span> <span class="free">w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> unit_disc <span class="main">⟶</span> <span class="var">?P'</span> <span class="free">u</span> <span class="free">v</span> <span class="bound">w</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">v</span> <span class="free">u</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_x_axis<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> of_complex <span class="skolem">w'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">w'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?xw</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">w'</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> unit_disc_cmod_square_lt_1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> unit_disc_cmod_square_lt_1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> unit_disc›</span></span><span class="main">]</span> w
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">+</span> poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">w</span> <span class="main">=</span>
           arcosh <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?w</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">*</span> <span class="var">?x</span> <span class="main">*</span> <span class="var">?w</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?w</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> arcosh <span class="var">?r1</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula_zero_sum<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> unit_disc›</span></span><span class="main">]</span> w
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="skolem">w'</span><span class="main">)</span> <span class="main">=</span>
            arcosh <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?w</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?xw</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?w</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> arcosh <span class="var">?r2</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> disc
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> unit_disc›</span></span><span class="main">]</span> w
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> add_divide_distrib<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?w</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?xw</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?w</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">*</span> <span class="var">?x</span> <span class="main">*</span> <span class="var">?w</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">w'</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">(</span>cmod <span class="skolem">x</span> <span class="main">+</span> cmod <span class="skolem">w'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> norm_triangle_ineq4<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">w'</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mono<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_sum<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arcosh <span class="var">?r1</span> <span class="main">≥</span> arcosh <span class="var">?r2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> arcosh_mono<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r1</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> disc
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted">"*"</span> le_divide_eq_1_pos mult_pos_pos zero_le_power2<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r2</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> disc
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r1</span> <span class="main">≥</span> <span class="var">?r2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> disc
          <span class="keyword1"><span class="command">using</span></span> *
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> divide_right_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">≤</span> poincare_distance <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">+</span> poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> unit_disc›</span></span> w
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="skolem">v</span> <span class="skolem">u</span> <span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * **<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">w</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Poincare_Circles">
<div class="head">
<h1>Theory Poincare_Circles</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Poincare_Circles
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Poincare_Distance.html">Poincare_Distance</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(* -------------------------------------------------------------------------- *)</span>
<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹H-circles in the Poincar\'e model›</span></span>
<span class="comment1">(* -------------------------------------------------------------------------- *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Circles consist of points that are at the same distance from the center.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poincare_circle</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_homo <span class="main">⇒</span> real <span class="main">⇒</span> complex_homo set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poincare_circle</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">z'</span><span class="main">.</span> <span class="bound">z'</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_distance <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="bound">z'</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Each h-circle in the Poincar\'e model is represented by an Euclidean circle in the model ---
the center and radius of that euclidean circle are determined by the following formulas.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poincare_circle_euclidean</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_homo <span class="main">⇒</span> real <span class="main">⇒</span> euclidean_circle"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poincare_circle_euclidean</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span>
      <span class="main">(</span><span class="keyword1">let</span> <span class="bound">R</span> <span class="main">=</span> <span class="main">(</span>cosh <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">;</span>
           <span class="bound">z'</span> <span class="main">=</span> to_complex <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">;</span>
           <span class="bound">cz</span> <span class="main">=</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="bound">z'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">;</span>
           <span class="bound">k</span> <span class="main">=</span> <span class="bound">cz</span> <span class="main">*</span> <span class="bound">R</span> <span class="main">+</span> <span class="main">1</span>
        <span class="keyword1">in</span> <span class="main">(</span><span class="bound">z'</span> <span class="main">/</span> <span class="bound">k</span><span class="main">,</span> <span class="bound">cz</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="bound">R</span> <span class="main">*</span> <span class="main">(</span><span class="bound">R</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹That Euclidean circle has a positive radius and is always fully within the disc.›</span></span>
<span class="keyword1" id="Poincare_Circles-poincare_circle_in_disc"><span class="command">lemma</span></span> poincare_circle_in_disc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ze</span><span class="main">,</span> <span class="free">re</span><span class="main">)</span> <span class="main">=</span> poincare_circle_euclidean <span class="free">z</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cmod <span class="free">ze</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">re</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> circle <span class="free">ze</span> <span class="free">re</span><span class="main">.</span> cmod <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cosh <span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cz</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="var">?z'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?cz</span> <span class="main">*</span> <span class="var">?R</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ze</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?z'</span> <span class="main">/</span> <span class="var">?k</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?re</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?cz</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="var">?R</span> <span class="main">*</span> <span class="main">(</span><span class="var">?R</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="var">?k</span>"</span></span>

  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> unit_disc›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> z'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> of_complex <span class="skolem">z'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">=</span> <span class="var">?z'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">cz</span></span> <span class="keyword2"><span class="keyword">where</span></span> cz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">cz</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">z'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cz</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cz</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> unit_disc›</span></span> z' cz
    <span class="keyword1"><span class="command">using</span></span> unit_disc_cmod_square_lt_1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="var">?R</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cosh_gt_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> R<span class="main">)</span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="skolem">cz</span> <span class="main">*</span> <span class="skolem">R</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> k <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?RR</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">cz</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="skolem">R</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">k</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">z'</span> <span class="main">+</span> <span class="skolem">cz</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="skolem">R</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">k</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">-</span><span class="skolem">R</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">R</span><span class="main">*</span><span class="main">(</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">R</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> power2_diff
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="skolem">R</span><span class="main">*</span><span class="main">(</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">R</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">4</span><span class="main">*</span><span class="skolem">R</span><span class="main">*</span><span class="main">(</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">&gt;</span> <span class="skolem">R</span><span class="main">*</span><span class="main">(</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> power2_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="skolem">R</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt<span class="main">(</span><span class="skolem">R</span><span class="main">*</span><span class="main">(</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> arith_geo_mean_sqrt power_divide real_sqrt_four real_sqrt_pow2 zero_le_mult_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt<span class="main">(</span><span class="skolem">R</span><span class="main">*</span><span class="main">(</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">R</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>cmod <span class="skolem">z'</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt<span class="main">(</span><span class="skolem">R</span><span class="main">*</span><span class="main">(</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="main">(</span>cmod <span class="skolem">z'</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span>  <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult_strict_left_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">smt</span> norm_not_less_zero<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> unit_disc›</span></span> z'
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> cmod <span class="skolem">z'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> cmod <span class="skolem">z'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>sqrt<span class="main">(</span><span class="skolem">R</span><span class="main">*</span><span class="main">(</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">R</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> cmod <span class="skolem">z'</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> unit_disc›</span></span> z'
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult_strict_left_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cz</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="main">(</span><span class="skolem">R</span><span class="main">*</span><span class="main">(</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">R</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">-</span> cmod <span class="skolem">z'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> square_diff_square_factored<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">z'</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> cz<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> mult.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">z'</span> <span class="main">+</span> <span class="skolem">cz</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="skolem">R</span><span class="main">*</span><span class="main">(</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">R</span> <span class="main">*</span> <span class="skolem">cz</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> k
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">z'</span> <span class="main">/</span> <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">cz</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="skolem">R</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> add_divide_distrib<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="skolem">z'</span> <span class="main">/</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">cz</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="skolem">R</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="var">?ze</span> <span class="main">+</span> <span class="var">?re</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> k cz <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">=</span> <span class="var">?R</span>›</span></span> z'
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">cz</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="skolem">R</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">cz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?re</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> k cz <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">=</span> <span class="var">?R</span>›</span></span> z'
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="var">?ze</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="var">?ze</span> <span class="main">+</span> <span class="var">?re</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?re</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">ze</span> <span class="main">=</span> <span class="var">?ze</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">re</span> <span class="main">=</span> <span class="var">?re</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="free">ze</span><span class="main">,</span> <span class="free">re</span><span class="main">)</span> <span class="main">=</span> poincare_circle_euclidean <span class="free">z</span> <span class="free">r</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_circle_euclidean_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> circle <span class="free">ze</span> <span class="free">re</span><span class="main">.</span> cmod <span class="bound">x</span> <span class="main">≤</span> cmod <span class="free">ze</span> <span class="main">+</span> <span class="free">re</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> norm_triangle_ineq2<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">ze</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> circle_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mem_Collect_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">ultimately</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cmod <span class="free">ze</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">re</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> circle <span class="free">ze</span> <span class="free">re</span><span class="main">.</span> cmod <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The connection between the points on the h-circle and its corresponding Euclidean circle.›</span></span>
<span class="keyword1" id="Poincare_Circles-poincare_circle_is_euclidean_circle"><span class="command">lemma</span></span> poincare_circle_is_euclidean_circle<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="main">(</span><span class="bound">Ze</span><span class="main">,</span> <span class="bound">Re</span><span class="main">)</span> <span class="main">=</span> poincare_circle_euclidean <span class="free">z</span> <span class="free">r</span>
           <span class="keyword1">in</span> of_complex <span class="main">`</span> <span class="main">(</span>circle <span class="bound">Ze</span> <span class="bound">Re</span><span class="main">)</span> <span class="main">=</span> poincare_circle <span class="free">z</span> <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="free">z</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> z'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> of_complex <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">z'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> cmod <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="bound">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_iff_diff_less_0 minus_diff_eq mult.left_neutral neg_less_0_iff_less norm_mult_less norm_power power2_eq_square<span class="main">)</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cosh <span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="keyword2"><span class="keyword">where</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">=</span> <span class="var">?R</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?cz</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">z'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?czx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="skolem">z'</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">R</span> <span class="main">*</span> <span class="var">?cz</span>"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="var">?k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> R cosh_gt_1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms z' k *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z'</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"cor <span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> of_real_eq_0_iff<span class="main">)</span>


    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> poincare_circle <span class="free">z</span> <span class="free">r</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> poincare_distance <span class="free">z</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_circle_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> poincare_distance_formula' <span class="var">?z</span> <span class="skolem">x</span> <span class="main">=</span> cosh <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span> cosh_dist<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula_def
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">using</span></span> arcosh_cosh_real
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="var">?czx</span> <span class="main">/</span> <span class="main">(</span><span class="var">?cz</span> <span class="main">*</span> <span class="var">?cx</span><span class="main">)</span> <span class="main">=</span> <span class="var">?R</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> z'
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="var">?czx</span> <span class="main">=</span> <span class="var">?R</span> <span class="main">*</span> <span class="var">?cx</span> <span class="main">*</span> <span class="var">?cz</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms z' *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z'</span></span><span class="main">]</span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> nonzero_divide_eq_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">z'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="skolem">z'</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">z'</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cnj <span class="skolem">z'</span> <span class="main">-</span> cnj <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">R</span> <span class="main">*</span> <span class="var">?cz</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟷</span> <span class="main">_</span> <span class="main">∧</span> <span class="var">?l</span> <span class="main">=</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z'</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cnj <span class="skolem">z'</span> <span class="main">-</span> cnj <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="main">(</span><span class="skolem">z'</span> <span class="main">*</span> cnj <span class="skolem">z'</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?l</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?l</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">x</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> Im_complex_of_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="main">(</span><span class="skolem">z'</span> <span class="main">*</span> cnj <span class="skolem">z'</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> R<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cmod_square<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> complex_eq_if_Re_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">z'</span> <span class="main">*</span> cnj <span class="skolem">z'</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">z'</span> <span class="main">-</span> cnj <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">R</span> <span class="main">*</span> <span class="var">?cz</span> <span class="main">-</span> <span class="skolem">R</span> <span class="main">*</span> <span class="var">?cz</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> right_diff_distrib left_diff_distrib
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">x</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">z'</span> <span class="main">-</span> cnj <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">+</span> <span class="skolem">z'</span> <span class="main">*</span> cnj <span class="skolem">z'</span> <span class="main">=</span> <span class="skolem">R</span> <span class="main">*</span> <span class="var">?cz</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟷</span> <span class="main">_</span> <span class="main">∧</span> <span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> k<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">z'</span> <span class="main">-</span> cnj <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">+</span> <span class="skolem">z'</span> <span class="main">*</span> cnj <span class="skolem">z'</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">*</span> <span class="var">?cz</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> **
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Groups.mult_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">z'</span> <span class="main">/</span> <span class="skolem">k</span> <span class="main">-</span> cnj <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">z'</span> <span class="main">/</span> <span class="skolem">k</span> <span class="main">+</span> <span class="skolem">z'</span> <span class="main">*</span> cnj <span class="skolem">z'</span> <span class="main">/</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">*</span> <span class="var">?cz</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> **
      <span class="keyword1"><span class="command">unfolding</span></span> add_divide_distrib diff_divide_distrib
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">z'</span><span class="main">/</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">z'</span><span class="main">/</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">*</span> <span class="var">?cz</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">z'</span> <span class="main">/</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="skolem">z'</span> <span class="main">/</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">z'</span> <span class="main">*</span> cnj <span class="skolem">z'</span> <span class="main">/</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> diff_divide_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">z'</span><span class="main">/</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">*</span> <span class="var">?cz</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span>cmod <span class="skolem">z'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">z'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> complex_mult_cnj_cmod<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> complex_eq_if_Re_eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">z'</span><span class="main">/</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">*</span> <span class="var">?cz</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span>cmod <span class="skolem">z'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">z'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> **
      <span class="keyword1"><span class="command">unfolding</span></span> add_divide_distrib diff_divide_distrib
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span>cmod <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">z'</span><span class="main">/</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="var">?cz</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="skolem">R</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">k</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟷</span> <span class="main">_</span> <span class="main">∧</span> <span class="var">?a</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="var">?b</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">z'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span>cmod <span class="skolem">z'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">z'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">z'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="skolem">R</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> k<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_diff<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> cmod <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">z'</span><span class="main">/</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?cz</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="skolem">R</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">k</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">R</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z'</span></span><span class="main">]</span> ** <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> unit_disc›</span></span> z'
      <span class="keyword1"><span class="command">using</span></span> real_sqrt_unique<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_divide real_sqrt_mult power_divide power_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> poincare_circle <span class="free">z</span> <span class="free">r</span> <span class="main">⟷</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> circle <span class="main">(</span><span class="skolem">z'</span><span class="main">/</span><span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="var">?cz</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="skolem">R</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">R</span><span class="main">+</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> circle_def z' k R
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> poincare_circle <span class="free">z</span> <span class="free">r</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">Ze</span><span class="main">,</span> <span class="bound">Re</span><span class="main">)</span> <span class="main">=</span> poincare_circle_euclidean <span class="free">z</span> <span class="free">r</span> <span class="keyword1">in</span> cmod <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> circle <span class="bound">Ze</span> <span class="bound">Re</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_circle_euclidean_def Let_def circle_def
      <span class="keyword1"><span class="command">using</span></span> z' R k
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> poincare_circle <span class="free">z</span> <span class="free">r</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">Ze</span><span class="main">,</span> <span class="bound">Re</span><span class="main">)</span> <span class="main">=</span> poincare_circle_euclidean <span class="free">z</span> <span class="free">r</span> <span class="keyword1">in</span> <span class="skolem">x</span> <span class="main">∈</span> circle <span class="bound">Ze</span> <span class="bound">Re</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_circle_in_disc<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free">r</span></span></span> <span class="main"><span class="main"><span class="main">&gt;</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>›</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free">z</span></span></span> <span class="main"><span class="main"><span class="main">∈</span></span></span> unit_disc›</span></span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> * <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Let_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ze</span> <span class="skolem">Re</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poincare_circle_euclidean <span class="free">z</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Ze</span><span class="main">,</span> <span class="skolem">Re</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> circle <span class="skolem">Ze</span> <span class="skolem">Re</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> poincare_circle <span class="free">z</span> <span class="free">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Ze</span> <span class="skolem">Re</span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_circle_euclidean <span class="free">z</span> <span class="free">r</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Ze</span><span class="main">,</span> <span class="skolem">Re</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> poincare_circle <span class="free">z</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> x'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> of_complex <span class="skolem">x'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_circle_def
      <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> circle <span class="skolem">Ze</span> <span class="skolem">Re</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x'</span></span><span class="main">]</span> **
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> of_complex <span class="main">`</span> circle <span class="skolem">Ze</span> <span class="skolem">Re</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x'
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Intersection of circles in special positions›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Two h-circles centered at the x-axis intersect at mutually conjugate points›</span></span>
<span class="keyword1" id="Poincare_Circles-intersect_poincare_circles_x_axis"><span class="command">lemma</span></span> intersect_poincare_circles_x_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="free">z1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">z2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="free">z1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z1</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="free">z2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">z2</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
             <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">≠</span> <span class="free">z2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">∈</span> poincare_circle <span class="main">(</span>of_complex <span class="free">z1</span><span class="main">)</span> <span class="free">r1</span> <span class="main">∩</span> poincare_circle <span class="main">(</span>of_complex <span class="free">z2</span><span class="main">)</span> <span class="free">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∈</span> poincare_circle <span class="main">(</span>of_complex <span class="free">z1</span><span class="main">)</span> <span class="free">r1</span> <span class="main">∩</span> poincare_circle <span class="main">(</span>of_complex <span class="free">z2</span><span class="main">)</span> <span class="free">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">=</span> conjugate <span class="free">x2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"of_complex <span class="free">z1</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">z2</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1'</span></span> <span class="skolem"><span class="skolem">x2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> x'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">=</span> of_complex <span class="skolem">x1'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">=</span> of_complex <span class="skolem">x2'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> x1 x2
    <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x1</span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_circle_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ze1</span></span> <span class="skolem"><span class="skolem">Re1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Ze1</span><span class="main">,</span> <span class="skolem">Re1</span><span class="main">)</span> <span class="main">=</span> poincare_circle_euclidean <span class="main">(</span>of_complex <span class="free">z1</span><span class="main">)</span> <span class="free">r1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> poincare_circle_euclidean_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ze2</span></span> <span class="skolem"><span class="skolem">Re2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Ze2</span><span class="main">,</span> <span class="skolem">Re2</span><span class="main">)</span> <span class="main">=</span> poincare_circle_euclidean <span class="main">(</span>of_complex <span class="free">z2</span><span class="main">)</span> <span class="free">r2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> poincare_circle_euclidean_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> circle<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1'</span> <span class="main">∈</span> circle <span class="skolem">Ze1</span> <span class="skolem">Re1</span> <span class="main">∩</span> circle <span class="skolem">Ze2</span> <span class="skolem">Re2</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x2'</span> <span class="main">∈</span> circle <span class="skolem">Ze1</span> <span class="skolem">Re1</span> <span class="main">∩</span> circle <span class="skolem">Ze2</span> <span class="skolem">Re2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> poincare_circle_is_euclidean_circle<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="free">z1</span>"</span></span> <span class="quoted"><span class="free">r1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_circle_is_euclidean_circle<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="free">z2</span>"</span></span> <span class="quoted"><span class="free">r2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> assms 1 2 <span class="quoted"><span class="quoted">‹of_complex <span class="free">z1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="free">z2</span> <span class="main">∈</span> unit_disc›</span></span> x'
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> image_iff of_complex_inj<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">Ze1</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">Ze2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="quoted"><span class="quoted">‹is_real <span class="free">z1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">z2</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_circle_euclidean_def Let_def<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Re1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Re2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 in_disc <span class="quoted"><span class="quoted">‹<span class="free">r1</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> poincare_circle_in_disc<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r1</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">z1</span>"</span></span> <span class="quoted"><span class="skolem">Ze1</span></span> <span class="quoted"><span class="skolem">Re1</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_circle_in_disc<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">r2</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">z2</span>"</span></span> <span class="quoted"><span class="skolem">Ze2</span></span> <span class="quoted"><span class="skolem">Re2</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ze1</span> <span class="main">≠</span> <span class="skolem">Ze2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ze1</span> <span class="main">=</span> <span class="skolem">Ze2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Re1</span> <span class="main">=</span> <span class="skolem">Re2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> circle<span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> circle_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ze1</span> <span class="main">-</span> <span class="skolem">Re1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ze1</span> <span class="main">+</span> <span class="skolem">Re1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∈</span> circle <span class="skolem">Ze1</span> <span class="skolem">Re1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">∈</span> circle <span class="skolem">Ze1</span> <span class="skolem">Re1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Re1</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> circle_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="var">?A</span> <span class="main">∈</span> poincare_circle <span class="main">(</span>of_complex <span class="free">z1</span><span class="main">)</span> <span class="free">r1</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="var">?B</span> <span class="main">∈</span> poincare_circle <span class="main">(</span>of_complex <span class="free">z1</span><span class="main">)</span> <span class="free">r1</span>"</span></span>
          <span class="quoted"><span class="quoted">"of_complex <span class="var">?A</span> <span class="main">∈</span> poincare_circle <span class="main">(</span>of_complex <span class="free">z2</span><span class="main">)</span> <span class="free">r2</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="var">?B</span> <span class="main">∈</span> poincare_circle <span class="main">(</span>of_complex <span class="free">z2</span><span class="main">)</span> <span class="free">r2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eq
      <span class="keyword1"><span class="command">using</span></span> poincare_circle_is_euclidean_circle<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹of_complex <span class="free">z1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r1</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> poincare_circle_is_euclidean_circle<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹of_complex <span class="free">z2</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> 1 2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="free">z1</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="var">?A</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="main">(</span>of_complex <span class="free">z1</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="var">?B</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="free">z2</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="var">?A</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="main">(</span>of_complex <span class="free">z2</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="var">?B</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="main">(</span><span class="skolem">Ze1</span> <span class="main">-</span> <span class="skolem">Re1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">Ze1</span> <span class="main">-</span> <span class="skolem">Re1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="main">(</span><span class="skolem">Ze1</span> <span class="main">+</span> <span class="skolem">Re1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">Ze1</span> <span class="main">+</span> <span class="skolem">Re1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">Ze1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">Ze2</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_circle_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">=</span> <span class="free">z2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> unique_midpoint_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ze1</span> <span class="main">-</span> <span class="skolem">Re1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ze1</span> <span class="main">+</span> <span class="skolem">Re1</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">Ze1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">z1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">z2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Re1</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="free">z1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">z1</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="free">z2</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">z2</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z1</span> <span class="main">≠</span> <span class="free">z2</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">x1'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">x1'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x1'</span> <span class="main">*</span> <span class="skolem">Ze1</span> <span class="main">+</span> <span class="skolem">Ze1</span> <span class="main">*</span> <span class="skolem">Ze1</span> <span class="main">-</span> cor <span class="main">(</span><span class="skolem">Re1</span> <span class="main">*</span> <span class="skolem">Re1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
           <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">x1'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">x1'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x1'</span> <span class="main">*</span> <span class="skolem">Ze2</span> <span class="main">+</span> <span class="skolem">Ze2</span> <span class="main">*</span> <span class="skolem">Ze2</span> <span class="main">-</span> cor <span class="main">(</span><span class="skolem">Re2</span> <span class="main">*</span> <span class="skolem">Re2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
           <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">x2'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">x2'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x2'</span> <span class="main">*</span> <span class="skolem">Ze1</span> <span class="main">+</span> <span class="skolem">Ze1</span> <span class="main">*</span> <span class="skolem">Ze1</span> <span class="main">-</span> cor <span class="main">(</span><span class="skolem">Re1</span> <span class="main">*</span> <span class="skolem">Re1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
           <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">x2'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">x2'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x2'</span> <span class="main">*</span> <span class="skolem">Ze2</span> <span class="main">+</span> <span class="skolem">Ze2</span> <span class="main">*</span> <span class="skolem">Ze2</span> <span class="main">-</span> cor <span class="main">(</span><span class="skolem">Re2</span> <span class="main">*</span> <span class="skolem">Re2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> circle_equation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Re1</span></span> <span class="quoted"><span class="skolem">Ze1</span></span><span class="main">]</span> circle_equation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Re2</span></span> <span class="quoted"><span class="skolem">Ze2</span></span><span class="main">]</span> circle
    <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Ze1</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">Ze1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Re1</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Ze2</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">Ze2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Re2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_add_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x1'</span></span><span class="main">]</span>  complex_add_cnj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x2'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Ze1</span></span> <span class="quoted"><span class="skolem">x1'</span></span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">x1'</span>"</span></span><span class="main">]</span> distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Ze2</span></span> <span class="quoted"><span class="skolem">x1'</span></span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">x1'</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Ze1</span></span> <span class="quoted"><span class="skolem">x2'</span></span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">x2'</span>"</span></span><span class="main">]</span> distrib_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Ze2</span></span> <span class="quoted"><span class="skolem">x2'</span></span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">x2'</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_mult_cnj power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x1'</span> <span class="main">*</span> <span class="skolem">Ze1</span> <span class="main">+</span> <span class="skolem">Ze1</span> <span class="main">*</span> <span class="skolem">Ze1</span> <span class="main">-</span> cor <span class="main">(</span><span class="skolem">Re1</span> <span class="main">*</span> <span class="skolem">Re1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x1'</span> <span class="main">*</span> <span class="skolem">Ze2</span> <span class="main">+</span> <span class="skolem">Ze2</span> <span class="main">*</span> <span class="skolem">Ze2</span> <span class="main">-</span> cor <span class="main">(</span><span class="skolem">Re2</span> <span class="main">*</span> <span class="skolem">Re2</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x2'</span> <span class="main">*</span> <span class="skolem">Ze1</span> <span class="main">+</span> <span class="skolem">Ze1</span> <span class="main">*</span> <span class="skolem">Ze1</span> <span class="main">-</span> cor <span class="main">(</span><span class="skolem">Re1</span> <span class="main">*</span> <span class="skolem">Re1</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x2'</span> <span class="main">*</span> <span class="skolem">Ze2</span> <span class="main">+</span> <span class="skolem">Ze2</span> <span class="main">*</span> <span class="skolem">Ze2</span> <span class="main">-</span> cor <span class="main">(</span><span class="skolem">Re2</span> <span class="main">*</span> <span class="skolem">Re2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> add_diff_cancel_right' add_diff_eq eq_iff_diff_eq_0 minus_diff_eq mult_minus_left of_real_minus<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x1'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">Ze2</span> <span class="main">-</span> <span class="skolem">Ze1</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="skolem">Ze2</span> <span class="main">*</span> <span class="skolem">Ze2</span> <span class="main">-</span> cor <span class="main">(</span><span class="skolem">Re2</span> <span class="main">*</span> <span class="skolem">Re2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">Ze1</span> <span class="main">*</span> <span class="skolem">Ze1</span> <span class="main">-</span> cor <span class="main">(</span><span class="skolem">Re1</span> <span class="main">*</span> <span class="skolem">Re1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x2'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">Ze2</span> <span class="main">-</span> <span class="skolem">Ze1</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="skolem">Ze2</span> <span class="main">*</span> <span class="skolem">Ze2</span> <span class="main">-</span> cor <span class="main">(</span><span class="skolem">Re2</span> <span class="main">*</span> <span class="skolem">Re2</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">Ze1</span> <span class="main">*</span> <span class="skolem">Ze1</span> <span class="main">-</span> cor <span class="main">(</span><span class="skolem">Re1</span> <span class="main">*</span> <span class="skolem">Re1</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x1'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">Ze2</span> <span class="main">-</span> <span class="skolem">Ze1</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x2'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">Ze2</span> <span class="main">-</span> <span class="skolem">Ze1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x1'</span> <span class="main">=</span> Re <span class="skolem">x2'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ze1</span> <span class="main">≠</span> <span class="skolem">Ze2</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Im <span class="skolem">x1'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>Im <span class="skolem">x2'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>1<span class="main">)</span> *<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">Ze1</span>›</span></span> complex_eq_if_Re_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">x1'</span> <span class="main">=</span> Im <span class="skolem">x2'</span> <span class="main">∨</span> Im <span class="skolem">x1'</span> <span class="main">=</span> <span class="main">-</span>Im <span class="skolem">x2'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> power2_eq_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> x' <span class="quoted"><span class="quoted">‹<span class="free">x1</span> <span class="main">≠</span> <span class="free">x2</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex.expand
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cnj.code complex_surj conjugate_of_complex<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Two h-circles of the same radius centered at mutually conjugate points intersect at the x-axis›</span></span>
<span class="keyword1" id="Poincare_Circles-intersect_poincare_circles_conjugate_centers"><span class="command">lemma</span></span> intersect_poincare_circles_conjugate_centers<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z2</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
          <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">≠</span> <span class="free">z2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">=</span> conjugate <span class="free">z2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> poincare_circle <span class="free">z1</span> <span class="free">r</span> <span class="main">∩</span> poincare_circle <span class="free">z2</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z1e</span></span> <span class="skolem"><span class="skolem">r1e</span></span> <span class="skolem"><span class="skolem">z2e</span></span> <span class="skolem"><span class="skolem">r2e</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   euclidean<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z1e</span><span class="main">,</span> <span class="skolem">r1e</span><span class="main">)</span> <span class="main">=</span> poincare_circle_euclidean <span class="free">z1</span> <span class="free">r</span>"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z2e</span><span class="main">,</span> <span class="skolem">r2e</span><span class="main">)</span> <span class="main">=</span> poincare_circle_euclidean <span class="free">z2</span> <span class="free">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> poincare_circle_euclidean_def<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z1'</span></span> <span class="skolem"><span class="skolem">z2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> z'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">z1</span> <span class="main">=</span> of_complex <span class="skolem">z1'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z2</span> <span class="main">=</span> of_complex <span class="skolem">z2'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z1</span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z2</span></span><span class="main">]</span> in_disc
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span> u'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> of_complex <span class="skolem">u'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> u inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_circle_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1'</span> <span class="main">=</span> cnj <span class="skolem">z2'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z1</span> <span class="main">=</span> conjugate <span class="free">z2</span>›</span></span> z'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> of_complex_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cz</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">z2'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?den</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?cz</span> <span class="main">*</span> <span class="main">(</span>cosh <span class="free">r</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cz</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_disc z'
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?den</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cosh_gt_1<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cor <span class="var">?den</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> of_real_eq_0_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r1e</span> <span class="main">=</span> <span class="skolem">r2e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1e</span> <span class="main">=</span> cnj <span class="skolem">z2e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1e</span> <span class="main">≠</span> <span class="skolem">z2e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> z' euclidean <span class="quoted"><span class="quoted">‹<span class="free">z1</span> <span class="main">≠</span> <span class="free">z2</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_circle_euclidean_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">∈</span> circle <span class="main">(</span>cnj <span class="skolem">z2e</span><span class="main">)</span> <span class="skolem">r2e</span> <span class="main">∩</span> circle <span class="skolem">z2e</span> <span class="skolem">r2e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z2e</span> <span class="main">≠</span> cnj <span class="skolem">z2e</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> euclidean u u'
    <span class="keyword1"><span class="command">using</span></span> poincare_circle_is_euclidean_circle<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z1</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_circle_is_euclidean_circle<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z2</span></span> <span class="quoted"><span class="free">r</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> in_disc <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">metis</span> image_iff of_complex_inj<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="skolem">u'</span> <span class="main">-</span> <span class="skolem">z2e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>cmod<span class="main">(</span><span class="skolem">u'</span> <span class="main">-</span> cnj <span class="skolem">z2e</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circle_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u'</span> <span class="main">-</span> <span class="skolem">z2e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cnj <span class="skolem">u'</span> <span class="main">-</span> cnj <span class="skolem">z2e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">u'</span> <span class="main">-</span> cnj <span class="skolem">z2e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cnj <span class="skolem">u'</span> <span class="main">-</span> <span class="skolem">z2e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_cnj_cnj complex_cnj_diff complex_norm_square<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z2e</span> <span class="main">-</span> cnj <span class="skolem">z2e</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">u'</span> <span class="main">-</span> cnj <span class="skolem">u'</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> u' <span class="quoted"><span class="quoted">‹<span class="skolem">z2e</span> <span class="main">≠</span> cnj <span class="skolem">z2e</span>›</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Congruent triangles›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For every pair of triangles such that its three pairs of sides are pairwise equal there is an
h-isometry (a unit disc preserving Möbius transform, eventually composed with a conjugation) that
maps one triangle onto the other.›</span></span>
<span class="keyword1" id="Poincare_Circles-unit_disc_fix_f_congruent_triangles"><span class="command">lemma</span></span> unit_disc_fix_f_congruent_triangles<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    in_disc'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    d<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> poincare_distance <span class="free">u'</span> <span class="free">v'</span>"</span></span>
       <span class="quoted"><span class="quoted">"poincare_distance <span class="free">v</span> <span class="free">w</span> <span class="main">=</span> poincare_distance <span class="free">v'</span> <span class="free">w'</span>"</span></span>
       <span class="quoted"><span class="quoted">"poincare_distance <span class="free">u</span> <span class="free">w</span> <span class="main">=</span> poincare_distance <span class="free">u'</span> <span class="free">w'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">M</span><span class="main">.</span> unit_disc_fix_f <span class="bound">M</span> <span class="main">∧</span> <span class="bound">M</span> <span class="free">u</span> <span class="main">=</span> <span class="free">u'</span> <span class="main">∧</span> <span class="bound">M</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v'</span> <span class="main">∧</span> <span class="bound">M</span> <span class="free">w</span> <span class="main">=</span> <span class="free">w'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span> <span class="main">∨</span> <span class="free">u</span> <span class="main">=</span> <span class="free">w</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="free">w</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u'</span></span> <span class="quoted"><span class="free">v'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v'</span></span> <span class="quoted"><span class="free">w'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u'</span></span> <span class="quoted"><span class="free">w'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_ex_moebius<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">v'</span></span> <span class="quoted"><span class="free">w'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_ex_moebius<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">u'</span></span> <span class="quoted"><span class="free">w'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_ex_moebius<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">u'</span></span> <span class="quoted"><span class="free">v'</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> unit_disc_fix_f_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">w</span> <span class="bound">u'</span> <span class="bound">v'</span> <span class="bound">w'</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">u'</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">v'</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">w'</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">w</span> <span class="main">≠</span> <span class="free">u</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">∧</span>
    poincare_distance <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> poincare_distance <span class="bound">u'</span> <span class="bound">v'</span> <span class="main">∧</span>
    poincare_distance <span class="free">v</span> <span class="bound">w</span> <span class="main">=</span> poincare_distance <span class="bound">v'</span> <span class="bound">w'</span> <span class="main">∧</span>
    poincare_distance <span class="free">u</span> <span class="bound">w</span> <span class="main">=</span> poincare_distance <span class="bound">u'</span> <span class="bound">w'</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∃</span> <span class="bound">M</span><span class="main">.</span> unit_disc_fix_f <span class="bound">M</span> <span class="main">∧</span> <span class="bound">M</span> <span class="free">u</span> <span class="main">=</span> <span class="bound">u'</span> <span class="main">∧</span> <span class="bound">M</span> <span class="free">v</span> <span class="main">=</span> <span class="bound">v'</span> <span class="main">∧</span> <span class="bound">M</span> <span class="bound">w</span> <span class="main">=</span> <span class="bound">w'</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">u</span> <span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_positive_x_axis<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> of_complex_zero_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex.expand<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">u'</span> <span class="skolem">v'</span> <span class="skolem">w'</span>
      <span class="keyword3"><span class="command">assume</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="skolem">u'</span> <span class="skolem">v'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M'</span></span> <span class="keyword2"><span class="keyword">where</span></span> M'<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M'</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M'</span> <span class="skolem">u'</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M'</span> <span class="skolem">v'</span> <span class="main">=</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_ex_moebius<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span> in_disc x
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M'</span> <span class="skolem">w'</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w'</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> of_complex <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> dist_gt_0<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">w</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> in_disc poincare_distance_ge0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> in_disc poincare_distance_ge0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> x
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w</span> <span class="main">=</span> poincare_distance <span class="skolem">v'</span> <span class="skolem">w'</span>"</span></span>
             <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">w</span> <span class="main">=</span> poincare_distance <span class="skolem">u'</span> <span class="skolem">w'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?w</span> <span class="main">=</span> poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">w</span>"</span></span>
            <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="var">?w</span> <span class="main">=</span> poincare_distance <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> M'<span class="main">(</span>1<span class="main">)</span> M'<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> M'<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> in_disc
        <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_preserve_poincare_distance<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M'</span></span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="skolem">w'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_preserve_poincare_distance<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M'</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="skolem">w'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">∈</span> poincare_circle <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∩</span> poincare_circle <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>poincare_distance <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> poincare_circle <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">w</span><span class="main">)</span> <span class="main">∩</span> poincare_circle <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>poincare_distance <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?w</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> poincare_circle_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">=</span> <span class="skolem">w</span> <span class="main">∨</span> <span class="var">?w</span> <span class="main">=</span> conjugate <span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> intersect_poincare_circles_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> x
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> dist_gt_0
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_0_iff
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">M</span><span class="main">.</span> unit_disc_fix_f <span class="bound">M</span> <span class="main">∧</span> <span class="bound">M</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">=</span> <span class="skolem">u'</span> <span class="main">∧</span> <span class="bound">M</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v'</span> <span class="main">∧</span> <span class="bound">M</span> <span class="skolem">w</span> <span class="main">=</span> <span class="skolem">w'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M'</span> <span class="skolem">w'</span> <span class="main">=</span> <span class="skolem">w</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> M'
          <span class="keyword1"><span class="command">using</span></span> moebius_pt_invert<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M'</span></span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> moebius_pt_invert<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M'</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> moebius_pt_invert<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M'</span></span> <span class="quoted"><span class="skolem">w'</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"moebius_pt <span class="main">(</span><span class="main">-</span><span class="skolem">M'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_disc_fix_f_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">M'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="main">(</span><span class="main">-</span><span class="skolem">M'</span><span class="main">)</span> <span class="main">∘</span> conjugate"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M'</span> <span class="skolem">w'</span> <span class="main">=</span> conjugate <span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">w</span> <span class="main">=</span> <span class="skolem">w'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> moebius_pt_invert<span class="main">[</span><span class="operator">of</span>  <span class="quoted"><span class="skolem">M'</span></span> <span class="quoted"><span class="skolem">w'</span></span> <span class="quoted"><span class="quoted">"conjugate <span class="skolem">w</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">=</span> <span class="skolem">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">v'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> moebius_pt_invert<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M'</span></span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> moebius_pt_invert<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M'</span></span> <span class="quoted"><span class="skolem">v'</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> M' <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix_f <span class="var">?M</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M'</span>›</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> unit_disc_fix_f_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">-</span><span class="skolem">M'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?Mu</span> <span class="var">?Mv</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">u'</span> <span class="skolem">v'</span> <span class="skolem">w'</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mw</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">w</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mu'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">u'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mv'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mw'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">w'</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
             <span class="quoted"><span class="quoted">"poincare_distance <span class="skolem">u</span> <span class="skolem">v</span> <span class="main">=</span> poincare_distance <span class="skolem">u'</span> <span class="skolem">v'</span>"</span></span>
             <span class="quoted"><span class="quoted">"poincare_distance <span class="skolem">v</span> <span class="skolem">w</span> <span class="main">=</span> poincare_distance <span class="skolem">v'</span> <span class="skolem">w'</span>"</span></span>
             <span class="quoted"><span class="quoted">"poincare_distance <span class="skolem">u</span> <span class="skolem">w</span> <span class="main">=</span> poincare_distance <span class="skolem">u'</span> <span class="skolem">w'</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M'</span></span> <span class="keyword2"><span class="keyword">where</span></span> M'<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix_f <span class="skolem">M'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="var">?Mu</span> <span class="main">=</span> <span class="var">?Mu'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="var">?Mv</span> <span class="main">=</span> <span class="var">?Mv'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M'</span> <span class="var">?Mw</span> <span class="main">=</span> <span class="var">?Mw'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 2<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?Mw</span></span></span> <span class="var"><span class="quoted"><span class="var">?Mu'</span></span></span> <span class="var"><span class="quoted"><span class="var">?Mv'</span></span></span> <span class="var"><span class="quoted"><span class="var">?Mw'</span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="main">(</span><span class="main">-</span><span class="skolem">M</span><span class="main">)</span> <span class="main">∘</span> <span class="skolem">M'</span> <span class="main">∘</span> moebius_pt <span class="skolem">M</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">M</span><span class="main">.</span> unit_disc_fix_f <span class="bound">M</span> <span class="main">∧</span> <span class="bound">M</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u'</span> <span class="main">∧</span> <span class="bound">M</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">v'</span> <span class="main">∧</span> <span class="bound">M</span> <span class="skolem">w</span> <span class="main">=</span> <span class="skolem">w'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?M</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix_f <span class="var">?M</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> M'<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> unit_disc_fix_f_comp<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> unit_disc_fix_f_comp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">v</span> <span class="main">=</span> <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">w</span> <span class="main">=</span> <span class="skolem">w'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> M'
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms False
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Poincare_Between">
<div class="head">
<h1>Theory Poincare_Between</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Poincare_Between
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Poincare_Distance.html">Poincare_Distance</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹H-betweenness in the Poincar\'e model›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹H-betwenness expressed by a cross-ratio›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The point $v$ is h-between $u$ and $w$ if the cross-ratio between the pairs $u$ and $w$ and $v$
and inverse of $v$ is real and negative.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poincare_between</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_homo <span class="main">⇒</span> complex_homo <span class="main">⇒</span> complex_homo <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poincare_between</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">⟷</span>
         <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">∨</span>
         <span class="main">(</span><span class="keyword1">let</span> <span class="bound">cr</span> <span class="main">=</span> cross_ratio <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">w</span></span></span> <span class="main">(</span>inversion <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>
           <span class="keyword1">in</span> is_real <span class="main">(</span>to_complex <span class="bound">cr</span><span class="main">)</span> <span class="main">∧</span> Re <span class="main">(</span>to_complex <span class="bound">cr</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹H-betwenness is preserved by h-isometries›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Since they preserve cross-ratio and inversion, h-isometries (unit disc preserving Möbius
transformations and conjugation) preserve h-betweeness.›</span></span>

<span class="keyword1" id="Poincare_Between-unit_disc_fix_moebius_preserve_poincare_between"><span class="command">lemma</span></span> unit_disc_fix_moebius_preserve_poincare_between <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">w</span><span class="main">)</span> <span class="main">⟷</span>
         poincare_between <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="free">w</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="free">u</span> <span class="main">≠</span> moebius_pt <span class="free">M</span> <span class="free">v</span> <span class="main">∧</span> moebius_pt <span class="free">M</span> <span class="free">v</span> <span class="main">≠</span> moebius_pt <span class="free">M</span> <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> inversion <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> inversion <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">∈</span> unit_disc›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> unit_circle_fix_moebius_pt_inversion<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> unit_circle_fix_moebius_pt_inversion<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Between-conjugate_preserve_poincare_between"><span class="command">lemma</span></span> conjugate_preserve_poincare_between <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span>conjugate <span class="free">u</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="free">v</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="free">w</span><span class="main">)</span> <span class="main">⟷</span>
         poincare_between <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="free">w</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"conjugate <span class="free">u</span> <span class="main">≠</span> conjugate <span class="free">v</span> <span class="main">∧</span> conjugate <span class="free">v</span> <span class="main">≠</span> conjugate <span class="free">w</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conjugate_inj <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> inversion <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">≠</span> inversion <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">w</span> <span class="main">∈</span> unit_disc›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> conjugate_cross_ratio<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">v</span>"</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> conjugate_id_iff conjugate_involution inversion_def inversion_sym o_apply<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Some elementary properties of h-betwenness›</span></span>

<span class="keyword1" id="Poincare_Between-poincare_between_nonstrict"><span class="command">lemma</span></span> poincare_between_nonstrict <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">u</span> <span class="free">u</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">u</span> <span class="free">v</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_between_def<span class="main">)</span>                       

<span class="keyword1" id="Poincare_Between-poincare_between_sandwich"><span class="command">lemma</span></span> poincare_between_sandwich<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">u</span> <span class="free">v</span> <span class="free">u</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> cross_ratio_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">v</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def Let_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Between-poincare_between_rev"><span class="command">lemma</span></span> poincare_between_rev<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="main">⟷</span> poincare_between <span class="free">w</span> <span class="free">v</span> <span class="free">u</span>"</span></span>       
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> cross_ratio_commute_13<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">v</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> cross_ratio_not_inf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">v</span>"</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> cross_ratio_not_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">v</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cross_ratio <span class="free">w</span> <span class="free">v</span> <span class="free">u</span> <span class="main">(</span>inversion <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def Im_complex_div_eq_0 Re_divide divide_less_0_iff<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹H-betwenness and h-collinearity›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Three points can be in an h-between relation only when they are h-collinear.›</span></span>
<span class="keyword1" id="Poincare_Between-poincare_between_poincare_collinear"><span class="command">lemma</span></span> poincare_between_poincare_collinear <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>       
  <span class="keyword2"><span class="keyword">assumes</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> betw<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">=</span> <span class="free">w</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> inversion <span class="free">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_disc inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> betw poincare_between_sandwich<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_between_def Let_def<span class="main">)</span>

  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">,</span> inversion <span class="free">v</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def
    <span class="keyword1"><span class="command">using</span></span> four_points_on_circline_iff_cross_ratio_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">w</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">v</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> poincare_line <span class="free">u</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms distinct
    <span class="keyword1"><span class="command">using</span></span> unique_circline_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="quoted">"inversion <span class="free">v</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span><span class="main">]</span> poincare_line_inversion<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">u</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">v</span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> * assms False
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"poincare_line <span class="free">u</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Between-poincare_between_poincare_line_uvz"><span class="command">lemma</span></span> poincare_between_poincare_line_uvz<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">u</span> <span class="free">v</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_collinear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Poincare_Between-poincare_between_poincare_line_uzv"><span class="command">lemma</span></span> poincare_between_poincare_line_uzv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">u</span> <span class="free">z</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_collinear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹H-betweeness on Euclidean segments›</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If the three points lie on an h-line that is a Euclidean line (e.g., if it contains zero),
h-betweenness can be characterized much simpler than in the definition.›</span></span>

<span class="keyword1" id="Poincare_Between-poincare_between_x_axis_u0v"><span class="command">lemma</span></span> poincare_between_x_axis_u0v<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">u'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span>of_complex <span class="free">u'</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="free">v'</span><span class="main">)</span> <span class="main">⟷</span> is_real <span class="free">v'</span> <span class="main">∧</span> Re <span class="free">u'</span> <span class="main">*</span> Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">u'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_eq_if_Re_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> nz<span class="main">:</span> <span class="quoted"><span class="quoted">"of_complex <span class="free">u'</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">v'</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">≠</span> of_complex <span class="free">v'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cross_ratio <span class="main">(</span>of_complex <span class="free">u'</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="free">v'</span><span class="main">)</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span> <span class="main">∧</span> Re <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> is_real <span class="free">v'</span> <span class="main">∧</span> Re <span class="free">u'</span> <span class="main">*</span> Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cross_ratio_0inf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v'</span></span> <span class="quoted"><span class="free">u'</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">v'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">u'</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Re_complex_div_lt_0 Re_mult_real complex_cnj_divide divide_cancel_left eq_cnj_iff_real to_complex_of_complex<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def inversion_zero
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="free">u'</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">≠</span> of_complex <span class="free">v'</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Between-poincare_between_u0v"><span class="command">lemma</span></span> poincare_between_u0v<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">u</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">v</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">k</span></span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">.</span> to_complex <span class="free">u</span> <span class="main">=</span> cor <span class="bound">k</span> <span class="main">*</span> to_complex <span class="free">v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">u</span> <span class="free">v</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_between_sandwich<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span><span class="main">]</span>      
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>                                                 
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">⟶</span> <span class="var">?P</span> <span class="bound">u</span> <span class="free">v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_rotation_to_positive_x_axis<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">φ</span> <span class="skolem">v</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="main">(</span>moebius_rotation <span class="skolem">φ</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="main">(</span><span class="var">?M</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span><span class="var">?M</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span><span class="var">?M</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">⟷</span> poincare_between <span class="skolem">u</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_moebius_preserve_poincare_between unit_disc_fix_rotation zero_in_unit_disc 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 2<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">u</span>"</span></span><span class="main">]</span> 3
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>    
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> of_complex <span class="skolem">u'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> of_complex <span class="skolem">u'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_between_rev<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_u0v<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">u'</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Re <span class="skolem">u'</span> <span class="main">/</span> Re <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_neg_pos <span class="dynamic"><span class="dynamic">algebra_split_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> mult_neg_pos mult_pos_neg
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Between-poincare_between_u0v_polar_form"><span class="command">lemma</span></span> poincare_between_u0v_polar_form<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
          <span class="quoted"><span class="quoted">"to_complex <span class="free">x</span> <span class="main">=</span> cor <span class="free">rx</span> <span class="main">*</span> cis <span class="free">φ</span>"</span></span> <span class="quoted"><span class="quoted">"to_complex <span class="free">y</span> <span class="main">=</span> cor <span class="free">ry</span> <span class="main">*</span> cis <span class="free">φ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">y</span> <span class="main">⟷</span> <span class="free">rx</span> <span class="main">*</span> <span class="free">ry</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">x</span> <span class="free">y</span> <span class="free">rx</span> <span class="free">ry</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">rx</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ry</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="main">0</span><span class="main">.</span> cor <span class="free">rx</span> <span class="main">=</span> cor <span class="bound">k</span> <span class="main">*</span> cor <span class="free">ry</span> <span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">rx</span> <span class="main">*</span> <span class="free">ry</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="main">0</span><span class="main">.</span> cor <span class="free">rx</span> <span class="main">=</span> cor <span class="bound">k</span> <span class="main">*</span> cor <span class="free">ry</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"cor <span class="free">rx</span> <span class="main">=</span> cor <span class="skolem">k</span> <span class="main">*</span> cor <span class="free">ry</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">rx</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">ry</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> of_real_eq_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">rx</span> <span class="main">*</span> <span class="free">ry</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">rx</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ry</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> divisors_zero mult_nonneg_nonpos mult_nonpos_nonpos zero_less_mult_pos2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">rx</span> <span class="main">*</span> <span class="free">ry</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">rx</span> <span class="main">=</span> <span class="main">(</span><span class="free">rx</span><span class="main">/</span><span class="free">ry</span><span class="main">)</span><span class="main">*</span><span class="free">ry</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">rx</span> <span class="main">/</span> <span class="free">ry</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">rx</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ry</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_less_0_iff <span class="dynamic"><span class="dynamic">algebra_split_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="main">0</span><span class="main">.</span> cor <span class="free">rx</span> <span class="main">=</span> cor <span class="bound">k</span> <span class="main">*</span> cor <span class="free">ry</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">rx</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ry</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">rx</span> <span class="main">/</span> <span class="free">ry</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms                                 
    <span class="keyword1"><span class="command">using</span></span> poincare_between_u0v<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Between-poincare_between_x_axis_0uv"><span class="command">lemma</span></span> poincare_between_x_axis_0uv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="free">x</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="free">y</span><span class="main">)</span> <span class="main">⟷</span>
        <span class="main">(</span><span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="free">y</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?x</span><span class="main">,</span> <span class="var">?y</span><span class="main">,</span> inversion <span class="var">?x</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?y</span> <span class="main">∈</span> unit_disc›</span></span>
    <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> of_complex_inj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct_length_2_or_more distinct_singleton of_complex_zero_iff of_real_eq_0_iff of_real_eq_iff zero_in_unit_disc<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cross_ratio <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?x</span> <span class="var">?y</span> <span class="main">(</span>inversion <span class="var">?x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> inversion_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="skolem">b</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute mult_eq_0_iff mult_neg_pos mult_pos_pos not_less_iff_gr_or_eq not_real_square_gt_zero power2_eq_square<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> minus_mult_minus mult_le_cancel_left1<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">y</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_le_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_less_0_iff<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lhs</span>›</span></span> distinct
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def Let_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> of_complex <span class="main">(</span>cor <span class="free">x</span><span class="main">)</span><span class="main">,</span> of_complex <span class="main">(</span>cor <span class="free">y</span><span class="main">)</span><span class="main">,</span> inversion <span class="main">(</span>of_complex <span class="main">(</span>cor <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> circline_set x_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> is_real_inversion<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cor <span class="free">x</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inversion <span class="var">?x</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> inversion_of_complex<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> four_points_on_circline_iff_cross_ratio_real<span class="main">[</span><span class="operator">OF</span> distinct<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> distinct
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def Let_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Between-poincare_between_0uv"><span class="command">lemma</span></span> poincare_between_0uv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">u</span> <span class="free">v</span> <span class="main">⟷</span>
         <span class="main">(</span><span class="keyword1">let</span> <span class="bound">u'</span> <span class="main">=</span> to_complex <span class="free">u</span><span class="main">;</span> <span class="bound">v'</span> <span class="main">=</span> to_complex <span class="free">v</span> <span class="keyword1">in</span> arg <span class="bound">u'</span> <span class="main">=</span> arg <span class="bound">v'</span> <span class="main">∧</span> cmod <span class="bound">u'</span> <span class="main">≤</span> cmod <span class="bound">v'</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">u</span> <span class="free">v</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">≠</span> <span class="free">u</span> <span class="main">⟶</span> <span class="main">(</span>poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">u</span> <span class="bound">v</span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">u'</span> <span class="main">=</span> to_complex <span class="free">u</span><span class="main">;</span> <span class="bound">v'</span> <span class="main">=</span> to_complex <span class="bound">v</span> <span class="keyword1">in</span> arg <span class="bound">u'</span> <span class="main">=</span> arg <span class="bound">v'</span> <span class="main">∧</span> cmod <span class="bound">u'</span> <span class="main">≤</span> cmod <span class="bound">v'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="free">u</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_rotation_to_positive_x_axis<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> circline_set x_axis"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> of_complex <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> circline_set x_axis"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_line_uvz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> poincare_line_0_real_is_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">≠</span> of_complex <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> circline_set x_axis›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> of_complex <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> of_complex <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">v'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">v'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> circline_set x_axis›</span></span> of_complex_inj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re real_imag_0<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">u'</span> <span class="main">=</span> to_complex <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span><span class="main">;</span> <span class="bound">v'</span> <span class="main">=</span> to_complex <span class="skolem">v</span> <span class="keyword1">in</span> arg <span class="bound">u'</span> <span class="main">=</span> arg <span class="bound">v'</span> <span class="main">∧</span> cmod <span class="bound">u'</span> <span class="main">≤</span> cmod <span class="bound">v'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_0uv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">v'</span>"</span></span><span class="main">]</span> * **
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">v</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> arg_complex_of_real_positive<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span>"</span></span><span class="main">]</span> arg_complex_of_real_negative<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> arg_complex_of_real_positive<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">v'</span>"</span></span><span class="main">]</span> arg_complex_of_real_negative<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">v'</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> of_complex <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> of_complex <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≠</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">u'</span> <span class="main">=</span> to_complex <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span><span class="main">;</span> <span class="bound">v'</span> <span class="main">=</span> to_complex <span class="skolem">v</span> <span class="keyword1">in</span> arg <span class="bound">u'</span> <span class="main">=</span> arg <span class="bound">v'</span> <span class="main">∧</span> cmod <span class="bound">u'</span> <span class="main">≤</span> cmod <span class="bound">v'</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="skolem">v'</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="skolem">v'</span> <span class="main">≤</span> Re <span class="skolem">x</span> <span class="main">∨</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">v'</span> <span class="main">∧</span> Re <span class="skolem">x</span> <span class="main">≤</span> Re <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> arg_pi_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> arg_pi_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> arg_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> arg_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> * **
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> cmod_Re_le_iff to_complex_of_complex<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">v'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">v'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span> ** <span class="quoted"><span class="quoted">‹is_real <span class="skolem">v'</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re complex_eq_if_Re_eq<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_0uv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">v'</span>"</span></span><span class="main">]</span> * ** ***
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">φ</span> <span class="skolem">u</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_rotation <span class="skolem">φ</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="main">(</span>moebius_pt <span class="var">?M</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="var">?M</span> <span class="skolem">v</span> <span class="main">≠</span> moebius_pt <span class="var">?M</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">u</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> of_complex <span class="skolem">v'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> of_complex <span class="skolem">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="var">?M</span> <span class="skolem">v</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹moebius_pt <span class="var">?M</span> <span class="skolem">v</span> <span class="main">≠</span> moebius_pt <span class="var">?M</span> <span class="skolem">u</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_moebius_preserve_poincare_between<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> arg_mult_eq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cis <span class="skolem">φ</span>"</span></span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> arg_mult norm_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms False
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Between-poincare_between_y_axis_0uv"><span class="command">lemma</span></span> poincare_between_y_axis_0uv<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span>
        <span class="main">(</span><span class="free">x</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> poincare_between_0uv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="free">y</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> arg_pi2_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> cor <span class="free">x</span>"</span></span><span class="main">]</span> arg_pi2_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> cor <span class="free">y</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> arg_minus_pi2_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> cor <span class="free">x</span>"</span></span><span class="main">]</span> arg_minus_pi2_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> cor <span class="free">y</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> norm_mult<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> <span class="main"><span class="main">(</span></span>verit<span class="main"><span class="main">,</span></span> best<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Poincare_Between-poincare_between_x_axis_uvw"><span class="command">lemma</span></span> poincare_between_x_axis_uvw<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span>of_complex <span class="free">x</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="free">y</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="free">z</span><span class="main">)</span> <span class="main">⟷</span>
        <span class="main">(</span><span class="free">y</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">&lt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">y</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">y</span> <span class="main">&gt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">&gt;</span> <span class="free">x</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_0uv assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_0uv assms poincare_between_rev
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> norm_of_real of_complex_zero of_real_0 poincare_between_nonstrict<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> unit_disc_iff_cmod_lt_1<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span>of_complex <span class="free">x</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="free">z</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>is_real <span class="free">z</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> poincare_between_x_axis_u0v 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">*</span> <span class="free">z</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> True <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> zero_le_mult_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">=</span> <span class="free">y</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="free">z</span>"</span></span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword1"><span class="command">have</span></span> distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="var">?x</span><span class="main">,</span> <span class="var">?y</span><span class="main">,</span> <span class="var">?z</span><span class="main">,</span> inversion <span class="var">?y</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≠</span> <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">≠</span> <span class="free">x</span>›</span></span> False <span class="quoted"><span class="quoted">‹<span class="var">?x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?z</span> <span class="main">∈</span> unit_disc›</span></span>
      <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> of_complex_inj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>  of_complex_inj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>  of_complex_inj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cor <span class="free">y</span> <span class="main">*</span> cor <span class="free">x</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> minus_mult_minus mult_less_cancel_left2 mult_less_cancel_right2 of_real_1 of_real_eq_iff of_real_mult<span class="main">)</span>
  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cr</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cross_ratio <span class="var">?x</span> <span class="var">?y</span> <span class="var">?z</span> <span class="main">(</span>inversion <span class="var">?y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="free">z</span><span class="main">*</span><span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">⋀</span><span class="bound">y</span> <span class="bound">x</span> <span class="bound">z</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">y</span> <span class="main">≠</span> <span class="bound">x</span><span class="main">;</span> <span class="bound">z</span> <span class="main">≠</span> <span class="bound">x</span><span class="main">;</span> <span class="bound">z</span> <span class="main">≠</span> <span class="bound">y</span><span class="main">;</span> cor <span class="bound">y</span> <span class="main">*</span> cor <span class="bound">x</span> <span class="main">≠</span> <span class="main">1</span><span class="main">;</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span> <span class="bound">z</span> <span class="main">≠</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> 
           <span class="main">(</span><span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="bound">y</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">y</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span>
           <span class="main">(</span><span class="bound">y</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="bound">y</span> <span class="main">*</span> <span class="bound">z</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">y</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
           <span class="main">(</span><span class="bound">y</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">y</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="bound">y</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="bound">z</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="bound">z</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">*</span> <span class="main">(</span><span class="bound">y</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> ab_group_add_class.ab_diff_conv_add_uminus distrib_left mult_divide_mult_cancel_left_if mult_minus_right<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≠</span> <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">≠</span> <span class="free">x</span>›</span></span> False <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cor <span class="free">y</span> <span class="main">*</span> cor <span class="free">x</span> <span class="main">≠</span> <span class="main">1</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> inversion_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
      
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">*</span><span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> minus_mult_minus mult_less_cancel_right2 zero_less_mult_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span><span class="main">*</span><span class="free">y</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> minus_mult_minus mult_less_cancel_right2 zero_less_mult_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">z</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≠</span> <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">≠</span> <span class="free">x</span>›</span></span> False <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> divide_less_cancel divide_nonneg_nonpos divide_nonneg_pos divide_nonpos_nonneg divide_nonpos_nonpos<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="dynamic"><span class="dynamic">algebra_split_simps</span></span><span class="main"><span class="main">(</span></span>24<span class="main"><span class="main">)</span></span> minus_divide_left zero_less_divide_iff zero_less_mult_iff<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lhs</span>›</span></span> distinct
        <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def Let_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> *
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> *
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>of_complex <span class="main">(</span>cor <span class="free">x</span><span class="main">)</span><span class="main">,</span> of_complex <span class="main">(</span>cor <span class="free">y</span><span class="main">)</span><span class="main">,</span> of_complex <span class="main">(</span>cor <span class="free">z</span><span class="main">)</span><span class="main">,</span> inversion <span class="main">(</span>of_complex <span class="main">(</span>cor <span class="free">y</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> circline_set x_axis"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">z</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>›</span></span> is_real_inversion<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cor <span class="free">y</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inversion <span class="var">?y</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> inversion_of_complex<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="var">?cr</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> four_points_on_circline_iff_cross_ratio_real<span class="main">[</span><span class="operator">OF</span> distinct<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> distinct
        <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def Let_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹H-betweenness and h-collinearity›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For three h-collinear points at least one of the three possible h-betweeness relations must
hold.›</span></span>
<span class="keyword1" id="Poincare_Between-poincare_collinear3_between"><span class="command">lemma</span></span> poincare_collinear3_between<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="main">∨</span> poincare_between <span class="free">u</span> <span class="free">w</span> <span class="free">v</span> <span class="main">∨</span> poincare_between <span class="free">v</span> <span class="free">u</span> <span class="free">w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">=</span><span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_collinear <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="bound">w</span><span class="main">}</span> <span class="main">⟶</span> <span class="var">?P'</span> <span class="free">u</span> <span class="free">v</span> <span class="bound">w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">u</span> <span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_positive_x_axis<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> complex.expand<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> x_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x poincare_line_0_real_is_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> of_complex <span class="skolem">x</span><span class="main">,</span> <span class="skolem">w</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> circline_set x_axis"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="keyword2"><span class="keyword">where</span></span> w'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> of_complex <span class="skolem">w'</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">w'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">w'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">w'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_between <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> w'
        <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">w'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> w' complex.expand<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w'</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">w'</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 poincare_between_x_axis_u0v<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">w'</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> w'
        <span class="keyword1"><span class="command">using</span></span> mult_pos_neg
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

      <span class="keyword1"><span class="command">moreover</span></span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">w'</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_0uv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">w'</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> w' x <span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">w'</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">w'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">w'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">w</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_0uv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">w'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> w' x <span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">w'</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">w'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">w'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?Mu</span> <span class="var">?Mv</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">,</span> <span class="skolem">w</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_between <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_between <span class="skolem">v</span> <span class="skolem">u</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">u</span> <span class="skolem">w</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 2<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">w</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Between-poincare_collinear3_iff"><span class="command">lemma</span></span> poincare_collinear3_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">}</span> <span class="main">⟷</span> poincare_between <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="main">∨</span> poincare_between <span class="free">v</span> <span class="free">u</span> <span class="free">w</span> <span class="main">∨</span> poincare_between <span class="free">v</span> <span class="free">w</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> poincare_collinear3_between insert_commute poincare_between_poincare_collinear poincare_between_rev<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Some properties of betweenness›</span></span>

<span class="keyword1" id="Poincare_Between-poincare_between_transitivity"><span class="command">lemma</span></span> poincare_between_transitivity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="quoted"><span class="quoted">"poincare_between <span class="free">a</span> <span class="free">x</span> <span class="free">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">a</span> <span class="free">b</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x</span> <span class="free">b</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> poincare_between_sandwich <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">y</span><span class="main">.</span> poincare_between <span class="free">a</span> <span class="bound">x</span> <span class="free">b</span> <span class="main">∧</span> poincare_between <span class="free">a</span> <span class="free">b</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc
                  <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc <span class="main">⟶</span> poincare_between <span class="bound">x</span> <span class="free">b</span> <span class="bound">y</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">a</span> <span class="free">b</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_positive_x_axis<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> 
              <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> poincare_between <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span> <span class="bound">x</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∧</span> 
                  poincare_between <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span> <span class="bound">y</span> <span class="main">∧</span>
                  <span class="bound">x</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc <span class="main">⟶</span>
                  poincare_between <span class="bound">x</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span> <span class="bound">y</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> poincare_between <span class="skolem">u</span> <span class="bound">x</span> <span class="skolem">v</span> <span class="main">∧</span> poincare_between <span class="skolem">u</span> <span class="skolem">v</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc 
                <span class="main">⟶</span> poincare_between <span class="bound">x</span> <span class="skolem">v</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">u</span> <span class="skolem">x</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_between <span class="skolem">u</span> <span class="skolem">x</span> <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_between <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">x</span> <span class="skolem">v</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">using</span></span> cmod_eq_Re <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xx <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> circline_set x_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xx <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">m</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">∧</span> poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="bound">n</span> <span class="main">∧</span>
            <span class="bound">m</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> unit_disc <span class="main">⟶</span> poincare_between <span class="bound">m</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">m</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
                 <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">n</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">m</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> circline_set x_axis"</span></span>
          <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_line_uzv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> poincare_line_0_real_is_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> circline_set x_axis›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> unit_disc›</span></span> **<span class="main">(</span>1<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> of_complex <span class="skolem">m'</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">m'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> unit_disc›</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">m'</span> <span class="main">≤</span> Re <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">m</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>›</span></span> xx <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> False ** <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
          <span class="keyword1"><span class="command">using</span></span> cmod_Re_le_iff poincare_between_0uv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> **<span class="main">(</span>2<span class="main">,</span> 4<span class="main">)</span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
          <span class="keyword1"><span class="command">using</span></span> poincare_between_sandwich <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> circline_set x_axis"</span></span>
          <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_line_uvz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> poincare_line_0_real_is_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> circline_set x_axis›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> unit_disc›</span></span> **<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> of_complex <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">n'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> unit_disc›</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">≤</span> Re <span class="skolem">n'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">n</span>›</span></span> xx <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> False ** <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> cmod_Re_le_iff poincare_between_0uv
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Re_complex_of_real arg_0_iff rcis_cmod_arg rcis_zero_arg to_complex_of_complex<span class="main">)</span>
        
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span>of_complex <span class="skolem">m'</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="skolem">n'</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">≤</span> Re <span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">m'</span> <span class="main">≤</span> Re <span class="skolem">x</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_uvw<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">m'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">n'</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">m'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> of_complex <span class="skolem">n'</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> xx <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">=</span> of_complex <span class="skolem">m'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> unit_disc›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> complex_of_real_Re norm_of_real poincare_between_def unit_disc_iff_cmod_lt_1<span class="main">)</span>

        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">=</span> of_complex <span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">=</span> of_complex <span class="skolem">m'</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Poincare between - sum distances›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Another possible definition of the h-betweenness relation is given in terms of h-distances
between pairs of points. We prove it as a characterization equivalent to our cross-ratio based
definition.›</span></span>

<span class="keyword1" id="Poincare_Between-poincare_between_sum_distances_x_axis_u0v"><span class="command">lemma</span></span> poincare_between_sum_distances_x_axis_u0v<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">u'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">v'</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="free">u'</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">+</span> poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="free">v'</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="main">(</span>of_complex <span class="free">u'</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="free">v'</span><span class="main">)</span> <span class="main">⟷</span>
          is_real <span class="free">v'</span> <span class="main">∧</span> Re <span class="free">u'</span> <span class="main">*</span> Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">u'</span> <span class="free">v'</span> <span class="main">⟷</span> <span class="var">?Q</span> <span class="free">u'</span> <span class="free">v'</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">u'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> complex_eq_if_Re_eq
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cmod <span class="free">u'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cmod <span class="free">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?uv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="free">u'</span> <span class="main">-</span> <span class="free">v'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unit_disc_cmod_square_lt_1<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> unit_disc_cmod_square_lt_1<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="free">u'</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">+</span> poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="free">v'</span><span class="main">)</span> <span class="main">=</span>
              arcosh <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">*</span> <span class="var">?u</span> <span class="main">*</span> <span class="var">?v</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> arcosh <span class="var">?r1</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula_zero_sum<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="free">u'</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="free">v'</span><span class="main">)</span> <span class="main">=</span>
              arcosh <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?uv</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> arcosh <span class="var">?r2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> disc
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> add_divide_distrib<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arcosh <span class="var">?r1</span> <span class="main">=</span> arcosh <span class="var">?r2</span> <span class="main">⟷</span> <span class="var">?Q</span> <span class="free">u'</span> <span class="free">v'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"arcosh <span class="var">?r1</span> <span class="main">=</span> arcosh <span class="var">?r2</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r1</span> <span class="main">=</span> <span class="var">?r2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> arcosh_eq_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r1</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">*</span> <span class="var">?u</span> <span class="main">*</span> <span class="var">?v</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> disc
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r2</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> disc
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="numeral">4</span> <span class="main">*</span> <span class="var">?u</span> <span class="main">*</span> <span class="var">?v</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?u</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="var">?v</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?uv</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> disc
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>              
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="free">u'</span> <span class="main">-</span> <span class="free">v'</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>cmod <span class="free">u'</span> <span class="main">+</span> cmod <span class="free">v'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">*</span> Re <span class="free">v'</span> <span class="main">+</span> <span class="main">¦</span>Re <span class="free">u'</span><span class="main">¦</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">(</span>Im <span class="free">v'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Re <span class="free">v'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">u'</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cmod_power2 cmod_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span>Im <span class="free">v'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Re <span class="free">v'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span>Re <span class="free">v'</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> complex_neq_0 mult.commute mult_cancel_right mult_minus_left real_sqrt_gt_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Im <span class="free">v'</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Im_eq_0 norm_complex_def<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">*</span> Re <span class="free">v'</span> <span class="main">=</span> <span class="main">-</span> <span class="main">¦</span>Re <span class="free">u'</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span>Re <span class="free">v'</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">*</span> Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">v'</span>›</span></span> complex_eq_if_Re_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="free">u'</span> <span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="free">u'</span> <span class="free">v'</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">v'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">*</span> Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r1</span> <span class="main">=</span> <span class="var">?r2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">*</span> Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> zero_le_mult_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> disc <span class="quoted"><span class="quoted">‹is_real <span class="free">u'</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">v'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cmod_power2 cmod_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">v'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">*</span> Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> zero_le_mult_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> disc <span class="quoted"><span class="quoted">‹is_real <span class="free">u'</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">v'</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> cmod_power2 cmod_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"arcosh <span class="var">?r1</span> <span class="main">=</span> arcosh <span class="var">?r2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Different proof of the previous theorem relying on the cross-ratio definition, and not the distance formula.
  We suppose that this could be also used to prove the triangle inequality.
›</span></span>
<span class="keyword1" id="Poincare_Between-poincare_between_sum_distances_x_axis_u0v_different_proof"><span class="command">lemma</span></span> poincare_between_sum_distances_x_axis_u0v_different_proof<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">u'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">v'</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="comment1">(* additional condition *)</span> <span class="quoted"><span class="quoted">"is_real <span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="free">u'</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">+</span> poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="free">v'</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="main">(</span>of_complex <span class="free">u'</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="free">v'</span><span class="main">)</span> <span class="main">⟷</span>
          Re <span class="free">u'</span> <span class="main">*</span> Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">u'</span> <span class="free">v'</span> <span class="main">⟷</span> <span class="var">?Q</span> <span class="free">u'</span> <span class="free">v'</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="free">u'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re complex_eq_if_Re_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="free">v'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">v'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re complex_eq_if_Re_eq<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">u'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">u'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">v'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">v'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">=</span>
        <span class="main">¦</span>ln <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">u'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">v'</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">u'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="free">v'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="main">⟷</span> Re <span class="free">u'</span> <span class="main">*</span> Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>ln <span class="var">?a1</span><span class="main">¦</span>  <span class="main">+</span> <span class="main">¦</span>ln <span class="var">?a2</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>ln <span class="var">?a3</span><span class="main">¦</span> <span class="main">⟷</span> <span class="main">_</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?a1</span>"</span></span> <span class="quoted"><span class="quoted">"ln <span class="var">?a1</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> Re <span class="free">u'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">u'</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> complex_is_Real_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?a2</span>"</span></span> <span class="quoted"><span class="quoted">"ln <span class="var">?a2</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">v'</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> complex_is_Real_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="var">?a3</span>"</span></span> <span class="quoted"><span class="quoted">"ln <span class="var">?a3</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> Re <span class="free">v'</span> <span class="main">&lt;</span> Re <span class="free">u'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">u'</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">v'</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> complex_is_Real_iff
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">*</span> Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>ln <span class="var">?a1</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span>ln <span class="var">?a2</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>ln <span class="var">?a3</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> *
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_nonneg_nonneg<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 2 3 <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">u'</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">v'</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> complex_is_Real_iff
          <span class="keyword1"><span class="command">using</span></span> ln_div ln_mult
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">v'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> *
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> zero_le_mult_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 2 3 <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">u'</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">v'</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> complex_is_Real_iff
          <span class="keyword1"><span class="command">using</span></span> ln_div ln_mult
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span>ln <span class="var">?a1</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span>ln <span class="var">?a2</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span>ln <span class="var">?a3</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">v'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> * 1 2 3
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">u'</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">v'</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> complex_is_Real_iff
          <span class="keyword1"><span class="command">using</span></span> ln_mult ln_div
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">v'</span> <span class="main">&lt;</span> Re <span class="free">u'</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> * 1 2 3
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">u'</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">v'</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> complex_is_Real_iff
          <span class="keyword1"><span class="command">using</span></span> ln_mult ln_div
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="free">v'</span> <span class="main">&lt;</span> Re <span class="free">u'</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="free">u'</span> <span class="main">*</span> Re <span class="free">v'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">u'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="free">v'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> divisors_zero mult_le_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poincare_distance_sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poincare_distance_zero_x_axis<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_x_axis<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poincare_distance_zero_x_axis<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_x_axis<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poincare_distance_x_axis_x_axis<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_x_axis<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_x_axis<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Between-poincare_between_sum_distances"><span class="command">lemma</span></span> poincare_between_sum_distances<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">u</span> <span class="free">v</span> <span class="free">w</span> <span class="main">⟷</span> 
         poincare_distance <span class="free">u</span> <span class="free">v</span> <span class="main">+</span> poincare_distance <span class="free">v</span> <span class="free">w</span> <span class="main">=</span> poincare_distance <span class="free">u</span> <span class="free">w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">w</span><span class="main">.</span> <span class="bound">w</span> <span class="main">∈</span> unit_disc <span class="main">⟶</span> <span class="main">(</span>poincare_between <span class="free">u</span> <span class="free">v</span> <span class="bound">w</span> <span class="main">⟷</span> poincare_distance <span class="free">u</span> <span class="free">v</span> <span class="main">+</span> poincare_distance <span class="free">v</span> <span class="bound">w</span> <span class="main">=</span> poincare_distance <span class="free">u</span> <span class="bound">w</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">u</span> <span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_positive_x_axis<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> circline_set x_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_x_axis<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> of_complex <span class="skolem">w'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">=</span> of_complex <span class="skolem">w'</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">=</span> of_complex <span class="skolem">w'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> unit_disc›</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poincare_between_x_axis_u0v<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> poincare_between_sum_distances_x_axis_u0v<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">u</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">v</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">w</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="skolem">v</span> <span class="skolem">u</span> <span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">w</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> **<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">w</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Some more properties of h-betweenness.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some lemmas proved earlier are proved almost directly using the sum of distances characterization.›</span></span>

<span class="keyword1" id="Poincare_Between-unit_disc_fix_moebius_preserve_poincare_between'"><span class="command">lemma</span></span> unit_disc_fix_moebius_preserve_poincare_between'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">w</span><span class="main">)</span> <span class="main">⟷</span>
         poincare_between <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> poincare_between_sum_distances
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Poincare_Between-conjugate_preserve_poincare_between'"><span class="command">lemma</span></span> conjugate_preserve_poincare_between'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span>conjugate <span class="free">u</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="free">v</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="free">w</span><span class="main">)</span> <span class="main">⟷</span> poincare_between <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> poincare_between_sum_distances
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹There is a unique point on a ray on the given distance from the given starting point›</span></span>
<span class="keyword1" id="Poincare_Between-unique_poincare_distance_on_ray"><span class="command">lemma</span></span> unique_poincare_distance_on_ray<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">u</span> <span class="free">y</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">u</span> <span class="free">v</span> <span class="free">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">u</span> <span class="free">z</span> <span class="main">=</span> <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">u</span> <span class="free">v</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">d</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">d</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span>
        <span class="bound">y</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_distance <span class="free">u</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">∧</span> poincare_between <span class="free">u</span> <span class="free">v</span> <span class="bound">y</span> <span class="main">∧</span>
        <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_distance <span class="free">u</span> <span class="bound">z</span> <span class="main">=</span> <span class="bound">d</span> <span class="main">∧</span> poincare_between <span class="free">u</span> <span class="free">v</span> <span class="bound">z</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">z</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">u</span> <span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_positive_x_axis<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> complex.expand<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> x_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x poincare_line_0_real_is_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arg <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x
      <span class="keyword1"><span class="command">using</span></span> arg_0_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">z</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> of_complex <span class="skolem">y'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> of_complex <span class="skolem">z'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">assume</span></span> betw<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>  <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_between_sandwich<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> of_complex_zero_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"arg <span class="skolem">y'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">y'</span> <span class="main">≥</span> cmod <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"arg <span class="skolem">z'</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">z'</span> <span class="main">≥</span> cmod <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_between_0uv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> poincare_between_0uv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹arg <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> unit_disc›</span></span> betw yz
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">y'</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">y'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> arg_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y'</span></span><span class="main">]</span> arg_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z'</span></span><span class="main">]</span> x <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> yz
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">z</span> <span class="main">=</span> poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">y</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * yz <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> unique_x_axis_poincare_distance_positive<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">y</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re unit_disc_to_complex_inj<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">d</span> <span class="skolem">y</span> <span class="skolem">z</span>
      <span class="keyword3"><span class="command">assume</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> poincare_distance <span class="skolem">u</span> <span class="skolem">y</span>"</span></span>
             <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">y</span>"</span></span>
             <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">z</span>"</span></span>
             <span class="quoted"><span class="quoted">"poincare_distance <span class="skolem">u</span> <span class="skolem">z</span> <span class="main">=</span> poincare_distance <span class="skolem">u</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?My</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mz</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mu</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mv</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?My</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mz</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?My</span> <span class="main">=</span> <span class="var">?Mz</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * ***
        <span class="keyword1"><span class="command">using</span></span> **<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"poincare_distance <span class="var">?Mu</span> <span class="var">?My</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?My</span></span></span> <span class="var"><span class="quoted"><span class="var">?Mz</span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> bij_moebius_pt<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> bij_def inj_on_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Poincare_Lines_Axis_Intersections">
<div class="head">
<h1>Theory Poincare_Lines_Axis_Intersections</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Poincare_Lines_Axis_Intersections
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Poincare_Between.html">Poincare_Between</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Intersection of h-lines with the x-axis in the Poincar\'e model›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="comment1">(* ---------------------------------------------------------------- *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Betweeness of x-axis intersection›</span></span>
<span class="comment1">(* ---------------------------------------------------------------- *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The intersection point of the h-line determined by points $u$ and $v$ and the x-axis is between
$u$ and $v$, then $u$ and $v$ are in the opposite half-planes (one must be in the upper, and the
other one in the lower half-plane).›</span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-poincare_between_x_axis_intersection"><span class="command">lemma</span></span> poincare_between_x_axis_intersection<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∉</span> circline_set x_axis"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∉</span> circline_set x_axis"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">∩</span> circline_set x_axis"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">u</span> <span class="free">z</span> <span class="free">v</span> <span class="main">⟷</span> arg <span class="main">(</span>to_complex <span class="free">u</span><span class="main">)</span> <span class="main">*</span> arg <span class="main">(</span>to_complex <span class="free">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">∧</span>
       <span class="bound">u</span> <span class="main">∉</span> circline_set x_axis <span class="main">∧</span> <span class="bound">v</span> <span class="main">∉</span> circline_set x_axis <span class="main">∧</span> 
       <span class="free">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="bound">u</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∩</span> circline_set x_axis <span class="main">⟶</span> 
       <span class="main">(</span>poincare_between <span class="bound">u</span> <span class="free">z</span> <span class="bound">v</span> <span class="main">⟷</span> arg <span class="main">(</span>to_complex <span class="bound">u</span><span class="main">)</span> <span class="main">*</span> arg <span class="main">(</span>to_complex <span class="bound">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">z</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_real_zero<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
                <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> circline_set x_axis"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> circline_set x_axis"</span></span>
                <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∩</span> circline_set x_axis"</span></span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> uv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> of_complex <span class="skolem">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> of_complex <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

       
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> *
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"arg <span class="skolem">u'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"arg <span class="skolem">v'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * arg_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u'</span></span><span class="main">]</span> arg_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis uv
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> *
        <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"poincare_line <span class="skolem">u</span> <span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&lt;</span><span class="main">0</span><span class="main">.</span> <span class="skolem">u'</span> <span class="main">=</span> cor <span class="bound">k</span> <span class="main">*</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>arg <span class="skolem">u'</span> <span class="main">*</span> arg <span class="skolem">v'</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">=</span> cor <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">v'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> arg_mult_real_negative<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> arg_uminus_opposite_sign<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹arg <span class="skolem">u'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹arg <span class="skolem">v'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_neg_pos mult_pos_neg<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ru</span></span> <span class="skolem"><span class="skolem">rv</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="keyword2"><span class="keyword">where</span></span> polar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">=</span> cor <span class="skolem">ru</span> <span class="main">*</span> cis <span class="skolem">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v'</span> <span class="main">=</span> cor <span class="skolem">rv</span> <span class="main">*</span> cis <span class="skolem">φ</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">}</span>›</span></span> poincare_collinear_zero_polar_form<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="skolem">v'</span></span><span class="main">]</span> uv * <span class="quoted"><span class="quoted">‹<span class="skolem">u'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ru</span> <span class="main">*</span> <span class="skolem">rv</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> polar <span class="quoted"><span class="quoted">‹<span class="var">?rhs</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> arg_mult_real_negative<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ru</span>"</span></span> <span class="quoted"><span class="quoted">"cis <span class="skolem">φ</span>"</span></span><span class="main">]</span> arg_mult_real_positive<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ru</span>"</span></span> <span class="quoted"><span class="quoted">"cis <span class="skolem">φ</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> arg_mult_real_negative<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">rv</span>"</span></span> <span class="quoted"><span class="quoted">"cis <span class="skolem">φ</span>"</span></span><span class="main">]</span> arg_mult_real_positive<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">rv</span>"</span></span> <span class="quoted"><span class="quoted">"cis <span class="skolem">φ</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ru</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">rv</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_pos_neg<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">rv</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_neg_pos<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> polar     
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">ru</span> <span class="main">/</span> <span class="skolem">rv</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_less_0_iff mult_less_0_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">u</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>arg <span class="main">(</span>to_complex <span class="skolem">u</span><span class="main">)</span> <span class="main">*</span> arg <span class="main">(</span>to_complex <span class="skolem">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_between_u0v<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> * <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> uv
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">z</span> 
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>moebius_pt <span class="main">(</span>blaschke <span class="skolem">a</span><span class="main">)</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="main">(</span>blaschke <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> circline_set x_axis"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∉</span> circline_set x_axis"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="main">::</span> real<span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> sgn <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="bound">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∩</span> circline_set x_axis"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">u</span> <span class="skolem">z</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span>arg <span class="main">(</span>to_complex <span class="skolem">u</span><span class="main">)</span> <span class="main">*</span> arg <span class="main">(</span>to_complex <span class="skolem">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * 1 2<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?Mu</span></span></span> <span class="var"><span class="quoted"><span class="var">?Mv</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">a</span>›</span></span> blaschke_unit_disc_fix<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> **<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> **<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sgn_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> sgn_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> **<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> **<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sgn_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> sgn_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_x_axis<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Check if an h-line intersects the x-axis›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-x_axis_intersection_equation"><span class="command">lemma</span></span> x_axis_intersection_equation<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> mk_circline <span class="free">A</span> <span class="free">B</span> <span class="free">C</span> <span class="free">D</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">,</span> <span class="free">C</span><span class="main">,</span> <span class="free">D</span><span class="main">)</span> <span class="main">∈</span> hermitean_nonzero"</span></span>
 <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="free">z</span> <span class="main">∈</span> circline_set x_axis <span class="main">∩</span> circline_set <span class="free">H</span> <span class="main">⟷</span>
        <span class="free">A</span><span class="main">*</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>Re <span class="free">B</span><span class="main">*</span><span class="free">z</span> <span class="main">+</span> <span class="free">D</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> is_real <span class="free">z</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="free">A</span><span class="main">*</span><span class="free">z</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span><span class="free">B</span> <span class="main">+</span> cnj <span class="free">B</span><span class="main">)</span><span class="main">*</span><span class="free">z</span> <span class="main">+</span> <span class="free">D</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">=</span> cnj <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> circline_equation_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> circline_equation<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">D</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> hermitean_elems
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> hermitean_elems<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">B</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">C</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">D</span></span></span></span></span></span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_add_cnj complex_eq_if_Re_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Check if an h-line intersects x-axis within the unit disc - this could be generalized to
checking if an arbitrary circline intersects the x-axis, but we do not need that.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">intersects_x_axis_cmat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intersects_x_axis_cmat</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">,</span> <span class="bound">C</span><span class="main">,</span> <span class="bound">D</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="keyword1">in</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span>Re <span class="bound">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="bound">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> intersects_x_axis_clmat <span class="main">::</span> <span class="quoted"><span class="quoted">"circline_mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">intersects_x_axis_cmat</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> intersects_x_axis <span class="main">::</span> <span class="quoted"><span class="quoted">"circline <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">intersects_x_axis_clmat</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H1</span> <span class="skolem">H2</span>
  <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H1</span> <span class="main">∧</span> <span class="skolem">H1</span> <span class="main">≠</span> mat_zero"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H2</span> <span class="main">∧</span> <span class="skolem">H2</span> <span class="main">≠</span> mat_zero"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A1</span></span> <span class="skolem"><span class="skolem">B1</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">D1</span></span> <span class="skolem"><span class="skolem">A2</span></span> <span class="skolem"><span class="skolem">B2</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="skolem"><span class="skolem">D2</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A1</span><span class="main">,</span> <span class="skolem">B1</span><span class="main">,</span> <span class="skolem">C1</span><span class="main">,</span> <span class="skolem">D1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A2</span><span class="main">,</span> <span class="skolem">B2</span><span class="main">,</span> <span class="skolem">C2</span><span class="main">,</span> <span class="skolem">D2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">H2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="skolem">H1</span> <span class="skolem">H2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">H2</span> <span class="main">=</span> cor <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">H1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_cmat <span class="skolem">H1</span> <span class="main">=</span> intersects_x_axis_cmat <span class="skolem">H2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>Re <span class="skolem">A1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span>Re <span class="skolem">B1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> Re <span class="skolem">A1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> Re <span class="skolem">B1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_strict_left_mono power2_eq_square semiring_normalization_rules<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> zero_less_power2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> * k
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-intersects_x_axis_mk_circline"><span class="command">lemma</span></span> intersects_x_axis_mk_circline<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="main">(</span>mk_circline <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>cnj <span class="free">B</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">A</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span>Re <span class="free">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">,</span> <span class="main">(</span>cnj <span class="free">B</span><span class="main">)</span><span class="main">,</span>  <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="var">?H</span>"</span></span>                
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">A</span>›</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> hermitean_def mat_adj_def mat_cnj_def
    <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="main">≠</span> mat_zero"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-intersects_x_axis_iff"><span class="command">lemma</span></span> intersects_x_axis_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> circline_set x_axis<span class="main">)</span> <span class="main">⟷</span> intersects_x_axis <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ac</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">Dc</span></span> <span class="keyword2"><span class="keyword">where</span></span>  *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> mk_circline <span class="skolem">Ac</span> <span class="skolem">B</span> <span class="skolem">C</span> <span class="skolem">Dc</span>"</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="main">(</span><span class="skolem">Ac</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">Dc</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Ac</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">Dc</span><span class="main">)</span> <span class="main">≠</span> mat_zero"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ex_mk_circline<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="skolem">Ac</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ac</span> <span class="main">=</span> <span class="skolem">Dc</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> is_poincare_line_mk_circline
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> mk_circline <span class="main">(</span>Re <span class="skolem">Ac</span><span class="main">)</span> <span class="skolem">B</span> <span class="main">(</span>cnj <span class="skolem">B</span><span class="main">)</span> <span class="main">(</span>Re <span class="skolem">Ac</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="main">(</span>cor <span class="main">(</span>Re <span class="skolem">Ac</span><span class="main">)</span><span class="main">,</span>  <span class="skolem">B</span><span class="main">,</span> <span class="main">(</span>cnj <span class="skolem">B</span><span class="main">)</span><span class="main">,</span> cor <span class="main">(</span>Re <span class="skolem">Ac</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cor <span class="main">(</span>Re <span class="skolem">Ac</span><span class="main">)</span><span class="main">,</span>  <span class="skolem">B</span><span class="main">,</span> <span class="main">(</span>cnj <span class="skolem">B</span><span class="main">)</span><span class="main">,</span> cor <span class="main">(</span>Re <span class="skolem">Ac</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> mat_zero"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hermitean_elems<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Ac</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Dc</span></span></span></span></span></span></span></span><span class="main">]</span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> mk_circline <span class="main">(</span>cor <span class="skolem">A</span><span class="main">)</span> <span class="skolem">B</span> <span class="main">(</span>cnj <span class="skolem">B</span><span class="main">)</span> <span class="main">(</span>cor <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cor <span class="skolem">A</span><span class="main">,</span>  <span class="skolem">B</span><span class="main">,</span> <span class="main">(</span>cnj <span class="skolem">B</span><span class="main">)</span><span class="main">,</span> cor <span class="skolem">A</span><span class="main">)</span> <span class="main">∈</span> hermitean_nonzero"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">using</span></span> x_axis_intersection_equation<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_mk_circline<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"cor <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="skolem">B</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> circline_set x_axis"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> circline_set x_axis"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_or_of_complex inf_notin_unit_disc<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
        <span class="keyword1"><span class="command">using</span></span> of_complex_inj
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">B</span> <span class="main">*</span> Re <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> **
        <span class="keyword1"><span class="command">using</span></span> x_axis_intersection_equation<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">A</span> <span class="main">*</span> <span class="skolem">A</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> discriminant_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> discrim_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span> False
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≥</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≠</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B</span> <span class="main">=</span> Re <span class="skolem">A</span> <span class="main">∨</span> Re <span class="skolem">B</span> <span class="main">=</span> <span class="main">-</span> Re <span class="skolem">A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> power2_eq_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span>  <span class="skolem">A</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">*</span> Re <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">A</span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">A</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> eq
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span>  <span class="numeral">2</span><span class="main">*</span> Re <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">A</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span>Re <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span>Re <span class="skolem">x</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_sum power2_diff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">=</span> <span class="main">-</span><span class="main">1</span> <span class="main">∨</span> Re <span class="skolem">x</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="free">H</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_mk_circline
        <span class="keyword1"><span class="command">using</span></span> *
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * False
        <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_mk_circline
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> discr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> <span class="skolem">A</span> <span class="main">*</span> <span class="skolem">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        eqs<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">*</span> <span class="skolem">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">B</span> <span class="main">*</span> <span class="skolem">x1</span> <span class="main">+</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">*</span> <span class="skolem">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">B</span> <span class="main">*</span> <span class="skolem">x2</span> <span class="main">+</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> discriminant_pos_ex<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> discrim_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">*</span> <span class="skolem">x2</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> viette2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> Re <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="skolem">x1</span></span> <span class="quoted"><span class="skolem">x2</span></span><span class="main">]</span> discr <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="skolem">x1</span> <span class="main">≠</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"abs <span class="skolem">x2</span> <span class="main">≠</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> eqs discr <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">*</span> <span class="skolem">x2</span> <span class="main">=</span> <span class="main">1</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_if power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs <span class="skolem">x1</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">∨</span> abs <span class="skolem">x2</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">*</span> <span class="skolem">x2</span> <span class="main">=</span> <span class="main">1</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_le_cancel_left1 mult_minus_right<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> circline_set x_axis"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x_axis_intersection_equation<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x1</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> x_axis_intersection_equation<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">(</span></span>1-2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x2</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> eqs
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Check if a Poincar\'e line intersects the y-axis›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">intersects_y_axis_cmat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intersects_y_axis_cmat</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">,</span> <span class="bound">C</span><span class="main">,</span> <span class="bound">D</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="keyword1">in</span> <span class="bound">A</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span>Im <span class="bound">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="bound">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> intersects_y_axis_clmat <span class="main">::</span> <span class="quoted"><span class="quoted">"circline_mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">intersects_y_axis_cmat</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> intersects_y_axis <span class="main">::</span> <span class="quoted"><span class="quoted">"circline <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">intersects_y_axis_clmat</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H1</span> <span class="skolem">H2</span>
  <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H1</span> <span class="main">∧</span> <span class="skolem">H1</span> <span class="main">≠</span> mat_zero"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H2</span> <span class="main">∧</span> <span class="skolem">H2</span> <span class="main">≠</span> mat_zero"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A1</span></span> <span class="skolem"><span class="skolem">B1</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">D1</span></span> <span class="skolem"><span class="skolem">A2</span></span> <span class="skolem"><span class="skolem">B2</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="skolem"><span class="skolem">D2</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A1</span><span class="main">,</span> <span class="skolem">B1</span><span class="main">,</span> <span class="skolem">C1</span><span class="main">,</span> <span class="skolem">D1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A2</span><span class="main">,</span> <span class="skolem">B2</span><span class="main">,</span> <span class="skolem">C2</span><span class="main">,</span> <span class="skolem">D2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">H2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="skolem">H1</span> <span class="skolem">H2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">H2</span> <span class="main">=</span> cor <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">H1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"intersects_y_axis_cmat <span class="skolem">H1</span> <span class="main">=</span> intersects_y_axis_cmat <span class="skolem">H2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span>Re <span class="skolem">A1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span>Im <span class="skolem">B1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> Re <span class="skolem">A1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> Im <span class="skolem">B1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_strict_left_mono power2_eq_square semiring_normalization_rules<span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> zero_less_power2<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> * k
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-intersects_x_axis_intersects_y_axis"><span class="command">lemma</span></span> intersects_x_axis_intersects_y_axis <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="main">(</span>moebius_circline <span class="main">(</span>moebius_rotation <span class="main">(</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">⟷</span> intersects_y_axis <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> moebius_rotation_def moebius_similarity_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_adj_def mat_cnj_def<span class="main">)</span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-intersects_y_axis_iff"><span class="command">lemma</span></span> intersects_y_axis_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> circline_set y_axis<span class="main">)</span> <span class="main">⟷</span> intersects_y_axis <span class="free">H</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_rotation <span class="main">(</span>pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_circline <span class="var">?R</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="var">?H'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> unit_circle_fix_preserve_is_poincare_line<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> circline_set y_axis"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="var">?R</span> <span class="skolem">y</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> moebius_pt <span class="var">?R</span> <span class="skolem">y</span> <span class="main">∈</span> circline_set <span class="var">?H'</span> <span class="main">∩</span> circline_set x_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rotation_pi_2_y_axis
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff circline_set_moebius_circline_E moebius_circline_comp_inv_left moebius_pt_comp_inv_left unit_disc_fix_discI unit_disc_fix_rotation<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_iff<span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_intersects_y_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"intersects_y_axis <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="var">?H'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_intersects_y_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> circline_set <span class="var">?H'</span> <span class="main">∩</span> circline_set x_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_iff<span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="main">(</span><span class="main">-</span><span class="var">?R</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="var">?y</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> circline_set y_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * rotation_pi_2_y_axis<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff circline_set_moebius_circline_E moebius_pt_comp_inv_left moebius_rotation_uminus uminus_moebius_def unit_disc_fix_discI unit_disc_fix_rotation<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Intersection point of a Poincar\'e line with the x-axis in the unit disc›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">calc_x_axis_intersection_cvec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> complex <span class="main">⇒</span> complex_vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">calc_x_axis_intersection_cvec</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="bound">discr</span> <span class="main">=</span> <span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="keyword1">in</span>
         <span class="main">(</span><span class="main">-</span>Re<span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">+</span> sgn <span class="main">(</span>Re <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">)</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="bound">discr</span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* intersection with the x-axis for poincare lines that are euclidean circles *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">calc_x_axis_intersection_cmat_cvec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_mat <span class="main">⇒</span> complex_vec"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">calc_x_axis_intersection_cmat_cvec</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span>
    <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">,</span> <span class="bound">C</span><span class="main">,</span> <span class="bound">D</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="keyword1">in</span> 
       <span class="keyword1">if</span> <span class="bound">A</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span>
          calc_x_axis_intersection_cvec <span class="bound">A</span> <span class="bound">B</span>
       <span class="keyword1">else</span>
          <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span>
    <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> calc_x_axis_intersection_clmat_hcoords <span class="main">::</span> <span class="quoted"><span class="quoted">"circline_mat <span class="main">⇒</span> complex_homo_coords"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">calc_x_axis_intersection_cmat_cvec</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> calc_x_axis_intersection <span class="main">::</span> <span class="quoted"><span class="quoted">"circline <span class="main">⇒</span> complex_homo"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">calc_x_axis_intersection_clmat_hcoords</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">transfer</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H1</span> <span class="skolem">H2</span>
  <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H1</span> <span class="main">∧</span> <span class="skolem">H1</span> <span class="main">≠</span> mat_zero"</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H2</span> <span class="main">∧</span> <span class="skolem">H2</span> <span class="main">≠</span> mat_zero"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A1</span></span> <span class="skolem"><span class="skolem">B1</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">D1</span></span> <span class="skolem"><span class="skolem">A2</span></span> <span class="skolem"><span class="skolem">B2</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="skolem"><span class="skolem">D2</span></span> <span class="keyword2"><span class="keyword">where</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A1</span><span class="main">,</span> <span class="skolem">B1</span><span class="main">,</span> <span class="skolem">C1</span><span class="main">,</span> <span class="skolem">D1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A2</span><span class="main">,</span> <span class="skolem">B2</span><span class="main">,</span> <span class="skolem">C2</span><span class="main">,</span> <span class="skolem">D2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">H2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="skolem">H1</span> <span class="skolem">H2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H2</span> <span class="main">=</span> cor <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">H1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"calc_x_axis_intersection_cvec <span class="skolem">A1</span> <span class="skolem">B1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> calc_x_axis_intersection_cvec <span class="skolem">A2</span> <span class="skolem">B2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hh k
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"cor <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_mult power_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> right_diff_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> real_sqrt_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sgn_eq right_diff_distrib<span class="main">)</span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"calc_x_axis_intersection_cmat_cvec <span class="skolem">H1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span>
        calc_x_axis_intersection_cmat_cvec <span class="skolem">H2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hh k
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> calc_x_axis_intersection_cvec_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Poincare_Lines_Axis_Intersections-calc_x_axis_intersection_in_unit_disc"><span class="command">lemma</span></span> calc_x_axis_intersection_in_unit_disc<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"calc_x_axis_intersection <span class="free">H</span> <span class="main">∈</span> unit_disc"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_line <span class="free">H</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> unit_disc_def disc_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> unit_disc_def disc_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span>
    <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">H</span> <span class="main">≠</span> mat_zero"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> cnj <span class="skolem">B</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">D</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hermitean_elems
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H</span></span><span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> cnj <span class="skolem">B</span><span class="main">,</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> circline_A0_cmat <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_cmat <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square complex.expand<span class="main">)</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex.expand<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">&lt;</span> sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> real_sqrt_less_iff<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  sgn <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_minus_right nonzero_eq_divide_eq real_sgn_eq real_sqrt_abs<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">&lt;</span> sgn <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> sgn <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_strict_right_mono<span class="main">[</span><span class="operator">OF</span> 1<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span>sgn <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>Re <span class="skolem">B</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mult_strict_left_mono<span class="main">[</span><span class="operator">OF</span> 2<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sgn <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">B</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sgn_if<span class="main">)</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span>Re <span class="skolem">B</span> <span class="main">+</span> sgn <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>›</span></span> 3
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_diff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"in_ocircline_cmat_cvec unit_circle_cmat <span class="main">(</span>calc_x_axis_intersection_cmat_cvec <span class="skolem">H</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def power2_eq_square <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Poincare_Lines_Axis_Intersections-calc_x_axis_intersection"><span class="command">lemma</span></span> calc_x_axis_intersection<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"calc_x_axis_intersection <span class="free">H</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> circline_set x_axis"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"is_line <span class="free">H</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span>
    <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">H</span> <span class="main">≠</span> mat_zero"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> cnj <span class="skolem">B</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">D</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hermitean_elems
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H</span></span><span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> cnj <span class="skolem">B</span><span class="main">,</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> circline_A0_cmat <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_cmat <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square complex.expand<span class="main">)</span>

    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"on_circline_cmat_cvec <span class="skolem">H</span> <span class="main">(</span>calc_x_axis_intersection_cmat_cvec <span class="skolem">H</span><span class="main">)</span> <span class="main">∧</span>
        on_circline_cmat_cvec x_axis_cmat <span class="main">(</span>calc_x_axis_intersection_cmat_cvec <span class="skolem">H</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P1</span> <span class="main">∧</span> <span class="var">?P2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"on_circline_cmat_cvec <span class="skolem">H</span> <span class="main">(</span>calc_x_axis_intersection_cmat_cvec <span class="skolem">H</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"circline_A0_cmat <span class="skolem">H</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹is_poincare_line_cmat <span class="skolem">H</span>›</span></span> <span class="quoted"><span class="quoted">‹intersects_x_axis_cmat <span class="skolem">H</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"calc_x_axis_intersection_cvec <span class="skolem">A</span> <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nom</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst <span class="var">?x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?den</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd <span class="var">?x</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">=</span> <span class="main">(</span><span class="var">?nom</span><span class="main">,</span> <span class="var">?den</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"on_circline_cmat_cvec <span class="skolem">H</span> <span class="main">(</span>calc_x_axis_intersection_cvec <span class="skolem">A</span> <span class="skolem">B</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> on_circline_cmat_cvec_circline_equation<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">B</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> sgn_pos zero_less_power2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> 
                <span class="main">(</span><span class="main">-</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_diff<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">*</span><span class="main">(</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">1</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span>
                        <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>           

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?nom</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?den</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span><span class="var">?nom</span><span class="main">)</span> <span class="main">=</span> <span class="var">?nom</span>"</span></span> <span class="quoted"><span class="quoted">"cnj <span class="main">(</span><span class="var">?den</span><span class="main">)</span> <span class="main">=</span> <span class="var">?den</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>eq_cnj_iff_real<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>      
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">*</span><span class="var">?nom</span><span class="main">*</span><span class="main">(</span>cnj <span class="main">(</span><span class="var">?nom</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">*</span><span class="var">?den</span><span class="main">*</span><span class="main">(</span>cnj <span class="main">(</span><span class="var">?nom</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>cnj <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>cnj <span class="main">(</span><span class="var">?den</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="var">?nom</span> <span class="main">+</span> <span class="skolem">A</span><span class="main">*</span><span class="var">?den</span><span class="main">*</span><span class="main">(</span>cnj <span class="main">(</span><span class="var">?den</span><span class="main">)</span><span class="main">)</span>
                <span class="main">=</span> <span class="skolem">A</span><span class="main">*</span><span class="var">?nom</span><span class="main">*</span><span class="var">?nom</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">*</span><span class="var">?den</span><span class="main">*</span><span class="var">?nom</span> <span class="main">+</span> <span class="main">(</span>cnj <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="var">?den</span><span class="main">*</span><span class="var">?nom</span> <span class="main">+</span> <span class="skolem">A</span><span class="main">*</span><span class="var">?den</span><span class="main">*</span><span class="var">?den</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">A</span><span class="main">*</span><span class="var">?nom</span><span class="main">*</span><span class="var">?nom</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">B</span> <span class="main">+</span> <span class="main">(</span>cnj <span class="skolem">B</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="var">?den</span><span class="main">*</span><span class="var">?nom</span> <span class="main">+</span> <span class="skolem">A</span><span class="main">*</span><span class="var">?den</span><span class="main">*</span><span class="var">?den</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">A</span><span class="main">*</span><span class="var">?nom</span><span class="main">*</span><span class="var">?nom</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="var">?den</span><span class="main">*</span><span class="var">?nom</span> <span class="main">+</span> <span class="skolem">A</span><span class="main">*</span><span class="var">?den</span><span class="main">*</span><span class="var">?den</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>complex_add_cnj<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">A</span><span class="main">*</span><span class="var">?nom</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="var">?den</span><span class="main">*</span><span class="var">?nom</span> <span class="main">+</span> <span class="skolem">A</span><span class="main">*</span><span class="var">?den</span><span class="main">*</span><span class="var">?den</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">A</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>
                           <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="skolem">A</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">A</span><span class="main">*</span><span class="skolem">A</span><span class="main">*</span><span class="skolem">A</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> calc_x_axis_intersection_cvec_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">A</span><span class="main">*</span><span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="skolem">A</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">A</span><span class="main">*</span><span class="skolem">A</span><span class="main">*</span><span class="skolem">A</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">-</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span>
                        <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="skolem">A</span><span class="main">*</span><span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="skolem">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> 
                     <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="skolem">A</span><span class="main">*</span><span class="main">(</span><span class="main">-</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">+</span> sgn<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">*</span>sqrt<span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">A</span><span class="main">*</span><span class="skolem">A</span><span class="main">*</span><span class="skolem">A</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">*</span><span class="var">?nom</span><span class="main">*</span><span class="main">(</span>cnj <span class="main">(</span><span class="var">?nom</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">B</span><span class="main">*</span><span class="var">?den</span><span class="main">*</span><span class="main">(</span>cnj <span class="main">(</span><span class="var">?nom</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>cnj <span class="skolem">B</span><span class="main">)</span><span class="main">*</span><span class="main">(</span>cnj <span class="main">(</span><span class="var">?den</span><span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="var">?nom</span> <span class="main">+</span> <span class="skolem">A</span><span class="main">*</span><span class="var">?den</span><span class="main">*</span><span class="main">(</span>cnj <span class="main">(</span><span class="var">?den</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>       
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"circline_equation <span class="skolem">A</span> <span class="skolem">B</span> <span class="main">(</span>cnj <span class="skolem">B</span><span class="main">)</span> <span class="skolem">A</span> <span class="var">?nom</span> <span class="var">?den</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹is_poincare_line_cmat <span class="skolem">H</span>›</span></span> <span class="quoted"><span class="quoted">‹intersects_x_axis_cmat <span class="skolem">H</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"on_circline_cmat_cvec x_axis_cmat <span class="main">(</span>calc_x_axis_intersection_cmat_cvec <span class="skolem">H</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹is_poincare_line_cmat <span class="skolem">H</span>›</span></span> <span class="quoted"><span class="quoted">‹intersects_x_axis_cmat <span class="skolem">H</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-unique_calc_x_axis_intersection"><span class="command">lemma</span></span> unique_calc_x_axis_intersection<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≠</span> x_axis"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> circline_set x_axis"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> calc_x_axis_intersection <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_iff<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> calc_x_axis_intersection <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calc_x_axis_intersection<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> *<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> calc_x_axis_intersection_in_unit_disc<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> *<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> unique_is_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="quoted">"calc_x_axis_intersection <span class="free">H</span>"</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted">x_axis</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Check if an h-line intersects the positive part of the x-axis›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">intersects_x_axis_positive_cmat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intersects_x_axis_positive_cmat</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">,</span> <span class="bound">C</span><span class="main">,</span> <span class="bound">D</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="keyword1">in</span> Re <span class="bound">A</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> Re <span class="bound">B</span> <span class="main">/</span> Re <span class="bound">A</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> intersects_x_axis_positive_clmat <span class="main">::</span> <span class="quoted"><span class="quoted">"circline_mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">intersects_x_axis_positive_cmat</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> intersects_x_axis_positive <span class="main">::</span> <span class="quoted"><span class="quoted">"circline <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">intersects_x_axis_positive_clmat</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H1</span> <span class="skolem">H2</span>
  <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H1</span> <span class="main">∧</span> <span class="skolem">H1</span> <span class="main">≠</span> mat_zero"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H2</span> <span class="main">∧</span> <span class="skolem">H2</span> <span class="main">≠</span> mat_zero"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A1</span></span> <span class="skolem"><span class="skolem">B1</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">D1</span></span> <span class="skolem"><span class="skolem">A2</span></span> <span class="skolem"><span class="skolem">B2</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="skolem"><span class="skolem">D2</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A1</span><span class="main">,</span> <span class="skolem">B1</span><span class="main">,</span> <span class="skolem">C1</span><span class="main">,</span> <span class="skolem">D1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A2</span><span class="main">,</span> <span class="skolem">B2</span><span class="main">,</span> <span class="skolem">C2</span><span class="main">,</span> <span class="skolem">D2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">H2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="skolem">H1</span> <span class="skolem">H2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">H2</span> <span class="main">=</span> cor <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">H1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive_cmat <span class="skolem">H1</span> <span class="main">=</span> intersects_x_axis_positive_cmat <span class="skolem">H2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-intersects_x_axis_positive_mk_circline"><span class="command">lemma</span></span> intersects_x_axis_positive_mk_circline<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive <span class="main">(</span>mk_circline <span class="free">A</span> <span class="free">B</span> <span class="main">(</span>cnj <span class="free">B</span><span class="main">)</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> Re <span class="free">B</span> <span class="main">/</span> Re <span class="free">A</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">B</span><span class="main">,</span> <span class="main">(</span>cnj <span class="free">B</span><span class="main">)</span><span class="main">,</span>  <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="var">?H</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">A</span>›</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> hermitean_def mat_adj_def mat_cnj_def
    <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H</span> <span class="main">≠</span> mat_zero"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Poincare_Lines_Axis_Intersections-intersects_x_axis_positive_intersects_x_axis"><span class="command">lemma</span></span> intersects_x_axis_positive_intersects_x_axis <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">a</span> <span class="bound">aa</span><span class="main">.</span> <span class="main">⟦</span> Re <span class="bound">a</span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span> Re <span class="bound">aa</span> <span class="main">/</span> Re <span class="bound">a</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">1</span><span class="main">;</span> <span class="main">¬</span> <span class="main">(</span>Re <span class="bound">a</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span>Re <span class="bound">aa</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">aa</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> less_divide_eq_1_pos one_less_power pos2 power2_minus power_divide zero_less_power2<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-add_less_abs_positive_iff"><span class="command">lemma</span></span> add_less_abs_positive_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"abs <span class="free">b</span> <span class="main">&lt;</span> abs <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-calc_x_axis_intersection_positive_abs'"><span class="command">lemma</span></span> calc_x_axis_intersection_positive_abs'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span> <span class="free">B</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>sgn<span class="main">(</span><span class="free">B</span><span class="main">)</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="free">A</span><span class="main">)</span> <span class="main">&lt;</span> abs<span class="main">(</span><span class="main">-</span><span class="free">B</span><span class="main">/</span><span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">&lt;</span> abs <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> real_sqrt_less_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult divide_strict_right_mono<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-calc_intersect_x_axis_positive_lemma"><span class="command">lemma</span></span> calc_intersect_x_axis_positive_lemma<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">B</span> <span class="main">+</span> sgn <span class="free">B</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">-</span><span class="free">B</span><span class="main">/</span><span class="free">A</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">B</span> <span class="main">+</span> sgn <span class="free">B</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">A</span> <span class="main">=</span> <span class="main">-</span><span class="free">B</span> <span class="main">/</span> <span class="free">A</span> <span class="main">+</span> <span class="main">(</span>sgn <span class="free">B</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">A</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">B</span> <span class="main">/</span> <span class="free">A</span> <span class="main">+</span> <span class="main">(</span>sgn <span class="free">B</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="free">B</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">A</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">-</span> <span class="free">B</span> <span class="main">/</span> <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> add_less_abs_positive_iff<span class="main">[</span><span class="operator">OF</span> calc_x_axis_intersection_positive_abs'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">B</span><span class="main">/</span><span class="free">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span><span class="main">/</span><span class="free">A</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">B</span><span class="main">/</span><span class="free">A</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> one_power2 pos2 power2_minus power_0 power_strict_decreasing zero_power2<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">B</span> <span class="main">/</span> <span class="free">A</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="main">-</span><span class="free">B</span> <span class="main">/</span> <span class="free">A</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-intersects_x_axis_positive_iff'"><span class="command">lemma</span></span> intersects_x_axis_positive_iff'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive <span class="free">H</span> <span class="main">⟷</span> 
         calc_x_axis_intersection <span class="free">H</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> calc_x_axis_intersection <span class="free">H</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> positive_x_axis"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"calc_x_axis_intersection <span class="free">H</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> circline_set x_axis"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">using</span></span> calc_x_axis_intersection_in_unit_disc<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> calc_x_axis_intersection<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lhs</span>›</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span>
    <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">H</span> <span class="main">≠</span> mat_zero"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive_cmat <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B</span> <span class="main">/</span> Re <span class="skolem">A</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> **
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> divide_less_eq_1_neg divide_minus_left less_divide_eq_1_pos real_sqrt_abs real_sqrt_less_iff right_inverse_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hh hermitean_elems * <span class="quoted"><span class="quoted">‹Re <span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> complex.expand<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> cmod_power2 power2_less_0 zero_power2<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">-</span> Re <span class="skolem">B</span> <span class="main">+</span> sgn <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> Re <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> calc_intersect_x_axis_positive_lemma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B</span>"</span></span><span class="main">]</span> ** <span class="quoted"><span class="quoted">‹<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">D</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * hh
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span>cor <span class="main">(</span>sgn <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> cor <span class="main">(</span>sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> cor <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sgn <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> Re <span class="skolem">B</span><span class="main">)</span> <span class="main">/</span> Re <span class="skolem">D</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">D</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Re_complex_of_real complex_of_real_Re of_real_diff of_real_divide of_real_mult<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="main">(</span>to_complex_cvec <span class="main">(</span>calc_x_axis_intersection_cmat_cvec <span class="skolem">H</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * hh ** *** <span class="quoted"><span class="quoted">‹<span class="main">(</span>cmod <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">D</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> positive_x_axis_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"calc_x_axis_intersection <span class="free">H</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="var">?x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> circline_set x_axis"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> positive_x_axis_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_iff<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="main">(</span>to_complex <span class="var">?x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span>
    <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">H</span> <span class="main">≠</span> mat_zero"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="main">(</span>to_complex_cvec <span class="main">(</span>calc_x_axis_intersection_cmat_cvec <span class="skolem">H</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_cmat <span class="skolem">H</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="main">(</span><span class="main">(</span>cor <span class="main">(</span>sgn <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> cor <span class="main">(</span>sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> cor <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">D</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * hh hermitean_elems
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> complex.expand<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">(</span>cor <span class="main">(</span>sgn <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> cor <span class="main">(</span>sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> cor <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">D</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sgn <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> Re <span class="skolem">B</span><span class="main">)</span> <span class="main">/</span> Re <span class="skolem">D</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">D</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Re_complex_of_real complex_of_real_Re of_real_diff of_real_divide of_real_mult<span class="main">)</span>

    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive_cmat <span class="skolem">H</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * ** <span class="quoted"><span class="quoted">‹Re <span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> calc_intersect_x_axis_positive_lemma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-intersects_x_axis_positive_iff"><span class="command">lemma</span></span> intersects_x_axis_positive_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≠</span> x_axis"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive <span class="free">H</span> <span class="main">⟷</span> 
         <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">x</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> positive_x_axis<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_positive_iff'<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> positive_x_axis"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> unique_calc_x_axis_intersection<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_positive_iff'<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> positive_x_axis_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Check if an h-line intersects the positive part of the y-axis›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">intersects_y_axis_positive_cmat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">intersects_y_axis_positive_cmat</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">,</span> <span class="bound">C</span><span class="main">,</span> <span class="bound">D</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="keyword1">in</span> Re <span class="bound">A</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> Im <span class="bound">B</span> <span class="main">/</span> Re <span class="bound">A</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> intersects_y_axis_positive_clmat <span class="main">::</span> <span class="quoted"><span class="quoted">"circline_mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">intersects_y_axis_positive_cmat</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> intersects_y_axis_positive <span class="main">::</span> <span class="quoted"><span class="quoted">"circline <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">intersects_y_axis_positive_clmat</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H1</span> <span class="skolem">H2</span>
  <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H1</span> <span class="main">∧</span> <span class="skolem">H1</span> <span class="main">≠</span> mat_zero"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H2</span> <span class="main">∧</span> <span class="skolem">H2</span> <span class="main">≠</span> mat_zero"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A1</span></span> <span class="skolem"><span class="skolem">B1</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">D1</span></span> <span class="skolem"><span class="skolem">A2</span></span> <span class="skolem"><span class="skolem">B2</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="skolem"><span class="skolem">D2</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A1</span><span class="main">,</span> <span class="skolem">B1</span><span class="main">,</span> <span class="skolem">C1</span><span class="main">,</span> <span class="skolem">D1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A2</span><span class="main">,</span> <span class="skolem">B2</span><span class="main">,</span> <span class="skolem">C2</span><span class="main">,</span> <span class="skolem">D2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">H2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="skolem">H1</span> <span class="skolem">H2</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="skolem">H2</span> <span class="main">=</span> cor <span class="skolem">k</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>m</sub></span> <span class="skolem">H1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"intersects_y_axis_positive_cmat <span class="skolem">H1</span> <span class="main">=</span> intersects_y_axis_positive_cmat <span class="skolem">H2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-intersects_x_axis_positive_intersects_y_axis_positive"><span class="command">lemma</span></span> intersects_x_axis_positive_intersects_y_axis_positive <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive <span class="main">(</span>moebius_circline <span class="main">(</span>moebius_rotation <span class="main">(</span><span class="main">-</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="free">H</span><span class="main">)</span> <span class="main">⟷</span> intersects_y_axis_positive <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hermitean_elems
  <span class="keyword1"><span class="command">unfolding</span></span> moebius_rotation_def moebius_similarity_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mat_adj_def mat_cnj_def<span class="main">)</span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-intersects_y_axis_positive_iff"><span class="command">lemma</span></span> intersects_y_axis_positive_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≠</span> y_axis"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> positive_y_axis<span class="main">)</span> <span class="main">⟷</span> intersects_y_axis_positive <span class="free">H</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_rotation <span class="main">(</span><span class="main">-</span>pi <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_circline <span class="var">?R</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="var">?H'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> unit_circle_fix_preserve_is_poincare_line<span class="main">[</span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"moebius_circline <span class="var">?R</span> <span class="free">H</span> <span class="main">≠</span> x_axis"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> moebius_circline <span class="main">(</span>moebius_rotation <span class="main">(</span>pi<span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> x_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> moebius_circline_comp_inv_left<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?R</span></span></span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">H</span> <span class="main">≠</span> y_axis›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> positive_y_axis"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="var">?R</span> <span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="var">?R</span> <span class="skolem">y</span> <span class="main">∈</span> circline_set <span class="var">?H'</span> <span class="main">∩</span> positive_x_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> rotation_minus_pi_2_positive_y_axis
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_positive_iff<span class="main">[</span><span class="operator">OF</span> 1 2<span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_positive_intersects_y_axis_positive<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"intersects_y_axis_positive <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive <span class="var">?H'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_positive_intersects_y_axis_positive<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> circline_set <span class="var">?H'</span> <span class="main">∩</span> positive_x_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_positive_iff<span class="main">[</span><span class="operator">OF</span> 1 2<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="main">(</span><span class="main">-</span><span class="var">?R</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="var">?y</span> <span class="main">∈</span> circline_set <span class="free">H</span> <span class="main">∩</span> positive_y_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * rotation_minus_pi_2_positive_y_axis<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_iff circline_set_moebius_circline_E image_eqI moebius_pt_comp_inv_image_left moebius_rotation_uminus uminus_moebius_def unit_disc_fix_discI unit_disc_fix_rotation<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Position of the intersection point in the unit disc›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Check if the intersection point of one h-line with the x-axis is located more outward the edge
of the disc than the intersection point of another h-line.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">outward_cmat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_mat <span class="main">⇒</span> complex_mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">outward_cmat</span> <span class="free"><span class="bound"><span class="entity">H1</span></span></span> <span class="free"><span class="bound"><span class="entity">H2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">A1</span><span class="main">,</span> <span class="bound">B1</span><span class="main">,</span> <span class="bound">C1</span><span class="main">,</span> <span class="bound">D1</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">H1</span></span></span><span class="main">;</span> <span class="main">(</span><span class="bound">A2</span><span class="main">,</span> <span class="bound">B2</span><span class="main">,</span> <span class="bound">C2</span><span class="main">,</span> <span class="bound">D2</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">H2</span></span></span>
                                 <span class="keyword1">in</span> <span class="main">-</span>Re <span class="bound">B1</span><span class="main">/</span>Re <span class="bound">A1</span> <span class="main">≤</span> <span class="main">-</span>Re <span class="bound">B2</span><span class="main">/</span>Re <span class="bound">A2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> outward_clmat <span class="main">::</span> <span class="quoted"><span class="quoted">"circline_mat <span class="main">⇒</span> circline_mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">outward_cmat</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> outward <span class="main">::</span> <span class="quoted"><span class="quoted">"circline <span class="main">⇒</span> circline <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">outward_clmat</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">circline_mat1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">circline_mat2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">circline_mat3</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">circline_mat4</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule_tac</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-outward_mk_circline"><span class="command">lemma</span></span> outward_mk_circline<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">A1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_real <span class="free">A2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">B1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">A2</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">B2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"outward <span class="main">(</span>mk_circline <span class="free">A1</span> <span class="free">B1</span> <span class="main">(</span>cnj <span class="free">B1</span><span class="main">)</span> <span class="free">A1</span><span class="main">)</span> <span class="main">(</span>mk_circline <span class="free">A2</span> <span class="free">B2</span> <span class="main">(</span>cnj <span class="free">B2</span><span class="main">)</span> <span class="free">A2</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">-</span> Re <span class="free">B1</span> <span class="main">/</span> Re <span class="free">A1</span> <span class="main">≤</span> <span class="main">-</span> Re <span class="free">B2</span> <span class="main">/</span> Re <span class="free">A2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A1</span><span class="main">,</span> <span class="free">B1</span><span class="main">,</span> <span class="main">(</span>cnj <span class="free">B1</span><span class="main">)</span><span class="main">,</span>  <span class="free">A1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?H2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A2</span><span class="main">,</span> <span class="free">B2</span><span class="main">,</span> <span class="main">(</span>cnj <span class="free">B2</span><span class="main">)</span><span class="main">,</span>  <span class="free">A2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="var">?H1</span>"</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="var">?H2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">A1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="free">A2</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> hermitean_def mat_adj_def mat_cnj_def
    <span class="keyword1"><span class="command">using</span></span> eq_cnj_iff_real 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H1</span> <span class="main">≠</span> mat_zero"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?H2</span> <span class="main">≠</span> mat_zero"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-calc_x_axis_intersection_fun_mono"><span class="command">lemma</span></span> calc_x_axis_intersection_fun_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x1</span> <span class="free">x2</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">&gt;</span> <span class="free">x1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">-</span> sqrt<span class="main">(</span><span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">x2</span> <span class="main">-</span> sqrt<span class="main">(</span><span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"sqrt<span class="main">(</span><span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> one_less_power pos2 real_sqrt_gt_zero<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt<span class="main">(</span><span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">x1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> real_sqrt_less_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">x1</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt<span class="main">(</span><span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">x2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> real_sqrt_less_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">x1</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x2</span> <span class="main">&gt;</span> <span class="free">x1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt<span class="main">(</span><span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">x1</span> <span class="main">+</span> <span class="free">x2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x1</span> <span class="main">+</span> <span class="free">x2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>sqrt<span class="main">(</span><span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">using</span></span> less_divide_eq_1_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sqrt<span class="main">(</span><span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">+</span> <span class="free">x2</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>sqrt<span class="main">(</span><span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">x2</span> <span class="main">-</span> <span class="free">x1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x2</span> <span class="main">&gt;</span> <span class="free">x1</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_less_cancel_left_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">-</span> <span class="free">x1</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x2</span> <span class="main">+</span> <span class="free">x1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>sqrt<span class="main">(</span><span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sqrt<span class="main">(</span><span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> sqrt<span class="main">(</span><span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>sqrt<span class="main">(</span><span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> sqrt<span class="main">(</span><span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x1</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x2</span> <span class="main">&gt;</span> <span class="free">x1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt<span class="main">(</span><span class="free">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> sqrt<span class="main">(</span><span class="free">x1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">x2</span> <span class="main">-</span> <span class="free">x1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-calc_x_axis_intersection_mono"><span class="command">lemma</span></span> calc_x_axis_intersection_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a1</span> <span class="free">b1</span> <span class="free">a2</span> <span class="free">b2</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">b1</span><span class="main">/</span><span class="free">a1</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">b2</span><span class="main">/</span><span class="free">a2</span> <span class="main">≥</span> <span class="main">-</span><span class="free">b1</span><span class="main">/</span><span class="free">a1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="free">b1</span> <span class="main">+</span> sgn <span class="free">b1</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="free">b1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">a1</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">a1</span> <span class="main">≥</span> <span class="main">(</span><span class="main">-</span><span class="free">b2</span> <span class="main">+</span> sgn <span class="free">b2</span> <span class="main">*</span> sqrt<span class="main">(</span><span class="free">b2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="free">a2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="free">a2</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">≥</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="main">-</span><span class="free">b1</span><span class="main">/</span><span class="free">a1</span> <span class="main">-</span> sqrt<span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free">b1</span><span class="main">/</span><span class="free">a1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> divide_neg_pos<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b1</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a1</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_divide <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b1</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b1</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> divide_pos_neg<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b1</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a1</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_divide <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">=</span> <span class="main">-</span><span class="free">b2</span><span class="main">/</span><span class="free">a2</span> <span class="main">-</span> sqrt<span class="main">(</span><span class="main">(</span><span class="main">-</span><span class="free">b2</span><span class="main">/</span><span class="free">a2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> divide_neg_pos<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a2</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_divide <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">b2</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">a2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> divide_pos_neg<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">b2</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_divide <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> calc_x_axis_intersection_fun_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">b1</span><span class="main">/</span><span class="free">a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">b2</span><span class="main">/</span><span class="free">a2</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">b1</span><span class="main">/</span><span class="free">a1</span><span class="main">=</span><span class="main">-</span><span class="free">b2</span><span class="main">/</span><span class="free">a2</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-outward"><span class="command">lemma</span></span> outward<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive <span class="free">H1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive <span class="free">H2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"outward <span class="free">H1</span> <span class="free">H2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="main">(</span>calc_x_axis_intersection <span class="free">H1</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> Re <span class="main">(</span>to_complex <span class="main">(</span>calc_x_axis_intersection <span class="free">H2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="free">H1</span>"</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="free">H2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H1</span> <span class="skolem">H2</span>
    <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H1</span> <span class="main">∧</span> <span class="skolem">H1</span> <span class="main">≠</span> mat_zero"</span></span>  <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H2</span> <span class="main">∧</span> <span class="skolem">H2</span> <span class="main">≠</span> mat_zero"</span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A1</span></span> <span class="skolem"><span class="skolem">B1</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">D1</span></span> <span class="skolem"><span class="skolem">A2</span></span> <span class="skolem"><span class="skolem">B2</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="skolem"><span class="skolem">D2</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A1</span><span class="main">,</span> <span class="skolem">B1</span><span class="main">,</span> <span class="skolem">C1</span><span class="main">,</span> <span class="skolem">D1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A2</span><span class="main">,</span> <span class="skolem">B2</span><span class="main">,</span> <span class="skolem">C2</span><span class="main">,</span> <span class="skolem">D2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">H2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A1</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> hermitean_elems * hh
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive_cmat <span class="skolem">H1</span>"</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive_cmat <span class="skolem">H2</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"intersects_x_axis_cmat <span class="skolem">H1</span>"</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_cmat <span class="skolem">H2</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H1</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H2</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"outward_cmat <span class="skolem">H1</span> <span class="skolem">H2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A2</span>›</span></span> 1 complex.expand<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A1</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> complex.expand<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A2</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sgn <span class="main">(</span>Re <span class="skolem">B2</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> Re <span class="skolem">B2</span><span class="main">)</span> <span class="main">/</span> Re <span class="skolem">A2</span>
         <span class="main">≤</span> <span class="main">(</span>sgn <span class="main">(</span>Re <span class="skolem">B1</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> Re <span class="skolem">B1</span><span class="main">)</span> <span class="main">/</span> Re <span class="skolem">A1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> calc_x_axis_intersection_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B1</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">A1</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B2</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">A2</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> 1 4 *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sgn <span class="main">(</span>Re <span class="skolem">B2</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> Re <span class="skolem">B2</span><span class="main">)</span> <span class="main">/</span> Re <span class="skolem">A2</span> <span class="main">=</span> 
          Re <span class="main">(</span><span class="main">(</span>cor <span class="main">(</span>sgn <span class="main">(</span>Re <span class="skolem">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> cor <span class="main">(</span>sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> cor <span class="main">(</span>Re <span class="skolem">B2</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">A2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Re_divide_real<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sgn <span class="main">(</span>Re <span class="skolem">B1</span><span class="main">)</span> <span class="main">*</span> sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> Re <span class="skolem">B1</span><span class="main">)</span> <span class="main">/</span> Re <span class="skolem">A1</span> <span class="main">=</span>
           Re <span class="main">(</span><span class="main">(</span>cor <span class="main">(</span>sgn <span class="main">(</span>Re <span class="skolem">B1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> cor <span class="main">(</span>sqrt <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">A1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> cor <span class="main">(</span>Re <span class="skolem">B1</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">A1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Re_divide_real<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex_cvec <span class="main">(</span>calc_x_axis_intersection_cmat_cvec <span class="skolem">H2</span><span class="main">)</span><span class="main">)</span>
          <span class="main">≤</span> Re <span class="main">(</span>to_complex_cvec <span class="main">(</span>calc_x_axis_intersection_cmat_cvec <span class="skolem">H1</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 3 <span class="quoted"><span class="quoted">‹<span class="skolem">A1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> * <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A1</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A2</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> is_poincare_line_cmat_def intersects_x_axis_cmat_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>    
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Ideal points and x-axis intersection›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1" id="Poincare_Lines_Axis_Intersections-ideal_points_intersects_x_axis"><span class="command">lemma</span></span> ideal_points_intersects_x_axis<span class="main">:</span>               
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="free">H</span> <span class="main">=</span> <span class="main">{</span><span class="free">i1</span><span class="main">,</span> <span class="free">i2</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">≠</span> x_axis"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"intersects_x_axis <span class="free">H</span> <span class="main">⟷</span> Im <span class="main">(</span>to_complex <span class="free">i1</span><span class="main">)</span> <span class="main">*</span> Im <span class="main">(</span>to_complex <span class="free">i2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i1</span> <span class="main">≠</span> <span class="free">i2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> ex_poincare_line_points ideal_points_different<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"calc_ideal_points <span class="free">H</span> <span class="main">=</span> <span class="main">{</span><span class="free">i1</span><span class="main">,</span> <span class="free">i2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> ideal_points_unique
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">i1</span> <span class="main">∈</span> calc_ideal_points <span class="free">H</span><span class="main">.</span> 
        <span class="main">∀</span> <span class="bound">i2</span> <span class="main">∈</span> calc_ideal_points <span class="free">H</span><span class="main">.</span> 
             is_poincare_line <span class="free">H</span> <span class="main">∧</span> <span class="free">H</span> <span class="main">≠</span> x_axis <span class="main">∧</span> <span class="bound">i1</span> <span class="main">≠</span> <span class="bound">i2</span> <span class="main">⟶</span> <span class="main">(</span>Im <span class="main">(</span>to_complex <span class="bound">i1</span><span class="main">)</span> <span class="main">*</span> Im <span class="main">(</span>to_complex <span class="bound">i2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> intersects_x_axis <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">H</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">i1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">i2</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i11</span> <span class="skolem">i12</span> <span class="skolem">i21</span> <span class="skolem">i22</span> <span class="skolem">A</span> <span class="skolem">B</span> <span class="skolem">C</span> <span class="skolem">D</span> <span class="skolem">H</span> <span class="skolem">i1</span> <span class="skolem">i2</span>
    <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">≠</span> mat_zero"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> line<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">i11</span><span class="main">,</span> <span class="skolem">i12</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">∈</span> calc_ideal_points_cmat_cvec <span class="skolem">H</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">i21</span><span class="main">,</span> <span class="skolem">i22</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">∈</span> calc_ideal_points_cmat_cvec <span class="skolem">H</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> different<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">i1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">i2</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> not_x_axis<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> circline_eq_cmat <span class="skolem">H</span> x_axis_cmat"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">D</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> cnj <span class="skolem">B</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H hermitean_elems
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span>cmod <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">D</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> line H
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?discr</span></span></span> <span class="main">=</span>  <span class="quoted"><span class="quoted">"sqrt <span class="main">(</span><span class="main">(</span>cmod <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?den</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">D</span> <span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?discr</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">*</span> <span class="main">(</span><span class="main">-</span> <span class="skolem">D</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">*</span> <span class="var">?discr</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i11</span> <span class="main">=</span> <span class="var">?i1</span> <span class="main">∨</span> <span class="skolem">i11</span> <span class="main">=</span> <span class="var">?i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i12</span> <span class="main">=</span> <span class="var">?den</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="skolem">i21</span> <span class="main">=</span> <span class="var">?i1</span> <span class="main">∨</span> <span class="skolem">i21</span> <span class="main">=</span> <span class="var">?i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i22</span> <span class="main">=</span> <span class="var">?den</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> i1 i2 H line
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i11</span> <span class="main">=</span> <span class="var">?i1</span> <span class="main">∧</span> <span class="skolem">i21</span> <span class="main">=</span> <span class="var">?i2</span> <span class="main">∨</span> <span class="skolem">i11</span> <span class="main">=</span> <span class="var">?i2</span> <span class="main">∧</span> <span class="skolem">i21</span> <span class="main">=</span> <span class="var">?i1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="skolem">i1</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">i2</span>›</span></span> i1 i2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">i11</span> <span class="main">/</span> <span class="skolem">i12</span><span class="main">)</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">i21</span> <span class="main">/</span> <span class="skolem">i22</span><span class="main">)</span> <span class="main">=</span> Im <span class="main">(</span><span class="var">?i1</span> <span class="main">/</span> <span class="var">?den</span><span class="main">)</span> <span class="main">*</span> Im <span class="main">(</span><span class="var">?i2</span> <span class="main">/</span> <span class="var">?den</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> i <span class="quoted"><span class="quoted">‹<span class="skolem">i12</span> <span class="main">=</span> <span class="var">?den</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i22</span> <span class="main">=</span> <span class="var">?den</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Im <span class="main">(</span><span class="var">?i1</span><span class="main">)</span> <span class="main">*</span> Im <span class="main">(</span><span class="var">?i2</span><span class="main">)</span> <span class="main">/</span> <span class="var">?den</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Im <span class="skolem">B</span> <span class="main">*</span> <span class="main">(</span>Im <span class="skolem">B</span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">D</span> <span class="main">*</span> Re <span class="skolem">D</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> Re <span class="skolem">B</span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">B</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>cmod <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> cmod <span class="skolem">B</span> <span class="main">^</span> <span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span>cmod <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">D</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">D</span>›</span></span> cmod_eq_Re<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Im <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> cmod <span class="skolem">B</span> <span class="main">^</span> <span class="numeral">4</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">B</span> <span class="main">*</span> cmod <span class="skolem">B</span> <span class="main">=</span> Re <span class="skolem">B</span> <span class="main">*</span> Re <span class="skolem">B</span> <span class="main">+</span> Im <span class="skolem">B</span> <span class="main">*</span> Im <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cmod_power2 power2_eq_square<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> cmod <span class="skolem">B</span> <span class="main">^</span> <span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> Im_product<span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span><span class="skolem">i11</span> <span class="main">/</span> <span class="skolem">i12</span><span class="main">)</span> <span class="main">*</span> Im <span class="main">(</span><span class="skolem">i21</span> <span class="main">/</span> <span class="skolem">i22</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> cmod <span class="skolem">B</span> <span class="main">^</span> <span class="numeral">4</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>to_complex_cvec <span class="skolem">i1</span><span class="main">)</span> <span class="main">*</span> Im <span class="main">(</span>to_complex_cvec <span class="skolem">i2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> intersects_x_axis_cmat <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">assume</span></span> opposite<span class="main">:</span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>to_complex_cvec <span class="skolem">i1</span><span class="main">)</span> <span class="main">*</span> Im <span class="main">(</span>to_complex_cvec <span class="skolem">i2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_cmat <span class="skolem">H</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> cmod <span class="skolem">B</span> <span class="main">^</span> <span class="numeral">4</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Im_product opposite i1 i2
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_less_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_less_0_iff not_sum_power2_lt_zero<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> H <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">D</span>›</span></span>  <span class="quoted"><span class="quoted">‹is_real <span class="skolem">D</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">.</span> <span class="bound">k</span> <span class="main">*</span> Im <span class="skolem">B</span> <span class="main">=</span> <span class="main">1</span> <span class="main">⟶</span> <span class="bound">k</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> Im <span class="skolem">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> Im <span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> divide_cancel_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_cmat <span class="skolem">H</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">D</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> H <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">=</span> <span class="skolem">D</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">D</span>›</span></span> line  H <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">=</span> cnj <span class="skolem">B</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> not_x_axis *
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Re <span class="skolem">D</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">-</span> <span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>Re <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_cancel_left_left diff_less_eq mult_eq_0_iff mult_less_0_iff power2_eq_square power2_less_0 sum_squares_gt_zero_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>to_complex_cvec <span class="skolem">i1</span><span class="main">)</span> <span class="main">*</span> Im <span class="main">(</span>to_complex_cvec <span class="skolem">i2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Im_product i1 i2
        <span class="keyword1"><span class="command">using</span></span> divide_eq_0_iff divide_less_0_iff prod.simps<span class="main">(</span>2<span class="main">)</span> to_complex_cvec_def zero_complex.simps<span class="main">(</span>1<span class="main">)</span> zero_less_norm_iff 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹calc_ideal_points <span class="free">H</span> <span class="main">=</span> <span class="main">{</span><span class="free">i1</span><span class="main">,</span> <span class="free">i2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i1</span> <span class="main">≠</span> <span class="free">i2</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Poincare_Perpendicular">
<div class="head">
<h1>Theory Poincare_Perpendicular</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Poincare_Perpendicular
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Poincare_Lines_Axis_Intersections.html">Poincare_Lines_Axis_Intersections</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹H-perpendicular h-lines in the Poincar\'e model›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">perpendicular_to_x_axis_cmat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">perpendicular_to_x_axis_cmat</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">,</span> <span class="bound">C</span><span class="main">,</span> <span class="bound">D</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">H</span></span></span> <span class="keyword1">in</span> is_real <span class="bound">B</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> perpendicular_to_x_axis_clmat <span class="main">::</span> <span class="quoted"><span class="quoted">"circline_mat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">perpendicular_to_x_axis_cmat</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> perpendicular_to_x_axis <span class="main">::</span> <span class="quoted"><span class="quoted">"circline <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">perpendicular_to_x_axis_clmat</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="operator">auto</span>

<span class="keyword1" id="Poincare_Perpendicular-perpendicular_to_x_axis"><span class="command">lemma</span></span> perpendicular_to_x_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"perpendicular_to_x_axis <span class="free">H</span> <span class="main">⟷</span> perpendicular x_axis <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> perpendicular_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">H</span> <span class="main">≠</span> mat_zero"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> cnj <span class="skolem">B</span><span class="main">,</span> <span class="skolem">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hermitean_elems<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">A</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">D</span></span></span></span></span></span></span></span><span class="main">]</span> hh
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"perpendicular_to_x_axis_cmat <span class="skolem">H</span> <span class="main">=</span>
        <span class="main">(</span>cos_angle_cmat <span class="main">(</span>of_circline_cmat x_axis_cmat<span class="main">)</span> <span class="main">(</span>of_circline_cmat <span class="skolem">H</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> cmod_square<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">B</span></span><span class="main">]</span> cmod_square<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Perpendicular-perpendicular_to_x_axis_y_axis"><span class="command">lemma</span></span> perpendicular_to_x_axis_y_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"perpendicular_to_x_axis <span class="main">(</span>poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="free">z</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_imag <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>


<span class="keyword1" id="Poincare_Perpendicular-wlog_perpendicular_axes"><span class="command">lemma</span></span> wlog_perpendicular_axes<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> perpendicular<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H1</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H2</span>"</span></span> <span class="quoted"><span class="quoted">"perpendicular <span class="free">H1</span> <span class="free">H2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> circline_set <span class="free">H1</span> <span class="main">∩</span> circline_set <span class="free">H2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> circline_set <span class="free">H1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> circline_set <span class="free">H2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> axes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">⟦</span>is_real <span class="bound">x</span><span class="main">;</span> <span class="main">0</span> <span class="main">≤</span> Re <span class="bound">x</span><span class="main">;</span> Re <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">;</span> is_imag <span class="bound">y</span><span class="main">;</span> <span class="main">0</span> <span class="main">≤</span> Im <span class="bound">y</span><span class="main">;</span> Im <span class="bound">y</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="bound">x</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> moebius<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">M</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="main">⟦</span>unit_disc_fix <span class="bound">M</span><span class="main">;</span> <span class="bound">u</span> <span class="main">∈</span> unit_disc<span class="main">;</span> <span class="bound">v</span> <span class="main">∈</span> unit_disc<span class="main">;</span> <span class="bound">w</span> <span class="main">∈</span> unit_disc<span class="main">;</span> <span class="free">P</span> <span class="main">(</span>moebius_pt <span class="bound">M</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="bound">M</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="bound">M</span> <span class="bound">w</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conjugate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">u</span> <span class="main">∈</span> unit_disc<span class="main">;</span> <span class="bound">v</span> <span class="main">∈</span> unit_disc<span class="main">;</span> <span class="bound">w</span> <span class="main">∈</span> unit_disc<span class="main">;</span> <span class="free">P</span> <span class="main">(</span>conjugate <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="bound">v</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="bound">w</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">z</span> <span class="free">u</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">v</span> <span class="bound">H1</span> <span class="bound">H2</span><span class="main">.</span> is_poincare_line <span class="bound">H1</span> <span class="main">∧</span> is_poincare_line <span class="bound">H2</span> <span class="main">∧</span> perpendicular <span class="bound">H1</span> <span class="bound">H2</span> <span class="main">∧</span>
                   <span class="free">z</span> <span class="main">∈</span> circline_set <span class="bound">H1</span> <span class="main">∩</span> circline_set <span class="bound">H2</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">∈</span> circline_set <span class="bound">H1</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> circline_set <span class="bound">H2</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> unit_disc <span class="main">⟶</span> <span class="free">P</span> <span class="free">z</span> <span class="free">u</span> <span class="bound">v</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">z</span> <span class="free">u</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_x_axis<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="skolem">H1</span> <span class="skolem">H2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> of_complex <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="skolem">H1</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="skolem">H2</span>"</span></span> <span class="quoted"><span class="quoted">"perpendicular <span class="skolem">H1</span> <span class="skolem">H2</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="skolem">H1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="skolem">H2</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> circline_set <span class="skolem">H1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> circline_set <span class="skolem">H2</span>"</span></span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> axes<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_rotation_to_positive_y_axis<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_imag <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Im <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="skolem">y</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> x axes<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">φ</span> <span class="skolem">u</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
                   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="main">(</span>moebius_rotation <span class="skolem">φ</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> moebius<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_rotation <span class="skolem">φ</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> x_axis"</span></span>
          <span class="keyword1"><span class="command">using</span></span> x poincare_line_0_real_is_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H1</span> <span class="main">=</span> x_axis"</span></span>
          <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">H1</span></span><span class="main">]</span> 1 2
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> False
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_imag <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">≠</span> of_complex <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> of_complex_zero_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H2</span> <span class="main">=</span> poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">y</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span>
            <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="skolem">H2</span></span><span class="main">]</span> y
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> 1 <span class="quoted"><span class="quoted">‹<span class="skolem">H1</span> <span class="main">=</span> x_axis›</span></span>
            <span class="keyword1"><span class="command">using</span></span> perpendicular_to_x_axis_y_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> False
            <span class="keyword1"><span class="command">using</span></span> perpendicular_to_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">H2</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Im <span class="skolem">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> axes<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> x y <span class="quoted"><span class="quoted">‹is_imag <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Im<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjugate<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>cnj <span class="skolem">y</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span> y <span class="quoted"><span class="quoted">‹is_imag <span class="skolem">y</span>›</span></span> eq_minus_cnj_iff_imag<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Im<span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>conjugate <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">)</span> <span class="main">(</span>conjugate <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="skolem">v</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> eq_cnj_iff_real<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> y <span class="quoted"><span class="quoted">‹is_imag <span class="skolem">y</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> axes<span class="main">[</span><span class="operator">OF</span> x<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"cnj <span class="skolem">y</span>"</span></span><span class="main">]</span> False
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">w</span> <span class="skolem">H1</span> <span class="skolem">H2</span>
      <span class="keyword3"><span class="command">assume</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="skolem">H1</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="skolem">H2</span>"</span></span> <span class="quoted"><span class="quoted">"perpendicular <span class="skolem">H1</span> <span class="skolem">H2</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> circline_set <span class="skolem">H1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> circline_set <span class="skolem">H2</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> circline_set <span class="skolem">H1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> circline_set <span class="skolem">H2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> moebius<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">w</span></span><span class="main">]</span> *
        <span class="keyword1"><span class="command">using</span></span> **<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_circline <span class="skolem">M</span> <span class="skolem">H1</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_circline <span class="skolem">M</span> <span class="skolem">H2</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">w</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Perpendicular-wlog_perpendicular_foot"><span class="command">lemma</span></span> wlog_perpendicular_foot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> perpendicular<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"perpendicular <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">∩</span> circline_set <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> axes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="main">⟦</span>is_real <span class="bound">u</span><span class="main">;</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="bound">u</span><span class="main">;</span> Re <span class="bound">u</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">;</span> is_real <span class="bound">v</span><span class="main">;</span> <span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="bound">v</span><span class="main">;</span> Re <span class="bound">v</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">;</span> Re <span class="bound">u</span> <span class="main">≠</span> Re <span class="bound">v</span><span class="main">;</span> is_imag <span class="bound">w</span><span class="main">;</span> <span class="main">0</span> <span class="main">≤</span> Im <span class="bound">w</span><span class="main">;</span> Im <span class="bound">w</span> <span class="main">&lt;</span> <span class="main">1</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="bound">v</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="bound">w</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> moebius<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">M</span> <span class="bound">z</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="main">⟦</span>unit_disc_fix <span class="bound">M</span><span class="main">;</span> <span class="bound">u</span> <span class="main">∈</span> unit_disc<span class="main">;</span> <span class="bound">v</span> <span class="main">∈</span> unit_disc<span class="main">;</span> <span class="bound">w</span> <span class="main">∈</span> unit_disc<span class="main">;</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc<span class="main">;</span> <span class="free">P</span> <span class="main">(</span>moebius_pt <span class="bound">M</span> <span class="bound">z</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="bound">M</span> <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="bound">M</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="bound">M</span> <span class="bound">w</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">z</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> conjugate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">z</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">u</span> <span class="main">∈</span> unit_disc<span class="main">;</span> <span class="bound">v</span> <span class="main">∈</span> unit_disc<span class="main">;</span> <span class="bound">w</span> <span class="main">∈</span> unit_disc<span class="main">;</span> <span class="free">P</span> <span class="main">(</span>conjugate <span class="bound">z</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="bound">u</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="bound">v</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="bound">w</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">z</span> <span class="bound">u</span> <span class="bound">v</span> <span class="bound">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> perm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">z</span> <span class="free">v</span> <span class="free">u</span> <span class="free">w</span> <span class="main">⟹</span> <span class="free">P</span> <span class="free">z</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">z</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∨</span> <span class="skolem">m</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="free">u</span> <span class="main">∨</span> <span class="skolem">n</span> <span class="main">=</span> <span class="free">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≠</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">z</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">∩</span> circline_set <span class="free">H</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> mn
    <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="skolem">m</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">u</span> <span class="free">v</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> in_disc
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="bound">n</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">z</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">m</span> <span class="main">≠</span> <span class="free">z</span> <span class="main">⟶</span> <span class="free">P</span> <span class="free">z</span> <span class="skolem">m</span> <span class="bound">n</span> <span class="free">w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="free">z</span> <span class="skolem">m</span> <span class="free">w</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_perpendicular_axes<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?Q</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mn in_disc
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">∩</span> circline_set <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"perpendicular <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> circline_set <span class="free">H</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"is_imag <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> Im <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> circline_set x_axis"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_line_0_real_is_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span> xy
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_x_axis<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> of_complex <span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">n'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> circline_set x_axis›</span></span>
        <span class="keyword1"><span class="command">using</span></span> of_complex_inj
        <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">n'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> unit_disc›</span></span> n'
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">n'</span> <span class="main">≠</span> Re <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> complex.expand<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">n</span>›</span></span> n'
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> xy <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex.expand<span class="main">)</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">n</span> <span class="main">(</span>of_complex <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> axes<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">n'</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> xy n' <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">n'</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">n'</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">n'</span> <span class="main">≠</span> Re <span class="skolem">x</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">n</span> <span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> moebius<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> 1 2<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">n</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">(</span>conjugate <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">n</span> <span class="skolem">w</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> conjugate<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">n</span></span> <span class="quoted"><span class="skolem">w</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> 1 2<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"conjugate <span class="skolem">n</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> conjugate_inj
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> mn in_disc <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">z</span> <span class="skolem">m</span><span class="main">)</span>›</span></span> perm
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Perpendicular-perpendicular_to_x_axis_intersects_x_axis"><span class="command">lemma</span></span> perpendicular_to_x_axis_intersects_x_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"perpendicular_to_x_axis <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms hermitean_elems
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>


<span class="keyword1" id="Poincare_Perpendicular-perpendicular_intersects"><span class="command">lemma</span></span> perpendicular_intersects<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H1</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H2</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"perpendicular <span class="free">H1</span> <span class="free">H2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> circline_set <span class="free">H1</span> <span class="main">∩</span> circline_set <span class="free">H2</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="free">H1</span> <span class="free">H2</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">H2</span><span class="main">.</span> is_poincare_line <span class="bound">H2</span> <span class="main">∧</span> perpendicular <span class="free">H1</span> <span class="bound">H2</span> <span class="main">⟶</span> <span class="var">?P'</span> <span class="free">H1</span> <span class="bound">H2</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">H1</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_line_x_axis<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> x_axis"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="skolem">H2</span>"</span></span> <span class="quoted"><span class="quoted">"perpendicular x_axis <span class="skolem">H2</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> circline_set x_axis <span class="main">∩</span> circline_set <span class="skolem">H2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> perpendicular_to_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">H2</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> perpendicular_to_x_axis_intersects_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">H2</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">H2</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>moebius_circline <span class="skolem">M</span> <span class="free">H1</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">H1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="skolem">H2</span>"</span></span> <span class="quoted"><span class="quoted">"perpendicular <span class="free">H1</span> <span class="skolem">H2</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>moebius_circline <span class="skolem">M</span> <span class="free">H1</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>moebius_circline <span class="skolem">M</span> <span class="skolem">H2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_circline <span class="skolem">M</span> <span class="skolem">H2</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> circline_set <span class="free">H1</span> <span class="main">∩</span> circline_set <span class="skolem">H2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"moebius_pt <span class="main">(</span><span class="main">-</span><span class="skolem">M</span><span class="main">)</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
           <span class="main">(</span><span class="operator">metis</span> IntI add.inverse_inverse circline_set_moebius_circline_iff moebius_pt_comp_inv_left uminus_moebius_def unit_disc_fix_discI unit_disc_fix_moebius_uminus<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H1</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">calc_perpendicular_to_x_axis_cmat</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_vec <span class="main">⇒</span> complex_mat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">calc_perpendicular_to_x_axis_cmat</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">=</span>
     <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">z1</span><span class="main">,</span> <span class="bound">z2</span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span>
       <span class="keyword1">in</span> <span class="keyword1">if</span> <span class="bound">z1</span><span class="main">*</span>cnj <span class="bound">z2</span> <span class="main">+</span> <span class="bound">z2</span><span class="main">*</span>cnj <span class="bound">z1</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span>
          <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>
       <span class="keyword1">else</span>
          <span class="keyword1">let</span> <span class="bound">A</span> <span class="main">=</span> <span class="bound">z1</span><span class="main">*</span>cnj <span class="bound">z2</span> <span class="main">+</span> <span class="bound">z2</span><span class="main">*</span>cnj <span class="bound">z1</span><span class="main">;</span>
              <span class="bound">B</span> <span class="main">=</span> <span class="main">-</span><span class="main">(</span><span class="bound">z1</span><span class="main">*</span>cnj <span class="bound">z1</span> <span class="main">+</span> <span class="bound">z2</span><span class="main">*</span>cnj <span class="bound">z2</span><span class="main">)</span>
           <span class="keyword1">in</span> <span class="main">(</span><span class="bound">A</span><span class="main">,</span> <span class="bound">B</span><span class="main">,</span> <span class="bound">B</span><span class="main">,</span> <span class="bound">A</span><span class="main">)</span>
     <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lift_definition</span></span> calc_perpendicular_to_x_axis_clmat <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_homo_coords <span class="main">⇒</span> circline_mat"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">calc_perpendicular_to_x_axis_cmat</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hermitean_def mat_adj_def mat_cnj_def Let_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> calc_perpendicular_to_x_axis <span class="main">::</span> <span class="quoted"><span class="quoted">"complex_homo <span class="main">⇒</span> circline"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">calc_perpendicular_to_x_axis_clmat</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">w</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> vec_zero"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">≠</span> vec_zero"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="skolem"><span class="skolem">z2</span></span> <span class="skolem"><span class="skolem">w1</span></span> <span class="skolem"><span class="skolem">w2</span></span> <span class="keyword2"><span class="keyword">where</span></span> zw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z1</span><span class="main">,</span> <span class="skolem">z2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">w1</span><span class="main">,</span> <span class="skolem">w2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">w</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> <span class="skolem">w</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">*</span><span class="skolem">z1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w2</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">*</span><span class="skolem">z2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zw
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">*</span> cnj <span class="skolem">w2</span> <span class="main">+</span> <span class="skolem">w2</span> <span class="main">*</span> cnj <span class="skolem">w1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> cnj <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">z1</span> <span class="main">*</span> cnj <span class="skolem">z2</span> <span class="main">+</span> <span class="skolem">z2</span> <span class="main">*</span> cnj <span class="skolem">z1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w1</span> <span class="main">*</span> cnj <span class="skolem">w1</span> <span class="main">+</span> <span class="skolem">w2</span> <span class="main">*</span> cnj <span class="skolem">w2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> cnj <span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">z1</span> <span class="main">*</span> cnj <span class="skolem">z1</span> <span class="main">+</span> <span class="skolem">z2</span> <span class="main">*</span> cnj <span class="skolem">z2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"circline_eq_cmat <span class="main">(</span>calc_perpendicular_to_x_axis_cmat <span class="skolem">z</span><span class="main">)</span> <span class="main">(</span>calc_perpendicular_to_x_axis_cmat <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zw *
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> cnj <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex.expand <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Perpendicular-calc_perpendicular_to_x_axis"><span class="command">lemma</span></span> calc_perpendicular_to_x_axis<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> of_complex <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> of_complex <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>calc_perpendicular_to_x_axis <span class="free">z</span><span class="main">)</span> <span class="main">∧</span>
         is_poincare_line <span class="main">(</span>calc_perpendicular_to_x_axis <span class="free">z</span><span class="main">)</span> <span class="main">∧</span>
         perpendicular_to_x_axis <span class="main">(</span>calc_perpendicular_to_x_axis <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def perpendicular_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">complex_vec</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="skolem"><span class="skolem">z2</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">z1</span><span class="main">,</span> <span class="skolem">z2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">z</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> of_complex_cvec <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">z</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> of_complex_cvec <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"on_circline_cmat_cvec <span class="main">(</span>calc_perpendicular_to_x_axis_cmat <span class="skolem">z</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">∧</span>
        is_poincare_line_cmat <span class="main">(</span>calc_perpendicular_to_x_axis_cmat <span class="skolem">z</span><span class="main">)</span> <span class="main">∧</span>
        perpendicular_to_x_axis_cmat <span class="main">(</span>calc_perpendicular_to_x_axis_cmat <span class="skolem">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span><span class="main">*</span>cnj <span class="skolem">z2</span> <span class="main">+</span> <span class="skolem">z2</span><span class="main">*</span>cnj <span class="skolem">z1</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> z
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def hermitean_def mat_adj_def mat_cnj_def mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z2</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> z
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="skolem">z2</span> <span class="main">*</span> cnj <span class="skolem">z2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex.expand<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span> <span class="main">≠</span> <span class="main">-</span><span class="skolem">z2</span> <span class="main">∧</span> <span class="skolem">z1</span> <span class="main">≠</span> <span class="skolem">z2</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> of_complex_cvec <span class="main">1</span> <span class="main">∨</span> <span class="skolem">z</span> <span class="keyword1">≈<span class="hidden">⇩</span><sub>v</sub></span> of_complex_cvec <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> z <span class="quoted"><span class="quoted">‹<span class="skolem">z2</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> **
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span><span class="main">*</span>cnj <span class="skolem">z2</span> <span class="main">+</span> <span class="skolem">z2</span><span class="main">*</span>cnj <span class="skolem">z1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">(</span><span class="skolem">z1</span><span class="main">*</span>cnj <span class="skolem">z1</span> <span class="main">+</span> <span class="skolem">z2</span><span class="main">*</span>cnj <span class="skolem">z2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re<span class="main">(</span><span class="skolem">z1</span><span class="main">*</span>cnj <span class="skolem">z1</span> <span class="main">+</span> <span class="skolem">z2</span><span class="main">*</span>cnj <span class="skolem">z2</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?B</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> uminus_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>Re <span class="var">?B</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> Re <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Re <span class="skolem">z1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">z1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Re <span class="skolem">z2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">z2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&gt;</span> abs <span class="main">(</span>Re <span class="var">?A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Re <span class="var">?A</span> <span class="main">≥</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">z1</span> <span class="main">+</span> Re <span class="skolem">z2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">z1</span> <span class="main">+</span> Im <span class="skolem">z2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z1</span> <span class="main">≠</span> <span class="main">-</span><span class="skolem">z2</span> <span class="main">∧</span> <span class="skolem">z1</span> <span class="main">≠</span> <span class="skolem">z2</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add.inverse_unique complex_neq_0 plus_complex.code plus_complex.simps<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> False
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_sum power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="skolem">z1</span> <span class="main">-</span> Re <span class="skolem">z2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">(</span>Im <span class="skolem">z1</span> <span class="main">-</span> Im <span class="skolem">z2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z1</span> <span class="main">≠</span> <span class="main">-</span><span class="skolem">z2</span> <span class="main">∧</span> <span class="skolem">z1</span> <span class="main">≠</span> <span class="skolem">z2</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> complex_eq_iff right_minus_eq sum_power2_gt_zero_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> True
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_sum power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span>Re <span class="var">?B</span><span class="main">)</span> <span class="main">&gt;</span> abs <span class="main">(</span>Re <span class="var">?A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="var">?B</span> <span class="main">=</span> abs <span class="main">(</span>Re <span class="var">?B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="var">?A</span> <span class="main">=</span> abs <span class="main">(</span>Re <span class="var">?A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="var">?B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="var">?A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> power2_le_imp_le<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> z False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def hermitean_def mat_adj_def mat_cnj_def cmod_eq_Re vec_cnj_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Perpendicular-ex_perpendicular"><span class="command">lemma</span></span> ex_perpendicular<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">H'</span><span class="main">.</span> is_poincare_line <span class="bound">H'</span> <span class="main">∧</span> perpendicular <span class="free">H</span> <span class="bound">H'</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">∈</span> circline_set <span class="bound">H'</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="free">H</span> <span class="free">z</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">⟶</span> <span class="var">?P'</span> <span class="free">H</span> <span class="bound">z</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">H</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_line_x_axis<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> x_axis"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> of_complex <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> of_complex <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> x_axis <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> calc_perpendicular_to_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> perpendicular_to_x_axis
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"calc_perpendicular_to_x_axis <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>moebius_circline <span class="skolem">M</span> <span class="free">H</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">H'</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="skolem">H'</span>"</span></span> <span class="quoted"><span class="quoted">"perpendicular <span class="main">(</span>moebius_circline <span class="skolem">M</span> <span class="free">H</span><span class="main">)</span> <span class="skolem">H'</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">z</span> <span class="main">∈</span> circline_set <span class="skolem">H'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> *
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">H</span> <span class="main">=</span> moebius_circline <span class="main">(</span><span class="main">-</span><span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>moebius_circline <span class="skolem">M</span> <span class="free">H</span><span class="main">)</span>"</span></span>   
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="free">H</span> <span class="skolem">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> h<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"moebius_circline <span class="main">(</span><span class="main">-</span><span class="skolem">M</span><span class="main">)</span> <span class="skolem">H'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> moebius_circline_comp_inv_left<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Perpendicular-ex_perpendicular_foot"><span class="command">lemma</span></span> ex_perpendicular_foot<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">H'</span><span class="main">.</span> is_poincare_line <span class="bound">H'</span> <span class="main">∧</span> <span class="free">z</span> <span class="main">∈</span> circline_set <span class="bound">H'</span> <span class="main">∧</span> perpendicular <span class="free">H</span> <span class="bound">H'</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∃</span> <span class="bound">z'</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="bound">z'</span> <span class="main">∈</span> circline_set <span class="bound">H'</span> <span class="main">∩</span> circline_set <span class="free">H</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">using</span></span> ex_perpendicular<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
  <span class="keyword1"><span class="command">using</span></span> perpendicular_intersects<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">H</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Poincare_Perpendicular-Pythagoras"><span class="command">lemma</span></span> Pythagoras<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct<span class="main">[</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">]</span> <span class="main">⟶</span> perpendicular <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">w</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cosh <span class="main">(</span>poincare_distance <span class="free">v</span> <span class="free">w</span><span class="main">)</span> <span class="main">=</span> cosh <span class="main">(</span>poincare_distance <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">*</span> cosh <span class="main">(</span>poincare_distance <span class="free">u</span> <span class="free">w</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">]</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_disc
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_distance_sym<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">]</span> <span class="main">⟶</span> <span class="var">?P'</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">u</span> <span class="free">v</span> <span class="free">w</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_perpendicular_axes<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="main">[</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">]</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"perpendicular <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">w</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">w</span><span class="main">)</span>"</span></span>
         <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">v</span><span class="main">)</span> <span class="main">∩</span> circline_set <span class="main">(</span>poincare_line <span class="free">u</span> <span class="free">w</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="main">[</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">,</span> <span class="free">w</span><span class="main">]</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"is_imag <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> Im <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">y</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">using</span></span> x y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re cmod_eq_Im<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> of_complex <span class="skolem">x</span><span class="main">,</span> of_complex <span class="skolem">y</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?den1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?den2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?den1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?den2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> x y
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re cmod_eq_Im abs_square_less_1<span class="main">)</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="var">?den1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh <span class="main">(</span>poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?d1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den1</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">moreover</span></span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>cmod <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="var">?den2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh <span class="main">(</span>poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?d2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">y</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?den</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?den1</span> <span class="main">*</span> <span class="var">?den2</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d3</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>cmod <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="var">?den</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cosh <span class="main">(</span>poincare_distance <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?d3</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den1</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">y</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d1</span> <span class="main">*</span> <span class="var">?d2</span> <span class="main">=</span> <span class="var">?d3</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d3</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="skolem">y</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span>cmod <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span> <span class="var">?den</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den1</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> add_num_frac<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="skolem">y</span> <span class="main">*</span> cnj <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">*</span>cnj <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="var">?den</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹is_imag <span class="skolem">y</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">subst</span> cmod_square<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Re <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">*</span> cnj <span class="skolem">y</span>
                               <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">*</span> cnj <span class="skolem">x</span> <span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">*</span> cnj <span class="skolem">y</span><span class="main">)</span> <span class="main">/</span> <span class="var">?den</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Re <span class="main">(</span><span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">*</span> cnj <span class="skolem">y</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x</span> <span class="main">*</span> cnj <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="var">?den</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹is_imag <span class="skolem">y</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den1</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?den2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add_num_frac<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add_num_frac<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cmod_square<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="skolem">y</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>conjugate <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>conjugate <span class="skolem">w</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 1 2
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugate_inj<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> True
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Poincare">
<div class="head">
<h1>Theory Poincare</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Poincar\'e disc model types›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this section we introduce datatypes that represent objects in the Poincar\'e disc model.
The types are defined as subtypes (e.g., the h-points are defined as elements of $\mathbb{C}P^1$
that lie within the unit disc). The functions on those types are defined by lifting the functions
defined on the carrier type (e.g., h-distance is defined by lifting the distance function defined
for elements of $\mathbb{C}P^1$).›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Poincare
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Poincare_Lines.html">Poincare_Lines</a> <a href="Poincare_Between.html">Poincare_Between</a> <a href="Poincare_Distance.html">Poincare_Distance</a> <a href="Poincare_Circles.html">Poincare_Circles</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹H-points›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">typedef</span></span> p_point <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> zero_in_unit_disc
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_p_point

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Point zero›</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> p_zero <span class="main">::</span> <span class="quoted"><span class="quoted">"p_point"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> zero_in_unit_disc<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Constructing h-points from complex numbers›</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> p_of_complex <span class="main">::</span> <span class="quoted"><span class="quoted">"complex <span class="main">⇒</span> p_point"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">z</span><span class="main">.</span> <span class="keyword1">if</span> cmod <span class="bound">z</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="keyword1">then</span> of_complex <span class="bound">z</span> <span class="keyword1">else</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹H-lines›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">typedef</span></span> p_line <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">H</span><span class="main">.</span> is_poincare_line <span class="bound">H</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"x_axis"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_p_line

<span class="keyword1"><span class="command">lift_definition</span></span> p_incident <span class="main">::</span> <span class="quoted"><span class="quoted">"p_line <span class="main">⇒</span> p_point <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">on_circline</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Set of h-points on an h-line›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">p_points</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"p_line <span class="main">⇒</span> p_point set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">p_points</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> p_incident <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="bound">p</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹x-axis is an example of an h-line›</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> p_x_axis <span class="main">::</span> <span class="quoted"><span class="quoted">"p_line"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">x_axis</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Constructing the unique h-line from two h-points›</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> p_line <span class="main">::</span> <span class="quoted"><span class="quoted">"p_point <span class="main">⇒</span> p_point <span class="main">⇒</span> p_line"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">poincare_line</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="skolem">v</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>poincare_line <span class="skolem">u</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This branch must work only for formal reasons.›</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hermitean_def mat_adj_def mat_cnj_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next we show how to lift some lemmas. This could be done for all the lemmas that we have
proved earlier, but we do not do that.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹If points are different then the constructed line contains the starting points›</span></span>
<span class="keyword1" id="Poincare-p_on_line"><span class="command">lemma</span></span> p_on_line<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">≠</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"p_incident <span class="main">(</span>p_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span> <span class="free">z</span>"</span></span>
        <span class="quoted"><span class="quoted">"p_incident <span class="main">(</span>p_line <span class="free">z</span> <span class="free">w</span><span class="main">)</span> <span class="free">w</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹There is a unique h-line passing trough the two different given h-points›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃!</span> <span class="bound">l</span><span class="main">.</span> <span class="main">{</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">}</span> <span class="main">⊆</span> p_points <span class="bound">l</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> a<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"p_line <span class="free">u</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ex1I<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> p_points_def p_on_line<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_poincare_line<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The unique h-line trough zero and a non-zero h-point on the x-axis is the x-axis›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"p_zero <span class="main">∈</span> p_points <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> p_points <span class="free">l</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> p_zero"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> p_points p_x_axis"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">=</span> p_x_axis"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> p_points_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command">using</span></span> is_poincare_line_0_real_is_x_axis inf_notin_unit_disc
  <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹H-collinearity›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> p_collinear <span class="main">::</span> <span class="quoted"><span class="quoted">"p_point set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">poincare_collinear</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹H-isometries›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹H-isometries are functions that map the unit disc onto itself›</span></span>
<span class="keyword1"><span class="command">typedef</span></span> p_isometry <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">f</span><span class="main">.</span> unit_disc_fix_f <span class="bound">f</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"id"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_disc_fix_f_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"id_moebius"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_p_isometry

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Action of an h-isometry on an h-point›</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> p_isometry_pt <span class="main">::</span> <span class="quoted"><span class="quoted">"p_isometry <span class="main">⇒</span> p_point <span class="main">⇒</span> p_point"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">f</span> <span class="bound">p</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_f_unit_disc
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Action of an h-isometry on an h-line›</span></span>
<span class="keyword1"><span class="command">lift_definition</span></span> p_isometry_line <span class="main">::</span> <span class="quoted"><span class="quoted">"p_isometry <span class="main">⇒</span> p_line <span class="main">⇒</span> p_line"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">f</span> <span class="bound">l</span><span class="main">.</span> unit_disc_fix_f_circline <span class="bound">f</span> <span class="bound">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix_f <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="skolem">H</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> moebius_pt <span class="skolem">M</span> <span class="main">∨</span> <span class="skolem">f</span> <span class="main">=</span> moebius_pt <span class="skolem">M</span> <span class="main">∘</span> conjugate"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> unit_disc_fix_f_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>unit_disc_fix_f_circline <span class="skolem">f</span> <span class="skolem">H</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> moebius_pt <span class="skolem">M</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹is_poincare_line <span class="skolem">H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_f_circline_direct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">H</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> moebius_pt <span class="skolem">M</span> <span class="main">∘</span> conjugate"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹is_poincare_line <span class="skolem">H</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_f_circline_indirect<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">H</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹An example lemma about h-isometries.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹H-isometries preserve h-collinearity›</span></span>
<span class="keyword1" id="Poincare-p_collinear_p_isometry_pt"><span class="command">lemma</span></span> p_collinear_p_isometry_pt <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"p_collinear <span class="main">(</span>p_isometry_pt <span class="free">M</span> <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟷</span> p_collinear <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">M</span> <span class="bound">A</span><span class="main">.</span>  <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> moebius_pt <span class="bound">M</span> <span class="main">(</span>conjugate <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="bound">A</span> <span class="main">=</span> moebius_pt <span class="bound">M</span> <span class="main">`</span> <span class="main">(</span>conjugate <span class="main">`</span> <span class="bound">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unit_disc_fix_f_def *<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹H-distance and h-congruence›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> p_dist <span class="main">::</span> <span class="quoted"><span class="quoted">"p_point <span class="main">⇒</span> p_point <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">poincare_distance</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">p_congruent</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"p_point <span class="main">⇒</span> p_point <span class="main">⇒</span> p_point <span class="main">⇒</span> p_point <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p_congruent</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">⟷</span> p_dist <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> p_dist <span class="free"><span class="bound"><span class="entity">u'</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"p_dist <span class="free">u</span> <span class="free">v</span> <span class="main">=</span> p_dist <span class="free">u'</span> <span class="free">v'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"p_dist <span class="free">v</span> <span class="free">w</span> <span class="main">=</span> p_dist <span class="free">v'</span> <span class="free">w'</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"p_dist <span class="free">u</span> <span class="free">w</span> <span class="main">=</span> p_dist <span class="free">u'</span> <span class="free">w'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">f</span><span class="main">.</span> p_isometry_pt <span class="bound">f</span> <span class="free">u</span> <span class="main">=</span> <span class="free">u'</span> <span class="main">∧</span> p_isometry_pt <span class="bound">f</span> <span class="free">v</span> <span class="main">=</span> <span class="free">v'</span> <span class="main">∧</span> p_isometry_pt <span class="bound">f</span> <span class="free">w</span> <span class="main">=</span> <span class="free">w'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_f_congruent_triangles
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We prove that unit disc equipped with Poincar\'e distance is a metric space, i.e. an
instantiation of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">metric_space</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> locale.›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> p_point <span class="main">::</span> <span class="quoted">metric_space</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">dist_p_point</span></span> <span class="main">=</span> p_dist"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="class_parameter">uniformity_p_point</span></span> <span class="main">::</span> <span class="main">(</span>p_point <span class="main">×</span> p_point<span class="main">)</span> filter<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">INF</span> <span class="bound">e</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span><span class="main">.</span> principal <span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> dist_class.dist <span class="bound">x</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">open_p_point</span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">::</span> p_point set<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">.</span> eventually <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x'</span><span class="main">,</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">x'</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span><span class="main">)</span> uniformity<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span> <span class="quoted">p_point</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>dist_class.dist <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dist_p_point_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_distance_eq_0_iff<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">p_point</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dist_class.dist <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">≤</span> dist_class.dist <span class="skolem">x</span> <span class="skolem">z</span> <span class="main">+</span> dist_class.dist <span class="skolem">y</span> <span class="skolem">z</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> dist_p_point_def                 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_distance_triangle_inequality poincare_distance_sym
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> open_p_point_def uniformity_p_point_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>                                                                       

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹H-betweennes›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">lift_definition</span></span> p_between <span class="main">::</span> <span class="quoted"><span class="quoted">"p_point <span class="main">⇒</span> p_point <span class="main">⇒</span> p_point <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">is</span></span> <span class="quoted">poincare_between</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword2"><span class="keyword">end</span></span>                                                                                                  
</pre>
</div><div id="Poincare_Tarski">
<div class="head">
<h1>Theory Poincare_Tarski</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Poincar\'e model satisfies Tarski axioms›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Poincare_Tarski
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Poincare.html">Poincare</a> <a href="Poincare_Lines_Axis_Intersections.html">Poincare_Lines_Axis_Intersections</a> <a href="Tarski.html">Tarski</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Pasch axiom›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1" id="Poincare_Tarski-Pasch_fun_mono"><span class="command">lemma</span></span> Pasch_fun_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">r1</span> <span class="free">r2</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">r1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">≤</span> <span class="free">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">r1</span> <span class="main">≥</span> <span class="free">r2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">r2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">=</span> <span class="free">r2</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">-</span> <span class="free">r1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_le_cancel_left1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">r2</span> <span class="main">-</span> <span class="free">r1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">r2</span> <span class="main">-</span> <span class="free">r1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r2</span> <span class="main">-</span> <span class="free">r1</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> mult_less_cancel_left_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">r2</span> <span class="main">-</span> <span class="free">r1</span>"</span></span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="main">(</span><span class="free">r1</span> <span class="main">*</span> <span class="free">r2</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="free">r1</span> <span class="main">-</span> <span class="main">1</span> <span class="main">/</span> <span class="free">r2</span> <span class="main">&gt;</span> <span class="free">r2</span> <span class="main">-</span> <span class="free">r1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Pasch axiom, non-degenerative case.›</span></span>
<span class="keyword1" id="Poincare_Tarski-Pasch_nondeg"><span class="command">lemma</span></span> Pasch_nondeg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">,</span> <span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">]</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x</span> <span class="free">u</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">y</span> <span class="free">v</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_between <span class="free">u</span> <span class="bound">a</span> <span class="free">y</span> <span class="main">∧</span> poincare_between <span class="free">x</span> <span class="bound">a</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">y</span> <span class="bound">z</span> <span class="bound">u</span><span class="main">.</span> distinct <span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="free">v</span><span class="main">]</span> <span class="main">∧</span> <span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="bound">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">}</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> unit_disc <span class="main">∧</span>
                 poincare_between <span class="free">x</span> <span class="bound">u</span> <span class="bound">z</span> <span class="main">∧</span> poincare_between <span class="bound">y</span> <span class="free">v</span> <span class="bound">z</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_between <span class="bound">u</span> <span class="bound">a</span> <span class="bound">y</span> <span class="main">∧</span> poincare_between <span class="free">x</span> <span class="bound">a</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">x</span> <span class="free">v</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_positive_x_axis<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">v</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span> distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">,</span> <span class="skolem">u</span><span class="main">,</span> of_complex <span class="skolem">v</span><span class="main">]</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="skolem"><span class="skolem">u'</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> of_complex <span class="skolem">y'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> of_complex <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> of_complex <span class="skolem">u'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex inf_notin_unit_disc
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">≠</span> <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">≠</span> <span class="skolem">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">≠</span> <span class="skolem">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≠</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> of_complex_inj distinct *
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">note</span></span> distinct <span class="main">=</span> distinct this

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span>

      <span class="keyword1"><span class="command">hence</span></span> nondeg_yz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span><span class="main">*</span>cnj <span class="skolem">z'</span> <span class="main">≠</span> cnj <span class="skolem">y'</span> <span class="main">*</span> <span class="skolem">z'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * poincare_collinear_zero_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y'</span></span> <span class="quoted"><span class="skolem">z'</span></span><span class="main">]</span> in_disc distinct
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">u</span> <span class="skolem">z</span>"</span></span>

      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"arg <span class="skolem">u'</span> <span class="main">=</span> arg <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">u'</span> <span class="main">≤</span> cmod <span class="skolem">z'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * poincare_between_0uv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> distinct in_disc
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">φ</span></span> <span class="skolem"><span class="skolem">ru</span></span> <span class="skolem"><span class="skolem">rz</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        uz_polar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span> <span class="main">=</span> cor <span class="skolem">ru</span> <span class="main">*</span> cis <span class="skolem">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">=</span> cor <span class="skolem">rz</span> <span class="main">*</span> cis <span class="skolem">φ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ru</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ru</span> <span class="main">≤</span> <span class="skolem">rz</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">rz</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">=</span> arg <span class="skolem">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">=</span> arg <span class="skolem">z'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">u'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> cmod_cis norm_le_zero_iff<span class="main">)</span>

      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">θ</span></span> <span class="skolem"><span class="skolem">ry</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        y_polar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">=</span> cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ry</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">=</span> arg <span class="skolem">y'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y'</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> cmod_cis norm_le_zero_iff<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> in_disc * <span class="quoted"><span class="quoted">‹<span class="skolem">u'</span> <span class="main">=</span> cor <span class="skolem">ru</span> <span class="main">*</span> cis <span class="skolem">φ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">=</span> cor <span class="skolem">rz</span> <span class="main">*</span> cis <span class="skolem">φ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y'</span> <span class="main">=</span> cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ru</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rz</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ry</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> norm_mult<span class="main">)</span>

      <span class="keyword1"><span class="command">note</span></span> polar <span class="main">=</span> this y_polar uz_polar

      <span class="keyword1"><span class="command">have</span></span> nondeg<span class="main">:</span> <span class="quoted"><span class="quoted">"cis <span class="skolem">θ</span> <span class="main">*</span> cis <span class="main">(</span><span class="main">-</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">≠</span> cis <span class="main">(</span><span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">*</span> cis <span class="skolem">φ</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nondeg_yz polar
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yz</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_line <span class="skolem">y</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"calc_x_axis_intersection <span class="var">?yz</span>"</span></span>

      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">y</span> <span class="main">(</span>of_complex <span class="skolem">v</span><span class="main">)</span> <span class="skolem">z</span>"</span></span>

      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">v</span> <span class="main">∈</span> circline_set <span class="var">?yz</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> in_disc <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> distinct poincare_between_poincare_collinear<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_collinear_def<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">v</span> <span class="main">∈</span> circline_set x_axis"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">v</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?yz</span> <span class="main">≠</span> x_axis"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="main">(</span>poincare_line <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
          <span class="keyword1"><span class="command">using</span></span> distinct poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z</span></span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
          <span class="keyword1"><span class="command">using</span></span> distinct
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">=</span> of_complex <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="var">?yz</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> unique_calc_x_axis_intersection<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poincare_line <span class="skolem">y</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">v</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_iff<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?yz</span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> distinct <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntI is_poincare_line_poincare_line<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive <span class="var">?yz</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">v</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> circline_set <span class="var">?yz</span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> circline_set x_axis›</span></span>
        <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_positive_iff<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?yz</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">z</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?yz</span> <span class="main">≠</span> x_axis›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> positive_x_axis_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> circline_set x_axis"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="skolem">y</span> <span class="main">(</span>of_complex <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> x_axis"</span></span>
          <span class="keyword1"><span class="command">using</span></span> distinct <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> circline_set x_axis›</span></span>
          <span class="keyword1"><span class="command">using</span></span> in_disc <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span>
          <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">v</span>"</span></span> <span class="quoted">x_axis</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="skolem">y</span> <span class="main">(</span>of_complex <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> circline_set <span class="var">?yz</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="skolem">y</span> <span class="skolem">z</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> in_disc <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span> distinct
          <span class="keyword1"><span class="command">using</span></span> poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z</span></span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct_length_2_or_more is_poincare_line_poincare_line mem_Collect_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> circline_set x_axis"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> circline_set x_axis"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">moreover</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∉</span> circline_set x_axis"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="skolem">z</span> <span class="main">(</span>of_complex <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> x_axis"</span></span>
          <span class="keyword1"><span class="command">using</span></span> distinct <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> circline_set x_axis›</span></span>
          <span class="keyword1"><span class="command">using</span></span> in_disc <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span>
          <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">v</span>"</span></span> <span class="quoted">x_axis</span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="skolem">z</span> <span class="main">(</span>of_complex <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> circline_set <span class="var">?yz</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="skolem">y</span> <span class="skolem">z</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> in_disc <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span> distinct
          <span class="keyword1"><span class="command">using</span></span> poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">y</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">z</span></span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct_length_2_or_more is_poincare_line_poincare_line mem_Collect_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> circline_set x_axis"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> circline_set x_axis"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">ultimately</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">*</span> <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_between <span class="skolem">y</span> <span class="main">(</span>of_complex <span class="skolem">v</span><span class="main">)</span> <span class="skolem">z</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_intersection<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">v</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> in_disc <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span> distinct
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> circline_set <span class="var">?yz</span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">v</span> <span class="main">∈</span> circline_set x_axis›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">=</span> arg <span class="skolem">z'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">θ</span> <span class="main">=</span> arg <span class="skolem">y'</span>›</span></span> *
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">≠</span> pi"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∉</span> circline_set x_axis›</span></span> * polar cis_pi
        <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">≠</span> pi"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∉</span> circline_set x_axis›</span></span> * polar cis_pi
        <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> phi_sin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> sin <span class="skolem">φ</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> sin <span class="skolem">φ</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">=</span> arg <span class="skolem">z'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">≠</span> pi›</span></span>
        <span class="keyword1"><span class="command">using</span></span> arg_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> sin_gt_zero sin_le_zero sin_pi_minus sin_0_iff_canon sin_ge_zero<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

      <span class="keyword1"><span class="command">have</span></span> theta_sin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟷</span> sin <span class="skolem">θ</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> sin <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">θ</span> <span class="main">=</span> arg <span class="skolem">y'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">θ</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">θ</span> <span class="main">≠</span> pi›</span></span>
        <span class="keyword1"><span class="command">using</span></span> arg_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y'</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> sin_gt_zero sin_le_zero sin_pi_minus sin_0_iff_canon sin_ge_zero<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">φ</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">*</span> <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> phi_sin theta_sin
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_less_0_iff<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="numeral">2</span> <span class="main">*</span> pi <span class="main">&lt;</span> <span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="numeral">2</span> <span class="main">*</span> pi"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">=</span> arg <span class="skolem">z'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">θ</span> <span class="main">=</span> arg <span class="skolem">y'</span>›</span></span> arg_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z'</span></span><span class="main">]</span> arg_bounded<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y'</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">≠</span> pi›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">θ</span> <span class="main">≠</span> pi›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span> <span class="main">=</span> <span class="main">-</span>pi <span class="main">∨</span> <span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span> <span class="main">=</span> pi"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> sin_0_iff_canon sin_periodic_pi2<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span> <span class="main">=</span> <span class="main">-</span> pi"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">=</span> <span class="skolem">θ</span> <span class="main">-</span> pi"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> nondeg_yz
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y'</span> <span class="main">=</span> cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">=</span> cor <span class="skolem">rz</span> <span class="main">*</span> cis <span class="skolem">φ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">=</span> <span class="skolem">θ</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y'</span> <span class="main">=</span> cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">=</span> cor <span class="skolem">rz</span> <span class="main">*</span> cis <span class="skolem">φ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> nondeg_yz
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span> <span class="main">=</span> pi"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">=</span> <span class="skolem">θ</span> <span class="main">+</span> pi"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y'</span> <span class="main">=</span> cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">=</span> cor <span class="skolem">rz</span> <span class="main">*</span> cis <span class="skolem">φ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> nondeg_yz
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∉</span> circline_set x_axis"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> is_real <span class="skolem">u'</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> * polar in_disc
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">=</span> arg <span class="skolem">u'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">≠</span> pi›</span></span>  phi_sin<span class="main">(</span>1<span class="main">)</span> phi_sin<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_real_arg2<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> in_disc
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> * of_complex_inj<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u'</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?yu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_line <span class="skolem">y</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> nondeg_yu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y'</span> <span class="main">*</span> cnj <span class="skolem">u'</span> <span class="main">≠</span> cnj <span class="skolem">u'</span> <span class="main">*</span> <span class="skolem">u'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nondeg_yz polar <span class="quoted"><span class="quoted">‹<span class="skolem">ru</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> distinct
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">{</span></span>
        <span class="comment1">(* derive results simultaneously for both u and z *)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="main">::</span> <span class="quoted">real</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> den<span class="main">:</span> <span class="quoted"><span class="quoted">"cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span> <span class="main">*</span> cnj <span class="main">1</span> <span class="main">*</span> cnj <span class="main">(</span>cor <span class="skolem">r</span> <span class="main">*</span> cis <span class="skolem">φ</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">-</span> cor <span class="skolem">r</span> <span class="main">*</span> cis <span class="skolem">φ</span> <span class="main">*</span> cnj <span class="main">1</span> <span class="main">*</span> cnj <span class="main">(</span>cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span><span class="main">)</span> <span class="main">*</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ry</span>›</span></span> nondeg
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">r</span> <span class="main">*</span> <span class="skolem">ry</span> <span class="main">*</span> sin<span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> cis <span class="skolem">φ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ry</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">r</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ReB</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">ry</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">r</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">-</span> <span class="skolem">r</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ry</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> sin <span class="skolem">φ</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">*</span> cis <span class="main">(</span><span class="main">-</span><span class="skolem">φ</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">ry</span> <span class="main">*</span> cis <span class="main">(</span><span class="skolem">θ</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">ry</span> <span class="main">*</span> cis <span class="main">(</span><span class="main">-</span><span class="skolem">θ</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">r</span> <span class="main">*</span> cis <span class="main">(</span><span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_diff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="main">(</span><span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ry</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>  <span class="quoted"><span class="quoted">"cor <span class="skolem">r</span> <span class="main">*</span> cis <span class="main">(</span><span class="main">-</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>cor <span class="skolem">r</span> <span class="main">*</span> cis <span class="skolem">φ</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">r</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cis_inverse cis_neq_zero divide_complex_def cor_squared nonzero_mult_div_cancel_right power2_eq_square semiring_normalization_rules<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword1"><span class="command">ultimately</span></span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_line_cvec_cmat <span class="main">(</span>of_complex_cvec <span class="main">(</span>cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_complex_cvec <span class="main">(</span>cor <span class="skolem">r</span> <span class="main">*</span> cis <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?A</span><span class="main">,</span> <span class="var">?B</span><span class="main">,</span> cnj <span class="var">?B</span><span class="main">,</span> <span class="var">?A</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> den
          <span class="keyword1"><span class="command">unfolding</span></span> poincare_line_cvec_cmat_def of_complex_cvec_def Let_def prod.case
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="var">?A</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?mix</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"cis <span class="skolem">θ</span> <span class="main">*</span> cis <span class="main">(</span><span class="main">-</span> <span class="skolem">φ</span><span class="main">)</span> <span class="main">-</span> cis <span class="main">(</span><span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">*</span> cis <span class="skolem">φ</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_imag <span class="var">?mix</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> eq_minus_cnj_iff_imag<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?mix</span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Im <span class="var">?mix</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> nondeg
          <span class="keyword1"><span class="command">using</span></span> complex.expand<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?mix</span></span></span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="var">?A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sin_diff <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 3
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"cor <span class="var">?A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 2 3
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> zero_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ReB</span> <span class="main">/</span> <span class="var">?A</span> <span class="main">=</span> <span class="main">(</span>sin <span class="skolem">θ</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">r</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>sin <span class="skolem">φ</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">ry</span> <span class="main">+</span> <span class="skolem">ry</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> diff_divide_distrib<span class="main">)</span>             
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add_frac_num<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> add_frac_num<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square mult.commute<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_line_cvec_cmat <span class="main">(</span>of_complex_cvec <span class="main">(</span>cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_complex_cvec <span class="main">(</span>cor <span class="skolem">r</span> <span class="main">*</span> cis <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?A</span><span class="main">,</span> <span class="var">?B</span><span class="main">,</span> cnj <span class="var">?B</span><span class="main">,</span> <span class="var">?A</span><span class="main">)</span> <span class="main">∧</span>
                is_real <span class="var">?A</span> <span class="main">∧</span> Re <span class="var">?A</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="var">?A</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> cor <span class="var">?A</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
                Re <span class="var">?B</span> <span class="main">=</span> <span class="var">?ReB</span> <span class="main">∧</span>
                <span class="var">?ReB</span> <span class="main">/</span> <span class="var">?A</span> <span class="main">=</span> <span class="main">(</span>sin <span class="skolem">θ</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">r</span> <span class="main">+</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>sin <span class="skolem">φ</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">ry</span> <span class="main">+</span> <span class="skolem">ry</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 2 3 4 5
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">note</span></span> ** <span class="main">=</span> this

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ayz</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">rz</span> <span class="main">*</span> <span class="skolem">ry</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Byz</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">rz</span> <span class="main">*</span> cis <span class="skolem">φ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ry</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">rz</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ReByz</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">ry</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">rz</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">-</span> <span class="skolem">rz</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ry</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> sin <span class="skolem">φ</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Kz</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sin <span class="skolem">θ</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">rz</span> <span class="main">+</span> <span class="skolem">rz</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>sin <span class="skolem">φ</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">ry</span> <span class="main">+</span> <span class="skolem">ry</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> yz<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_line_cvec_cmat <span class="main">(</span>of_complex_cvec <span class="main">(</span>cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_complex_cvec <span class="main">(</span>cor <span class="skolem">rz</span> <span class="main">*</span> cis <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?Ayz</span><span class="main">,</span> <span class="var">?Byz</span><span class="main">,</span> cnj <span class="var">?Byz</span><span class="main">,</span> <span class="var">?Ayz</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"is_real <span class="var">?Ayz</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?Ayz</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ayz</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"cor <span class="var">?Ayz</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?Byz</span> <span class="main">=</span> <span class="var">?ReByz</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Kz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ReByz</span> <span class="main">/</span> <span class="var">?Ayz</span> <span class="main">=</span> <span class="var">?Kz</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> **<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">rz</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ayu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="skolem">ru</span> <span class="main">*</span> <span class="skolem">ry</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Byu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">ru</span> <span class="main">*</span> cis <span class="skolem">φ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ry</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ru</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ReByu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">ry</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ru</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">-</span> <span class="skolem">ru</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ry</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> sin <span class="skolem">φ</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ku</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sin <span class="skolem">θ</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin<span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">ru</span> <span class="main">+</span> <span class="skolem">ru</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>sin <span class="skolem">φ</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">ry</span> <span class="main">+</span> <span class="skolem">ry</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> yu<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_line_cvec_cmat <span class="main">(</span>of_complex_cvec <span class="main">(</span>cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_complex_cvec <span class="main">(</span>cor <span class="skolem">ru</span> <span class="main">*</span> cis <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="var">?Ayu</span><span class="main">,</span> <span class="var">?Byu</span><span class="main">,</span> cnj <span class="var">?Byu</span><span class="main">,</span> <span class="var">?Ayu</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"is_real <span class="var">?Ayu</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?Ayu</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ayu</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"cor <span class="var">?Ayu</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?Byu</span> <span class="main">=</span> <span class="var">?ReByu</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Ku<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?ReByu</span> <span class="main">/</span> <span class="var">?Ayu</span> <span class="main">=</span> <span class="var">?Ku</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> **<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ru</span>›</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ayz</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?Byz</span> <span class="main">/</span> <span class="var">?Ayz</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹intersects_x_axis_positive <span class="var">?yz</span>›</span></span>
          * <span class="quoted"><span class="quoted">‹<span class="skolem">y'</span> <span class="main">=</span> cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">=</span> cor <span class="skolem">rz</span> <span class="main">*</span> cis <span class="skolem">φ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u'</span> <span class="main">=</span> cor <span class="skolem">ru</span> <span class="main">*</span> cis <span class="skolem">φ</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ry</span></span> <span class="quoted"><span class="skolem">rz</span></span> <span class="quoted"><span class="skolem">ru</span></span> <span class="quoted"><span class="skolem">θ</span></span> <span class="quoted"><span class="skolem">φ</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ry</span></span> <span class="quoted"><span class="skolem">rz</span></span> <span class="quoted"><span class="skolem">ru</span></span> <span class="quoted"><span class="skolem">θ</span></span> <span class="quoted"><span class="skolem">φ</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive_cmat <span class="main">(</span>poincare_line_cvec_cmat <span class="main">(</span>of_complex_cvec <span class="main">(</span>cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_complex_cvec <span class="main">(</span>cor <span class="skolem">rz</span> <span class="main">*</span> cis <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ry</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">rz</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">-</span> <span class="skolem">rz</span> <span class="main">*</span> sin <span class="skolem">φ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ry</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="skolem">rz</span> <span class="main">*</span> <span class="skolem">ry</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> yz
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ReByz</span> <span class="main">/</span> <span class="var">?Ayz</span> <span class="main">≥</span> <span class="var">?ReByu</span> <span class="main">/</span> <span class="var">?Ayu</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sin <span class="skolem">φ</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sin <span class="skolem">φ</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_nonneg_nonneg<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ReByz</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ry</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">rz</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sin <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_pos_neg mult_pos_pos zero_less_power<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rz</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ry</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> sin <span class="skolem">φ</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sin <span class="skolem">φ</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_pos_neg mult_pos_pos zero_less_power<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ayz</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?Byz</span> <span class="main">/</span> <span class="var">?Ayz</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?Byz</span> <span class="main">=</span> <span class="var">?ReByz</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ReByz</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> divide_less_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_pos_pos zero_less_mult_pos<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="skolem">ru</span> <span class="main">+</span> <span class="skolem">ru</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">rz</span> <span class="main">+</span> <span class="skolem">rz</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Pasch_fun_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ru</span></span> <span class="quoted"><span class="skolem">rz</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ru</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ru</span> <span class="main">≤</span> <span class="skolem">rz</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">θ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">ru</span> <span class="main">+</span> <span class="skolem">ru</span><span class="main">)</span> <span class="main">≤</span> sin <span class="skolem">θ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">rz</span> <span class="main">+</span> <span class="skolem">rz</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sin <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ru</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ru</span> <span class="main">≤</span> <span class="skolem">rz</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Ayz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> divide_right_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"sin <span class="skolem">θ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">ru</span> <span class="main">+</span> <span class="skolem">ru</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">θ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">rz</span> <span class="main">+</span> <span class="skolem">rz</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Kz<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Ku<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sin <span class="skolem">φ</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">φ</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sin <span class="skolem">φ</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"sin <span class="skolem">φ</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">θ</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sin <span class="skolem">φ</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_nonpos_nonpos<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ReByz</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ry</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">rz</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> sin <span class="skolem">θ</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sin <span class="skolem">θ</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_pos_neg mult_pos_pos zero_less_power<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">rz</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">ry</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> sin <span class="skolem">φ</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sin <span class="skolem">φ</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_pos_neg mult_pos_pos zero_less_power<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ayz</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?Byz</span> <span class="main">/</span> <span class="var">?Ayz</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Ayz</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?Byz</span> <span class="main">=</span> <span class="var">?ReByz</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ReByz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> divide_less_0_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ry</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> mult_nonneg_nonneg<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="skolem">ru</span> <span class="main">+</span> <span class="skolem">ru</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">/</span> <span class="skolem">rz</span> <span class="main">+</span> <span class="skolem">rz</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Pasch_fun_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ru</span></span> <span class="quoted"><span class="skolem">rz</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">ru</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ru</span> <span class="main">≤</span> <span class="skolem">rz</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">θ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">ru</span> <span class="main">+</span> <span class="skolem">ru</span><span class="main">)</span> <span class="main">≥</span> sin <span class="skolem">θ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">rz</span> <span class="main">+</span> <span class="skolem">rz</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹sin <span class="skolem">θ</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ru</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ru</span> <span class="main">≤</span> <span class="skolem">rz</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">rz</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Ayz</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> divide_right_mono_neg<span class="main">[</span><span class="operator">of</span>  <span class="quoted"><span class="quoted">"sin <span class="skolem">θ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">rz</span> <span class="main">+</span> <span class="skolem">rz</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"sin <span class="skolem">θ</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="skolem">ru</span> <span class="main">+</span> <span class="skolem">ru</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> sin <span class="main">(</span><span class="skolem">φ</span> <span class="main">-</span> <span class="skolem">θ</span><span class="main">)</span>"</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Kz<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Ku<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive <span class="var">?yu</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">y'</span> <span class="main">=</span> cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">=</span> cor <span class="skolem">rz</span> <span class="main">*</span> cis <span class="skolem">φ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u'</span> <span class="main">=</span> cor <span class="skolem">ru</span> <span class="main">*</span> cis <span class="skolem">φ</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ry</span></span> <span class="quoted"><span class="skolem">rz</span></span> <span class="quoted"><span class="skolem">ru</span></span> <span class="quoted"><span class="skolem">θ</span></span> <span class="quoted"><span class="skolem">φ</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ry</span></span> <span class="quoted"><span class="skolem">rz</span></span> <span class="quoted"><span class="skolem">ru</span></span> <span class="quoted"><span class="skolem">θ</span></span> <span class="quoted"><span class="skolem">φ</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?Byu</span> <span class="main">/</span> <span class="var">?Ayu</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?Byz</span> <span class="main">/</span> <span class="var">?Ayz</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ReByz</span> <span class="main">/</span> <span class="var">?Ayz</span> <span class="main">≥</span> <span class="var">?ReByu</span> <span class="main">/</span> <span class="var">?Ayu</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?Byz</span> <span class="main">=</span> <span class="var">?ReByz</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="quoted"><span class="quoted">‹Re <span class="var">?Byu</span> <span class="main">=</span> <span class="var">?ReByu</span>›</span></span><span class="main">)</span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive_cmat <span class="main">(</span>poincare_line_cvec_cmat <span class="main">(</span>of_complex_cvec <span class="main">(</span>cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_complex_cvec <span class="main">(</span>cor <span class="skolem">ru</span> <span class="main">*</span> cis <span class="skolem">φ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> yu
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"calc_x_axis_intersection <span class="var">?yu</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> positive_x_axis"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> circline_set <span class="var">?yu</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹intersects_x_axis_positive <span class="var">?yu</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_positive_iff'<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?yu</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">u</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a'</span></span> <span class="keyword2"><span class="keyword">where</span></span> a'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">=</span> of_complex <span class="skolem">a'</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">a'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">a'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">a'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> positive_x_axis_def circline_set_x_axis
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="var">?yz</span>"</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="var">?yu</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹intersects_x_axis_positive <span class="var">?yz</span>›</span></span> <span class="quoted"><span class="quoted">‹intersects_x_axis_positive <span class="var">?yu</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_between <span class="skolem">u</span> <span class="bound">a</span> <span class="skolem">y</span> <span class="main">∧</span> poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">a</span> <span class="main">(</span>of_complex <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">u</span> <span class="var">?a</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_intersection<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> calc_x_axis_intersection<span class="main">[</span><span class="operator">OF</span> is_poincare_line_poincare_line<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">u</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹intersects_x_axis <span class="var">?yu</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> calc_x_axis_intersection_in_unit_disc<span class="main">[</span><span class="operator">OF</span> is_poincare_line_poincare_line<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">u</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹intersects_x_axis <span class="var">?yu</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> in_disc <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∉</span> circline_set x_axis›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∉</span> circline_set x_axis›</span></span>
          <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">=</span> arg <span class="skolem">u'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">θ</span> <span class="main">=</span> arg <span class="skolem">y'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="main">*</span> <span class="skolem">θ</span> <span class="main">&lt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> poincare_between_rev<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a</span> <span class="main">(</span>of_complex <span class="skolem">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="var">?ReByz</span> <span class="main">/</span> <span class="var">?Ayz</span> <span class="main">≤</span> <span class="main">-</span><span class="var">?ReByu</span> <span class="main">/</span> <span class="var">?Ayu</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ReByz</span> <span class="main">/</span> <span class="var">?Ayz</span> <span class="main">≥</span> <span class="var">?ReByu</span> <span class="main">/</span> <span class="var">?Ayu</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"outward <span class="var">?yz</span> <span class="var">?yu</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">y'</span> <span class="main">=</span> cor <span class="skolem">ry</span> <span class="main">*</span> cis <span class="skolem">θ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z'</span> <span class="main">=</span> cor <span class="skolem">rz</span> <span class="main">*</span> cis <span class="skolem">φ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u'</span> <span class="main">=</span> cor <span class="skolem">ru</span> <span class="main">*</span> cis <span class="skolem">φ</span>›</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ry</span></span> <span class="quoted"><span class="skolem">rz</span></span> <span class="quoted"><span class="skolem">ru</span></span> <span class="quoted"><span class="skolem">θ</span></span> <span class="quoted"><span class="skolem">φ</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span> <span class="quasi_keyword">fixing</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ry</span></span> <span class="quoted"><span class="skolem">rz</span></span> <span class="quoted"><span class="skolem">ru</span></span> <span class="quoted"><span class="skolem">θ</span></span> <span class="quoted"><span class="skolem">φ</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> yz yu<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> outward_cmat_def
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Let_def prod.case<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> yz yu<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">-</span><span class="var">?ReByz</span> <span class="main">/</span> <span class="var">?Ayz</span> <span class="main">≤</span> <span class="main">-</span><span class="var">?ReByu</span> <span class="main">/</span> <span class="var">?Ayu</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">a'</span> <span class="main">≤</span> Re <span class="skolem">v</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v</span> <span class="main">=</span> of_complex <span class="skolem">v</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">=</span> of_complex <span class="skolem">a'</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹intersects_x_axis_positive <span class="var">?yz</span>›</span></span> <span class="quoted"><span class="quoted">‹intersects_x_axis_positive <span class="var">?yu</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> outward<span class="main">[</span><span class="operator">OF</span> is_poincare_line_poincare_line<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">z</span>›</span></span><span class="main"><span class="main">]</span></span> is_poincare_line_poincare_line<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="skolem">u</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?v</span> <span class="main">=</span> of_complex <span class="skolem">v</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_0uv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">a'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">v</span>"</span></span><span class="main">]</span> a' v
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> unit_disc"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">x</span> <span class="skolem">v</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?Mx</span> <span class="var">?Mv</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">x</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">u</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?My</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mz</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">,</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">v</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span>
             <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">x</span> <span class="skolem">u</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">y</span> <span class="skolem">v</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">Ma</span><span class="main">.</span> <span class="bound">Ma</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_between <span class="var">?Mu</span> <span class="bound">Ma</span> <span class="var">?My</span> <span class="main">∧</span> poincare_between <span class="var">?Mx</span> <span class="bound">Ma</span> <span class="var">?Mv</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 2<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?My</span></span></span> <span class="var"><span class="quoted"><span class="var">?Mz</span></span></span> <span class="var"><span class="quoted"><span class="var">?Mu</span></span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ma</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ma</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="var">?Mu</span> <span class="skolem">Ma</span> <span class="var">?My</span> <span class="main">∧</span> poincare_between <span class="var">?Mx</span> <span class="skolem">Ma</span> <span class="var">?Mv</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="main">(</span><span class="main">-</span><span class="skolem">M</span><span class="main">)</span> <span class="skolem">Ma</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ma</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="var">?a</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ma</span> <span class="main">=</span> <span class="skolem">Ma</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> moebius_pt_invert uminus_moebius_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ma</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="var">?Mu</span> <span class="var">?Ma</span> <span class="var">?My</span> <span class="main">∧</span> poincare_between <span class="var">?Mx</span> <span class="var">?Ma</span> <span class="var">?Mv</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Ma
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_between <span class="skolem">u</span> <span class="bound">a</span> <span class="skolem">y</span> <span class="main">∧</span> poincare_between <span class="skolem">x</span> <span class="bound">a</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_moebius_inv<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ma</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> moebius_pt_comp_inv_right<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Pasch axiom, only degenerative cases.›</span></span>
<span class="keyword1" id="Poincare_Tarski-Pasch_deg"><span class="command">lemma</span></span> Pasch_deg<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> distinct <span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">,</span> <span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">]</span> <span class="main">∨</span> poincare_collinear <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x</span> <span class="free">u</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">y</span> <span class="free">v</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_between <span class="free">u</span> <span class="bound">a</span> <span class="free">y</span> <span class="main">∧</span> poincare_between <span class="free">x</span> <span class="bound">a</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">∨</span> poincare_between <span class="free">y</span> <span class="free">x</span> <span class="free">z</span> <span class="main">∨</span> poincare_between <span class="free">y</span> <span class="free">z</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 3<span class="main">)</span> poincare_collinear3_between poincare_between_rev <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x</span> <span class="free">y</span> <span class="free">z</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x</span> <span class="free">y</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> True assms poincare_between_transitivity
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> poincare_between_rev<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">y</span> <span class="free">x</span> <span class="free">z</span> <span class="main">∨</span> poincare_between <span class="free">y</span> <span class="free">z</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_between <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">∨</span> poincare_between <span class="free">y</span> <span class="free">x</span> <span class="free">z</span> <span class="main">∨</span> poincare_between <span class="free">y</span> <span class="free">z</span> <span class="free">x</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">y</span> <span class="free">x</span> <span class="free">z</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">u</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> poincare_between_rev poincare_between_transitivity<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">y</span> <span class="free">z</span> <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_between <span class="free">y</span> <span class="free">x</span> <span class="free">z</span> <span class="main">∨</span> poincare_between <span class="free">y</span> <span class="free">z</span> <span class="free">x</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x</span> <span class="free">z</span> <span class="free">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> poincare_between_rev poincare_between_transitivity<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x</span> <span class="free">u</span> <span class="free">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms poincare_between_transitivity poincare_between_rev
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> poincare_between_sum_distances<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> distinct <span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">,</span> <span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">=</span><span class="free">z</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>poincare_between_rev<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="comment1">(* "u ≠ z" *)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms poincare_between_sandwich <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="free">z</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="comment1">(* v ≠ z *)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="free">z</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms poincare_between_sandwich <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">=</span> <span class="free">x</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False <span class="comment1">(*u ≠ x*)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_commute poincare_between_poincare_collinear<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_collinear <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x</span> <span class="free">v</span> <span class="free">z</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">v</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> poincare_between_rev<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_line_uvz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="free">z</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">v</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span> 
            <span class="keyword1"><span class="command">using</span></span> poincare_between_rev<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_line_uvz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="free">z</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">v</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> ex_poincare_line_two_points<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">z</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="free">z</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">v</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="free">z</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">v</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">v</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">z</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="free">z</span> <span class="free">v</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"poincare_line <span class="free">z</span> <span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>            
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="free">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">y</span> <span class="main">≠</span> <span class="free">z</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v</span> <span class="main">≠</span> <span class="free">z</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="free">z</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">u</span> <span class="main">≠</span> <span class="free">z</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> distinct <span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">,</span> <span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">]</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> assms
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Axiom of Pasch›</span></span>
<span class="keyword1" id="Poincare_Tarski-Pasch"><span class="command">lemma</span></span> Pasch<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x</span> <span class="free">u</span> <span class="free">z</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">y</span> <span class="free">v</span> <span class="free">z</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_between <span class="free">u</span> <span class="bound">a</span> <span class="free">y</span> <span class="main">∧</span> poincare_between <span class="free">x</span> <span class="bound">a</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">,</span> <span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">]</span> <span class="main">∧</span> <span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="free">z</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Pasch_nondeg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms Pasch_deg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Segment construction axiom›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1" id="Poincare_Tarski-segment_construction"><span class="command">lemma</span></span> segment_construction<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_between <span class="free">x</span> <span class="free">y</span> <span class="bound">z</span> <span class="main">∧</span> poincare_distance <span class="free">y</span> <span class="bound">z</span> <span class="main">=</span> poincare_distance <span class="free">a</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">=</span> poincare_distance <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d poincare_distance_ge0<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_between <span class="free">x</span> <span class="free">y</span> <span class="bound">z</span> <span class="main">∧</span> poincare_distance <span class="free">y</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">x</span> <span class="free">y</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_distance <span class="free">x</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_zero<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ex_x_axis_poincare_distance_negative<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">≥</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">u</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_distance <span class="main">(</span>moebius_pt <span class="main">(</span>blaschke <span class="skolem">a</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>moebius_pt <span class="main">(</span>blaschke <span class="skolem">a</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> z'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> moebius_pt <span class="main">(</span>blaschke <span class="skolem">a</span><span class="main">)</span> <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"blaschke <span class="skolem">a</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> blaschke_unit_disc_fix<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> poincare_distance <span class="skolem">u</span> <span class="bound">z</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * z' <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">:</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> blaschke_unit_disc_fix<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹cmod <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">=</span> <span class="free">y</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_positive_x_axis<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span> <span class="bound"><span class="bound">y</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="var"><span class="var">?P</span></span> <span class="bound"><span class="bound">x</span></span> <span class="bound"><span class="bound">y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>

      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">z</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="quoted"><span class="quoted">"of_complex <span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">z</span> <span class="main">∈</span> circline_set x_axis"</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ex_x_axis_poincare_distance_negative<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">d</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">d</span> <span class="main">≥</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_u0v<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> z <span class="quoted"><span class="quoted">‹is_real <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">x</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> False
          <span class="keyword1"><span class="command">using</span></span> complex_eq_if_Re_eq mult_pos_neg
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">z</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">d</span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="skolem">z</span> <span class="main">∈</span> unit_disc›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">z</span> <span class="main">=</span> <span class="skolem">d</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="keyword2"><span class="keyword">where</span></span> z'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> moebius_pt <span class="skolem">M</span> <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z'</span> <span class="main">∈</span> unit_disc"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">z</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">v</span> <span class="skolem">u</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms d
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Five segment axiom›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1" id="Poincare_Tarski-five_segment_axiom"><span class="command">lemma</span></span> five_segment_axiom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
     in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
     in_disc'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      betw<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x</span> <span class="free">y</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x'</span> <span class="free">y'</span> <span class="free">z'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      xy<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> poincare_distance <span class="free">x'</span> <span class="free">y'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      xu<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">x</span> <span class="free">u</span> <span class="main">=</span> poincare_distance <span class="free">x'</span> <span class="free">u'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      yu<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">y</span> <span class="free">u</span> <span class="main">=</span> poincare_distance <span class="free">y'</span> <span class="free">u'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      yz<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">y</span> <span class="free">z</span> <span class="main">=</span> poincare_distance <span class="free">y'</span> <span class="free">z'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>
     <span class="quoted"><span class="quoted">"poincare_distance <span class="free">z</span> <span class="free">u</span> <span class="main">=</span> poincare_distance <span class="free">z'</span> <span class="free">u'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  M<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix_f <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="free">u</span> <span class="main">=</span> <span class="free">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="free">y</span> <span class="main">=</span> <span class="free">y'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_f_congruent_triangles<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="free">z</span> <span class="main">=</span> <span class="free">z'</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> unique_poincare_distance_on_ray<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> u<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">x'</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> v<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">y'</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> y<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">M</span></span> <span class="free"><span class="free">z</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> z<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">z'</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> d<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"poincare_distance <span class="free"><span class="free">x</span></span> <span class="free"><span class="free">z</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> poincare_distance <span class="free">x</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_distance_ge0 in_disc
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">x'</span> <span class="main">≠</span> <span class="free">y'</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> M <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> in_disc in_disc' poincare_distance_eq_0_iff xy
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">x'</span> <span class="main">(</span><span class="skolem">M</span> <span class="free">z</span><span class="main">)</span> <span class="main">=</span> poincare_distance <span class="free">x</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> M in_disc
      <span class="keyword1"><span class="command">unfolding</span></span> unit_disc_fix_f_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">using</span></span> M in_disc
      <span class="keyword1"><span class="command">unfolding</span></span> unit_disc_fix_f_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">x'</span> <span class="free">z'</span> <span class="main">=</span> poincare_distance <span class="free">x</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xy yz betw
      <span class="keyword1"><span class="command">using</span></span> poincare_between_sum_distances<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> poincare_between_sum_distances<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x'</span></span> <span class="quoted"><span class="free">y'</span></span> <span class="quoted"><span class="free">z'</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> in_disc in_disc'
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x'</span> <span class="free">y'</span> <span class="main">(</span><span class="skolem">M</span> <span class="free">z</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> M
      <span class="keyword1"><span class="command">using</span></span> in_disc betw
      <span class="keyword1"><span class="command">unfolding</span></span> unit_disc_fix_f_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix_f <span class="skolem">M</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> in_disc in_disc'
    <span class="quoted"><span class="quoted">‹<span class="skolem">M</span> <span class="free">u</span> <span class="main">=</span> <span class="free">u'</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> unit_disc_fix_f_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Upper dimension axiom›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1" id="Poincare_Tarski-upper_dimension_axiom"><span class="command">lemma</span></span> upper_dimension_axiom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="free">x</span> <span class="free">u</span> <span class="main">=</span> poincare_distance <span class="free">x</span> <span class="free">v</span>"</span></span>
          <span class="quoted"><span class="quoted">"poincare_distance <span class="free">y</span> <span class="free">u</span> <span class="main">=</span> poincare_distance <span class="free">y</span> <span class="free">v</span>"</span></span>
          <span class="quoted"><span class="quoted">"poincare_distance <span class="free">z</span> <span class="free">u</span> <span class="main">=</span> poincare_distance <span class="free">z</span> <span class="free">v</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">≠</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="free">x</span> <span class="free">y</span> <span class="free">z</span> <span class="main">∨</span> poincare_between <span class="free">y</span> <span class="free">z</span> <span class="free">x</span> <span class="main">∨</span> poincare_between <span class="free">z</span> <span class="free">x</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="free">y</span> <span class="main">∨</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="free">z</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> in_disc
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≠</span> <span class="free">z</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?cong</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">a'</span> <span class="bound">b'</span><span class="main">.</span> poincare_distance <span class="bound">a</span> <span class="bound">b</span> <span class="main">=</span> poincare_distance <span class="bound">a'</span> <span class="bound">b'</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">z</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">v</span> <span class="main">∈</span> unit_disc <span class="main">∧</span>
                 <span class="var">?cong</span> <span class="free">x</span> <span class="bound">u</span> <span class="free">x</span> <span class="bound">v</span> <span class="main">∧</span> <span class="var">?cong</span> <span class="free">y</span> <span class="bound">u</span> <span class="free">y</span> <span class="bound">v</span> <span class="main">∧</span> <span class="var">?cong</span> <span class="bound">z</span> <span class="bound">u</span> <span class="bound">z</span> <span class="bound">v</span>  <span class="main">∧</span> <span class="bound">u</span> <span class="main">≠</span> <span class="bound">v</span> <span class="main">⟶</span>
                 poincare_collinear <span class="main">{</span><span class="free">x</span><span class="main">,</span> <span class="free">y</span><span class="main">,</span> <span class="bound">z</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">x</span> <span class="free">y</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_positive_x_axis<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">x</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set x_axis"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">u</span> <span class="skolem">v</span>
      <span class="keyword3"><span class="command">assume</span></span> in_disc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z'</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> zuv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">=</span> of_complex <span class="skolem">z'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> of_complex <span class="skolem">u'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> of_complex <span class="skolem">v'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">assume</span></span> cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?cong</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">u</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cong</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cong</span> <span class="skolem">z</span> <span class="skolem">u</span> <span class="skolem">z</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?r0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_distance <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="var"><span class="quoted"><span class="var">?rx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_distance <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="skolem">u</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?r0</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rx</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> in_disc  cong
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> poincare_distance_ge0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> poincare_distance_ge0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> poincare_distance_ge0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> poincare_distance_ge0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> x
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?pc0</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_circle <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?r0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          <span class="var"><span class="quoted"><span class="var">?pcx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_circle <span class="main">(</span>of_complex <span class="skolem">x</span><span class="main">)</span> <span class="var">?rx</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> <span class="var">?pc0</span> <span class="main">∩</span> <span class="var">?pcx</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="var">?pc0</span> <span class="main">∩</span> <span class="var">?pcx</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> in_disc cong
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_circle_def<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> conjugate <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> intersect_poincare_circles_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="var"><span class="quoted"><span class="var">?r0</span></span></span> <span class="var"><span class="quoted"><span class="var">?rx</span></span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> x <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?r0</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?rx</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ru</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_distance <span class="skolem">u</span> <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ru</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_ge0<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> in_disc
        <span class="keyword1"><span class="command">using</span></span> cong
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> poincare_distance_eq_0_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">z</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> poincare_distance_eq_0_iff
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> poincare_circle <span class="skolem">u</span> <span class="var">?ru</span> <span class="main">∩</span> poincare_circle <span class="skolem">v</span> <span class="var">?ru</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> cong in_disc
        <span class="keyword1"><span class="command">unfolding</span></span> poincare_circle_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_distance_sym<span class="main">)</span>

      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">z'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> intersect_poincare_circles_conjugate_centers<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="var"><span class="quoted"><span class="var">?ru</span></span></span> <span class="quoted"><span class="skolem">z</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">=</span> conjugate <span class="skolem">v</span>›</span></span> zuv
        <span class="keyword1"><span class="command">using</span></span> in_disc <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?ru</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> of_complex <span class="skolem">x</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_line_0_real_is_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">x</span>"</span></span><span class="main">]</span> x <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> zuv <span class="quoted"><span class="quoted">‹<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set x_axis›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted">x_axis</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_x_axis<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="skolem">M</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">z</span> <span class="skolem">u</span> <span class="skolem">v</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span>
             <span class="quoted"><span class="quoted">"<span class="var">?cong</span> <span class="skolem">x</span> <span class="skolem">u</span> <span class="skolem">x</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cong</span> <span class="skolem">y</span> <span class="skolem">u</span> <span class="skolem">y</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cong</span> <span class="skolem">z</span> <span class="skolem">u</span> <span class="skolem">z</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span>moebius_pt <span class="skolem">M</span> <span class="skolem">x</span><span class="main">,</span> moebius_pt <span class="skolem">M</span> <span class="skolem">y</span><span class="main">,</span> moebius_pt <span class="skolem">M</span> <span class="skolem">z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 2<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">z</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="skolem">M</span> <span class="skolem">v</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>moebius_pt <span class="skolem">M</span> <span class="skolem">x</span><span class="main">,</span> moebius_pt <span class="skolem">M</span> <span class="skolem">y</span><span class="main">,</span> moebius_pt <span class="skolem">M</span> <span class="skolem">z</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="skolem">y</span><span class="main">,</span> <span class="skolem">z</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"moebius_circline <span class="main">(</span><span class="main">-</span><span class="skolem">M</span><span class="main">)</span> <span class="skolem">p</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">using</span></span> poincare_collinear3_between<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quoted"><span class="free">z</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_between_rev
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Lower dimension axiom›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1" id="Poincare_Tarski-lower_dimension_axiom"><span class="command">lemma</span></span> lower_dimension_axiom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="main">∃</span> <span class="bound">b</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="main">∃</span> <span class="bound">c</span> <span class="main">∈</span> unit_disc<span class="main">.</span>
            <span class="main">¬</span> poincare_between <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span> <span class="main">¬</span> poincare_between <span class="bound">b</span> <span class="bound">c</span> <span class="bound">a</span> <span class="main">∧</span> <span class="main">¬</span> poincare_between <span class="bound">c</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?v</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?u</span><span class="main">,</span> <span class="var">?v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="skolem">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?u</span><span class="main">,</span> <span class="var">?v</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> of_complex <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> of_complex_inj
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="var">?u</span> <span class="var">?v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="var"><span class="quoted"><span class="var">?v</span></span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_collinear<span class="main">[</span><span class="operator">OF</span> 1 2 3<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_collinear<span class="main">[</span><span class="operator">OF</span> 2 3 1<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_collinear<span class="main">[</span><span class="operator">OF</span> 3 1 2<span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_commute<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Negated Euclidean axiom›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1" id="Poincare_Tarski-negated_euclidean_axiom_aux"><span class="command">lemma</span></span> negated_euclidean_axiom_aux<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"on_circline <span class="free">H</span> <span class="main">(</span>of_complex <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> intersects_y_axis_positive <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">H</span>
  <span class="keyword3"><span class="command">assume</span></span> hh<span class="main">:</span> <span class="quoted"><span class="quoted">"hermitean <span class="skolem">H</span> <span class="main">∧</span> <span class="skolem">H</span> <span class="main">≠</span> mat_zero"</span></span> <span class="quoted"><span class="quoted">"is_poincare_line_cmat <span class="skolem">H</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">D</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">H</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">A</span><span class="main">,</span> <span class="skolem">B</span><span class="main">,</span> cnj <span class="skolem">B</span><span class="main">,</span> <span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="skolem">B</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>cmod <span class="skolem">A</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hermitean_elems<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">A</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">D</span></span></span></span></span></span></span></span><span class="main">]</span> hh
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive_cmat <span class="skolem">H</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">B</span> <span class="main">/</span> Re <span class="skolem">A</span> <span class="main">&lt;</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"on_circline_cmat_cvec <span class="skolem">H</span> <span class="main">(</span>of_complex_cvec <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">+</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">6</span><span class="main">*</span><span class="skolem">A</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">*</span>Re <span class="skolem">B</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">*</span>Im <span class="skolem">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">unfolding</span></span> of_real_mult
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Re_express_cnj<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Im_express_cnj<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">B</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="numeral">6</span><span class="main">*</span><span class="skolem">A</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">*</span>Re <span class="skolem">B</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">*</span>Im <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">*</span>Re <span class="skolem">A</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>Re <span class="skolem">B</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span>Im <span class="skolem">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="skolem">A</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> Re <span class="skolem">B</span><span class="main">/</span>Re <span class="skolem">A</span> <span class="main">+</span> Im <span class="skolem">B</span><span class="main">/</span>Re <span class="skolem">A</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span>Im <span class="skolem">B</span><span class="main">/</span>Re <span class="skolem">A</span> <span class="main">-</span> <span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="skolem">B</span> <span class="main">/</span> Re <span class="skolem">A</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Im <span class="skolem">B</span><span class="main">/</span>Re <span class="skolem">A</span> <span class="main">&gt;</span> <span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> intersects_y_axis_positive_cmat <span class="skolem">H</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Tarski-negated_euclidean_axiom"><span class="command">lemma</span></span> negated_euclidean_axiom<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">t</span><span class="main">.</span>
           <span class="bound">a</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">d</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> unit_disc <span class="main">∧</span>
           poincare_between <span class="bound">a</span> <span class="bound">d</span> <span class="bound">t</span> <span class="main">∧</span> poincare_between <span class="bound">b</span> <span class="bound">d</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc <span class="main">∧</span>
                        poincare_between <span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span> <span class="main">∧</span> poincare_between <span class="bound">x</span> <span class="bound">t</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">¬</span> poincare_between <span class="bound">a</span> <span class="bound">c</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?dl</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">5</span> <span class="main">-</span> sqrt <span class="numeral">17</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="var">?dl</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span><span class="var">?dl</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?t</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?dl</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt <span class="numeral">17</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≠</span> <span class="numeral">5</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="numeral">17</span> <span class="main">≠</span> <span class="numeral">5</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">≠</span> <span class="var">?a</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?dl</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span><span class="var">?dl</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="var">?dl</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span><span class="var">?dl</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?dl</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?dl</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt <span class="numeral">17</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="numeral">5</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="numeral">17</span> <span class="main">&lt;</span> <span class="numeral">5</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power2_less_imp_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≠</span> <span class="var">?b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> divide_eq_0_iff of_complex_zero_iff zero_neq_numeral zero_neq_one<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≠</span> <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex_i_not_zero divide_eq_0_iff of_complex_zero_iff zero_neq_numeral<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?d</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>


    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power2_eq_square<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> cmod_d<span class="main">:</span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="var">?dl</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">*</span><span class="var">?dl</span><span class="main">)</span> <span class="main">=</span> <span class="var">?dl</span> <span class="main">*</span> sqrt <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?dl</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cmod_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> real_sqrt_mult<span class="main">)</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?dl</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">17</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span><span class="numeral">5</span> <span class="main">*</span> sqrt <span class="numeral">17</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">17</span> <span class="main">&lt;</span> <span class="numeral">5</span> <span class="main">*</span> sqrt <span class="numeral">17</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power2_less_imp_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?dl</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> sqrt <span class="numeral">2</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?dl</span> <span class="main">&lt;</span> <span class="main">1</span> <span class="main">/</span> sqrt <span class="numeral">2</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power2_less_imp_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> cmod_d
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> cmod_d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="main">(</span>to_complex <span class="var">?d</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="main">-</span><span class="numeral">17</span> <span class="main">+</span> <span class="numeral">5</span><span class="main">*</span>sqrt <span class="numeral">17</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?cmod_d</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> to_complex_of_complex<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> cmod_d<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_mult_distrib<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="keyword1"><span class="command">have</span></span> cmod_d_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span>to_complex <span class="var">?d</span> <span class="main">-</span> to_complex <span class="var">?c</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span><span class="numeral">17</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">*</span>sqrt <span class="numeral">17</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">4</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?cmod_dc</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> cmod_square
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> cmod_c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>cmod <span class="main">(</span>to_complex <span class="var">?c</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="numeral">3</span><span class="main">/</span><span class="numeral">4</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?cmod_c</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_square<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span><span class="main">(</span>to_complex <span class="var">?b</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>to_complex <span class="var">?d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> cmod <span class="main">(</span><span class="main">(</span>to_complex <span class="var">?d</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>to_complex <span class="var">?c</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span>to_complex <span class="var">?b</span><span class="main">)</span> <span class="main">=</span> cmod <span class="main">(</span>to_complex <span class="var">?c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_distance_formula' <span class="main">(</span>to_complex <span class="var">?b</span><span class="main">)</span> <span class="main">(</span>to_complex <span class="var">?d</span><span class="main">)</span> <span class="main">=</span>
             poincare_distance_formula' <span class="main">(</span>to_complex <span class="var">?d</span><span class="main">)</span> <span class="main">(</span>to_complex <span class="var">?c</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula'_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_distance_formula' <span class="main">(</span>to_complex <span class="var">?d</span><span class="main">)</span> <span class="main">(</span>to_complex <span class="var">?c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>sqrt <span class="numeral">17</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">3</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula'_def
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> cmod_d<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> cmod_c<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> cmod_d_c<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt <span class="numeral">17</span> <span class="main">*</span> <span class="numeral">15</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≠</span> <span class="numeral">51</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="numeral">17</span> <span class="main">*</span> <span class="numeral">15</span> <span class="main">≠</span> <span class="numeral">51</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="numeral">17</span> <span class="main">*</span> <span class="numeral">15</span> <span class="main">-</span> <span class="numeral">51</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">5</span> <span class="main">*</span> sqrt <span class="numeral">17</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≠</span> <span class="numeral">17</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">5</span> <span class="main">*</span> sqrt <span class="numeral">17</span> <span class="main">≠</span> <span class="numeral">17</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?cmod_d</span> <span class="main">*</span> <span class="var">?cmod_c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?cmod_dc</span> <span class="main">/</span> <span class="main">(</span><span class="var">?cmod_d</span> <span class="main">*</span> <span class="var">?cmod_c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="var">?cmod_d</span> <span class="main">*</span> <span class="var">?cmod_c</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="var">?cmod_dc</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="var">?cmod_d</span> <span class="main">*</span> <span class="var">?cmod_c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> add_frac_num<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?cmod_d</span> <span class="main">*</span> <span class="var">?cmod_c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">*</span> <span class="var">?cmod_dc</span>"</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">64</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">85</span> <span class="main">-</span> sqrt <span class="numeral">17</span> <span class="main">*</span> <span class="numeral">17</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">64</span> <span class="main">*</span> <span class="main">(</span>sqrt <span class="numeral">17</span> <span class="main">*</span> <span class="numeral">15</span> <span class="main">-</span> <span class="numeral">51</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">85</span> <span class="main">-</span> sqrt <span class="numeral">17</span> <span class="main">*</span> <span class="numeral">17</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>sqrt <span class="numeral">17</span> <span class="main">*</span> <span class="numeral">15</span> <span class="main">-</span> <span class="numeral">51</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_divide_mult_cancel_left<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> sqrt <span class="numeral">17</span> <span class="main">/</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> frac_eq_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="var">?cmod_dc</span> <span class="main">/</span> <span class="main">(</span><span class="var">?cmod_d</span> <span class="main">*</span> <span class="var">?cmod_c</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> sqrt <span class="numeral">17</span> <span class="main">/</span> <span class="numeral">3</span>"</span></span>
        <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="numeral">17</span> <span class="main">≥</span> <span class="numeral">3</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt <span class="numeral">17</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≥</span> <span class="numeral">3</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power2_le_imp_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="var">?b</span> <span class="var">?d</span> <span class="var">?c</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_sum_distances<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?c</span> <span class="main">∈</span> unit_disc›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">∈</span> unit_disc›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?c</span> <span class="main">∈</span> unit_disc›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?c</span> <span class="main">∈</span> unit_disc›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> xx<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> **<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> arcosh_double<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_def power2_eq_square<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="var">?a</span> <span class="var">?d</span> <span class="var">?t</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> poincare_between_0uv<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?t</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">≠</span> <span class="var">?a</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">19</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">5</span> <span class="main">*</span> sqrt <span class="numeral">17</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">19</span> <span class="main">≤</span> <span class="numeral">5</span> <span class="main">*</span> sqrt <span class="numeral">17</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power2_le_imp_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cmod <span class="main">(</span>to_complex <span class="var">?d</span><span class="main">)</span> <span class="main">≤</span> cmod <span class="main">(</span>to_complex <span class="var">?t</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def cmod_def power2_eq_square <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arg <span class="main">(</span>to_complex <span class="var">?d</span><span class="main">)</span> <span class="main">=</span> arg <span class="main">(</span>to_complex <span class="var">?t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"to_complex <span class="var">?d</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="numeral">5</span> <span class="main">-</span> sqrt <span class="numeral">17</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"to_complex <span class="var">?t</span> <span class="main">=</span> <span class="main">(</span>cor <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="keyword1">𝗂</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sqrt <span class="numeral">17</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&lt;</span> <span class="numeral">5</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"sqrt <span class="numeral">17</span> <span class="main">&lt;</span> <span class="numeral">5</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power2_less_imp_less<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">5</span> <span class="main">-</span> sqrt <span class="numeral">17</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">4</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> 2<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> arg_mult_real_positive<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 3<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> arg_mult_real_positive<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 4<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">d'</span> <span class="main">=</span> to_complex <span class="var">?d</span><span class="main">;</span> <span class="bound">t'</span> <span class="main">=</span> to_complex <span class="var">?t</span> <span class="keyword1">in</span> arg <span class="bound">d'</span> <span class="main">=</span> arg <span class="bound">t'</span> <span class="main">∧</span> cmod <span class="bound">d'</span> <span class="main">≤</span> cmod <span class="bound">t'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">=</span> <span class="var">?d</span> <span class="main">⟹</span> False"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?d</span> <span class="main">≠</span> <span class="var">?a</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span>

    <span class="keyword3"><span class="command">assume</span></span> abx<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_between <span class="var">?a</span> <span class="var">?b</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> circline_set x_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_line_uvz<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">≠</span> <span class="var">?b</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_line_0_real_is_x_axis<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_x_axis<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> abx poincare_between_sandwich<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">≠</span> <span class="var">?b</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> positive_x_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> circline_set x_axis›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
      <span class="keyword1"><span class="command">using</span></span> abx poincare_between_x_axis_0uv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="skolem">x</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">unfolding</span></span> circline_set_x_axis positive_x_axis_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re abs_less_iff complex_eq_if_Re_eq<span class="main">)</span>

    <span class="keyword3"><span class="command">assume</span></span> acy<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_between <span class="var">?a</span> <span class="var">?c</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> circline_set y_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_line_uvz<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">≠</span> <span class="var">?c</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_line_0_imag_is_y_axis<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_y_axis<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> acy poincare_between_sandwich<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">≠</span> <span class="var">?c</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> positive_y_axis"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">;</span> poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="bound">x</span><span class="main">)</span><span class="main">;</span> is_imag <span class="bound">x</span><span class="main">;</span> <span class="main">-</span> <span class="main">1</span> <span class="main">&lt;</span> Im <span class="bound">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> Im <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> add.left_neutral complex.expand divide_complex_def complex_eq divide_less_0_1_iff divide_less_eq_1_pos imaginary_unit.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> mult.left_neutral of_real_1 of_real_add of_real_divide of_real_eq_0_iff one_add_one poincare_between_y_axis_0uv zero_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_less_divide_1_iff<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> circline_set y_axis›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> acy
        <span class="keyword1"><span class="command">unfolding</span></span> circline_set_y_axis positive_y_axis_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Im abs_less_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> positive_x_axis›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> positive_y_axis›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> positive_x_axis_def positive_y_axis_def circline_set_x_axis circline_set_y_axis
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">assume</span></span> xty<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">x</span> <span class="var">?t</span> <span class="skolem">y</span>"</span></span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?xy</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_line <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?t</span> <span class="main">∈</span> circline_set <span class="var">?xy</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xty poincare_between_poincare_line_uzv<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?t</span> <span class="main">∈</span> unit_disc›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xy</span> <span class="main">≠</span> x_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_line_circline_set<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">x</span></span> <span class="main"><span class="main">≠</span></span> <span class="skolem"><span class="skolem">y</span></span>›</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> positive_y_axis›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_x_axis positive_y_axis_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive <span class="var">?xy</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_positive_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?xy</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> positive_x_axis›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">moreover</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?xy</span> <span class="main">≠</span> y_axis"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_line_circline_set<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">x</span></span> <span class="main"><span class="main">≠</span></span> <span class="skolem"><span class="skolem">y</span></span>›</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> positive_x_axis›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_y_axis positive_x_axis_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"intersects_y_axis_positive <span class="var">?xy</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> intersects_y_axis_positive_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?xy</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> positive_y_axis›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">ultimately</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> negated_euclidean_axiom_aux<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?xy</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Alternate form of the Euclidean axiom -- this one is much easier to prove›</span></span>
<span class="keyword1" id="Poincare_Tarski-negated_euclidean_axiom'"><span class="command">lemma</span></span> negated_euclidean_axiom'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span>
           <span class="bound">a</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">b</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span>poincare_collinear <span class="main">{</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">,</span> <span class="bound">c</span><span class="main">}</span><span class="main">)</span>  <span class="main">∧</span>
                <span class="main">¬</span><span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> 
                  poincare_distance <span class="bound">a</span> <span class="bound">x</span> <span class="main">=</span> poincare_distance <span class="bound">b</span> <span class="bound">x</span> <span class="main">∧</span>
                  poincare_distance <span class="bound">a</span> <span class="bound">x</span> <span class="main">=</span> poincare_distance <span class="bound">c</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">5</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≠</span> <span class="var">?b</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> to_complex_of_complex<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≠</span> <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> to_complex_of_complex<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minus_equation_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">≠</span> <span class="var">?c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> to_complex_of_complex<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span>poincare_collinear <span class="main">{</span><span class="var">?a</span><span class="main">,</span> <span class="var">?b</span><span class="main">,</span> <span class="var">?c</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> <span class="main">(</span><span class="main">∄</span><span class="bound">p</span><span class="main">.</span> is_poincare_line <span class="bound">p</span> <span class="main">∧</span> <span class="main">{</span><span class="var">?a</span><span class="main">,</span> <span class="var">?b</span><span class="main">,</span> <span class="var">?c</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="bound">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="skolem">p</span> <span class="main">∧</span> <span class="main">{</span><span class="var">?a</span><span class="main">,</span> <span class="var">?b</span><span class="main">,</span> <span class="var">?c</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="skolem">p</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ab</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_line <span class="var">?a</span> <span class="var">?b</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="var">?ab</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_poincare_line <span class="skolem">p</span> <span class="main">∧</span> <span class="main">{</span><span class="var">?a</span><span class="main">,</span> <span class="var">?b</span><span class="main">,</span> <span class="var">?c</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="skolem">p</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">≠</span> <span class="var">?b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">∈</span> unit_disc›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">∉</span> circline_set <span class="var">?ab</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?c</span> <span class="main">∉</span> circline_set <span class="var">?ab</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="var">?a</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?b</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> poincare_between_def
        <span class="keyword1"><span class="command">using</span></span> cross_ratio_0inf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="var">?ab</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">≠</span> <span class="var">?b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_line_uzv zero_in_unit_disc 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?ab</span> <span class="main">=</span> poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> unique_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">≠</span> <span class="var">?b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_poincare_line <span class="skolem">p</span> <span class="main">∧</span> <span class="main">{</span><span class="var">?a</span><span class="main">,</span> <span class="var">?b</span><span class="main">,</span> <span class="var">?c</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="skolem">p</span>›</span></span> 
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="var">?ab</span>›</span></span> poincare_line_circline_set<span class="main">(</span>1<span class="main">)</span> unique_poincare_line
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.inverse_neutral divide_minus_left of_complex_zero_iff  zero_in_unit_disc<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> cnj<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">5</span><span class="main">)</span> <span class="main">=</span> cnj<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">5</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> poincare_collinear_zero_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">5</span><span class="main">)</span>"</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">≠</span> <span class="var">?c</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="var">?c</span> <span class="main">∉</span> circline_set <span class="var">?ab</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?c</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="var">?ab</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="var">?ab</span>›</span></span> <span class="quoted"><span class="quoted">‹is_poincare_line <span class="skolem">p</span> <span class="main">∧</span> <span class="main">{</span><span class="var">?a</span><span class="main">,</span> <span class="var">?b</span><span class="main">,</span> <span class="var">?c</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="skolem">p</span>›</span></span> 
        <span class="keyword1"><span class="command">using</span></span> poincare_collinear_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">=</span> <span class="var">?ab</span>›</span></span> <span class="quoted"><span class="quoted">‹is_poincare_line <span class="skolem">p</span> <span class="main">∧</span> <span class="main">{</span><span class="var">?a</span><span class="main">,</span> <span class="var">?b</span><span class="main">,</span> <span class="var">?c</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="skolem">p</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> 
                  poincare_distance <span class="var">?a</span> <span class="bound">x</span> <span class="main">=</span> poincare_distance <span class="var">?b</span> <span class="bound">x</span> <span class="main">∧</span>
                  poincare_distance <span class="var">?a</span> <span class="bound">x</span> <span class="main">=</span> poincare_distance <span class="var">?c</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_distance <span class="var">?a</span> <span class="skolem">x</span> <span class="main">=</span> poincare_distance <span class="var">?b</span> <span class="skolem">x</span>"</span></span>
                        <span class="quoted"><span class="quoted">"poincare_distance <span class="var">?a</span> <span class="skolem">x</span> <span class="main">=</span> poincare_distance <span class="var">?c</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_distance_formula' <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="var">?x</span> <span class="main">=</span> poincare_distance_formula' <span class="main">(</span><span class="main">-</span><span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_distance <span class="var">?a</span> <span class="skolem">x</span> <span class="main">=</span> poincare_distance <span class="var">?b</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">∈</span> unit_disc›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cosh_dist to_complex_of_complex<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>cmod <span class="main">(</span><span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">=</span> <span class="main">(</span>cmod <span class="main">(</span><span class="main">-</span> <span class="keyword1">𝗂</span> <span class="main">/</span> <span class="numeral">2</span> <span class="main">-</span> <span class="var">?x</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula'_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> unit_disc_cmod_square_lt_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Im <span class="var">?x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> cmod_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power2_eq_iff<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> unit_disc_cmod_square_lt_1
      <span class="keyword1"><span class="command">using</span></span> cmod_power2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">24</span> <span class="main">-</span> <span class="numeral">24</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_distance_formula' <span class="main">(</span><span class="keyword1">𝗂</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="var">?x</span> <span class="main">=</span> poincare_distance_formula' <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">5</span><span class="main">)</span> <span class="var">?x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_distance <span class="var">?a</span> <span class="skolem">x</span> <span class="main">=</span> poincare_distance <span class="var">?c</span> <span class="skolem">x</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?c</span> <span class="main">∈</span> unit_disc›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> cosh_dist to_complex_of_complex<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">8</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">/</span><span class="main">(</span><span class="numeral">3</span> <span class="main">-</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="var">?x</span> <span class="main">*</span> <span class="numeral">5</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">/</span> <span class="main">(</span><span class="numeral">24</span> <span class="main">-</span> <span class="numeral">24</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_distance_formula'_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> cmod_def 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Im <span class="var">?x</span> <span class="main">=</span> <span class="main">0</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">24</span> <span class="main">-</span> <span class="numeral">24</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span>  <span class="main">=</span> <span class="var">?rhs</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">24</span> <span class="main">-</span> <span class="numeral">24</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="numeral">24</span> <span class="main">-</span> <span class="numeral">24</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">24</span> <span class="main">-</span> <span class="numeral">24</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">8</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="numeral">24</span> <span class="main">-</span> <span class="numeral">24</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?rhs</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">24</span> <span class="main">-</span> <span class="numeral">24</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="var">?x</span> <span class="main">*</span> <span class="numeral">5</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="numeral">24</span> <span class="main">-</span> <span class="numeral">24</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">-</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">8</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> Re <span class="var">?x</span> <span class="main">*</span> <span class="numeral">5</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="var">?lhs</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">24</span> <span class="main">-</span> <span class="numeral">24</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">8</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span><span class="main">)</span> <span class="main">*</span> <span class="numeral">8</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>      
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">7</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="numeral">10</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">7</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">field_simps</span></span> comm_ring_1_class.power2_diff<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
      <span class="keyword1"><span class="command">using</span></span> discriminant_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">7</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="numeral">10</span></span> <span class="quoted"><span class="numeral">7</span></span><span class="main">]</span> discrim_def<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">7</span></span> <span class="quoted"><span class="numeral">10</span></span> <span class="quoted"><span class="numeral">7</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?c</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Continuity axiom›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The set $\phi$ is on the left of the set $\psi$›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">set_order</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">set_order</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> unit_disc<span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span> unit_disc<span class="main">.</span>  <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="bound">x</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="bound">y</span> <span class="main">⟶</span> poincare_between <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The point $B$ is between the sets $\phi$ and $\psi$›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">point_between_sets</span> <span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free">point_between_sets</span> <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span> unit_disc<span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span> unit_disc<span class="main">.</span>  <span class="free"><span class="bound"><span class="entity">φ</span></span></span> <span class="bound">x</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">ψ</span></span></span> <span class="bound">y</span> <span class="main">⟶</span> poincare_between <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="bound">y</span>"</span></span>

<span class="keyword1" id="Poincare_Tarski-continuity"><span class="command">lemma</span></span>  continuity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">A</span> <span class="main">∈</span> unit_disc<span class="main">.</span> set_order <span class="bound">A</span> <span class="free">φ</span> <span class="free">ψ</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">B</span> <span class="main">∈</span> unit_disc<span class="main">.</span> point_between_sets <span class="free">φ</span> <span class="bound">B</span> <span class="free">ψ</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span> <span class="bound">x0</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="free">φ</span> <span class="bound">x0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">y0</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="free">ψ</span> <span class="bound">y0</span><span class="main">)</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="skolem">Y0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y0</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"set_order <span class="skolem">A</span> <span class="free">φ</span> <span class="free">ψ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="free">φ</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> unit_disc›</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_between_nonstrict<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X0</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">X0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X0</span> <span class="main">≠</span> <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X0</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y0</span> <span class="main">≠</span> <span class="skolem">A</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">Y0</span> <span class="main">≠</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="free">φ</span> <span class="bound">x</span> <span class="main">⟶</span> poincare_between <span class="skolem">A</span> <span class="bound">x</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="free">ψ</span> <span class="skolem">Y0</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">A</span></span><span class="main">)</span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="free">φ</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * poincare_between_sandwich <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">B</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="free">φ</span> <span class="bound">B</span> <span class="main">∧</span> <span class="free">ψ</span> <span class="bound">B</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ψ</span> <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="free">φ</span> <span class="bound">x</span> <span class="main">⟶</span> poincare_between <span class="skolem">A</span> <span class="bound">x</span> <span class="skolem">B</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="free">ψ</span> <span class="bound">y</span> <span class="main">⟶</span> poincare_between <span class="skolem">A</span> <span class="skolem">B</span> <span class="bound">y</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">φ</span> <span class="skolem">B</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> unit_disc"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="free">ψ</span> <span class="skolem">y</span>"</span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">A</span> <span class="skolem">x</span> <span class="skolem">B</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">A</span> <span class="skolem">B</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="free">φ</span> <span class="bound">x</span> <span class="main">⟶</span> poincare_between <span class="skolem">A</span> <span class="bound">x</span> <span class="skolem">B</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="free">ψ</span> <span class="bound">y</span> <span class="main">⟶</span> poincare_between <span class="skolem">A</span> <span class="skolem">B</span> <span class="bound">y</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">+</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">x</span> <span class="skolem">B</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> unit_disc›</span></span>
          <span class="keyword1"><span class="command">using</span></span> poincare_between_transitivity<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">A</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">B</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">A</span> <span class="skolem">X0</span> <span class="skolem">Y0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">φ</span> <span class="skolem">X0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ψ</span> <span class="skolem">Y0</span>›</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">Y0</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X0</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">φ</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">ψ</span><span class="main">.</span> set_order <span class="skolem">A</span> <span class="bound">φ</span> <span class="bound">ψ</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">B</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="bound">φ</span> <span class="bound">B</span> <span class="main">∧</span> <span class="bound">ψ</span> <span class="bound">B</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">φ</span> <span class="skolem">X0</span> <span class="main">∧</span> 
                      <span class="main">(</span><span class="main">∃</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="bound">ψ</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="bound">φ</span> <span class="bound">x</span><span class="main">)</span>
                   <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">B</span> <span class="main">∈</span> unit_disc<span class="main">.</span> point_between_sets <span class="bound">φ</span> <span class="bound">B</span> <span class="bound">ψ</span><span class="main">)</span>"</span></span>
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">A</span> <span class="skolem">X0</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_positive_x_axis<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?P</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> unit_disc"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X0</span> <span class="main">∈</span> unit_disc"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="skolem">X0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X0</span> <span class="main">≠</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">M</span> <span class="skolem">u</span> <span class="skolem">v</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> moebius_pt <span class="skolem">M</span> <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mu</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?Mv</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> hip<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="skolem">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span>"</span></span>
               <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="var">?Mu</span> <span class="var">?Mv</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">φ</span> <span class="skolem">ψ</span> <span class="skolem">x</span> <span class="skolem">y</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"set_order <span class="skolem">u</span> <span class="skolem">φ</span> <span class="skolem">ψ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="skolem">φ</span> <span class="bound">B</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="bound">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">v</span>"</span></span>
                  <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ψ</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">x</span>"</span></span>

          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mφ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">X'</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">φ</span> <span class="bound">X</span> <span class="main">∧</span> <span class="var">?M</span> <span class="bound">X</span> <span class="main">=</span> <span class="bound">X'</span>"</span></span> 
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mψ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">X'</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">X</span><span class="main">.</span> <span class="skolem">ψ</span> <span class="bound">X</span> <span class="main">∧</span> <span class="var">?M</span> <span class="bound">X</span> <span class="main">=</span> <span class="bound">X'</span>"</span></span>

          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Mφ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Mφ</span> <span class="main">=</span> <span class="var">?Mφ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Mψ</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Mψ</span> <span class="main">=</span> <span class="var">?Mψ</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Mφ</span> <span class="var">?Mv</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Mφ</span> <span class="main">=</span> <span class="var">?Mφ</span>›</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">B</span> <span class="main">∈</span>unit_disc<span class="main">.</span> <span class="skolem">Mφ</span> <span class="bound">B</span> <span class="main">∧</span> <span class="skolem">Mψ</span> <span class="bound">B</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="skolem">φ</span> <span class="bound">B</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="bound">B</span><span class="main">)</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Mφ</span> <span class="main">=</span> <span class="var">?Mφ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Mψ</span> <span class="main">=</span> <span class="var">?Mψ</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hip<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> moebius_pt_invert unit_disc_fix_discI unit_disc_fix_moebius_inv<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="skolem">Mψ</span> <span class="bound">y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ψ</span> <span class="skolem">y</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">Mψ</span> <span class="main">=</span> <span class="var">?Mψ</span>›</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set_order <span class="var">?Mu</span> <span class="var">?Mφ</span> <span class="var">?Mψ</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>                                       
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Mx</span> <span class="skolem">My</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Mx</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">My</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mφ</span> <span class="skolem">Mx</span> <span class="main">∧</span> <span class="var">?Mψ</span> <span class="skolem">My</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="var">?M</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">Mx</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ψ</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="var">?M</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">My</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Mx</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">My</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> moebius_pt_comp_inv_left unit_disc_fix_discI unit_disc_fix_moebius_inv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">u</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set_order <span class="skolem">u</span> <span class="skolem">φ</span> <span class="skolem">ψ</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Mx</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">My</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="var">?M</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">Mx</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ψ</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="var">?M</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">My</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="var">?Mu</span> <span class="skolem">Mx</span> <span class="skolem">My</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="var">?M</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">Mx</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ψ</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="var">?M</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">My</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span> 
              <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_moebius_preserve_poincare_between <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"set_order <span class="var">?Mu</span> <span class="skolem">Mφ</span> <span class="skolem">Mψ</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Mφ</span> <span class="main">=</span> <span class="var">?Mφ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Mψ</span> <span class="main">=</span> <span class="var">?Mψ</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">ultimately</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">Mb</span> <span class="main">∈</span> unit_disc<span class="main">.</span> point_between_sets <span class="skolem">Mφ</span> <span class="bound">Mb</span> <span class="skolem">Mψ</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> hip<span class="main">(</span>5<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Mb</span></span> <span class="keyword2"><span class="keyword">where</span></span> bbb<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">Mb</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"point_between_sets <span class="var">?Mφ</span> <span class="skolem">Mb</span> <span class="var">?Mψ</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Mφ</span> <span class="main">=</span> <span class="var">?Mφ</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Mψ</span> <span class="main">=</span> <span class="var">?Mψ</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="main">(</span>moebius_inv <span class="skolem">M</span><span class="main">)</span> <span class="skolem">Mb</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span> <span class="main">∈</span> unit_disc<span class="main">.</span> point_between_sets <span class="skolem">φ</span> <span class="bound">b</span> <span class="skolem">ψ</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">u</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set_order <span class="skolem">u</span> <span class="skolem">φ</span> <span class="skolem">ψ</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Mx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?My</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">y</span>"</span></span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mφ</span> <span class="var">?Mx</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mψ</span> <span class="var">?My</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="skolem">y</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Mx</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?My</span> <span class="main">∈</span> unit_disc"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="var">?Mx</span> <span class="skolem">Mb</span> <span class="var">?My</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Mφ</span> <span class="var">?Mx</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Mψ</span> <span class="var">?My</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Mx</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?My</span> <span class="main">∈</span> unit_disc›</span></span> bbb
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">x</span> <span class="var">?b</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span> 
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Mb</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Mx</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?My</span> <span class="main">∈</span> unit_disc›</span></span>
              <span class="keyword1"><span class="command">using</span></span> unit_disc_fix_moebius_preserve_poincare_between<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">∈</span> unit_disc"</span></span>
              <span class="keyword1"><span class="command">using</span></span> bbb <span class="quoted"><span class="quoted">‹unit_disc_fix <span class="skolem">M</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span>
        <span class="keyword3"><span class="command">assume</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">X</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?X</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">X</span>"</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?X</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">erule</span> conjE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">φ</span> <span class="skolem">ψ</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"set_order <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">φ</span> <span class="skolem">ψ</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="skolem">φ</span> <span class="bound">B</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="bound">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="var">?X</span>"</span></span> 
                 <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="skolem">ψ</span> <span class="bound">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="skolem">φ</span> <span class="bound">x</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?X</span> <span class="main">∈</span> unit_disc"</span></span>
            <span class="keyword1"><span class="command">using</span></span> xx
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>

          <span class="keyword1"><span class="command">have</span></span> ψpos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="skolem">ψ</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">(</span>is_real <span class="main">(</span>to_complex <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> Re <span class="main">(</span>to_complex <span class="bound">y</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">y</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ψ</span> <span class="skolem">y</span>"</span></span>

            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?X</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set_order <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">φ</span> <span class="skolem">ψ</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?X</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="var">?X</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?y</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="var">?y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> xx <span class="quoted"><span class="quoted">‹<span class="var">?X</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> arg_0_iff of_complex_zero_iff poincare_between_0uv poincare_between_sandwich to_complex_of_complex unit_disc_to_complex_inj zero_in_unit_disc<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">have</span></span> φnoneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="skolem">φ</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="main">(</span>is_real <span class="main">(</span>to_complex <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> Re <span class="main">(</span>to_complex <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">x</span>"</span></span>

            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ψ</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="skolem">ψ</span> <span class="bound">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">y</span>"</span></span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?y</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ψpos <span class="quoted"><span class="quoted">‹<span class="skolem">ψ</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set_order <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">φ</span> <span class="skolem">ψ</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span>unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ψ</span> <span class="skolem">y</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?x</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">≤</span> Re <span class="var">?x</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="main">(</span>to_complex <span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ψ</span> <span class="skolem">y</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set_order <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">φ</span> <span class="skolem">ψ</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="var">?X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?X</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?y</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arg_0_iff le_less of_complex_zero poincare_between_0uv to_complex_of_complex zero_complex.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_complex.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">have</span></span> φlessψ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="skolem">φ</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="bound">y</span> <span class="main">⟶</span> Re <span class="main">(</span>to_complex <span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> Re <span class="main">(</span>to_complex <span class="bound">y</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">y</span>"</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="skolem">y</span>"</span></span>

            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set_order <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">φ</span> <span class="skolem">ψ</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> φnoneg
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">moreover</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?y</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> ψpos
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="skolem">y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">ultimately</span></span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?x</span> <span class="main">≤</span> Re <span class="var">?y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Re_complex_of_real arg_0_iff le_less of_complex_zero poincare_between_0uv rcis_cmod_arg rcis_zero_arg to_complex_of_complex<span class="main">)</span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?x</span> <span class="main">≠</span> Re <span class="var">?y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?x</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?y</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">B</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="skolem">φ</span> <span class="bound">B</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="bound">B</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> complex.expand unit_disc_to_complex_inj<span class="main">)</span>

            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?x</span> <span class="main">&lt;</span> Re <span class="var">?y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?x</span> <span class="main">≤</span> Re <span class="var">?y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="main">∀</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc<span class="main">.</span> 
                    is_real <span class="main">(</span>to_complex <span class="bound">b</span><span class="main">)</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="skolem">φ</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">(</span>Re <span class="main">(</span>to_complex <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> Re <span class="main">(</span>to_complex <span class="bound">b</span><span class="main">)</span> <span class="main">∧</span> Re <span class="main">(</span>to_complex <span class="bound">b</span><span class="main">)</span> <span class="main">≤</span> Re <span class="main">(</span>to_complex <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Phi</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>of_complex <span class="main">(</span>cor <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="skolem">φ</span> <span class="main">(</span>of_complex <span class="main">(</span>cor <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="skolem">φ</span> <span class="bound">x</span> <span class="main">⟶</span> Re <span class="main">(</span>to_complex <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> Sup <span class="var">?Phi</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
              <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">x</span>"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">x</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> φnoneg
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cor <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span>"</span></span>
                 <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span>cor <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> unit_disc"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> 
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_notin_unit_disc of_complex_to_complex<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">(</span>of_complex <span class="main">(</span>cor <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cor <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="skolem">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_notin_unit_disc of_complex_to_complex<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?x</span> <span class="main">∈</span> <span class="var">?Phi</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="var">?Phi</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">M</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> φlessψ
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="skolem">ψ</span> <span class="bound">y</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Re_complex_of_real le_less mem_Collect_eq to_complex_of_complex<span class="main">)</span>

              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?x</span> <span class="main">≤</span> Sup <span class="var">?Phi</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> cSup_upper<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="var">?x</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?Phi</span></span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">unfolding</span></span> bdd_above_def
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?x</span> <span class="main">∈</span> <span class="var">?Phi</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                
            <span class="keyword1"><span class="command">qed</span></span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">y</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="skolem">ψ</span> <span class="bound">y</span> <span class="main">⟶</span> Sup <span class="var">?Phi</span> <span class="main">≤</span> Re <span class="main">(</span>to_complex <span class="bound">y</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span>
              <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">y</span>"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ψ</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Sup <span class="var">?Phi</span> <span class="main">≤</span> Re <span class="var">?y</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?y</span> <span class="main">&lt;</span> Sup <span class="var">?Phi</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="skolem">φ</span> <span class="main">(</span>of_complex <span class="main">(</span>cor <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>of_complex <span class="main">(</span>cor <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> unit_disc"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">x'</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="skolem">φ</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">x'</span>"</span></span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?x'</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="skolem">x'</span>›</span></span>
                    <span class="keyword1"><span class="command">using</span></span> φnoneg
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"cor <span class="main">(</span>Re <span class="var">?x'</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x'</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">=</span> of_complex <span class="main">(</span>cor <span class="main">(</span>Re <span class="var">?x'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> unit_disc›</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_notin_unit_disc of_complex_to_complex<span class="main">)</span>
                  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Re <span class="var">?x'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">∈</span> unit_disc›</span></span> 
                    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">=</span> of_complex <span class="main">(</span>cor <span class="main">(</span>Re <span class="var">?x'</span><span class="main">)</span><span class="main">)</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="skolem">x'</span>›</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x'</span> <span class="main">=</span> of_complex <span class="main">(</span>cor <span class="main">(</span>Re <span class="var">?x'</span><span class="main">)</span><span class="main">)</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>               
                <span class="keyword1"><span class="command">qed</span></span>

                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Phi</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="main">(</span>of_complex <span class="main">(</span>cor <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?y</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span>
                                    <span class="quoted"><span class="quoted">"<span class="main">(</span>of_complex <span class="main">(</span>cor <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> unit_disc"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?y</span> <span class="main">&lt;</span> Sup <span class="var">?Phi</span>›</span></span>
                  <span class="keyword1"><span class="command">using</span></span> less_cSupE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="var">?y</span>"</span></span> <span class="var"><span class="quoted"><span class="var">?Phi</span></span></span><span class="main">]</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">moreover</span></span>
                <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?y</span> <span class="main">&lt;</span> Re <span class="main">(</span>to_complex <span class="main">(</span>of_complex <span class="main">(</span>cor <span class="skolem">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?y</span> <span class="main">&lt;</span> <span class="skolem">x</span>›</span></span> 
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">ultimately</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
                  <span class="keyword1"><span class="command">using</span></span> φlessψ
                  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ψ</span> <span class="skolem">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_not_sym<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>

            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> <span class="skolem">φ</span> <span class="bound">x</span> <span class="main">⟶</span> Re <span class="main">(</span>to_complex <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> Sup <span class="var">?Phi</span>›</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>of_complex <span class="main">(</span>cor <span class="main">(</span>Sup <span class="var">?Phi</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="skolem">ψ</span> <span class="bound">y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="var">?X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?X</span> <span class="main">∈</span> unit_disc›</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="skolem">ψ</span> <span class="bound">y</span> <span class="main">⟶</span> is_real <span class="main">(</span>to_complex <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">&lt;</span> Re <span class="main">(</span>to_complex <span class="bound">y</span><span class="main">)</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> complex_of_real_Re inf_notin_unit_disc norm_of_real of_complex_to_complex to_complex_of_complex unit_disc_iff_cmod_lt_1 xx<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>

          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">B</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="main">(</span>to_complex <span class="skolem">B</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="skolem">φ</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="bound">y</span> <span class="main">⟶</span> Re <span class="main">(</span>to_complex <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> Re <span class="main">(</span>to_complex <span class="skolem">B</span><span class="main">)</span> <span class="main">∧</span>
             Re <span class="main">(</span>to_complex <span class="skolem">B</span><span class="main">)</span> <span class="main">≤</span> Re <span class="main">(</span>to_complex <span class="bound">y</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span> <span class="main">∈</span> unit_disc<span class="main">.</span> point_between_sets <span class="skolem">φ</span> <span class="bound">b</span> <span class="skolem">ψ</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">B</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">∈</span> unit_disc"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"point_between_sets <span class="skolem">φ</span> <span class="skolem">B</span> <span class="skolem">ψ</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> 
              <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">B</span>"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="skolem">y</span>"</span></span>

              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?x</span> <span class="main">≤</span> Re <span class="var">?B</span> <span class="main">∧</span> Re <span class="var">?B</span> <span class="main">≤</span> Re <span class="var">?y</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="skolem">φ</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="bound">y</span> <span class="main">⟶</span> Re <span class="main">(</span>to_complex <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> Re <span class="var">?B</span> <span class="main">∧</span>
                       Re <span class="main">(</span>to_complex <span class="skolem">B</span><span class="main">)</span> <span class="main">≤</span> Re <span class="main">(</span>to_complex <span class="bound">y</span><span class="main">)</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?x</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> φnoneg
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="skolem">y</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?y</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?y</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> ψpos
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">φ</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="skolem">y</span>›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">moreover</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cor <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re <span class="quoted"><span class="quoted">‹is_real <span class="var">?x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> of_complex <span class="main">(</span>cor <span class="main">(</span>Re <span class="var">?x</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_notin_unit_disc of_complex_to_complex<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cor <span class="main">(</span>Re <span class="var">?y</span><span class="main">)</span> <span class="main">=</span> <span class="var">?y</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re <span class="quoted"><span class="quoted">‹is_real <span class="var">?y</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> of_complex <span class="main">(</span>cor <span class="main">(</span>Re <span class="var">?y</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_notin_unit_disc of_complex_to_complex<span class="main">)</span>
              <span class="keyword1"><span class="command">moreover</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cor <span class="main">(</span>Re <span class="var">?B</span><span class="main">)</span> <span class="main">=</span> <span class="var">?B</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> complex_of_real_Re <span class="quoted"><span class="quoted">‹is_real <span class="main">(</span>to_complex  <span class="skolem">B</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">B</span> <span class="main">=</span> of_complex <span class="main">(</span>cor <span class="main">(</span>Re <span class="var">?B</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> unit_disc›</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_notin_unit_disc of_complex_to_complex<span class="main">)</span>
              <span class="keyword1"><span class="command">ultimately</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="skolem">x</span> <span class="skolem">B</span> <span class="skolem">y</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="main">(</span>to_complex <span class="skolem">B</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">B</span> <span class="main">∈</span> unit_disc›</span></span>
                <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_uvw<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="skolem">B</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="main">(</span>to_complex <span class="skolem">y</span><span class="main">)</span>"</span></span><span class="main">]</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Re_complex_of_real arg_0_iff poincare_between_nonstrict<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rcis_cmod_arg rcis_zero_arg unit_disc_iff_cmod_lt_1<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">qed</span></span>            
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="quoted"><span class="quoted">‹<span class="free">φ</span> <span class="skolem">X0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">ψ</span> <span class="skolem">Y0</span>›</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">Y0</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">X0</span> <span class="main">∈</span> unit_disc›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>      
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* ------------------------------------------------------------------ *)</span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Limiting parallels axiom›</span></span>
<span class="comment1">(* ------------------------------------------------------------------ *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Auxiliary definitions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poincare_on_line</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poincare_on_line</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> poincare_collinear <span class="main">{</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poincare_on_ray</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">poincare_on_ray</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⟷</span> poincare_between <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∨</span> poincare_between <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poincare_in_angle</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poincare_in_angle</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">⟷</span>
      <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> poincare_between <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∧</span> poincare_on_ray <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">poincare_ray_meets_line</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">poincare_ray_meets_line</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">x</span> <span class="main">∈</span> unit_disc<span class="main">.</span> poincare_on_ray <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> poincare_on_line <span class="bound">x</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹All points on ray are collinear›</span></span>
<span class="keyword1" id="Poincare_Tarski-poincare_on_ray_poincare_collinear"><span class="command">lemma</span></span> poincare_on_ray_poincare_collinear<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"poincare_on_ray <span class="free">p</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="free">p</span><span class="main">,</span> <span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms poincare_between_poincare_collinear
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_on_ray_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_commute<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹H-isometries preserve all defined auxiliary relations›</span></span>

<span class="keyword1" id="Poincare_Tarski-unit_disc_fix_preserves_poincare_on_line"><span class="command">lemma</span></span> unit_disc_fix_preserves_poincare_on_line <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_on_line <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> poincare_on_line <span class="free">p</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_on_line_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Poincare_Tarski-unit_disc_fix_preserves_poincare_on_ray"><span class="command">lemma</span></span> unit_disc_fix_preserves_poincare_on_ray <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_on_ray <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟷</span> poincare_on_ray <span class="free">p</span> <span class="free">a</span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> poincare_on_ray_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="Poincare_Tarski-unit_disc_fix_preserves_poincare_in_angle"><span class="command">lemma</span></span> unit_disc_fix_preserves_poincare_in_angle <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_in_angle <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> poincare_in_angle <span class="free">p</span> <span class="free">a</span> <span class="free">b</span> <span class="free">c</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Mx</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Mx</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="quoted"><span class="quoted">"poincare_between <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">a</span><span class="main">)</span> <span class="skolem">Mx</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">c</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">Mx</span> <span class="main">≠</span> moebius_pt <span class="free">M</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Mx</span> <span class="main">≠</span> moebius_pt <span class="free">M</span> <span class="free">c</span>"</span></span>  <span class="quoted"><span class="quoted">"poincare_on_ray <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">b</span><span class="main">)</span> <span class="skolem">Mx</span>"</span></span>
      <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="free">b</span> <span class="main">≠</span> moebius_pt <span class="free">M</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="free">b</span> <span class="main">≠</span> moebius_pt <span class="free">M</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="free">p</span> <span class="main">≠</span> moebius_pt <span class="free">M</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_in_angle_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Mx</span> <span class="main">=</span> moebius_pt <span class="free">M</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> image_iff unit_disc_fix_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> * assms
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_in_angle_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="quoted"><span class="quoted">"poincare_between <span class="free">a</span> <span class="skolem">x</span> <span class="free">c</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="free">c</span>"</span></span>  <span class="quoted"><span class="quoted">"poincare_on_ray <span class="free">p</span> <span class="free">b</span> <span class="skolem">x</span>"</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≠</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_in_angle_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_in_angle_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Poincare_Tarski-unit_disc_fix_preserves_poincare_ray_meets_line"><span class="command">lemma</span></span> unit_disc_fix_preserves_poincare_ray_meets_line <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> unit_disc"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"poincare_ray_meets_line <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">b</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">d</span><span class="main">)</span> <span class="main">⟷</span> poincare_ray_meets_line <span class="free">a</span> <span class="free">b</span> <span class="free">c</span> <span class="free">d</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Mx</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Mx</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_on_ray <span class="skolem">Mx</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">a</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">b</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"poincare_on_line <span class="skolem">Mx</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">c</span><span class="main">)</span> <span class="main">(</span>moebius_pt <span class="free">M</span> <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_ray_meets_line_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Mx</span> <span class="main">=</span> moebius_pt <span class="free">M</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> image_iff unit_disc_fix_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms *
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_ray_meets_line_def poincare_on_line_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_on_ray <span class="skolem">x</span> <span class="free">a</span> <span class="free">b</span>"</span></span> 
    <span class="quoted"><span class="quoted">"poincare_on_line <span class="skolem">x</span> <span class="free">c</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_ray_meets_line_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> assms *
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_ray_meets_line_def poincare_on_line_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"moebius_pt <span class="free">M</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹H-lines that intersect on the absolute do not meet (they do not share a common h-point)›</span></span>
<span class="keyword1" id="Poincare_Tarski-tangent_not_meet"><span class="command">lemma</span></span> tangent_not_meet<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">≠</span> <span class="free">x2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="free">x1</span><span class="main">,</span> <span class="free">x2</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> ideal_points <span class="main">(</span>poincare_line <span class="free">x1</span> <span class="free">x2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="free">a</span><span class="main">,</span> <span class="free">i</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_ray_meets_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">a</span> <span class="free">x1</span> <span class="free">x2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_on_ray <span class="skolem">x</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">a</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="free">x1</span><span class="main">,</span> <span class="free">x2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_ray_meets_line_def poincare_on_line_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="free">a</span><span class="main">,</span> <span class="skolem">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_on_ray <span class="skolem">x</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> unit_disc›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> poincare_between_poincare_collinear poincare_between_rev poincare_on_ray_def poincare_on_ray_poincare_collinear zero_in_unit_disc<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="free">x1</span><span class="main">,</span> <span class="free">x2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="free">x1</span><span class="main">,</span> <span class="free">x2</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> poincare_between_rev<span class="main">)</span>

  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_line <span class="free">x1</span> <span class="free">x2</span>"</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> circline_set unit_circle"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">∈</span> ideal_points <span class="main">(</span>poincare_line <span class="free">x1</span> <span class="free">x2</span><span class="main">)</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> ideal_points_on_unit_circle is_poincare_line_poincare_line <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> circline_set <span class="var">?l1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="free">a</span><span class="main">,</span> <span class="free">i</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_subset unique_poincare_line zero_in_unit_disc<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> circline_set <span class="var">?l1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="free">a</span><span class="main">,</span> <span class="skolem">x</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> poincare_collinear3_between poincare_between_poincare_line_uvz poincare_between_poincare_line_uzv poincare_line_sym zero_in_unit_disc<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inversion <span class="skolem">x</span> <span class="main">∈</span> circline_set <span class="var">?l1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="free">a</span><span class="main">,</span> <span class="skolem">x</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">using</span></span> poincare_line_inversion_full<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> poincare_collinear3_between is_poincare_line_inverse_point is_poincare_line_poincare_line poincare_between_poincare_line_uvz poincare_between_poincare_line_uzv poincare_line_sym zero_in_unit_disc<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> circline_set <span class="var">?l2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="free">x1</span><span class="main">,</span> <span class="free">x2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x1</span> <span class="main">≠</span> <span class="free">x2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x2</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_commute inversion_noteq_unit_disc poincare_between_poincare_line_uvz poincare_between_poincare_line_uzv poincare_collinear3_iff poincare_line_sym_general<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command"><span class="improper">hence</span></span></span> <span class="quoted"><span class="quoted">"inversion <span class="skolem">x</span> <span class="main">∈</span> circline_set <span class="var">?l2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span>  <span class="quoted"><span class="quoted">‹<span class="free">x1</span> <span class="main">≠</span> <span class="free">x2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x2</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
    <span class="keyword1"><span class="command">using</span></span> poincare_line_inversion_full<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x1</span></span> <span class="quoted"><span class="free">x2</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> circline_set <span class="var">?l2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x1</span> <span class="main">≠</span> <span class="free">x2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x2</span> <span class="main">∈</span> unit_disc›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">∈</span> ideal_points <span class="var">?l2</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ideal_points_on_circline<span class="main">)</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> inversion <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
    <span class="keyword1"><span class="command">using</span></span> inversion_noteq_unit_disc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">∈</span> circline_set unit_circle›</span></span> circline_set_def inversion_noteq_unit_disc 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1"><span class="command">moreover</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inversion <span class="skolem">x</span> <span class="main">≠</span> <span class="free">i</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">i</span> <span class="main">∈</span> circline_set unit_circle›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">≠</span> <span class="free">i</span>›</span></span> circline_set_def inversion_unit_circle 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">ultimately</span></span>
          
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l1</span> <span class="main">=</span> <span class="var">?l2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unique_circline_set<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"inversion <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="free">i</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="var">?l2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> poincare_line_circline_set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="free">x1</span><span class="main">,</span> <span class="free">x2</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="skolem">x</span><span class="main">,</span> <span class="free">x1</span><span class="main">,</span> <span class="free">x2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x1</span> <span class="main">≠</span> <span class="free">x2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x2</span> <span class="main">∈</span> unit_disc›</span></span> poincare_collinear_def unique_poincare_line
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Poincare_Tarski-limiting_parallels"><span class="command">lemma</span></span> limiting_parallels<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x1</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x2</span> <span class="main">∈</span> unit_disc"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_on_line <span class="free">a</span> <span class="free">x1</span> <span class="free">x2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a1</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="main">∃</span><span class="bound">a2</span><span class="main">∈</span>unit_disc<span class="main">.</span>
          <span class="main">¬</span> poincare_on_line <span class="free">a</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="main">∧</span>
          <span class="main">¬</span> poincare_ray_meets_line <span class="free">a</span> <span class="bound">a1</span> <span class="free">x1</span> <span class="free">x2</span> <span class="main">∧</span> <span class="main">¬</span> poincare_ray_meets_line <span class="free">a</span> <span class="bound">a2</span> <span class="free">x1</span> <span class="free">x2</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">a'</span><span class="main">∈</span>unit_disc<span class="main">.</span> poincare_in_angle <span class="bound">a'</span> <span class="bound">a1</span> <span class="free">a</span> <span class="bound">a2</span> <span class="main">⟶</span> poincare_ray_meets_line <span class="free">a</span> <span class="bound">a'</span> <span class="free">x1</span> <span class="free">x2</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="free">a</span> <span class="free">x1</span> <span class="free">x2</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">x1</span><span class="main">,</span> <span class="free">x2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_on_line <span class="free">a</span> <span class="free">x1</span> <span class="free">x2</span>›</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> poincare_on_line_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="bound">x1</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">x2</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="bound">x1</span><span class="main">,</span> <span class="bound">x2</span><span class="main">}</span> <span class="main">⟶</span> <span class="var">?P</span> <span class="free">a</span> <span class="bound">x1</span> <span class="bound">x2</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="free">a</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_zero<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="main">∈</span> unit_disc›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">u</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="skolem">a</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> uf<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="main">(</span>blaschke <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">assume</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="main">(</span>moebius_pt <span class="main">(</span>blaschke <span class="skolem">a</span><span class="main">)</span> <span class="skolem">u</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="main">(</span>blaschke <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> xx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> MM<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">x1</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="var">?M</span> <span class="skolem">x2</span><span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="var">?M</span> <span class="skolem">u</span><span class="main">,</span> <span class="var">?M</span> <span class="skolem">x1</span><span class="main">,</span> <span class="var">?M</span> <span class="skolem">x2</span><span class="main">}</span>"</span></span>   
        <span class="keyword1"><span class="command">using</span></span> *
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">u</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a1</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="main">∃</span><span class="bound">a2</span><span class="main">∈</span>unit_disc<span class="main">.</span> <span class="var">?P'</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="skolem">u</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ma1</span></span> <span class="skolem"><span class="skolem">Ma2</span></span> <span class="keyword2"><span class="keyword">where</span></span> MM<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ma1</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Ma2</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="skolem">Ma1</span> <span class="skolem">Ma2</span> <span class="main">(</span><span class="var">?M</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span><span class="var">?M</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">(</span><span class="var">?M</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span>   
          <span class="keyword1"><span class="command">using</span></span> **<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> MM<span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> MM'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a'</span><span class="main">∈</span>unit_disc<span class="main">.</span> poincare_in_angle <span class="bound">a'</span> <span class="skolem">Ma1</span> <span class="main">(</span><span class="var">?M</span> <span class="skolem">u</span><span class="main">)</span> <span class="skolem">Ma2</span> <span class="main">⟶</span> poincare_ray_meets_line <span class="main">(</span><span class="var">?M</span> <span class="skolem">u</span><span class="main">)</span> <span class="bound">a'</span> <span class="main">(</span><span class="var">?M</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">(</span><span class="var">?M</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">a1</span> <span class="main">=</span> <span class="skolem">Ma1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">a2</span> <span class="main">=</span> <span class="skolem">Ma2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> uf
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ma1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Ma2</span> <span class="main">∈</span> unit_disc›</span></span> image_iff unit_disc_fix_iff<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a'</span><span class="main">∈</span>unit_disc<span class="main">.</span> poincare_in_angle <span class="bound">a'</span> <span class="skolem">a1</span> <span class="skolem">u</span> <span class="skolem">a2</span> <span class="main">⟶</span> poincare_ray_meets_line <span class="skolem">u</span> <span class="bound">a'</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a'</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_in_angle <span class="skolem">a'</span> <span class="skolem">a1</span> <span class="skolem">u</span> <span class="skolem">a2</span>"</span></span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"poincare_ray_meets_line <span class="skolem">u</span> <span class="skolem">a'</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> MM<span class="main">(</span>1-2<span class="main">)</span> MM'<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">a'</span>"</span></span><span class="main">]</span> * uf a xx
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> unit_disc_fix_discI unit_disc_fix_preserves_poincare_in_angle unit_disc_fix_preserves_poincare_ray_meets_line<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P'</span> <span class="skolem">a1</span> <span class="skolem">a2</span> <span class="skolem">u</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> MM * uf xx a
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a2</span> <span class="main">∈</span> unit_disc›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∈</span> unit_disc"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">}</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_line <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x2</span> <span class="main">∈</span> unit_disc›</span></span><span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear  <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> poincare_collinear3_between                  
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> lx<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="var">?lx</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> is_poincare_line_poincare_line<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i1</span></span> <span class="skolem"><span class="skolem">i2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="var">?lx</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span> is_poincare_line_poincare_line obtain_ideal_points<span class="main">)</span>
      
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?li</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_line <span class="skolem">i1</span> <span class="skolem">i2</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">i1</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">i2</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">∈</span> unit_circle_set"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">∈</span> unit_circle_set"</span></span>
          <span class="keyword1"><span class="command">using</span></span> lx <span class="quoted"><span class="quoted">‹ideal_points <span class="var">?lx</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> unit_circle_set_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ideal_points_on_unit_circle insertI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> ideal_points_on_unit_circle insertI1 insertI2<span class="main">)</span>
                                                               
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ideal_points <span class="var">?lx</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x2</span> <span class="main">∈</span> unit_disc›</span></span> ideal_points_different<span class="main">(</span>1<span class="main">)</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="var">?i1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="var">?i2</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?la</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_line <span class="var">?a1</span> <span class="var">?a2</span>"</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a1</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a2</span> <span class="main">∈</span> unit_disc"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">∈</span> unit_circle_set›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i2</span> <span class="main">∈</span> unit_circle_set›</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> unit_circle_set_def unit_disc_def disc_def circline_set_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">i1</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">i2</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a1</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a2</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">∈</span> unit_circle_set›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i2</span> <span class="main">∈</span> unit_circle_set›</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> unit_circle_set_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a1</span> <span class="main">≠</span> <span class="var">?a2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">∈</span> unit_circle_set›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i2</span> <span class="main">∈</span> unit_circle_set›</span></span> circline_set_def divide_cancel_right inversion_infty inversion_unit_circle mem_Collect_eq of_complex_to_complex of_complex_zero to_complex_of_complex unit_circle_set_def zero_neq_numeral<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?a1</span><span class="main">,</span> <span class="skolem">i1</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> is_poincare_line_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="var"><span class="quoted"><span class="var">?a1</span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>                                                               

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?a2</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> is_poincare_line_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="var"><span class="quoted"><span class="var">?a2</span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a2</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>                                                               

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_ray_meets_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a1</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> tangent_not_meet<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x1</span></span> <span class="quoted"><span class="skolem">x2</span></span> <span class="quoted"><span class="skolem">i1</span></span> <span class="var"><span class="quoted"><span class="var">?a1</span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x2</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ideal_points <span class="var">?lx</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?a1</span><span class="main">,</span> <span class="skolem">i1</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">moreover</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_ray_meets_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a2</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> tangent_not_meet<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x1</span></span> <span class="quoted"><span class="skolem">x2</span></span> <span class="quoted"><span class="skolem">i2</span></span> <span class="var"><span class="quoted"><span class="var">?a2</span></span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x2</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ideal_points <span class="var">?lx</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?a2</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">moreover</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a'</span> <span class="main">∈</span> unit_disc<span class="main">.</span> poincare_in_angle <span class="bound">a'</span> <span class="var">?a1</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a2</span> <span class="main">⟶</span> poincare_ray_meets_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">a'</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> poincare_in_angle_def
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a'</span> <span class="skolem">a</span>
          <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"poincare_on_ray <span class="skolem">a'</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
                    <span class="quoted"><span class="quoted">"poincare_between <span class="var">?a1</span> <span class="skolem">a</span> <span class="var">?a2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="var">?a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="var">?a2</span>"</span></span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_ray_meets_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">a'</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a'</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">i1</span> <span class="bound">i2</span><span class="main">.</span>
                  <span class="bound">a'</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">x1</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">x2</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">x1</span> <span class="main">≠</span> <span class="bound">x2</span> <span class="main">∧</span>
                  <span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="bound">x1</span><span class="main">,</span> <span class="bound">x2</span><span class="main">}</span> <span class="main">∧</span> ideal_points <span class="main">(</span>poincare_line <span class="bound">x1</span> <span class="bound">x2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">i1</span><span class="main">,</span> <span class="bound">i2</span><span class="main">}</span> <span class="main">∧</span>
                  <span class="bound">a1</span> <span class="main">=</span> of_complex <span class="main">(</span>to_complex <span class="bound">i1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">a2</span> <span class="main">=</span> of_complex <span class="main">(</span>to_complex <span class="bound">i2</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="bound">i1</span> <span class="main">≠</span> <span class="bound">i2</span> <span class="main">∧</span> <span class="bound">a1</span> <span class="main">≠</span> <span class="bound">a2</span> <span class="main">∧</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="bound">a1</span><span class="main">,</span> <span class="bound">i1</span><span class="main">}</span> <span class="main">∧</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="bound">a2</span><span class="main">,</span> <span class="bound">i2</span><span class="main">}</span> <span class="main">∧</span>
                  <span class="bound">a1</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">a2</span> <span class="main">∈</span> unit_disc <span class="main">∧</span> <span class="bound">i1</span> <span class="main">∈</span> unit_circle_set <span class="main">∧</span> <span class="bound">i2</span> <span class="main">∈</span> unit_circle_set <span class="main">∧</span>
                  poincare_on_ray <span class="bound">a'</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">a</span> <span class="main">∧</span> <span class="bound">a'</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∧</span> poincare_between <span class="bound">a1</span> <span class="skolem">a</span> <span class="bound">a2</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="bound">a1</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="bound">a2</span> <span class="main">⟶</span>
                  poincare_ray_meets_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">a'</span> <span class="bound">x1</span> <span class="bound">x2</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a'</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">i1</span> <span class="bound">i2</span><span class="main">.</span> <span class="var">?R</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="bound">a'</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">i1</span> <span class="bound">i2</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> wlog_rotation_to_positive_x_axis<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∈</span> unit_disc›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span> <span class="bound">zero</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">a'</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">i1</span> <span class="bound">i2</span><span class="main">.</span> <span class="var">?R</span> <span class="bound">zero</span> <span class="bound">a'</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">i1</span> <span class="bound">i2</span> <span class="bound">a</span>"</span></span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span>
              <span class="keyword3"><span class="command">assume</span></span> xa<span class="main">:</span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">xa</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> Re <span class="skolem">xa</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">xa</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
              <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">xa</span>"</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R'</span> <span class="var">?a</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a'</span> <span class="skolem">a1</span> <span class="skolem">a2</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">i1</span> <span class="skolem">i2</span>
                <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">i1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?i2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">i2</span>"</span></span>
                <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="var">?i1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?a2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"of_complex <span class="main">(</span><span class="var">?i2</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?la</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_line <span class="var">?a1</span> <span class="var">?a2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?lx</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_line <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?li</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"poincare_line <span class="skolem">i1</span> <span class="skolem">i2</span>"</span></span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>"</span></span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"ideal_points <span class="var">?lx</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>"</span></span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poincare_on_ray <span class="skolem">a'</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="var">?a1</span> <span class="var">?a</span> <span class="var">?a2</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≠</span> <span class="var">?a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≠</span> <span class="var">?a2</span>"</span></span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a1</span> <span class="main">≠</span> <span class="var">?a2</span>"</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?a1</span><span class="main">,</span> <span class="skolem">i1</span><span class="main">}</span>"</span></span>  <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?a2</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>"</span></span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a1</span> <span class="main">∈</span> unit_disc"</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?a2</span> <span class="main">∈</span> unit_disc"</span></span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">∈</span> unit_circle_set"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">∈</span> unit_circle_set"</span></span>
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_ray_meets_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">a'</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>   
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lx</span> <span class="main">=</span> <span class="var">?li</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ideal_points <span class="var">?lx</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span> ideal_points_line_unique
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                  <span class="keyword1"><span class="command">have</span></span> lx<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="var">?lx</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> is_poincare_line_poincare_line<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span><span class="main">]</span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> circline_set <span class="var">?lx</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∈</span> circline_set <span class="var">?lx</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> lx <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lx</span> <span class="main">≠</span> x_axis"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">∈</span> circline_set <span class="var">?lx</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x2</span> <span class="main">∈</span> circline_set <span class="var">?lx</span>›</span></span> lx
                    <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∉</span> circline_set <span class="var">?lx</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">}</span>›</span></span> lx <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">∈</span> circline_set <span class="var">?lx</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x2</span> <span class="main">∈</span> circline_set <span class="var">?lx</span>›</span></span>
                    <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> 
                    <span class="keyword1"><span class="command">using</span></span> xa
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">≠</span> <span class="var">?a</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> positive_x_axis"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> xa
                    <span class="keyword1"><span class="command">unfolding</span></span> positive_x_axis_def 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> unit_disc"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> xa
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>

                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">∈</span> circline_set <span class="var">?la</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_between <span class="var">?a1</span> <span class="var">?a</span> <span class="var">?a2</span>›</span></span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="var">?a2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">∈</span> unit_disc›</span></span> poincare_between_poincare_line_uzv 
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                                                
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a1</span> <span class="main">∈</span> circline_set <span class="var">?la</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a2</span> <span class="main">∈</span> circline_set <span class="var">?la</span>"</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="var">?a2</span>›</span></span><span class="main">)</span>

                  <span class="keyword1"><span class="command">have</span></span> la<span class="main">:</span> <span class="quoted"><span class="quoted">"is_poincare_line <span class="var">?la</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> is_poincare_line_poincare_line<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="var">?a2</span>›</span></span><span class="main">]</span>
                    <span class="keyword1"><span class="command">by</span></span>  <span class="operator">simp</span>

                  <span class="keyword1"><span class="command">have</span></span> inv<span class="main">:</span> <span class="quoted"><span class="quoted">"inversion <span class="skolem">i1</span> <span class="main">=</span> <span class="skolem">i1</span>"</span></span> <span class="quoted"><span class="quoted">"inversion <span class="skolem">i2</span> <span class="main">=</span> <span class="skolem">i2</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">∈</span> unit_circle_set›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i2</span> <span class="main">∈</span> unit_circle_set›</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> circline_set_def unit_circle_set_def<span class="main">)</span>

                  <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> inv
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a1</span> <span class="main">∉</span> circline_set x_axis <span class="main">∧</span> <span class="var">?a2</span> <span class="main">∉</span> circline_set x_axis"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
                    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a1</span> <span class="main">∈</span> circline_set x_axis <span class="main">∨</span> <span class="var">?a2</span> <span class="main">∈</span> circline_set x_axis"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?la</span> <span class="main">=</span> x_axis"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span>
                      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a1</span> <span class="main">∈</span> circline_set x_axis"</span></span>
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?a</span><span class="main">,</span> <span class="var">?a1</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="var">?la</span> <span class="main">∩</span> circline_set x_axis"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> circline_set <span class="var">?la</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∈</span> circline_set <span class="var">?la</span>›</span></span><span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> positive_x_axis›</span></span>
                        <span class="keyword1"><span class="command">using</span></span> circline_set_x_axis_I xa<span class="main">(</span>1<span class="main">)</span> 
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?la</span> <span class="main">=</span> x_axis"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> unique_is_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?a1</span></span></span> <span class="var"><span class="quoted"><span class="var">?la</span></span></span> <span class="quoted">x_axis</span><span class="main">]</span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> unit_disc›</span></span> la <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">≠</span> <span class="var">?a1</span>›</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">next</span></span>
                      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a2</span> <span class="main">∈</span> circline_set x_axis"</span></span>
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="var">?a</span><span class="main">,</span> <span class="var">?a2</span><span class="main">}</span> <span class="main">⊆</span> circline_set <span class="var">?la</span> <span class="main">∩</span> circline_set x_axis"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> circline_set <span class="var">?la</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">∈</span> circline_set <span class="var">?la</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> positive_x_axis›</span></span>
                        <span class="keyword1"><span class="command">using</span></span> circline_set_x_axis_I xa<span class="main">(</span>1<span class="main">)</span> 
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?la</span> <span class="main">=</span> x_axis"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> unique_is_poincare_line<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="var"><span class="quoted"><span class="var">?a2</span></span></span> <span class="var"><span class="quoted"><span class="var">?la</span></span></span> <span class="quoted">x_axis</span><span class="main">]</span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> unit_disc›</span></span> la <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">≠</span> <span class="var">?a2</span>›</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                    <span class="keyword1"><span class="command">qed</span></span>

                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">∈</span> circline_set x_axis <span class="main">∧</span> <span class="skolem">i2</span> <span class="main">∈</span> circline_set x_axis"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∈</span> circline_set <span class="var">?la</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">∈</span> circline_set <span class="var">?la</span>›</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i2</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="main">(</span>to_complex <span class="skolem">i1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹of_complex <span class="main">(</span>to_complex <span class="skolem">i2</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> of_complex <span class="main">(</span>to_complex <span class="skolem">i1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="skolem">i1</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> of_complex <span class="main">(</span>to_complex <span class="skolem">i2</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>›</span></span> divide_eq_0_iff inf_not_of_complex inv<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> inv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> inversion_noteq_unit_disc of_complex_to_complex of_complex_zero_iff poincare_collinear3_poincare_lines_equal_general poincare_line_0_real_is_x_axis poincare_line_circline_set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_in_unit_disc zero_neq_numeral<span class="main">)</span>

                    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lx</span> <span class="main">≠</span> x_axis›</span></span> unique_is_poincare_line_general<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i1</span></span> <span class="quoted"><span class="skolem">i2</span></span> <span class="var"><span class="quoted"><span class="var">?li</span></span></span> <span class="quoted">x_axis</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>›</span></span> inv <span class="quoted"><span class="quoted">‹<span class="var">?lx</span> <span class="main">=</span> <span class="var">?li</span>›</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>

                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?la</span> <span class="main">≠</span> x_axis"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="var">?a2</span>›</span></span> poincare_line_circline_set<span class="main">(</span>1<span class="main">)</span>      
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive <span class="var">?la</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_positive_iff<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?la</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="var">?la</span> <span class="main">≠</span> x_axis›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> circline_set <span class="var">?la</span>›</span></span> la
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> positive_x_axis›</span></span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis <span class="var">?lx</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arg <span class="main">(</span>to_complex <span class="var">?a1</span><span class="main">)</span> <span class="main">*</span> arg <span class="main">(</span>to_complex <span class="var">?a2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_between <span class="var">?a1</span> <span class="var">?a</span> <span class="var">?a2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">∈</span> unit_disc›</span></span>
                      <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_intersection<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a1</span></span></span> <span class="var"><span class="quoted"><span class="var">?a2</span></span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">xa</span>"</span></span><span class="main">]</span>
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="var">?a2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∉</span> circline_set x_axis <span class="main">∧</span> <span class="var">?a2</span> <span class="main">∉</span> circline_set x_axis›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> positive_x_axis›</span></span>
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a</span> <span class="main">∈</span> circline_set <span class="var">?la</span>›</span></span>                                                                                         
                      <span class="keyword1"><span class="command">unfolding</span></span> positive_x_axis_def
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

                    <span class="keyword1"><span class="command">moreover</span></span>

                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span> <span class="bound">y</span> <span class="bound">x'</span> <span class="bound">y'</span> <span class="main">::</span> real<span class="main">.</span> <span class="main">⟦</span>sgn <span class="bound">x'</span> <span class="main">=</span> sgn <span class="bound">x</span><span class="main">;</span> sgn <span class="bound">y'</span> <span class="main">=</span> sgn <span class="bound">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">x</span><span class="main">*</span><span class="bound">y</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="main">⟷</span> <span class="bound">x'</span><span class="main">*</span><span class="bound">y'</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sgn_less sgn_mult<span class="main">)</span>

                    <span class="keyword1"><span class="command">ultimately</span></span>

                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Im <span class="main">(</span>to_complex <span class="var">?a1</span><span class="main">)</span> <span class="main">*</span> Im <span class="main">(</span>to_complex <span class="var">?a2</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> arg_Im_sgn<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"to_complex <span class="var">?a1</span>"</span></span><span class="main">]</span> arg_Im_sgn<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"to_complex <span class="var">?a2</span>"</span></span><span class="main">]</span>
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∉</span> circline_set x_axis <span class="main">∧</span> <span class="var">?a2</span> <span class="main">∉</span> circline_set x_axis›</span></span> 
                      <span class="keyword1"><span class="command">using</span></span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a1</span></span></span><span class="main">]</span> inf_or_of_complex<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a2</span></span></span><span class="main">]</span> circline_set_x_axis
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> circline_set_x_axis_I to_complex_of_complex<span class="main">)</span>

                    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">using</span></span> ideal_points_intersects_x_axis<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?lx</span></span></span> <span class="quoted"><span class="skolem">i1</span></span> <span class="quoted"><span class="skolem">i2</span></span><span class="main">]</span>
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ideal_points <span class="var">?lx</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>›</span></span> lx <span class="quoted"><span class="quoted">‹<span class="var">?lx</span> <span class="main">≠</span> x_axis›</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">qed</span></span>

                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"intersects_x_axis_positive <span class="var">?lx</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cmod <span class="var">?i1</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"cmod <span class="var">?i2</span> <span class="main">=</span> <span class="main">1</span>"</span></span>                
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">∈</span> unit_circle_set›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i2</span> <span class="main">∈</span> unit_circle_set›</span></span> 
                      <span class="keyword1"><span class="command">unfolding</span></span> unit_circle_set_def 
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a1'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?i1</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?a2'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="var">?i2</span> <span class="main">/</span> <span class="numeral">2</span>"</span></span>
                    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Aa1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="var">?a1'</span> <span class="main">*</span> cnj <span class="var">?a2'</span> <span class="main">-</span> <span class="var">?a2'</span> <span class="main">*</span> cnj <span class="var">?a1'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                        <span class="var"><span class="quoted"><span class="var">?Ba1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="var">?a2'</span> <span class="main">*</span> cor <span class="main">(</span><span class="main">(</span>cmod <span class="var">?a1'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?a1'</span> <span class="main">*</span> cor <span class="main">(</span><span class="main">(</span>cmod <span class="var">?a2'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Aa1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?Ba1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="main">(</span>to_complex <span class="skolem">i1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span>  <span class="quoted"><span class="quoted">‹cmod <span class="main">(</span>to_complex <span class="skolem">i2</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="var">?a2</span>›</span></span>              
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide complex_mult_cnj_cmod<span class="main">)</span>

                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?Aa1</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a1</span> <span class="main">≠</span> inversion <span class="var">?a2</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">∈</span> unit_disc›</span></span> inversion_noteq_unit_disc <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?Ba1</span> <span class="main">/</span> Re <span class="var">?Aa1</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹intersects_x_axis_positive <span class="var">?la</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="var">?a2</span>›</span></span>
                      <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_positive_mk_circline<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?Aa1</span></span></span> <span class="var"><span class="quoted"><span class="var">?Ba1</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="var">?Aa1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?Ba1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?Aa1</span>›</span></span>
                      <span class="keyword1"><span class="command">using</span></span> poincare_line_non_homogenous<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?a1</span></span></span> <span class="var"><span class="quoted"><span class="var">?a2</span></span></span><span class="main">]</span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>

                    <span class="keyword1"><span class="command">moreover</span></span>

                    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i1'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">i1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="var"><span class="quoted"><span class="var">?i2'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">i2</span>"</span></span>
                    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Ai1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="var">?i1'</span> <span class="main">*</span> cnj <span class="var">?i2'</span> <span class="main">-</span> <span class="var">?i2'</span> <span class="main">*</span> cnj <span class="var">?i1'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                        <span class="var"><span class="quoted"><span class="var">?Bi1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">𝗂</span> <span class="main">*</span> <span class="main">(</span><span class="var">?i2'</span> <span class="main">*</span> cor <span class="main">(</span><span class="main">(</span>cmod <span class="var">?i1'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="var">?i1'</span> <span class="main">*</span> cor <span class="main">(</span><span class="main">(</span>cmod <span class="var">?i2'</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>

                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ai1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?Bi1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="main">(</span>to_complex <span class="skolem">i1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span>  <span class="quoted"><span class="quoted">‹cmod <span class="main">(</span>to_complex <span class="skolem">i2</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="var">?a2</span>›</span></span>              
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide complex_mult_cnj_cmod<span class="main">)</span>

                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_real <span class="var">?Ai1</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sgn <span class="main">(</span>Re <span class="var">?Bi1</span> <span class="main">/</span> Re <span class="var">?Ai1</span><span class="main">)</span> <span class="main">=</span> sgn <span class="main">(</span>Re <span class="var">?Ba1</span> <span class="main">/</span> Re <span class="var">?Aa1</span><span class="main">)</span>"</span></span>  
                    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?Bi1</span> <span class="main">/</span> Re <span class="var">?Ai1</span> <span class="main">=</span> <span class="main">(</span>Im <span class="var">?i1</span> <span class="main">*</span> <span class="numeral">2</span> <span class="main">-</span> Im <span class="var">?i2</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">/</span>
                                                <span class="main">(</span>Im <span class="var">?i2</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?i1</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> Im <span class="var">?i1</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?i2</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="var">?i1</span> <span class="main">=</span> <span class="main">1</span>›</span></span>  <span class="quoted"><span class="quoted">‹cmod <span class="var">?i2</span> <span class="main">=</span> <span class="main">1</span>›</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_mult_cnj_cmod <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span>  <span class="main">(</span>Im <span class="var">?i1</span> <span class="main">-</span> Im <span class="var">?i2</span><span class="main">)</span> <span class="main">/</span>
                                        <span class="main">(</span>Im <span class="var">?i2</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?i1</span><span class="main">)</span> <span class="main">-</span> Im <span class="var">?i1</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?i2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="var">?expr</span>"</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> left_diff_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> left_diff_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.commute mult_divide_mult_cancel_left_if zero_neq_numeral<span class="main">)</span>
                      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="var">?Bi1</span> <span class="main">/</span> Re <span class="var">?Ai1</span> <span class="main">=</span> <span class="main">(</span>Im <span class="var">?i1</span> <span class="main">-</span> Im <span class="var">?i2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Im <span class="var">?i2</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?i1</span><span class="main">)</span> <span class="main">-</span> Im <span class="var">?i1</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?i2</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">.</span></span>

                
                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?Ba1</span> <span class="main">/</span> Re <span class="var">?Aa1</span> <span class="main">=</span> <span class="main">(</span>Im <span class="var">?i1</span> <span class="main">*</span> <span class="numeral">20</span> <span class="main">-</span> Im <span class="var">?i2</span> <span class="main">*</span> <span class="numeral">20</span><span class="main">)</span> <span class="main">/</span>
                                                <span class="main">(</span>Im <span class="var">?i2</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?i1</span> <span class="main">*</span> <span class="numeral">16</span><span class="main">)</span> <span class="main">-</span> Im <span class="var">?i1</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?i2</span> <span class="main">*</span> <span class="numeral">16</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cmod <span class="main">(</span>to_complex <span class="skolem">i1</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span>  <span class="quoted"><span class="quoted">‹cmod <span class="main">(</span>to_complex <span class="skolem">i2</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>›</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_mult_cnj_cmod <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
                      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">20</span> <span class="main">/</span> <span class="numeral">16</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>Im <span class="var">?i1</span> <span class="main">-</span> Im <span class="var">?i2</span><span class="main">)</span> <span class="main">/</span>
                                       <span class="main">(</span>Im <span class="var">?i2</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?i1</span><span class="main">)</span> <span class="main">-</span> Im <span class="var">?i1</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?i2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> left_diff_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> left_diff_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span>  field_class.field_divide_inverse mult.commute times_divide_times_eq<span class="main">)</span>
                      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"Re <span class="var">?Ba1</span> <span class="main">/</span> Re <span class="var">?Aa1</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">5</span> <span class="main">/</span> <span class="numeral">4</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>Im <span class="var">?i1</span> <span class="main">-</span> Im <span class="var">?i2</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Im <span class="var">?i2</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?i1</span><span class="main">)</span> <span class="main">-</span> Im <span class="var">?i1</span> <span class="main">*</span> <span class="main">(</span>Re <span class="var">?i2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?expr</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Re <span class="var">?Ba1</span> <span class="main">/</span> Re <span class="var">?Aa1</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>›</span></span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> 2<span class="main">)</span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
                      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> 1<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> 2<span class="main">)</span>
                        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sgn_mult<span class="main">)</span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                    <span class="keyword1"><span class="command">qed</span></span>
                      

                    <span class="keyword1"><span class="command">moreover</span></span>

                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">≠</span> inversion <span class="skolem">i2</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>›</span></span> inv<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="var">?Bi1</span> <span class="main">/</span> Re <span class="var">?Ai1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
                    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ai1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span>Re <span class="var">?Bi1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="var">?Ai1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹intersects_x_axis <span class="var">?lx</span>›</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i2</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">≠</span> inversion <span class="skolem">i2</span>›</span></span>
                        <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_mk_circline<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?Ai1</span></span></span> <span class="var"><span class="quoted"><span class="var">?Bi1</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="var">?Ai1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?Bi1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?Ai1</span>›</span></span>
                        <span class="keyword1"><span class="command">using</span></span> poincare_line_non_homogenous<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i1</span></span> <span class="quoted"><span class="skolem">i2</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="var">?lx</span> <span class="main">=</span> <span class="var">?li</span>›</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
                                                  
                      <span class="keyword1"><span class="command">moreover</span></span>
                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Ai1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
                        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
                        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="var">?li</span>"</span></span>
                          <span class="keyword1"><span class="command">unfolding</span></span> circline_set_def
                          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
                          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">i1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">i2</span></span><span class="main">)</span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vec_cnj_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
                        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
                          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∉</span> circline_set <span class="var">?lx</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?lx</span> <span class="main">=</span> <span class="var">?li</span>›</span></span>
                          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                      <span class="keyword1"><span class="command">qed</span></span>

                      <span class="keyword1"><span class="command">ultimately</span></span>

                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Re <span class="var">?Bi1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">(</span>Re <span class="var">?Ai1</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span>"</span></span>    
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                      <span class="keyword1"><span class="command">moreover</span></span>

                      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?Ai1</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?Ai1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Ai1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complex_eq_iff<span class="main">)</span>

                      <span class="keyword1"><span class="command">ultimately</span></span>

                      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> power_divide<span class="main">)</span>
                    <span class="keyword1"><span class="command">qed</span></span>

                    <span class="keyword1"><span class="command">moreover</span></span>

                    <span class="keyword1"><span class="command">{</span></span>
                      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">::</span> <span class="quoted">real</span>
                      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"sgn <span class="skolem">x1</span> <span class="main">=</span> sgn <span class="skolem">x2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span><span class="main"><span class="hidden">⇧</span><sup>2</sup></span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> one_power2 real_sqrt_abs real_sqrt_less_iff sgn_neg sgn_pos<span class="main">)</span>
                    <span class="keyword1"><span class="command">}</span></span>

                    <span class="keyword1"><span class="command">ultimately</span></span>

                    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Re <span class="var">?Bi1</span> <span class="main">/</span> Re <span class="var">?Ai1</span> <span class="main">&lt;</span> <span class="main">-</span><span class="main">1</span>"</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

                    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i2</span> <span class="main">≠</span> <span class="keyword1">∞<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">≠</span> inversion <span class="skolem">i2</span>›</span></span>
                      <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_positive_mk_circline<span class="main">[</span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var">?Ai1</span></span></span> <span class="var"><span class="quoted"><span class="var">?Bi1</span></span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="var">?Ai1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∨</span> <span class="var">?Bi1</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹is_real <span class="var">?Ai1</span>›</span></span>
                      <span class="keyword1"><span class="command">using</span></span> poincare_line_non_homogenous<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i1</span></span> <span class="quoted"><span class="skolem">i2</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="var">?lx</span> <span class="main">=</span> <span class="var">?li</span>›</span></span>
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">qed</span></span>

                  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> circline_set <span class="var">?lx</span> <span class="main">∩</span> positive_x_axis"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> intersects_x_axis_positive_iff<span class="main">[</span><span class="operator">OF</span> lx <span class="quoted"><span class="quoted">‹<span class="var">?lx</span> <span class="main">≠</span> x_axis›</span></span><span class="main">]</span>
                    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_on_ray <span class="skolem">x</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">a'</span> <span class="main">∧</span> poincare_collinear <span class="main">{</span><span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">,</span> <span class="skolem">x</span><span class="main">}</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">,</span> <span class="skolem">x</span><span class="main">}</span>"</span></span>
                      <span class="keyword1"><span class="command">using</span></span> x lx <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">∈</span> circline_set <span class="var">?lx</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x2</span> <span class="main">∈</span> circline_set <span class="var">?lx</span>›</span></span>
                      <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
                      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_on_ray <span class="skolem">x</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">a'</span>"</span></span>
                      <span class="keyword1"><span class="command">unfolding</span></span> poincare_on_ray_def
                    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
                      <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">∈</span> circline_set x_axis"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_on_ray <span class="skolem">a'</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a</span>›</span></span> xa <span class="quoted"><span class="quoted">‹<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">≠</span> <span class="var">?a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">xa</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> unit_disc›</span></span>
                        <span class="keyword1"><span class="command">unfolding</span></span> poincare_on_ray_def 
                        <span class="keyword1"><span class="command">using</span></span> poincare_line_0_real_is_x_axis<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">xa</span>"</span></span><span class="main">]</span>
                        <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_line_uvz<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">xa</span>"</span></span> <span class="quoted"><span class="skolem">a'</span></span><span class="main">]</span>
                        <span class="keyword1"><span class="command">using</span></span> poincare_between_poincare_line_uzv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="quoted">"of_complex <span class="skolem">xa</span>"</span></span> <span class="quoted"><span class="skolem">a'</span></span><span class="main">]</span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span>  <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>

                      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xa'</span></span> <span class="keyword2"><span class="keyword">where</span></span> xa'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a'</span> <span class="main">=</span> of_complex <span class="skolem">xa'</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">xa'</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> unit_disc›</span></span>
                        <span class="keyword1"><span class="command">using</span></span> circline_set_def on_circline_x_axis 
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span> <span class="main">&lt;</span> Re <span class="skolem">xa'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">xa'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xa'</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cmod_eq_Re<span class="main">)</span>

                      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">xa'</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">xa'</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">xa'</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_on_ray <span class="skolem">a'</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">(</span>of_complex <span class="skolem">xa</span><span class="main">)</span>›</span></span>
                        <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_0uv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">xa'</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">xa</span>"</span></span><span class="main">]</span>
                        <span class="keyword1"><span class="command">using</span></span> poincare_between_x_axis_0uv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">xa</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">xa'</span>"</span></span><span class="main">]</span>
                        <span class="keyword1"><span class="command">using</span></span> circline_set_positive_x_axis_I<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Re <span class="skolem">xa'</span>"</span></span><span class="main">]</span>
                        <span class="keyword1"><span class="command">using</span></span> xa xa' complex_of_real_Re
                        <span class="keyword1"><span class="command">unfolding</span></span> poincare_on_ray_def
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> of_real_0<span class="main"><span class="keyword3">,</span></span> <span class="operator">linarith</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

                      <span class="keyword1"><span class="command">moreover</span></span>

                      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xx</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"is_real <span class="skolem">xx</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">xx</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"Re <span class="skolem">xx</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> of_complex <span class="skolem">xx</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> x
                        <span class="keyword1"><span class="command">unfolding</span></span> positive_x_axis_def
                        <span class="keyword1"><span class="command">using</span></span> circline_set_def cmod_eq_Re on_circline_x_axis
                        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

                      <span class="keyword1"><span class="command">ultimately</span></span>

                      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">x</span> <span class="skolem">a'</span> <span class="main">∨</span> poincare_between <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">a'</span> <span class="skolem">x</span>"</span></span>
                        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">=</span> of_complex <span class="skolem">xa'</span>›</span></span>
                        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> unit_disc›</span></span> arg_0_iff poincare_between_0uv poincare_between_def to_complex_of_complex x<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
                    <span class="keyword1"><span class="command">qed</span></span>

                  <span class="keyword1"><span class="command">qed</span></span>

                  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>               
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> unit_disc›</span></span>
                    <span class="keyword1"><span class="command">unfolding</span></span> poincare_ray_meets_line_def poincare_on_line_def
                    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_commute<span class="main">)</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&lt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"to_complex <span class="var">?a1</span> <span class="main">=</span> cor <span class="skolem">k</span> <span class="main">*</span> to_complex <span class="var">?a2</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> poincare_between_u0v<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span><span class="main">]</span>
                  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_between <span class="var">?a1</span> <span class="skolem">a</span> <span class="var">?a2</span>›</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"to_complex <span class="skolem">i1</span> <span class="main">=</span> cor <span class="skolem">k</span> <span class="main">*</span> to_complex <span class="skolem">i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> ideal_points_proportional<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"poincare_line <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span> <span class="quoted"><span class="skolem">i1</span></span> <span class="quoted"><span class="skolem">i2</span></span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹ideal_points <span class="main">(</span>poincare_line <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>›</span></span>
                  <span class="keyword1"><span class="command">using</span></span> is_poincare_line_poincare_line<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span><span class="main">]</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span>
                  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">}</span>›</span></span>
                  <span class="keyword1"><span class="command">using</span></span> is_poincare_line_poincare_line<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span><span class="main">]</span>
                  <span class="keyword1"><span class="command">unfolding</span></span> poincare_collinear_def
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span> empty_subsetI insert_subset poincare_line_circline_set<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> poincare_line_circline_set<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">next</span></span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">φ</span> <span class="skolem">u</span>
              <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?R'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span> <span class="bound">zero</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">a'</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">i1</span> <span class="bound">i2</span><span class="main">.</span> <span class="var">?R</span> <span class="bound">zero</span> <span class="bound">a'</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">i1</span> <span class="bound">i2</span> <span class="bound">a</span>"</span></span>
              <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"moebius_pt <span class="main">(</span>moebius_rotation <span class="skolem">φ</span><span class="main">)</span>"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?R'</span> <span class="main">(</span><span class="var">?M</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> uf<span class="main">:</span> <span class="quoted"><span class="quoted">"unit_disc_fix <span class="main">(</span>moebius_rotation <span class="skolem">φ</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">=</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?R'</span> <span class="main">(</span><span class="var">?M</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">(</span><span class="var">?M</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> **
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R'</span> <span class="skolem">u</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a'</span> <span class="skolem">a1</span> <span class="skolem">a2</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">i1</span> <span class="skolem">i2</span>
                <span class="keyword1"><span class="command">have</span></span> i1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">∈</span> unit_circle_set <span class="main">⟶</span> moebius_pt <span class="main">(</span>moebius_rotation <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="main">(</span>to_complex <span class="skolem">i1</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> of_complex <span class="main">(</span>to_complex <span class="main">(</span>moebius_pt <span class="main">(</span>moebius_rotation <span class="skolem">φ</span><span class="main">)</span> <span class="skolem">i1</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> unit_circle_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                
                <span class="keyword1"><span class="command">have</span></span> i2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">∈</span> unit_circle_set <span class="main">⟶</span> moebius_pt <span class="main">(</span>moebius_rotation <span class="skolem">φ</span><span class="main">)</span> <span class="main">(</span>of_complex <span class="main">(</span>to_complex <span class="skolem">i2</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> of_complex <span class="main">(</span>to_complex <span class="main">(</span>moebius_pt <span class="main">(</span>moebius_rotation <span class="skolem">φ</span><span class="main">)</span> <span class="skolem">i2</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> unit_circle_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
                
                <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?R</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">a'</span> <span class="skolem">a1</span> <span class="skolem">a2</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">i1</span> <span class="skolem">i2</span> <span class="skolem">u</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> **<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">a'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">x1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">x2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">i1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">i2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">a1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="skolem">a2</span>"</span></span><span class="main">]</span> uf * 
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>  moebius_pt_moebius_rotation_zero moebius_pt_moebius_rotation<span class="main">)</span>
                  <span class="keyword1"><span class="command">using</span></span> i1 i2
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>                                                                  
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x2</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span> 
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹ideal_points <span class="var">?lx</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="var">?a2</span>›</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?a1</span><span class="main">,</span> <span class="skolem">i1</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?a2</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>›</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">∈</span> unit_circle_set›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i2</span> <span class="main">∈</span> unit_circle_set›</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_on_ray <span class="skolem">a'</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="skolem">a</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a'</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹poincare_between <span class="var">?a1</span> <span class="skolem">a</span> <span class="var">?a2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="var">?a1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">≠</span> <span class="var">?a2</span>›</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">moreover</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_on_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a1</span> <span class="var">?a2</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"poincare_on_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a1</span> <span class="var">?a2</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?a1</span><span class="main">,</span> <span class="var">?a2</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> poincare_on_line_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a1</span> <span class="main">=</span> poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> poincare_collinear3_poincare_lines_equal_general<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="var"><span class="quoted"><span class="var">?a1</span></span></span> <span class="var"><span class="quoted"><span class="var">?a2</span></span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inversion_noteq_unit_disc zero_in_unit_disc<span class="main">)</span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i1</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?a1</span><span class="main">,</span> <span class="skolem">i1</span><span class="main">}</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> poincare_collinear3_poincare_line_general<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i1</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="var"><span class="quoted"><span class="var">?a1</span></span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_commute inversion_noteq_unit_disc zero_in_unit_disc<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i2</span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?a2</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> poincare_collinear3_poincare_line_general<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">i2</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="var"><span class="quoted"><span class="var">?a2</span></span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a1</span> <span class="main">=</span> poincare_line <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="var">?a2</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_commute inversion_noteq_unit_disc zero_in_unit_disc<span class="main">)</span>

          <span class="keyword1"><span class="command">ultimately</span></span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">≠</span> <span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="var">?a1</span><span class="main">,</span> <span class="skolem">i1</span><span class="main">}</span>›</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> insert_subset poincare_collinear_def unique_poincare_line zero_in_unit_disc<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span> <span class="main">∈</span> circline_set <span class="main">(</span>poincare_line <span class="skolem">i1</span> <span class="skolem">i2</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> poincare_collinear3_poincare_line_general<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span>"</span></span> <span class="quoted"><span class="skolem">i1</span></span> <span class="quoted"><span class="skolem">i2</span></span><span class="main">]</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i1</span> <span class="main">≠</span> <span class="skolem">i2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i2</span> <span class="main">∈</span> unit_circle_set›</span></span> unit_circle_set_def
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

          <span class="keyword1"><span class="command">moreover</span></span>

          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lx</span> <span class="main">=</span> <span class="var">?li</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹ideal_points <span class="var">?lx</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">i1</span><span class="main">,</span> <span class="skolem">i2</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span> ideal_points_line_unique
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

          <span class="keyword1"><span class="command">ultimately</span></span>

          <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="keyword1">0<span class="hidden">⇩</span><sub>h</sub></span><span class="main">,</span> <span class="skolem">x1</span><span class="main">,</span> <span class="skolem">x2</span><span class="main">}</span>›</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x1</span> <span class="main">≠</span> <span class="skolem">x2</span>›</span></span> poincare_line_poincare_collinear3_general
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>          

        <span class="keyword1"><span class="command">ultimately</span></span>

        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?a2</span> <span class="main">∈</span> unit_disc›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x1</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">x2</span> <span class="main">∈</span> unit_disc›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_collinear <span class="main">{</span><span class="free">a</span><span class="main">,</span> <span class="free">x1</span><span class="main">,</span> <span class="free">x2</span><span class="main">}</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>                                                                        

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Interpretation of locales›</span></span>

<span class="keyword1"><span class="command">global_interpretation</span></span> PoincareTarskiAbsolute<span class="main">:</span> TarskiAbsolute <span class="keyword2"><span class="keyword">where</span></span> cong  <span class="main">=</span> <span class="quoted">p_congruent</span> <span class="keyword2"><span class="keyword">and</span></span> betw <span class="main">=</span> <span class="quoted">p_between</span>
  <span class="keyword2"><span class="keyword">defines</span></span> p_on_line <span class="main">=</span> <span class="quoted">PoincareTarskiAbsolute.on_line</span> <span class="keyword2"><span class="keyword">and</span></span>
          p_on_ray <span class="main">=</span> <span class="quoted">PoincareTarskiAbsolute.on_ray</span> <span class="keyword2"><span class="keyword">and</span></span>
          p_in_angle <span class="main">=</span> <span class="quoted">PoincareTarskiAbsolute.in_angle</span> <span class="keyword2"><span class="keyword">and</span></span>
          p_ray_meets_line <span class="main">=</span> <span class="quoted">PoincareTarskiAbsolute.ray_meets_line</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"TarskiAbsolute p_congruent p_between"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 1. Reflexivity of congruence ›</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"p_congruent <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">y</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p_congruent_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_distance_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 2. Transitivity of congruence ›</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"p_congruent <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">u</span> <span class="main">∧</span> p_congruent <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">v</span> <span class="skolem">w</span> <span class="main">⟶</span> p_congruent <span class="skolem">z</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">w</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 3. Identity of congruence ›</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"p_congruent <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">z</span> <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p_congruent_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_distance_eq_0_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 4. Segment construction ›</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">z</span><span class="main">.</span> p_between <span class="skolem">x</span> <span class="skolem">y</span> <span class="bound">z</span> <span class="main">∧</span> p_congruent <span class="skolem">y</span> <span class="bound">z</span> <span class="skolem">a</span> <span class="skolem">b</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> segment_construction
      <span class="keyword1"><span class="command">unfolding</span></span> p_congruent_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 5. Five segment ›</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">x'</span> <span class="skolem">y'</span> <span class="skolem">z'</span> <span class="skolem">u</span> <span class="skolem">u'</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="skolem">y</span> <span class="main">∧</span> p_between <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">∧</span> p_between <span class="skolem">x'</span> <span class="skolem">y'</span> <span class="skolem">z'</span> <span class="main">∧</span>
      p_congruent <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">x'</span> <span class="skolem">y'</span> <span class="main">∧</span> p_congruent <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">y'</span> <span class="skolem">z'</span> <span class="main">∧</span>
      p_congruent <span class="skolem">x</span> <span class="skolem">u</span> <span class="skolem">x'</span> <span class="skolem">u'</span> <span class="main">∧</span> p_congruent <span class="skolem">y</span> <span class="skolem">u</span> <span class="skolem">y'</span> <span class="skolem">u'</span> <span class="main">⟶</span>
      p_congruent <span class="skolem">z</span> <span class="skolem">u</span> <span class="skolem">z'</span> <span class="skolem">u'</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p_congruent_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
      <span class="keyword1"><span class="command">using</span></span> five_segment_axiom                                             
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 6. Identity of betweeness ›</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"p_between <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> poincare_between_sum_distances poincare_distance_eq_0_iff poincare_distance_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 7. Pasch ›</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"p_between <span class="skolem">x</span> <span class="skolem">u</span> <span class="skolem">z</span> <span class="main">∧</span> p_between <span class="skolem">y</span> <span class="skolem">v</span> <span class="skolem">z</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> p_between <span class="skolem">u</span> <span class="bound">a</span> <span class="skolem">y</span> <span class="main">∧</span> p_between <span class="skolem">x</span> <span class="bound">a</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
      <span class="keyword1"><span class="command">using</span></span> Pasch
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 8. Lower dimension ›</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">c</span><span class="main">.</span> <span class="main">¬</span> p_between <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="main">∧</span> <span class="main">¬</span> p_between <span class="bound">b</span> <span class="bound">c</span> <span class="bound">a</span> <span class="main">∧</span> <span class="main">¬</span> p_between <span class="bound">c</span> <span class="bound">a</span> <span class="bound">b</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> lower_dimension_axiom
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 9. Upper dimension ›</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">u</span> <span class="skolem">v</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"p_congruent <span class="skolem">x</span> <span class="skolem">u</span> <span class="skolem">x</span> <span class="skolem">v</span> <span class="main">∧</span> p_congruent <span class="skolem">y</span> <span class="skolem">u</span> <span class="skolem">y</span> <span class="skolem">v</span> <span class="main">∧</span> p_congruent <span class="skolem">z</span> <span class="skolem">u</span> <span class="skolem">z</span> <span class="skolem">v</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="skolem">v</span> <span class="main">⟶</span>
          p_between <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">∨</span> p_between <span class="skolem">y</span> <span class="skolem">z</span> <span class="skolem">x</span> <span class="main">∨</span> p_between <span class="skolem">z</span> <span class="skolem">x</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> p_congruent_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">transfer</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> upper_dimension_axiom<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> 


<span class="keyword1"><span class="command">interpretation</span></span> PoincareTarskiHyperbolic<span class="main">:</span> TarskiHyperbolic
  <span class="keyword2"><span class="keyword">where</span></span> cong <span class="main">=</span> <span class="quoted">p_congruent</span> <span class="keyword2"><span class="keyword">and</span></span> betw <span class="main">=</span> <span class="quoted">p_between</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 10. Euclid negation ›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">d</span> <span class="bound">t</span><span class="main">.</span> p_between <span class="bound">a</span> <span class="bound">d</span> <span class="bound">t</span> <span class="main">∧</span> p_between <span class="bound">b</span> <span class="bound">d</span> <span class="bound">c</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="bound">d</span> <span class="main">∧</span>
                   <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> p_between <span class="bound">a</span> <span class="bound">b</span> <span class="bound">x</span> <span class="main">∧</span> p_between <span class="bound">a</span> <span class="bound">c</span> <span class="bound">y</span> <span class="main">⟶</span> <span class="main">¬</span> p_between <span class="bound">x</span> <span class="bound">t</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> negated_euclidean_axiom
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">transfer</span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x1</span>  <span class="skolem">x2</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> TarskiAbsolute.on_line p_between <span class="skolem">a</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> p_on_line <span class="skolem">a</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> TarskiAbsolute.on_line_def<span class="main">[</span><span class="operator">OF</span> PoincareTarskiAbsolute.TarskiAbsolute_axioms<span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> PoincareTarskiAbsolute.on_line_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 11. Limiting parallels  ›</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a1</span> <span class="bound">a2</span><span class="main">.</span>
          <span class="main">¬</span> TarskiAbsolute.on_line p_between <span class="skolem">a</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="main">∧</span>
          <span class="main">¬</span> TarskiAbsolute.ray_meets_line p_between <span class="skolem">a</span> <span class="bound">a1</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">∧</span>
          <span class="main">¬</span> TarskiAbsolute.ray_meets_line p_between <span class="skolem">a</span> <span class="bound">a2</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">∧</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">a'</span><span class="main">.</span> TarskiAbsolute.in_angle p_between <span class="bound">a'</span> <span class="bound">a1</span> <span class="skolem">a</span> <span class="bound">a2</span> <span class="main">⟶</span> TarskiAbsolute.ray_meets_line p_between <span class="skolem">a</span> <span class="bound">a'</span> <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> TarskiAbsolute.in_angle_def<span class="main">[</span><span class="operator">OF</span> PoincareTarskiAbsolute.TarskiAbsolute_axioms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> TarskiAbsolute.on_ray_def<span class="main">[</span><span class="operator">OF</span> PoincareTarskiAbsolute.TarskiAbsolute_axioms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> TarskiAbsolute.ray_meets_line_def<span class="main">[</span><span class="operator">OF</span> PoincareTarskiAbsolute.TarskiAbsolute_axioms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> TarskiAbsolute.on_ray_def<span class="main">[</span><span class="operator">OF</span> PoincareTarskiAbsolute.TarskiAbsolute_axioms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> TarskiAbsolute.on_line_def<span class="main">[</span><span class="operator">OF</span> PoincareTarskiAbsolute.TarskiAbsolute_axioms<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> PoincareTarskiAbsolute.on_line_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">x1</span> <span class="skolem">x2</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span> <span class="main">∈</span> unit_disc"</span></span>
              <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>poincare_between <span class="skolem">a</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">∨</span> poincare_between <span class="skolem">x1</span> <span class="skolem">a</span> <span class="skolem">x2</span> <span class="main">∨</span> poincare_between <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_on_line <span class="skolem">a</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> poincare_collinear3_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">x1</span></span> <span class="quoted"><span class="skolem">x2</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> poincare_between_rev poincare_on_line_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a1</span><span class="main">∈</span>unit_disc<span class="main">.</span>
            <span class="main">∃</span><span class="bound">a2</span><span class="main">∈</span>unit_disc<span class="main">.</span>
            <span class="main">¬</span> poincare_on_line <span class="skolem">a</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="main">∧</span>
            <span class="main">¬</span> poincare_ray_meets_line <span class="skolem">a</span> <span class="bound">a1</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">∧</span>
            <span class="main">¬</span> poincare_ray_meets_line <span class="skolem">a</span> <span class="bound">a2</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">∧</span>
            <span class="main">(</span><span class="main">∀</span><span class="bound">a'</span><span class="main">∈</span>unit_disc<span class="main">.</span>
                poincare_in_angle <span class="bound">a'</span> <span class="bound">a1</span> <span class="skolem">a</span> <span class="bound">a2</span> <span class="main">⟶</span>
                poincare_ray_meets_line <span class="skolem">a</span> <span class="bound">a'</span> <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> limiting_parallels<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">x1</span></span> <span class="quoted"><span class="skolem">x2</span></span><span class="main">]</span> *
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="keyword2"><span class="keyword">where</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a1</span><span class="main">∈</span>unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a2</span><span class="main">∈</span>unit_disc"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_on_line <span class="skolem">a</span> <span class="skolem">a1</span> <span class="skolem">a2</span>"</span></span>
                            <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_ray_meets_line <span class="skolem">a</span> <span class="skolem">a2</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
                            <span class="quoted"><span class="quoted">"<span class="main">¬</span> poincare_ray_meets_line <span class="skolem">a</span> <span class="skolem">a1</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
                            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a'</span><span class="main">∈</span>unit_disc<span class="main">.</span>
                                  poincare_in_angle <span class="bound">a'</span> <span class="skolem">a1</span> <span class="skolem">a</span> <span class="skolem">a2</span> <span class="main">⟶</span>
                                  poincare_ray_meets_line <span class="skolem">a</span> <span class="bound">a'</span> <span class="skolem">x1</span> <span class="skolem">x2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc<span class="main">}</span><span class="main">.</span>
                    <span class="main">(</span>poincare_between <span class="skolem">a</span> <span class="bound">x</span> <span class="skolem">a1</span> <span class="main">∨</span>
                     poincare_between <span class="skolem">a</span> <span class="skolem">a1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="main">(</span>poincare_between <span class="bound">x</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">∨</span>
                     poincare_between <span class="skolem">x1</span> <span class="bound">x</span> <span class="skolem">x2</span> <span class="main">∨</span>
                     poincare_between <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_ray_meets_line <span class="skolem">a</span> <span class="skolem">a1</span> <span class="skolem">x1</span> <span class="skolem">x2</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_on_line_def poincare_ray_meets_line_def poincare_on_ray_def
      <span class="keyword1"><span class="command">using</span></span> poincare_collinear3_iff<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">x1</span></span> <span class="quoted"><span class="skolem">x2</span></span><span class="main">]</span> poincare_between_rev *<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc<span class="main">}</span><span class="main">.</span>
                    <span class="main">(</span>poincare_between <span class="skolem">a</span> <span class="bound">x</span> <span class="skolem">a2</span> <span class="main">∨</span>
                     poincare_between <span class="skolem">a</span> <span class="skolem">a2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="main">(</span>poincare_between <span class="bound">x</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">∨</span>
                     poincare_between <span class="skolem">x1</span> <span class="bound">x</span> <span class="skolem">x2</span> <span class="main">∨</span>
                     poincare_between <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_ray_meets_line <span class="skolem">a</span> <span class="skolem">a2</span> <span class="skolem">x1</span> <span class="skolem">x2</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_on_line_def poincare_ray_meets_line_def poincare_on_ray_def
      <span class="keyword1"><span class="command">using</span></span> poincare_collinear3_iff<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">x1</span></span> <span class="quoted"><span class="skolem">x2</span></span><span class="main">]</span> poincare_between_rev *<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>poincare_between <span class="skolem">a</span> <span class="skolem">a1</span> <span class="skolem">a2</span> <span class="main">∨</span> poincare_between <span class="skolem">a1</span> <span class="skolem">a</span> <span class="skolem">a2</span> <span class="main">∨</span> poincare_between <span class="skolem">a1</span> <span class="skolem">a2</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> poincare_on_line <span class="skolem">a</span> <span class="skolem">a1</span> <span class="skolem">a2</span>›</span></span> poincare_collinear3_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">a1</span></span> <span class="quoted"><span class="skolem">a2</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>1<span class="main">)</span> **<span class="main">(</span>1-2<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_on_line_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a'</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc<span class="main">}</span><span class="main">.</span>
                 <span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">a1</span> <span class="main">∧</span>
                 <span class="skolem">a</span> <span class="main">≠</span> <span class="skolem">a2</span> <span class="main">∧</span>
                 <span class="bound">a'</span> <span class="main">≠</span> <span class="skolem">a</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc<span class="main">}</span><span class="main">.</span>
                     poincare_between <span class="skolem">a1</span> <span class="bound">x</span> <span class="skolem">a2</span> <span class="main">∧</span>
                     <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">a1</span> <span class="main">∧</span>
                     <span class="bound">x</span> <span class="main">≠</span> <span class="skolem">a2</span> <span class="main">∧</span>
                     <span class="main">(</span>poincare_between <span class="skolem">a</span> <span class="bound">a'</span> <span class="bound">x</span> <span class="main">∨</span>
                      poincare_between <span class="skolem">a</span> <span class="bound">x</span> <span class="bound">a'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                 <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc<span class="main">}</span><span class="main">.</span>
                     <span class="main">(</span>poincare_between <span class="skolem">a</span> <span class="bound">x</span> <span class="bound">a'</span> <span class="main">∨</span>
                      poincare_between <span class="skolem">a</span> <span class="bound">a'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span>poincare_between <span class="bound">x</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">∨</span>
                      poincare_between <span class="skolem">x1</span> <span class="bound">x</span> <span class="skolem">x2</span> <span class="main">∨</span>
                      poincare_between <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> **<span class="main">(</span>6<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> poincare_on_line_def poincare_in_angle_def poincare_ray_meets_line_def poincare_on_ray_def
      <span class="keyword1"><span class="command">using</span></span> poincare_collinear3_iff<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="skolem">x1</span></span> <span class="quoted"><span class="skolem">x2</span></span><span class="main">]</span> poincare_between_rev *<span class="main">(</span>2<span class="main">,</span> 3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">a1</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc<span class="main">}</span><span class="main">.</span>
           <span class="main">∃</span><span class="bound">a2</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc<span class="main">}</span><span class="main">.</span>
             <span class="main">¬</span> <span class="main">(</span>poincare_between <span class="skolem">a</span> <span class="bound">a1</span> <span class="bound">a2</span> <span class="main">∨</span> poincare_between <span class="bound">a1</span> <span class="skolem">a</span> <span class="bound">a2</span> <span class="main">∨</span> poincare_between <span class="bound">a1</span> <span class="bound">a2</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc<span class="main">}</span><span class="main">.</span>
                    <span class="main">(</span>poincare_between <span class="skolem">a</span> <span class="bound">x</span> <span class="bound">a1</span> <span class="main">∨</span>
                     poincare_between <span class="skolem">a</span> <span class="bound">a1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="main">(</span>poincare_between <span class="bound">x</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">∨</span>
                     poincare_between <span class="skolem">x1</span> <span class="bound">x</span> <span class="skolem">x2</span> <span class="main">∨</span>
                     poincare_between <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc<span class="main">}</span><span class="main">.</span>
                    <span class="main">(</span>poincare_between <span class="skolem">a</span> <span class="bound">x</span> <span class="bound">a2</span> <span class="main">∨</span>
                     poincare_between <span class="skolem">a</span> <span class="bound">a2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                    <span class="main">(</span>poincare_between <span class="bound">x</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">∨</span>
                     poincare_between <span class="skolem">x1</span> <span class="bound">x</span> <span class="skolem">x2</span> <span class="main">∨</span>
                     poincare_between <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">a'</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc<span class="main">}</span><span class="main">.</span>
                 <span class="skolem">a</span> <span class="main">≠</span> <span class="bound">a1</span> <span class="main">∧</span>
                 <span class="skolem">a</span> <span class="main">≠</span> <span class="bound">a2</span> <span class="main">∧</span>
                 <span class="bound">a'</span> <span class="main">≠</span> <span class="skolem">a</span> <span class="main">∧</span>
                 <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc<span class="main">}</span><span class="main">.</span>
                     poincare_between <span class="bound">a1</span> <span class="bound">x</span> <span class="bound">a2</span> <span class="main">∧</span>
                     <span class="bound">x</span> <span class="main">≠</span> <span class="bound">a1</span> <span class="main">∧</span>
                     <span class="bound">x</span> <span class="main">≠</span> <span class="bound">a2</span> <span class="main">∧</span>
                     <span class="main">(</span>poincare_between <span class="skolem">a</span> <span class="bound">a'</span> <span class="bound">x</span> <span class="main">∨</span>
                      poincare_between <span class="skolem">a</span> <span class="bound">x</span> <span class="bound">a'</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
                 <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> unit_disc<span class="main">}</span><span class="main">.</span>
                     <span class="main">(</span>poincare_between <span class="skolem">a</span> <span class="bound">x</span> <span class="bound">a'</span> <span class="main">∨</span>
                      poincare_between <span class="skolem">a</span> <span class="bound">a'</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>
                     <span class="main">(</span>poincare_between <span class="bound">x</span> <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="main">∨</span>
                      poincare_between <span class="skolem">x1</span> <span class="bound">x</span> <span class="skolem">x2</span> <span class="main">∨</span>
                      poincare_between <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> **<span class="main">(</span>1<span class="main">,</span> 2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> PoincareElementaryTarskiHyperbolic<span class="main">:</span> ElementaryTarskiHyperbolic <span class="quoted">p_congruent</span> <span class="quoted">p_between</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 12.  Continuity ›</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">φ</span> <span class="skolem">ψ</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">φ</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="bound">y</span> <span class="main">⟶</span> p_between <span class="bound">a</span> <span class="bound">x</span> <span class="bound">y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">b</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">y</span><span class="main">.</span> <span class="skolem">φ</span> <span class="bound">x</span> <span class="main">∧</span> <span class="skolem">ψ</span> <span class="bound">y</span> <span class="main">⟶</span> p_between <span class="bound">x</span> <span class="bound">b</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">transfer</span>
    <span class="keyword1"><span class="command">using</span></span> continuity
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>