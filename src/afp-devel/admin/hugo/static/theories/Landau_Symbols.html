<div id="Group_Sort">
<div class="head">
<h1>Theory Group_Sort</h1>
</div>
<pre class="source"><span class="comment1">(*
  File: Group_Sort.thy
  Author: Manuel Eberl &lt;eberlm@in.tum.de&gt;

  A sorting algorithm that sorts values according to a key function and groups equivalent 
  elements using a commutative and associative binary operation.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Sorting and grouping factors›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Group_Sort
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For the reification of products of powers of primitive functions such as
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">ln</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">^</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> into a canonical form, we need to be able to sort the factors 
  according to the growth of the primitive function it contains and merge terms with the same 
  function by adding their exponents. The following locale defines such an operation in a 
  general setting; we can then instantiate it for our setting.

  The locale takes as parameters a key function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> that sends list elements into a 
  linear ordering that determines the sorting order, a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">merge</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> function to merge to 
  equivalent (w.r.t. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>) elements into one, and a list reduction function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">g</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
  that reduces a list to a single value. This function must be invariant w.r.t. the order of 
  list elements and be compatible with merging of equivalent elements. In our case, this list 
  reduction function will be the product of all list elements.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> groupsort <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>linorder<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">merge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'c</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f_merge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="free">merge</span> <span class="free">x</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"mset <span class="free">xs</span> <span class="main">=</span> mset <span class="free">ys</span> <span class="main">⟹</span> <span class="free">g</span> <span class="free">xs</span> <span class="main">=</span> <span class="free">g</span> <span class="free">ys</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_merge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">[</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">]</span> <span class="main">=</span> <span class="free">g</span> <span class="main">[</span><span class="free">merge</span> <span class="free">x</span> <span class="free">y</span><span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_append_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">xs1</span> <span class="main">=</span> <span class="free">g</span> <span class="free">xs2</span> <span class="main">⟹</span> <span class="free">g</span> <span class="free">ys1</span> <span class="main">=</span> <span class="free">g</span> <span class="free">ys2</span> <span class="main">⟹</span> <span class="free">g</span> <span class="main">(</span><span class="free">xs1</span> <span class="main">@</span> <span class="free">ys1</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">xs2</span> <span class="main">@</span> <span class="free">ys2</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">function</span></span> <span class="entity">part_aux</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">part_aux</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">[]</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="free">part_aux</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">part_aux</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="free">part_aux</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">part_aux</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="free">part_aux</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">part_aux</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">@</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">P</span> <span class="skolem">p</span> <span class="skolem">xs</span> <span class="skolem">ls</span> <span class="skolem">eq</span> <span class="skolem">gs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs'</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"Wellfounded.measure <span class="main">(</span>size <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> groupsort_locale<span class="main">:</span> <span class="quoted"><span class="quoted">"groupsort <span class="free">f</span> <span class="free">merge</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemmas</span></span> part_aux_induct <span class="main">=</span> part_aux.induct<span class="main">[</span><span class="operator">split_format</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">complete</span><span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">OF</span> groupsort_locale<span class="main">]</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">part</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">part</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> part_aux <span class="main">(</span><span class="free">f</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> part<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"part <span class="free">p</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>rev <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">,</span> 
     <span class="free">p</span> <span class="main">#</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="free">xs</span><span class="main">,</span> rev <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">xs</span> <span class="skolem">ls</span> <span class="skolem">eq</span> <span class="skolem">gs</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>part_aux <span class="skolem">p</span> <span class="skolem">xs</span> <span class="main">(</span><span class="skolem">ls</span><span class="main">,</span> <span class="skolem">eq</span><span class="main">,</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">ls</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="skolem">ls</span></span> <span class="quoted"><span class="skolem">eq</span></span> <span class="quoted"><span class="skolem">gs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> part_aux_induct<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> A <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">xs</span> <span class="skolem">ls</span> <span class="skolem">eq</span> <span class="skolem">gs</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>part_aux <span class="skolem">p</span> <span class="skolem">xs</span> <span class="main">(</span><span class="skolem">ls</span><span class="main">,</span> <span class="skolem">eq</span><span class="main">,</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">gs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="skolem">ls</span></span> <span class="quoted"><span class="skolem">eq</span></span> <span class="quoted"><span class="skolem">gs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> part_aux_induct<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> B <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">xs</span> <span class="skolem">ls</span> <span class="skolem">eq</span> <span class="skolem">gs</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>part_aux <span class="skolem">p</span> <span class="skolem">xs</span> <span class="main">(</span><span class="skolem">ls</span><span class="main">,</span> <span class="skolem">eq</span><span class="main">,</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">eq</span> <span class="main">@</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">xs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="skolem">ls</span></span> <span class="quoted"><span class="skolem">eq</span></span> <span class="quoted"><span class="skolem">gs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> part_aux_induct<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> C <span class="main">=</span> this
  <span class="keyword1"><span class="command">note</span></span> ABC <span class="main">=</span> A B C
  <span class="keyword1"><span class="command">from</span></span> ABC<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">f</span></span></span> <span class="free"><span class="free"><span class="free">p</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[]</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[</span></span></span><span class="free"><span class="free"><span class="free">p</span></span></span><span class="main"><span class="main"><span class="main">]</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[]</span></span></span>"</span></span></span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> part_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_eqI<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">function</span></span> <span class="entity">sort</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sort</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">sort</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> part <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ls</span><span class="main">,</span> <span class="bound">eq</span><span class="main">,</span> <span class="bound">gs</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">sort</span> <span class="bound">ls</span> <span class="main">@</span> <span class="bound">eq</span> <span class="main">@</span> <span class="free">sort</span> <span class="bound">gs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"Wellfounded.measure length"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> part less_Suc_eq_le<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> filter_mset_union<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈#</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">⟹</span> False"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filter_mset <span class="free">P</span> <span class="free">A</span> <span class="main">+</span> filter_mset <span class="free">Q</span> <span class="free">A</span> <span class="main">=</span> filter_mset <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">∨</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="free">A</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">=</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> count_eq_zero_iff <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> multiset_eqI<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> multiset_of_sort<span class="main">:</span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span>sort <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> mset <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sort.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">oper</span><span class="main">.</span> <span class="main">{#</span><span class="bound">y</span><span class="main">:#</span> mset <span class="skolem">xs</span><span class="main">.</span> <span class="bound">oper</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">#}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mset <span class="main">(</span>sort <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?M</span> <span class="main">(&lt;)</span> <span class="main">+</span> <span class="var">?M</span> <span class="main">(=)</span> <span class="main">+</span> <span class="var">?M</span> <span class="main">(&gt;)</span> <span class="main">+</span> <span class="main">{#</span><span class="skolem">x</span><span class="main">#}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> part Multiset.union_assoc mset_filter<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">(&lt;)</span> <span class="main">+</span> <span class="var">?M</span> <span class="main">(=)</span> <span class="main">+</span> <span class="var">?M</span> <span class="main">(&gt;)</span> <span class="main">=</span> mset <span class="skolem">xs</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="main">(</span><span class="operator">subst</span> filter_mset_union<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> multiset_eq_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> g_sort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>sort <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> g_cong multiset_of_sort<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> set_sort<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>sort <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> set <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> arg_cong<span class="main">[</span><span class="operator">OF</span> multiset_of_sort<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">xs</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"set_mset"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> set_mset_mset<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> sorted_all_equal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span> <span class="main">⟹</span> sorted <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> sorted_sort<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>sort <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> sort.induct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sorted_append sort.simps part map_append split<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> conjI TrueI<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> sorted_map_same <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_sort<span class="main">)</span>



<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">fun</span></span> <span class="entity">group</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">group</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">group</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> partition <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">xs'</span><span class="main">,</span> <span class="bound">xs''</span><span class="main">)</span> <span class="main">⇒</span> 
                     fold <span class="free">merge</span> <span class="bound">xs'</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free">group</span> <span class="bound">xs''</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> f_fold_merge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span>fold <span class="free">merge</span> <span class="free">xs</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_induct<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_merge<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> f_group<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>group <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x'</span><span class="main">∈</span>set <span class="free">xs</span><span class="main">.</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> group.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x'</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> fold <span class="free">merge</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x'</span><span class="main">]</span> <span class="skolem">x'</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>group <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x'</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> fold <span class="free">merge</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x'</span><span class="main">]</span> <span class="skolem">x'</span>"</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">...</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> f_fold_merge<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> set <span class="main">(</span>group <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x'</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x'</span><span class="main">∈</span>set <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x'</span><span class="main">]</span><span class="main">.</span> <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> sorted_group<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> sorted <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>group <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> group.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x'</span> <span class="keyword3"><span class="command">assume</span></span> x'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">∈</span> set <span class="main">(</span>group <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> f_group <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x''</span></span> <span class="keyword2"><span class="keyword">where</span></span> x''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x''</span> <span class="main">∈</span> set <span class="skolem">xs</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x'</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>fold <span class="free">merge</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> f_fold_merge<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span> x'' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>fold <span class="free">merge</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>group <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> 2 sorted_filter<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> distinct_group<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>group <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> group.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>group <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> 2<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span>fold <span class="free">merge</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>group <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> f_fold_merge<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> f_group<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> g_fold_same<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>fold <span class="free">merge</span> <span class="free">xs</span> <span class="free">x</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="free">x</span><span class="main">#</span><span class="free">xs</span><span class="main">@</span><span class="free">ys</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">y</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> g_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">#</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">x</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">...</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="main">[</span><span class="free">merge</span> <span class="skolem">y</span> <span class="skolem">x</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> g_append_cong g_merge<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">merge</span> <span class="skolem">y</span> <span class="skolem">x</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ys</span> <span class="main">=</span> <span class="free">merge</span> <span class="skolem">y</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span> <span class="main">@</span> <span class="free">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">...</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>fold <span class="free">merge</span> <span class="skolem">xs</span> <span class="main">(</span><span class="free">merge</span> <span class="skolem">y</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> Cons.IH<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f_merge<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>fold <span class="free">merge</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">#</span> <span class="free">ys</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> g_group<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>group <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> group.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>group <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span>fold <span class="free">merge</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span> <span class="skolem">x</span> <span class="main">#</span> group <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span> <span class="main">@</span> group <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> g_fold_same<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> group <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">=</span> <span class="var">?A</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>group <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> g_append_cong<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">g</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> g_cong<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">function</span></span> <span class="entity">group_part_aux</span> <span class="main">::</span> 
  <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> list<span class="main">)</span>"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">group_part_aux</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">[]</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="free">group_part_aux</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">group_part_aux</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="free">group_part_aux</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">group_part_aux</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">⟹</span> <span class="free">group_part_aux</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">group_part_aux</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">,</span> <span class="free">merge</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">eq</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> prems<span class="main">:</span> <span class="main">(</span>1 <span class="skolem">P</span> <span class="skolem">p</span> <span class="skolem">xs</span> <span class="skolem">ls</span> <span class="skolem">eq</span> <span class="skolem">gs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">xs'</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs'</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> prems <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"Wellfounded.measure <span class="main">(</span>size <span class="main">∘</span> fst <span class="main">∘</span> snd<span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemmas</span></span> group_part_aux_induct <span class="main">=</span> 
  group_part_aux.induct<span class="main">[</span><span class="operator">split_format</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">complete</span><span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">OF</span> groupsort_locale<span class="main">]</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">group_part</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">group_part</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> group_part_aux <span class="main">(</span><span class="free">f</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> group_part<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"group_part <span class="free">p</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>rev <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">,</span> 
     fold <span class="free">merge</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="free">p</span><span class="main">,</span> rev <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="free">p</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">xs</span> <span class="skolem">ls</span> <span class="skolem">eq</span> <span class="skolem">gs</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>group_part_aux <span class="skolem">p</span> <span class="skolem">xs</span> <span class="main">(</span><span class="skolem">ls</span><span class="main">,</span> <span class="skolem">eq</span><span class="main">,</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">ls</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="skolem">ls</span></span> <span class="quoted"><span class="skolem">eq</span></span> <span class="quoted"><span class="skolem">gs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> group_part_aux_induct<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> A <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">xs</span> <span class="skolem">ls</span> <span class="skolem">eq</span> <span class="skolem">gs</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">(</span>snd <span class="main">(</span>group_part_aux <span class="skolem">p</span> <span class="skolem">xs</span> <span class="main">(</span><span class="skolem">ls</span><span class="main">,</span> <span class="skolem">eq</span><span class="main">,</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> rev <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">gs</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="skolem">ls</span></span> <span class="quoted"><span class="skolem">eq</span></span> <span class="quoted"><span class="skolem">gs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> group_part_aux_induct<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> B <span class="main">=</span> this
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">xs</span> <span class="skolem">ls</span> <span class="skolem">eq</span> <span class="skolem">gs</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">(</span>snd <span class="main">(</span>group_part_aux <span class="skolem">p</span> <span class="skolem">xs</span> <span class="main">(</span><span class="skolem">ls</span><span class="main">,</span> <span class="skolem">eq</span><span class="main">,</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
            fold <span class="free">merge</span> <span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">)</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">eq</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">xs</span></span> <span class="quoted"><span class="skolem">ls</span></span> <span class="quoted"><span class="skolem">eq</span></span> <span class="quoted"><span class="skolem">gs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> group_part_aux_induct<span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> C <span class="main">=</span> this
  <span class="keyword1"><span class="command">note</span></span> ABC <span class="main">=</span> A B C
  <span class="keyword1"><span class="command">from</span></span> ABC<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">f</span></span></span> <span class="free"><span class="free"><span class="free">p</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">xs</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[]</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">p</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">[]</span></span></span>"</span></span></span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> group_part_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> prod_eqI<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">function</span></span> <span class="entity">group_sort</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">group_sort</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">group_sort</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">case</span> group_part <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">ls</span><span class="main">,</span> <span class="bound">eq</span><span class="main">,</span> <span class="bound">gs</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">group_sort</span> <span class="bound">ls</span> <span class="main">@</span> <span class="bound">eq</span> <span class="main">#</span> <span class="free">group_sort</span> <span class="bound">gs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">pat_completeness</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">termination</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"Wellfounded.measure length"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> group_part less_Suc_eq_le<span class="main">)</span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> group_append<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="free">ys</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">f</span> <span class="bound">y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"group <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span> <span class="main">=</span> group <span class="free">xs</span> <span class="main">@</span> group <span class="free">ys</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">ys</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> length_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">xs'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> length <span class="bound">xs</span> <span class="main">&lt;</span> length <span class="skolem">xs'</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="bound">xs</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> set <span class="bound">ys</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free">f</span> <span class="bound">y</span><span class="main">)</span>
                <span class="main">⟹</span> group <span class="main">(</span><span class="bound">xs</span> <span class="main">@</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">=</span> group <span class="bound">xs</span> <span class="main">@</span> group <span class="bound">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs'</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> this
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span><span class="skolem">xs'</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span> fold <span class="free">merge</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span><span class="main">@</span><span class="skolem">ys</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span> <span class="skolem">x</span> <span class="main">#</span>
            group <span class="main">(</span><span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">ys</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span><span class="main">@</span><span class="skolem">ys</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span> <span class="main">=</span> <span class="main">[</span><span class="bound">y</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">y</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filter_empty_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">ys</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filter_id_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span><span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">ys</span><span class="main">)</span> <span class="main">=</span>
               group <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">≠</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span> <span class="main">@</span> group <span class="skolem">ys</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> IH<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_Suc_eq_le<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> o_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> group_empty_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"group <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟷</span> <span class="free">xs</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> group.induct<span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> group_sort_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"group_sort <span class="free">xs</span> <span class="main">=</span> group <span class="main">(</span>sort <span class="free">xs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> group_sort.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"group_sort <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> 
          group_sort <span class="main">(</span>rev <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> group <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span>
          group_sort <span class="main">(</span>rev <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="bound">xa</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> group_part<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"group_sort <span class="main">(</span>rev <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> group <span class="main">(</span>sort <span class="main">(</span>rev <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> group_part<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"group_sort <span class="main">(</span>rev <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> group <span class="main">(</span>sort <span class="main">(</span>rev <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> 2<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> group_part<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> group <span class="main">(</span>sort <span class="main">(</span>rev <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
             group <span class="main">(</span><span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> sort <span class="main">(</span>rev <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> group_append<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_sort<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"group <span class="main">(</span>sort <span class="main">(</span>rev <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">...</span> <span class="main">=</span> 
             group <span class="main">(</span>sort <span class="main">(</span>rev <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span>
                 sort <span class="main">(</span>rev <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> group_append<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_sort<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"sort <span class="main">(</span>rev <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">&lt;</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">x</span><span class="main">#</span><span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">@</span>
                 sort <span class="main">(</span>rev <span class="main">[</span><span class="bound">xa</span><span class="main">←</span><span class="skolem">xs</span> <span class="main">.</span> <span class="free">f</span> <span class="bound">xa</span> <span class="main">&gt;</span> <span class="free">f</span> <span class="skolem">x</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> sort <span class="main">(</span><span class="skolem">x</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> part<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">lemma</span></span> sorted_group_sort<span class="main">:</span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>group_sort <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> group_sort_correct <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sorted_group sorted_sort<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> distinct_group_sort<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map <span class="free">f</span> <span class="main">(</span>group_sort <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> group_sort_correct distinct_group<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> g_group_sort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">(</span>group_sort <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">g</span> <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> group_sort_correct g_group g_sort<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span></span></span></span><span class="main">]</span> <span class="main">=</span> group_sort.simps group_part_aux.simps

<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Landau_Real_Products">
<div class="head">
<h1>Theory Landau_Real_Products</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:   Landau_Real_Products.thy
  Author: Manuel Eberl &lt;eberlm@in.tum.de&gt;

  Mathematical background and reification for a decision procedure for Landau symbols of
  products of powers of real functions (currently the identity and the natural logarithm)

  TODO: more functions (exp?), more preprocessing (log)
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Decision procedure for real functions›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Landau_Real_Products
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../../HOL/HOL/Main.html">Main</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Function_Algebras.html">HOL-Library.Function_Algebras</a>"</span> 
  <span class="quoted">"<a href="../../HOL/HOL-Library/Set_Algebras.html">HOL-Library.Set_Algebras</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Landau_Symbols.html">HOL-Library.Landau_Symbols</a>"</span>
  <a href="Group_Sort.html">Group_Sort</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Eventual non-negativity/non-zeroness›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  For certain transformations of Landau symbols, it is required that the functions involved 
  are eventually non-negative of non-zero. In the following, we set up a system to guide the 
  simplifier to discharge these requirements during simplification at least in obvious cases.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">eventually_nonzero</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">::</span> <span class="main">_</span> <span class="main">::</span> real_normed_field<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">eventually_nonneg</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">⟷</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">::</span> <span class="main">_</span> <span class="main">::</span> linordered_field<span class="main">)</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span>"</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> eventually_nonzero_simps

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span> <span class="main">=</span> 
  eventually_nonzero_def <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> eventually_nonneg_def <span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzeroD<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually_nonzero <span class="free">F</span> <span class="free">f</span> <span class="main">⟹</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_nonzero_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_const <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonzero <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">::</span><span class="main">_</span><span class="main">::</span>linorder<span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">F</span> <span class="main">=</span> bot <span class="main">∨</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonzero_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_False<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_inverse <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonzero <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> eventually_nonzero <span class="free">F</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonzero_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_mult <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonzero <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> eventually_nonzero <span class="free">F</span> <span class="free">f</span> <span class="main">∧</span> eventually_nonzero <span class="free">F</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonzero_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_conj_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_pow <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonzero <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>linorder<span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">n</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> eventually_nonzero <span class="free">F</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">eventually_nonzero_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_divide <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonzero <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> eventually_nonzero <span class="free">F</span> <span class="free">f</span> <span class="main">∧</span> eventually_nonzero <span class="free">F</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonzero_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_conj_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_ident_at_top_linorder <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonzero at_top <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span><span class="main">{</span>real_normed_field<span class="main">,</span>linordered_field<span class="main">}</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonzero_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_ident_nhds <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonzero <span class="main">(</span>nhds <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eventually_nhds_in_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_nonzero_def open_Compl 
           <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> eventually_nhds_x_imp_x<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_ident_at_within <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonzero <span class="main">(</span><span class="keyword1">at</span> <span class="free">a</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eventually_nonzero_ident_nhds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_nonzero_def eventually_at_filter <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_ln_at_top <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonzero at_top <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonzero_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_ln_const_at_top <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> eventually_nonzero at_top <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">b</span> <span class="main">*</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonzero_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"max <span class="main"><span class="main">1</span></span> <span class="main"><span class="main">(</span></span>inverse <span class="free"><span class="free">b</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> exp_ln exp_minus exp_minus_inverse less_numeral_extra<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> ln_gt_zero max_less_iff_conj mult.commute mult_strict_right_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_ln_const'_at_top <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> eventually_nonzero at_top <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">b</span> <span class="main">::</span> real<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eventually_nonzero_ln_const_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_powr_at_top <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonzero at_top <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> eventually_nonzero at_top <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonzero_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_const <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">F</span> <span class="main">=</span> bot <span class="main">∨</span> <span class="free">c</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_False<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_inverse <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> eventually_nonneg <span class="free">F</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_subst<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_add <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_mult <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_mult' <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mult_nonpos_nonpos<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_divide <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_divide' <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> divide_nonpos_nonpos<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_ident_at_top <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonneg at_top <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_ge_at_top<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_ident_nhds <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>linorder_topology<span class="main">,</span> linordered_field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> eventually_nonneg <span class="main">(</span>nhds <span class="free">a</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def
  <span class="keyword1"><span class="command">using</span></span> eventually_nhds_in_open<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">&lt;..}</span>"</span></span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_nonneg_def <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> eventually_nhds_x_imp_x <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_ident_at_within <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>linorder_topology<span class="main">,</span> linordered_field<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> eventually_nonneg <span class="main">(</span><span class="keyword1">at</span> <span class="free">a</span> <span class="keyword1">within</span> <span class="free">A</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eventually_nonneg_ident_nhds<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_nonneg_def eventually_at_filter <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_pow <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">f</span> <span class="main">⟹</span> eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">eventually_nonzero_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_powr <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_nonneg_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_ln_at_top <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually_nonneg at_top <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span>
           <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_nonneg_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_ln_const <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> eventually_nonneg at_top <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def <span class="keyword1"><span class="command">using</span></span> eventually_ge_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="free">b</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_ln_const' <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> eventually_nonneg at_top <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="bound">x</span><span class="main">*</span><span class="free">b</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> eventually_nonneg_ln_const<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">b</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_bigtheta'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> eventually_nonzero <span class="free">F</span> <span class="free">f</span> <span class="main">⟷</span> eventually_nonzero <span class="free">F</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonzero_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> eventually_nonzero_bigtheta<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_at_top<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_at_top<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> <span class="main">::</span> <span class="main">{</span>linordered_field<span class="main">,</span> real_normed_field<span class="main">}</span><span class="main">)</span> at_top <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually_nonzero <span class="free">F</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonzero_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_at_top_ASSUMPTION <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ASSUMPTION <span class="main">(</span>filterlim <span class="free">f</span> at_top <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> eventually_nonneg <span class="free">F</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ASSUMPTION_def eventually_nonneg_at_top<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonzero_at_top_ASSUMPTION <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"ASSUMPTION <span class="main">(</span>filterlim <span class="free">f</span> <span class="main">(</span>at_top <span class="main">::</span> <span class="tfree">'a</span> <span class="main">::</span> <span class="main">{</span>linordered_field<span class="main">,</span> real_normed_field<span class="main">}</span> filter<span class="main">)</span> <span class="free">F</span><span class="main">)</span> <span class="main">⟹</span> 
     eventually_nonzero <span class="free">F</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eventually_nonzero_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">F</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ASSUMPTION_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> filterlim_at_top_iff_smallomega<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">ω[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> eventually_nonneg <span class="free">F</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">eventually_nonzero_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span>
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_at_infinity_imp_norm_at_top filterlim_at_top_imp_at_infinity<span class="main">)</span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">ω[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_omega.smallI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">ω[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> landau_omega.smallD<span class="main">[</span><span class="operator">OF</span> A this<span class="main">]</span> B 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="skolem">c</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_at_top_gt<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> smallomega_1_iff<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">f</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">ω[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">⟷</span> filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top_iff_smallomega<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> smallo_1_iff<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">f</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top_iff_smallomega smallomega_iff_smallo<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_add1 <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  landau_o.smallD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_less_one<span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_add2 <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  landau_o.smallD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_less_one<span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_diff1 <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  landau_o.smallD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_less_one<span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_diff2 <span class="main">[</span><span class="operator">eventually_nonzero_simps</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  landau_o.smallD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> zero_less_one<span class="main">]</span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Rewriting Landau symbols›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_mult_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> set_times_elim<span class="main"><span class="keyword3">,</span></span> <span class="operator">hypsubst</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> func_times<span class="main">)</span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> landau_theta.mult<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> c1 c2 <span class="main">::</span> <span class="quoted">real</span> <span class="keyword1"><span class="command">unfolding</span></span> bigtheta_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> landau_o.bigE landau_omega.bigE IntE<span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> c <span class="main">=</span> this

  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h1</span></span> <span class="skolem"><span class="skolem">h2</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h1</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="skolem">h</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">h</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="free">f</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="skolem">h</span> <span class="skolem">x</span> <span class="main">/</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="skolem">h</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="skolem">h</span> <span class="skolem">x</span> <span class="main">/</span> <span class="free">f</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="skolem">h1</span> <span class="main">*</span> <span class="skolem">h2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h1_def h2_def <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h1</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bigthetaI'<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> c<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"min <span class="skolem">c2</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> c<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"max <span class="skolem">c1</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> c<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> min <span class="skolem">c2</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">h1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> 
                            norm <span class="main">(</span><span class="skolem">h1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> max <span class="skolem">c1</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm <span class="main">(</span><span class="skolem">h</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
               <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm <span class="main">(</span><span class="skolem">h</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">c2</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="skolem">c2</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="skolem">c2</span> <span class="main">1</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> B
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">h1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≥</span> min <span class="skolem">c2</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m A
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h1_def norm_mult norm_divide <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

      <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> max <span class="skolem">c1</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">note</span></span> A
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> max <span class="skolem">c1</span> <span class="main">1</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">h1</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> max <span class="skolem">c1</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m A
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h1_def norm_mult norm_divide <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> bigthetaI'<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> c<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"min <span class="skolem">c2</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> c<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"max <span class="skolem">c1</span> <span class="main">1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> c<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> min <span class="skolem">c2</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span>  
                            norm <span class="main">(</span><span class="skolem">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> max <span class="skolem">c1</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">eventually_elim</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm <span class="main">(</span><span class="skolem">h</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c1</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
               <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>norm <span class="main">(</span><span class="skolem">h</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">c2</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"min <span class="skolem">c2</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"min <span class="skolem">c2</span> <span class="main">1</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c2</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> B
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">h2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≥</span> min <span class="skolem">c2</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m A B
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> h2_def abs_mult <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

      <span class="keyword1"><span class="command">have</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> max <span class="skolem">c1</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">note</span></span> A
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c1</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> max <span class="skolem">c1</span> <span class="main">1</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> mult_right_mono<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"norm <span class="main">(</span><span class="skolem">h2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> max <span class="skolem">c1</span> <span class="main">1</span> <span class="main">*</span> <span class="main">(</span>norm <span class="main">(</span><span class="free">g</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m A
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> h2_def abs_mult <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span> <span class="main">*</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Since the simplifier does not currently rewriting with relations other than equality,
  but we want to rewrite terms like <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">Θ(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> log <span class="numeral"><span class="numeral">2</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">*</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">Θ(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> ln <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">*</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
  we need to bring the term into something that contains <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">Θ(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> log <span class="numeral"><span class="numeral">2</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">Θ(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, which can then be rewritten individually.
  For this, we introduce the following constants and rewrite rules. The rules are mainly used 
  by the simprocs, but may be useful for manual reasoning occasionally.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">set_mult</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">set_inverse</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">|</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">set_divide</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">|</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">set_pow</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">^</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">|</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">set_powr</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">|</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_mult_eq_set_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> set_mult <span class="main">(</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> bigtheta_mult_eq set_mult_def set_times_def func_times <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_inverse_eq_set_inverse<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set_inverse <span class="main">(</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span>inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> bigtheta_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span>inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> set_inverse <span class="main">(</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_inverse_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> set_inverse <span class="main">(</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="skolem">g'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g'</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_inverse_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="skolem">g'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> bigtheta_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="skolem">g'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="skolem">g'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_divide_inverse<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"set_divide <span class="main">(</span><span class="free">A</span> <span class="main">::</span> <span class="main">(</span><span class="main">_</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">_</span> <span class="main">::</span> division_ring<span class="main">)</span><span class="main">)</span> set<span class="main">)</span> <span class="free">B</span> <span class="main">=</span> set_mult <span class="free">A</span> <span class="main">(</span>set_inverse <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set_divide <span class="free">A</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_divide_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set_inverse <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_inverse_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> divide_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set_mult <span class="free">A</span> <span class="main">(</span>set_inverse <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set_mult <span class="free">A</span> <span class="main">(</span>set_inverse <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="skolem">g</span> <span class="main">*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">B</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> set_times_def set_inverse_def set_mult_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">/</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="free">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">h</span> <span class="main">∈</span> <span class="free">B</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set_divide <span class="free">A</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> set_divide_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_divide_eq_set_divide<span class="main">:</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> set_divide <span class="main">(</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> set_divide_inverse divide_inverse bigtheta_mult_eq_set_mult 
                 bigtheta_inverse_eq_set_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">bigtheta_pow</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bigtheta_pow</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="keyword1">Θ[</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">bigtheta_pow</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> set_mult <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">(</span><span class="free">bigtheta_pow</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_pow_eq_set_pow<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> bigtheta_pow <span class="free">F</span> <span class="main">(</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bigtheta_mult_eq_set_mult<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bigtheta_powr</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">bigtheta_powr</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">g</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> eventually_nonneg <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">g</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">}</span> 
     <span class="keyword1">else</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="main">∃</span><span class="bound">g</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> eventually_nonneg <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="bound">g</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>norm <span class="main">(</span><span class="bound">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_powr_eq_set_powr<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">y</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span> <span class="main">=</span> bigtheta_powr <span class="free">F</span> <span class="main">(</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> bigtheta_powr <span class="free">F</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="skolem">g</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bigtheta_powr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">note</span></span> this<span class="main">(</span>3<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bigtheta_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> g<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">∈</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span><span class="main">.</span> eventually_nonneg <span class="free">F</span> <span class="bound">g</span> <span class="main">∧</span> <span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> conjI<span class="main">)</span> <span class="operator">simp_all</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> bigtheta_powr <span class="free">F</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bigtheta_powr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> equalityI subsetI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?h'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> inverse <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> bigtheta_powr<span class="main">[</span><span class="operator">OF</span> h<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="free">y</span>"</span></span><span class="main">]</span> y
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h'</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?h'</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">with</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span><span class="main">∈</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span><span class="main">.</span> eventually_nonneg <span class="free">F</span> <span class="bound">g</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>norm <span class="main">(</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bexI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?h'</span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr eventually_nonneg_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> bigtheta_powr <span class="free">F</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">unfolding</span></span> bigtheta_powr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> bigtheta_powr <span class="free">F</span> <span class="main">(</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> y <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">=</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">y</span>"</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bigtheta_powr_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bigtheta_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> A<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemmas</span></span> bigtheta_factors_eq <span class="main">=</span> 
  bigtheta_mult_eq_set_mult bigtheta_inverse_eq_set_inverse bigtheta_divide_eq_set_divide 
  bigtheta_pow_eq_set_pow bigtheta_powr_eq_set_powr

<span class="keyword1"><span class="command">lemmas</span></span> landau_bigtheta_congs <span class="main">=</span> landau_symbols<span class="main">[</span><span class="operator">THEN</span> landau_symbol.cong_bigtheta<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> landau_symbol<span class="main">)</span> meta_cong_bigtheta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span> <span class="main">≡</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">L</span> <span class="free">F</span> <span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">≡</span> <span class="free">L</span> <span class="free">F</span> <span class="main">(</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bigtheta_refl<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eq_reflection cong_bigtheta<span class="main">)</span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemmas</span></span> landau_bigtheta_meta_congs <span class="main">=</span> landau_symbols<span class="main">[</span><span class="operator">THEN</span> landau_symbol.meta_cong_bigtheta<span class="main">]</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminary facts›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> real_powr_at_top<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> at_top at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">subst</span> filterlim_cong<span class="main"><span class="main">[</span></span><span class="operator">OF</span> refl refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> exp <span class="main">(</span><span class="free">p</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exp_at_top filterlim_tendsto_pos_mult_at_top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_at_top assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">=</span> exp <span class="main">(</span><span class="free">p</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_ln_over_powr<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lhospital_at_top_at_top<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">:&gt;</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> real_powr_at_top<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span>ln <span class="keyword1">has_real_derivative</span> <span class="main">(</span>inverse <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span> DERIV_ln <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> <span class="free">a</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="free">a</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">a</span> <span class="main">=</span> inverse <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_diff powr_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="free">a</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">a</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_mult_right_zero tendsto_neg_powr filterlim_ident<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> tendsto_cong<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_ln_powr_over_powr<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">/</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">b</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">/</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span><span class="main">/</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_divide powr_powr<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">&lt;</span> ln <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span> <span class="main">/</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">::</span>real"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> eventually_mono<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>ln <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">b</span><span class="main">/</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_zero_powrI tendsto_ln_over_powr<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> tendsto_cong<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_ln_powr_over_powr'<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">/</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">b</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_sandwich<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span><span class="main"><span class="main">::</span></span>real<span class="main"><span class="main">.</span></span> <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">≤</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_at_top_linorder
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI exI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="main">::</span> <span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> exp <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> exp <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">x</span> <span class="main">≥</span> ln <span class="main">(</span>exp <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ln_le_cancel_iff<span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">≤</span> ln <span class="main">(</span>exp <span class="main">1</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> powr_mono2'<span class="main">)</span> <span class="operator">simp_all</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"ln <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">a</span> <span class="main">/</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">b</span> <span class="main">≤</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">b</span><span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> a<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span> powr_minus divide_right_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filterlim_ident tendsto_neg_powr assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_ln_powr_over_powr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_ln_over_ln<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> lhospital_at_top_at_top<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">LIM</span> <span class="bound">x</span> at_top<span class="main">.</span> ln <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">:&gt;</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ln_at_top<span class="main"><span class="main">]</span></span> filterlim_tendsto_pos_mult_at_top<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_const<span class="main"><span class="main">]</span></span> 
              filterlim_ident assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> <span class="main">(</span>inverse <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="free">a</span>"</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">has_real_derivative</span> <span class="main">(</span>inverse <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">at</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="free">c</span>"</span></span><span class="main">]</span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">derivative_eq_intros</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> inverse <span class="bound">x</span> <span class="main">/</span> inverse <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> tendsto_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="bound"><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_ln_powr_over_ln_powr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">d</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">d</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">d</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">d</span> <span class="main">=</span> <span class="main">(</span>ln <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">d</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span>inverse <span class="free">a</span><span class="main">)</span> <span class="main">(</span>inverse <span class="free">c</span><span class="main">)</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_divide <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>ln <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">d</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_eq_rhs<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_powr<span class="main"><span class="main">[</span></span><span class="operator">OF</span> tendsto_ln_over_ln tendsto_const<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> tendsto_cong<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_ln_powr_over_ln_powr'<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">d</span> <span class="main">/</span> ln <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">d</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tendsto_ln_powr_over_ln_powr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">d</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_ln_powr_over_ln_powr''<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">d</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">d</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tendsto_ln_powr_over_ln_powr<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_const_ln_powr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">d</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_tendsto<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> tendsto_ln_powr_over_ln_powr''<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_const_ln_pow <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">d</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_top<span class="main">.</span> ln <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">d</span> <span class="main">=</span> ln <span class="main">(</span><span class="free">a</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> real <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">a</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> a<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> powr_realpow<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="free">d</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> real <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bigthetaI_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> real <span class="free">d</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> real <span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_top<span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> real <span class="free">d</span> <span class="main">=</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">subst</span> powr_realpow<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> real <span class="free">d</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bigthetaI_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_const_ln <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="main">(</span><span class="free">a</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> tendsto_ln_over_ln<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_tendsto<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp_all</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  If there are two functions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">g</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> where any power of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">g</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is
  asymptotically smaller than <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, propositions like <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">^</span></span> <span class="free"><span class="free">p1</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">^</span></span> <span class="free"><span class="free">q1</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span>
  <span class="keyword1"><span class="keyword1">O(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">^</span></span> <span class="free"><span class="free">p2</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">^</span></span> <span class="free"><span class="free">q2</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> can be decided just by looking at the exponents:
  the proposition is true iff <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">p1</span></span> <span class="main"><span class="main">&lt;</span></span> <span class="free"><span class="free">p2</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> or <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">p1</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">p2</span></span> <span class="main"><span class="main">∧</span></span> <span class="free"><span class="free">q1</span></span> <span class="main"><span class="main">≤</span></span> <span class="free"><span class="free">q2</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

  The functions <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> ln <span class="bound"><span class="bound">x</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> ln <span class="main"><span class="main">(</span></span>ln <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, $\ldots$
  form a chain in which every function dominates all succeeding functions in the above sense,
  allowing to decide propositions involving Landau symbols and functions that are products of
  powers of functions from this chain by reducing the proposition to a statement involving only
  logical connectives and comparisons on the exponents.

  We will now give the mathematical background for this and implement reification to bring
  functions from this class into a canonical form, allowing the decision procedure to be
  implemented in a simproc.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Decision procedure›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">powr_closure</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="bound">p</span> <span class="main">::</span> real <span class="main">|</span><span class="bound">p</span><span class="main">.</span> True<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> powr_closureI <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> powr_closure <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> powr_closure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> powr_closureE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> powr_closure <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> powr_closure_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


<span class="keyword1"><span class="command">locale</span></span> landau_function_family <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> filter"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">H</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> real<span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> F_nontrivial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> linear<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">h2</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">h1</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">h2</span><span class="main">)</span> <span class="main">∨</span> <span class="free">h2</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">h1</span><span class="main">)</span> <span class="main">∨</span> <span class="free">h1</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">h2</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mult<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">h2</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">h1</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> inverse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> div<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">h2</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">h1</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> divide_inverse<span class="main">)</span> <span class="main">(</span><span class="operator">intro</span> mult inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">drule</span> pos<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> landau_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">h2</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">h1</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">h2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> linear<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> small_big_antisym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">h2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">h1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">False</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> nonzero<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> nonzero<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> landau_o.small_big_asymmetric<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">::</span><span class="tfree">'a</span><span class="main">.</span> False<span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_False F_nontrivial<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> small_antisym<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">h2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">h1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> small_big_antisym landau_o.small_imp_big<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">locale</span></span> landau_function_family_pair <span class="main">=</span>
  G<span class="main">:</span> landau_function_family <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">G</span></span> <span class="main">+</span> H<span class="main">:</span> landau_function_family <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">H</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">F</span> <span class="free">G</span> <span class="free">H</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">g</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gs_dominate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">g2</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">h1</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">h2</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">g1</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span> <span class="main">⟹</span>
     <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">h1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g2</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">h2</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g_dominates<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> GH<span class="main">:</span> landau_function_family <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">*</span> <span class="free">H</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">elim</span> set_times_elim<span class="main"><span class="keyword3">;</span></span> <span class="operator">hypsubst</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> G.pos<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> H.pos<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g</span><span class="main">*</span><span class="skolem">h</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="skolem">h</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="main">(</span><span class="skolem">g</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">*</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> G.inverse H.inverse set_times_intro<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="main">(</span><span class="skolem">g</span> <span class="main">*</span> <span class="skolem">h</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">*</span> <span class="free">H</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g1</span> <span class="skolem">g2</span> <span class="skolem">h1</span> <span class="skolem">h2</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h1</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> gs_dominate<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> gs_dominate<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
       G.linear<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> H.linear<span class="main">[</span><span class="operator">OF</span> this<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">*</span> <span class="skolem">h1</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="skolem">g2</span> <span class="main">*</span> <span class="skolem">h2</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">g2</span> <span class="main">*</span> <span class="skolem">h2</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="skolem">g1</span> <span class="main">*</span> <span class="skolem">h1</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">g1</span> <span class="main">*</span> <span class="skolem">h1</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="skolem">g2</span> <span class="main">*</span> <span class="skolem">h2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> func_times bigomega_iff_bigo <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> landau_theta.mult
         landau_o.small.mult landau_o.small_big_mult landau_o.big_small_mult<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g1</span> <span class="main">*</span> <span class="skolem">h1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g2</span> <span class="main">*</span> <span class="skolem">h2</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">g1</span> <span class="main">*</span> <span class="skolem">g2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">h1</span> <span class="main">*</span> <span class="skolem">h2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> func_times mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">g1</span> <span class="main">*</span> <span class="skolem">h1</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g2</span> <span class="main">*</span> <span class="skolem">h2</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">*</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> B<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> set_times_intro<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> G.mult H.mult <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> func_times<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span> G.F_nontrivial<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> smallo_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">h1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g2</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span>
             <span class="free">g1</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">g1</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">h2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> G.landau_cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> gs_dominate assms<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">g1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> bigtheta_sym<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> bigthetaD1<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∉</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> G.small_big_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g2</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">h2</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.small.cong_bigtheta landau_theta.mult_right<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> bigtheta_sym<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> G.nonzero<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> A
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> landau_o.small.mult_cancel_left<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> gs_dominate<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">*</span> <span class="free">h2</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g1</span> <span class="main">*</span> <span class="free">h1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> func_times<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∉</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∉</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms A
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> G.small_antisym G.small_big_antisym <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bigomega_iff_bigo<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="var">?P</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> notI GH.small_antisym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ B<span class="main"><span class="main">]</span></span> set_times_intro<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> func_times assms<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigo_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">h1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g2</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span>
             <span class="free">g1</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">g1</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">h2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⟷</span> <span class="var">?Q</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> G.landau_cases<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">,</span></span></span>2<span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> gs_dominate assms landau_o.small_imp_big<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g2</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∉</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> G.small_big_antisym<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> gs_dominate<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">,</span></span>1<span class="main"><span class="main">,</span></span>4<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span> A<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g2</span><span class="main">*</span><span class="free">h2</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g1</span><span class="main">*</span><span class="free">h1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> func_times<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span><span class="main">*</span><span class="free">h1</span> <span class="main">∉</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">*</span><span class="free">h2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> GH.small_big_antisym assms<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> func_times <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> landau_o.small_imp_big<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∉</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bigtheta_def <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> G.small_big_antisym <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bigomega_iff_bigo<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g2</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">h2</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> landau_o.big.cong_bigtheta<span class="main"><span class="main">[</span></span><span class="operator">OF</span> landau_theta.mult_right<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> A G.nonzero<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> landau_o.big.mult_cancel_left eventually_nonzero_bigtheta<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">g1</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">g2</span> <span class="main">∈</span> <span class="free">G</span> <span class="main">⟹</span> <span class="free">h1</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span> <span class="free">h2</span> <span class="main">∈</span> <span class="free">H</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">h1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g2</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">h2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">g1</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">h2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bigtheta_def bigo_iff bigomega_iff_bigo <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> landau_o.small_imp_big
           <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> G.small_antisym G.small_big_antisym<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">lemma</span></span> landau_function_family_powr_closure<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> bot"</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"landau_function_family <span class="free">F</span> <span class="main">(</span>powr_closure <span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">elim</span> powr_closureE<span class="main"><span class="keyword3">;</span></span> <span class="operator">hypsubst</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> filterlim_at_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">q</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∨</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">q</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∨</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
       <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> smalloI_tendsto tendsto_neg_powr <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_diff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>  assms A<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> powr_minus<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">≠</span> bot›</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> powr_closureI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> landau_function_family_pair_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"landau_function_family_pair <span class="free">Ftr</span> <span class="free">F</span> <span class="free">G</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"landau_function_family_pair <span class="free">Ftr</span> <span class="free">G</span> <span class="free">H</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"landau_function_family_pair <span class="free">Ftr</span> <span class="free">F</span> <span class="main">(</span><span class="free">G</span><span class="main">*</span><span class="free">H</span><span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> FG<span class="main">:</span> landau_function_family_pair <span class="quoted"><span class="free">Ftr</span></span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">f</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> GH<span class="main">:</span> landau_function_family_pair <span class="quoted"><span class="free">Ftr</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="free">g</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">elim</span> set_times_elim<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">;</span></span>
         <span class="main">(</span><span class="operator">unfold</span> func_times mult.assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f1</span> <span class="skolem">f2</span> <span class="skolem">g1</span> <span class="skolem">g2</span> <span class="skolem">h1</span> <span class="skolem">h2</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g2</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h1</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">∈</span> <span class="free">H</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f1</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">Ftr</span><span class="main">](</span><span class="skolem">f2</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f1</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">Ftr</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f1</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.small.mult_left GH.g_dominates<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f1</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f1</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">Ftr</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f2</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g2</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> FG.gs_dominate FG.H.mult FG.H.div GH.g<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="skolem">h2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">Ftr</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> GH.g_dominates GH.H.inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> GH.g A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f2</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g2</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">Ftr</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f2</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">g2</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h2</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FG.H.nonzero GH.H.nonzero divide_inverse
               <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> landau_o.small.mult_left <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> landau_o.small.inverse_flip<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="keyword1">o[</span><span class="free">Ftr</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f2</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h2</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f1</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">Ftr</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f2</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g2</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h2</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g1</span> <span class="skolem">h1</span> <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g1</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h1</span> <span class="main">∈</span> <span class="free">H</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">Ftr</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.small.mult_left GH.g_dominates<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">Ftr</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> FG.g_dominates FG.H.mult GH.g<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g1</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h1</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">Ftr</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FG.g<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> landau_function_family_pair_trans_powr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"landau_function_family_pair <span class="free">F</span> <span class="main">(</span>powr_closure <span class="free">g</span><span class="main">)</span> <span class="free">H</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"landau_function_family_pair <span class="free">F</span> <span class="main">(</span>powr_closure <span class="free">f</span><span class="main">)</span> <span class="main">(</span>powr_closure <span class="free">g</span> <span class="main">*</span> <span class="free">H</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> landau_function_family_pair_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">interpret</span></span> GH<span class="main">:</span> landau_function_family_pair <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="quoted">"powr_closure <span class="free">g</span>"</span></span> <span class="quoted"><span class="free">H</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">interpret</span></span> F<span class="main">:</span> landau_function_family <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="quoted">"powr_closure <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_function_family_powr_closure<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> GH.G.F_nontrivial<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"landau_function_family_pair <span class="free">F</span> <span class="main">(</span>powr_closure <span class="free">f</span><span class="main">)</span> <span class="main">(</span>powr_closure <span class="free">g</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">elim</span> powr_closureE<span class="main"><span class="keyword3">;</span></span> <span class="operator">hypsubst</span><span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> powr_closure <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> powr_closureI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span><span class="quoted">real</span>
    <span class="keyword1"><span class="command">note</span></span> assms<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> bigthetaI_cong <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">p1</span> <span class="skolem">p2</span> <span class="skolem">p3</span> <span class="main">::</span> <span class="quoted">real</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&lt;</span> <span class="skolem">p1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">p1</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="skolem">p1</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> smalloI_tendsto tendsto_neg_powr <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_diff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> F.small_antisym<span class="main">[</span><span class="operator">OF</span> _ _ this A<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_closureI<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p1</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaD1<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> F.small_big_antisym<span class="main">[</span><span class="operator">OF</span> _ _ A this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_closureI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> f_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">(</span><span class="skolem">p2</span> <span class="main">-</span> <span class="skolem">p3</span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="skolem">p1</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> smallo_powr<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">-</span> <span class="skolem">p</span>"</span></span><span class="main">]</span> p
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">p2</span> <span class="main">-</span> <span class="skolem">p3</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">p1</span> <span class="main">-</span> <span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p1</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p3</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> GH.G.nonzero<span class="main">[</span><span class="operator">OF</span> GH.g<span class="main">]</span> F.nonzero<span class="main">[</span><span class="operator">OF</span> powr_closureI<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff landau_o.small.divide_eq1
                    landau_o.small.divide_eq2 mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p1</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p3</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> f_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.small.cong_ex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p1</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dominates</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> filter <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> real<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dominates</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">](</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dominates_trans<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">F</span> <span class="free">f</span> <span class="free">g</span>"</span></span> <span class="quoted"><span class="quoted">"dominates <span class="free">F</span> <span class="free">g</span> <span class="free">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"dominates <span class="free">F</span> <span class="free">f</span> <span class="free">h</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> dominates_def
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dominates_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dominates_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">h</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">landau_dominating_chain</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">landau_dominating_chain</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span> <span class="main">⟷</span>
    dominates <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">∧</span> <span class="free">landau_dominating_chain</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">landau_dominating_chain</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">]</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">](</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">landau_dominating_chain</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">[]</span> <span class="main">⟷</span> True"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">landau_dominating_chain'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">landau_dominating_chain'</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">[]</span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">landau_dominating_chain'</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span> <span class="main">⟷</span>
    landau_function_family_pair <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">(</span>powr_closure <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="main">(</span>prod_list <span class="main">(</span>map powr_closure <span class="free"><span class="bound"><span class="entity">gs</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span>
    <span class="free">landau_dominating_chain'</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">gs</span></span></span>"</span></span>



<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">nonneg_list</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nonneg_list</span> <span class="main">[]</span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">nonneg_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">nonneg_list</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">primrec</span></span> <span class="entity">pos_list</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pos_list</span> <span class="main">[]</span> <span class="main">⟷</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pos_list</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">pos_list</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> dominating_chain_imp_dominating_chain'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Ftr</span> <span class="main">≠</span> bot <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">∈</span> set <span class="free">gs</span> <span class="main">⟹</span> filterlim <span class="bound">g</span> at_top <span class="free">Ftr</span><span class="main">)</span> <span class="main">⟹</span>
     landau_dominating_chain <span class="free">Ftr</span> <span class="free">gs</span> <span class="main">⟹</span> landau_dominating_chain' <span class="free">Ftr</span> <span class="free">gs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">gs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> landau_dominating_chain.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">F</span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">gs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> landau_function_family_pair_trans_powr <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dominates_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">F</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> F<span class="main">:</span> landau_function_family <span class="quoted"><span class="skolem">F</span></span> <span class="quoted"><span class="quoted">"powr_closure <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_function_family_powr_closure<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">o[</span><span class="skolem">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">o[</span><span class="skolem">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.small.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"landau_function_family_pair <span class="skolem">F</span> <span class="main">(</span>powr_closure <span class="skolem">f</span><span class="main">)</span> <span class="main">{</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> powr_closureI<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_fun_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">locale</span></span> landau_function_family_chain <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> filter"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">gs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_param</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">get_fun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span> <span class="main">⇒</span> real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> F_nontrivial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gs_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> set <span class="main">(</span>map <span class="free">get_fun</span> <span class="free">gs</span><span class="main">)</span> <span class="main">⟹</span> filterlim <span class="free">g</span> at_top <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> dominating_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"landau_dominating_chain <span class="free">F</span> <span class="main">(</span>map <span class="free">get_fun</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> dominating_chain'<span class="main">:</span> <span class="quoted"><span class="quoted">"landau_dominating_chain' <span class="free">F</span> <span class="main">(</span>map <span class="free">get_fun</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> dominating_chain_imp_dominating_chain' gs_pos dominating_chain F_nontrivial<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> gs_powr_0_eq_one<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">gs</span><span class="main">.</span> <span class="free">get_fun</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> gs_pos
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">gs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">g</span> <span class="skolem">gs</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">get_fun</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at_top_dense<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="skolem">gs</span><span class="main">.</span> <span class="free">get_fun</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> listmap_gs_in_listmap<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">fs</span><span class="main">.</span> <span class="free">h</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="bound">g</span><span class="main">)</span> <span class="main">∈</span> prod_list <span class="main">(</span>map powr_closure <span class="main">(</span>map <span class="free">h</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">fs</span><span class="main">.</span> <span class="free">h</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="bound">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">fs</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">h</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">induction</span> <span class="quoted"><span class="free">fs</span></span><span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">∈</span> prod_list <span class="main">(</span>map powr_closure <span class="main">(</span>map <span class="free">h</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">fs</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> list.map prod_list.Cons<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> set_times_intro<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> smallo_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">gs</span><span class="main">.</span> <span class="free">get_fun</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">get_param</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⟷</span> pos_list <span class="main">(</span>map <span class="free">get_param</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">gs</span><span class="main">.</span> <span class="free">get_fun</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">get_param</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span>
          <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">gs</span><span class="main">.</span> <span class="free">get_fun</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">gs</span><span class="main">.</span> <span class="free">get_fun</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">get_param</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> landau_o.small.in_cong gs_powr_0_eq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> gs_pos dominating_chain' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> pos_list <span class="main">(</span>map <span class="free">get_param</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">gs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'b</span><span class="main">.</span> <span class="main">1</span><span class="main">::</span>real<span class="main">)</span> <span class="main">∉</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F_nontrivial
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> landau_o.small_big_asymmetric<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">g</span> <span class="skolem">gs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> G<span class="main">:</span> landau_function_family_pair <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="quoted">"powr_closure <span class="main">(</span><span class="free">get_fun</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"prod_list <span class="main">(</span>map powr_closure <span class="main">(</span>map <span class="free">get_fun</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">get_fun</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> listmap_gs_in_listmap<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">get_fun</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">gs</span></span><span class="main">]</span> F_nontrivial
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G.smallo_iff listmap_gs_in_listmap powr_smallo_iff powr_bigtheta_iff
                   <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> powr_zero_eq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigo_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">gs</span><span class="main">.</span> <span class="free">get_fun</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">get_param</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⟷</span> nonneg_list <span class="main">(</span>map <span class="free">get_param</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">gs</span><span class="main">.</span> <span class="free">get_fun</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">get_param</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span>
          <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">gs</span><span class="main">.</span> <span class="free">get_fun</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">gs</span><span class="main">.</span> <span class="free">get_fun</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">get_param</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> landau_o.big.in_cong gs_powr_0_eq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> gs_pos dominating_chain' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> nonneg_list <span class="main">(</span>map <span class="free">get_param</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">gs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> func_one<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">g</span> <span class="skolem">gs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> G<span class="main">:</span> landau_function_family_pair <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="quoted">"powr_closure <span class="main">(</span><span class="free">get_fun</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"prod_list <span class="main">(</span>map powr_closure <span class="main">(</span>map <span class="free">get_fun</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">get_fun</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> listmap_gs_in_listmap<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">get_fun</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">gs</span></span><span class="main">]</span> F_nontrivial
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G.bigo_iff listmap_gs_in_listmap powr_smallo_iff powr_bigtheta_iff
                   <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> powr_zero_eq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">gs</span><span class="main">.</span> <span class="free">get_fun</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">get_param</span> <span class="bound">g</span><span class="main">)</span> <span class="main">⟷</span> list_all <span class="main">(</span><span class="main">(=)</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map <span class="free">get_param</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">gs</span><span class="main">.</span> <span class="free">get_fun</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">get_param</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span>
          <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">gs</span><span class="main">.</span> <span class="free">get_fun</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∏</span><span class="bound">g</span><span class="main">←</span><span class="free">gs</span><span class="main">.</span> <span class="free">get_fun</span> <span class="bound">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">get_param</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sym<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> landau_theta.in_cong gs_powr_0_eq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> gs_pos dominating_chain' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> list_all <span class="main">(</span><span class="main">(=)</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map <span class="free">get_param</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">gs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> func_one<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">g</span> <span class="skolem">gs</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">interpret</span></span> G<span class="main">:</span> landau_function_family_pair <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="quoted">"powr_closure <span class="main">(</span><span class="free">get_fun</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"prod_list <span class="main">(</span>map powr_closure <span class="main">(</span>map <span class="free">get_fun</span> <span class="skolem">gs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">get_fun</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> listmap_gs_in_listmap<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">get_fun</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">gs</span></span><span class="main">]</span> F_nontrivial
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> G.bigtheta_iff listmap_gs_in_listmap powr_smallo_iff powr_bigtheta_iff
                   <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> powr_zero_eq_one<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">lemma</span></span> fun_chain_at_top_at_top<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="free">f</span> <span class="main">::</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>order<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> at_top at_top"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="free">f</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> at_top at_top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> filterlim_ident filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> const_smallo_ln_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">(</span>ln<span class="main">::</span>real<span class="main">⇒</span>real<span class="main">)</span><span class="main">^^</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> smalloI_tendsto<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">1</span> <span class="main">/</span> <span class="main">(</span>ln<span class="main">^^</span><span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_divide_0 tendsto_const filterlim_at_top_imp_at_infinity
             fun_chain_at_top_at_top ln_at_top<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">from</span></span> fun_chain_at_top_at_top<span class="main">[</span><span class="operator">OF</span> ln_at_top<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">n</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span>ln<span class="main">^^</span><span class="free">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top_dense<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span>ln<span class="main">^^</span><span class="free">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ln_fun_in_smallo_fun<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top at_top"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="free">f</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> smalloI_tendsto<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">/</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_ln_powr_over_powr'<span class="main">)</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">/</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span> <span class="main">=</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> tendsto_cong<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">/</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> filterlim_compose<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ln_chain_dominates<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">&gt;</span> <span class="free">n</span> <span class="main">⟹</span> dominates at_top <span class="main">(</span><span class="main">(</span>ln<span class="main">::</span>real <span class="main">⇒</span> real<span class="main">)</span><span class="main">^^</span><span class="free">n</span><span class="main">)</span> <span class="main">(</span>ln<span class="main">^^</span><span class="free">m</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">erule</span> less_Suc_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dominates at_top <span class="main">(</span><span class="main">(</span>ln<span class="main">::</span>real<span class="main">⇒</span>real<span class="main">)</span><span class="main">^^</span><span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>ln<span class="main">^^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dominates_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> ln_fun_in_smallo_fun fun_chain_at_top_at_top ln_at_top<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="skolem">m</span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"dominates at_top <span class="main">(</span><span class="main">(</span>ln<span class="main">::</span>real <span class="main">⇒</span> real<span class="main">)</span><span class="main">^^</span><span class="skolem">k</span><span class="main">)</span> <span class="main">(</span>ln<span class="main">^^</span><span class="skolem">m</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"dominates at_top <span class="main">(</span><span class="main">(</span>ln<span class="main">::</span>real <span class="main">⇒</span> real<span class="main">)</span><span class="main">^^</span><span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>ln<span class="main">^^</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> fun_chain_at_top_at_top<span class="main">[</span><span class="operator">OF</span> ln_at_top<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span>ln<span class="main">^^</span><span class="skolem">m</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top_dense<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> this A <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"dominates at_top <span class="main">(</span><span class="main">(</span>ln<span class="main">::</span>real <span class="main">⇒</span> real<span class="main">)</span><span class="main">^^</span><span class="skolem">k</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>ln<span class="main">::</span>real <span class="main">⇒</span> real<span class="main">)</span><span class="main">^^</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> dominates_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>






<span class="keyword1"><span class="command">datatype</span></span> primfun <span class="main">=</span> LnChain <span class="quoted">nat</span>

<span class="keyword1"><span class="command">instantiation</span></span> primfun <span class="main">::</span> <span class="quoted">linorder</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_primfun</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"primfun <span class="main">⇒</span> primfun <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"LnChain <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> LnChain <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_primfun</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"primfun <span class="main">⇒</span> primfun <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"LnChain <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> LnChain <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_eq_primfun.induct<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_eq_primfun.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">z</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_eq_primfun.induct<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_eq_primfun.induct<span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eval_primfun'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> <span class="main">_</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval_primfun'</span> <span class="main">(</span>LnChain <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>ln<span class="main">^^</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">eval_primfun</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⇒</span> <span class="main">_</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval_primfun</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> eval_primfun' <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_primfun_altdef<span class="main">:</span> <span class="quoted"><span class="quoted">"eval_primfun <span class="free">f</span> <span class="free">x</span> <span class="main">=</span> eval_primfun' <span class="main">(</span>fst <span class="free">f</span><span class="main">)</span> <span class="free">x</span> <span class="keyword1">powr</span> snd <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">merge_primfun</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">merge_primfun</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>primfun<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">inverse_primfun</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">inverse_primfun</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>primfun<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="main">-</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">powr_primfun</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">powr_primfun</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::</span>primfun<span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> primfun_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">n</span> <span class="bound">e</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>LnChain <span class="bound">n</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">hypsubst</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">hypsubst</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> eval_primfun'_at_top<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span>eval_primfun' <span class="free">f</span><span class="main">)</span> at_top at_top"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">f</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> fun_chain_at_top_at_top ln_at_top<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> primfun_dominates<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">&lt;</span> <span class="free">g</span> <span class="main">⟹</span> dominates at_top <span class="main">(</span>eval_primfun' <span class="free">f</span><span class="main">)</span> <span class="main">(</span>eval_primfun' <span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> less_primfun.elims<span class="main"><span class="keyword3">;</span></span> <span class="operator">hypsubst</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ln_chain_dominates<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_primfun_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> eval_primfun <span class="free">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">f</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">hypsubst</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">e</span>
  <span class="keyword1"><span class="command">from</span></span> eval_primfun'_at_top <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> eval_primfun' <span class="skolem">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> filterlim_at_top_dense<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> eval_primfun <span class="main">(</span><span class="skolem">f</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_primfun<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually_nonneg at_top <span class="main">(</span>eval_primfun <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> eventually_nonneg_def <span class="keyword1"><span class="command">using</span></span> eval_primfun_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_primfun_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> eval_primfun <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eval_primfun_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_merge_primfun<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fst <span class="free">f</span> <span class="main">=</span> fst <span class="free">g</span> <span class="main">⟹</span>
     eval_primfun <span class="main">(</span>merge_primfun <span class="free">f</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> eval_primfun <span class="free">f</span> <span class="free">x</span> <span class="main">*</span> eval_primfun <span class="free">g</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">g</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> merge_primfun.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_add<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_inverse_primfun<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eval_primfun <span class="main">(</span>inverse_primfun <span class="free">f</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> inverse <span class="main">(</span>eval_primfun <span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> inverse_primfun.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eval_powr_primfun<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eval_primfun <span class="main">(</span>powr_primfun <span class="free">f</span> <span class="free">e</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> eval_primfun <span class="free">f</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> powr_primfun.induct<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr mult.commute<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eval_primfuns</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">eval_primfuns</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∏</span><span class="bound">f</span><span class="main">←</span><span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">.</span> eval_primfun <span class="bound">f</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_primfuns_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> eval_primfuns <span class="free">fs</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> prod_list_pos<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>linordered_semidom<span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">xs</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> prod_list <span class="skolem">xs</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">xs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"real list"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">f</span><span class="main">∈</span>set <span class="free">fs</span><span class="main">.</span> eval_primfun <span class="bound">f</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> eventually_ball_finite ballI eval_primfun_pos finite_set<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> eval_primfuns_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">rule</span> prod_list_pos<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eval_primfuns_nonzero<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> eval_primfuns <span class="free">fs</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eval_primfuns_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">fs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Reification›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">LANDAU_PROD'</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">LANDAU_PROD'</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">LANDAU_PROD</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">LANDAU_PROD</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">L</span></span></span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span> <span class="main">*</span> eval_primfuns <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BIGTHETA_CONST'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">BIGTHETA_CONST'</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BIGTHETA_CONST</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">BIGTHETA_CONST</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> set_mult <span class="keyword1">Θ(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BIGTHETA_FUN</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">BIGTHETA_FUN</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> BIGTHETA_CONST'_tag<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> BIGTHETA_CONST' <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> BIGTHETA_CONST'_def <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">lemma</span></span> BIGTHETA_CONST_tag<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> BIGTHETA_CONST <span class="main">1</span> <span class="keyword1">Θ(</span><span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BIGTHETA_CONST_def bigtheta_mult_eq_set_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> BIGTHETA_FUN_tag<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> BIGTHETA_FUN <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BIGTHETA_FUN_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> set_mult_is_times<span class="main">:</span> <span class="quoted"><span class="quoted">"set_mult <span class="free">A</span> <span class="free">B</span> <span class="main">=</span> <span class="free">A</span> <span class="main">*</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> set_mult_def set_times_def func_times <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> set_powr_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eventually_nonneg <span class="free">F</span> <span class="free">g</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> set_mult <span class="main">(</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eventually_nonneg_def<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_theta.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> set_mult <span class="main">(</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bigtheta_mult_eq_set_mult<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eventually_nonneg_bigtheta_pow_realpow<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> eval_primfun <span class="free">f</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> eval_primfun <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> real <span class="free">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> eval_primfun_pos<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> landau_theta.cong <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_realpow<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> BIGTHETA_CONST_fold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"BIGTHETA_CONST <span class="main">(</span><span class="free">c</span><span class="main">::</span>real<span class="main">)</span> <span class="main">(</span>BIGTHETA_CONST <span class="free">d</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> BIGTHETA_CONST <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">d</span><span class="main">)</span> <span class="free">A</span>"</span></span>
  <span class="quoted"><span class="quoted">"bigtheta_pow at_top <span class="main">(</span>BIGTHETA_CONST <span class="free">c</span> <span class="keyword1">Θ(</span>eval_primfun <span class="free">pf</span><span class="main">)</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span>
     BIGTHETA_CONST <span class="main">(</span><span class="free">c</span> <span class="main">^</span> <span class="free">k</span><span class="main">)</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> eval_primfun <span class="free">pf</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"set_inverse <span class="main">(</span>BIGTHETA_CONST <span class="free">c</span> <span class="keyword1">Θ(</span><span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> BIGTHETA_CONST <span class="main">(</span>inverse <span class="free">c</span><span class="main">)</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"set_mult <span class="main">(</span>BIGTHETA_CONST <span class="free">c</span> <span class="keyword1">Θ(</span><span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>BIGTHETA_CONST <span class="free">d</span> <span class="keyword1">Θ(</span><span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
     BIGTHETA_CONST <span class="main">(</span><span class="free">c</span><span class="main">*</span><span class="free">d</span><span class="main">)</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">*</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"BIGTHETA_CONST' <span class="main">(</span><span class="free">c</span><span class="main">::</span>real<span class="main">)</span> <span class="main">=</span> BIGTHETA_CONST <span class="free">c</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"BIGTHETA_FUN <span class="main">(</span><span class="free">f</span><span class="main">::</span>real<span class="main">⇒</span>real<span class="main">)</span> <span class="main">=</span> BIGTHETA_CONST <span class="main">1</span> <span class="keyword1">Θ(</span><span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BIGTHETA_CONST_def set_mult_is_times bigtheta_mult_eq_set_mult mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> BIGTHETA_CONST_def bigtheta_mult_eq_set_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
           bigtheta_pow_eq_set_pow<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> power_mult_distrib mult_ac<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bigtheta_mult_eq_set_mult eventually_nonneg_bigtheta_pow_realpow<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BIGTHETA_CONST_def BIGTHETA_CONST'_def BIGTHETA_FUN_def
        bigtheta_mult_eq_set_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> set_mult_is_times<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
        bigtheta_pow_eq_set_pow<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> bigtheta_inverse_eq_set_inverse<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>
        mult_ac power_mult_distrib<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> fold_fun_chain<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="free">x</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">^^</span> <span class="main">1</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">g</span> <span class="main">^^</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">g</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">g</span> <span class="main">^^</span> <span class="main">(</span><span class="free">m</span><span class="main">+</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> funpow_add<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> reify_ln_chain1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>ln <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span>eval_primfun <span class="main">(</span>LnChain <span class="free">n</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> landau_theta.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">(</span>ln <span class="main">::</span> real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> at_top at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fun_chain_at_top_at_top ln_at_top<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span>ln <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">using</span></span> filterlim_at_top_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>ln <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">=</span> eval_primfun <span class="main">(</span>LnChain <span class="free">n</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reify_monom1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span>eval_primfun <span class="main">(</span>LnChain <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> landau_theta.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>real"</span></span><span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> eval_primfun <span class="main">(</span>LnChain <span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reify_monom_pow<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span>eval_primfun <span class="main">(</span>LnChain <span class="main">0</span><span class="main">,</span> real <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span>eval_primfun <span class="main">(</span>LnChain <span class="main">0</span><span class="main">,</span> real <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">e</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_realpow<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_theta.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reify_monom_powr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span>eval_primfun <span class="main">(</span>LnChain <span class="main">0</span><span class="main">,</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_theta.cong<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> reify_monom <span class="main">=</span> reify_monom1 reify_monom_pow reify_monom_powr


<span class="keyword1"><span class="command">lemma</span></span> reify_ln_chain_pow<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>ln <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span>eval_primfun <span class="main">(</span>LnChain <span class="free">n</span><span class="main">,</span> real <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span>eval_primfun <span class="main">(</span>LnChain <span class="free">n</span><span class="main">,</span> real <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>ln <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="main">(</span>ln <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fun_chain_at_top_at_top<span class="main">[</span><span class="operator">OF</span> ln_at_top<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> filterlim_at_top_dense <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>ln <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ln <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">^</span> <span class="free">e</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">subst</span> powr_realpow<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>ln <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span>real <span class="free">e</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>ln <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">^</span><span class="free">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_theta.cong<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> reify_ln_chain_powr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>ln <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span>eval_primfun <span class="main">(</span>LnChain <span class="free">n</span><span class="main">,</span> <span class="free">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_theta.cong<span class="main">)</span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> reify_ln_chain <span class="main">=</span> reify_ln_chain1 reify_ln_chain_pow reify_ln_chain_powr

<span class="keyword1"><span class="command">lemma</span></span> numeral_power_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"numeral <span class="free">n</span> <span class="main">^</span> Suc <span class="free">a</span> <span class="main">=</span> numeral <span class="free">n</span> <span class="main">*</span> numeral <span class="free">n</span> <span class="main">^</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> power.simps<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> landau_product_preprocess <span class="main">=</span>
  one_add_one one_plus_numeral numeral_plus_one arith_simps numeral_power_Suc power_0
  fold_fun_chain<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> g <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">ln</span></span><span class="main">]</span> reify_ln_chain reify_monom


<span class="keyword1"><span class="command">lemma</span></span> LANDAU_PROD'_fold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"BIGTHETA_CONST <span class="free">e</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">d</span><span class="main">)</span> <span class="main">=</span> BIGTHETA_CONST <span class="main">(</span><span class="free">e</span><span class="main">*</span><span class="free">d</span><span class="main">)</span> <span class="keyword1">Θ(</span>eval_primfuns <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"LANDAU_PROD' <span class="free">c</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> LANDAU_PROD' <span class="free">c</span> <span class="main">(</span>eval_primfuns <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"eval_primfun <span class="free">f</span> <span class="main">=</span> eval_primfuns <span class="main">[</span><span class="free">f</span><span class="main">]</span>"</span></span>
  <span class="quoted"><span class="quoted">"eval_primfuns <span class="free">fs</span> <span class="free">x</span> <span class="main">*</span> eval_primfuns <span class="free">gs</span> <span class="free">x</span> <span class="main">=</span> eval_primfuns <span class="main">(</span><span class="free">fs</span> <span class="main">@</span> <span class="free">gs</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> BIGTHETA_CONST_def set_mult_is_times eval_primfuns_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> bigtheta_mult_eq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bigtheta_mult_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_primfuns_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> BIGTHETA_CONST_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> inverse_prod_list_field<span class="main">:</span>
  <span class="quoted"><span class="quoted">"prod_list <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>prod_list <span class="main">(</span>map <span class="free">f</span> <span class="free">xs</span> <span class="main">::</span> <span class="main">_</span> <span class="main">::</span> field list<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> landau_prod_meta_cong<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"landau_symbol <span class="free">L</span> <span class="free">L'</span> <span class="free">Lr</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="free">f</span><span class="main">)</span> <span class="main">≡</span> BIGTHETA_CONST <span class="free">c1</span> <span class="main">(</span><span class="keyword1">Θ(</span>eval_primfuns <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="free">g</span><span class="main">)</span> <span class="main">≡</span> BIGTHETA_CONST <span class="free">c2</span> <span class="main">(</span><span class="keyword1">Θ(</span>eval_primfuns <span class="free">gs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">L</span> at_top <span class="main">(</span><span class="free">g</span><span class="main">)</span> <span class="main">≡</span> LANDAU_PROD <span class="main">(</span><span class="free">L</span> at_top<span class="main">)</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">(</span>map inverse_primfun <span class="free">fs</span> <span class="main">@</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> landau_symbol <span class="quoted"><span class="free">L</span></span> <span class="quoted"><span class="free">L'</span></span> <span class="quoted"><span class="free">Lr</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">L</span> at_top <span class="main">(</span><span class="free">g</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c1</span> <span class="main">*</span> eval_primfuns <span class="free">fs</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> at_top <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c2</span> <span class="main">*</span> eval_primfuns <span class="free">gs</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> BIGTHETA_CONST_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cong_ex_bigtheta<span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bigtheta_mult_eq_set_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> at_top <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c2</span> <span class="main">*</span> eval_primfuns <span class="free">gs</span> <span class="bound">x</span> <span class="main">/</span> eval_primfuns <span class="free">fs</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_primfuns_nonzero divide_eq1<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">L</span> at_top <span class="main">(</span><span class="free">g</span><span class="main">)</span> <span class="main">≡</span> LANDAU_PROD <span class="main">(</span><span class="free">L</span> at_top<span class="main">)</span> <span class="free">c1</span> <span class="free">c2</span> <span class="main">(</span>map inverse_primfun <span class="free">fs</span> <span class="main">@</span> <span class="free">gs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LANDAU_PROD_def eval_primfuns_def eval_inverse_primfun
                  divide_inverse o_def inverse_prod_list_field mult_ac<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pos_primfun_list</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pos_primfun_list</span> <span class="main">[]</span> <span class="main">⟷</span> False"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">pos_primfun_list</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">pos_primfun_list</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">nonneg_primfun_list</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">nonneg_primfun_list</span> <span class="main">[]</span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">nonneg_primfun_list</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">nonneg_primfun_list</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">iszero_primfun_list</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">iszero_primfun_list</span> <span class="main">[]</span> <span class="main">⟷</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">iszero_primfun_list</span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">iszero_primfun_list</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">group_primfuns</span> <span class="main">≡</span> groupsort.group_sort fst merge_primfun"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_ConsCons_induct<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">xs</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">y</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span><span class="bound">x</span><span class="main">#</span><span class="bound">y</span><span class="main">#</span><span class="bound">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">xs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> length_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">x</span> <span class="skolem">xs'</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> A <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> assms 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">xs'</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">y</span> <span class="skolem">xs''</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 1 A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">y</span><span class="main">#</span><span class="skolem">xs''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> Cons A assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms A<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> landau_function_family_chain_primfuns<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sorted <span class="main">(</span>map fst <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"landau_function_family_chain at_top <span class="free">fs</span> <span class="main">(</span>eval_primfun' <span class="keyword1">o</span> fst<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 3
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">fs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> list_ConsCons_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">g</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> eval_primfun'_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">g</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_primfun' <span class="main">(</span>fst <span class="skolem">g</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">ω(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> smallomegaI_filterlim_at_infinity filterlim_at_top_imp_at_infinity<span class="main">)</span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smallomega_iff_smallo<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">f</span> <span class="skolem">g</span> <span class="skolem">gs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> primfun_dominates<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eval_primfun'_at_top<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> monoid_mult<span class="main">)</span> fold_plus_prod_list_rev<span class="main">:</span>
  <span class="quoted"><span class="quoted">"fold times <span class="free">xs</span> <span class="main">=</span> times <span class="main">(</span>prod_list <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fold times <span class="free">xs</span> <span class="skolem">x</span> <span class="main">=</span> prod_list <span class="main">(</span>rev <span class="free">xs</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">x</span><span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> foldr_conv_fold prod_list.eq_foldr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> prod_list <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fold times <span class="free">xs</span> <span class="skolem">x</span> <span class="main">=</span> prod_list <span class="main">(</span>rev <span class="free">xs</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">interpretation</span></span> groupsort_primfun<span class="main">:</span> groupsort <span class="quoted">fst</span> <span class="quoted">merge_primfun</span> <span class="quoted">eval_primfuns</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">y</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> merge_primfun.induct<span class="main">)</span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">fs</span> <span class="skolem">gs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eval_primfuns <span class="skolem">fs</span> <span class="skolem">x</span> <span class="main">=</span> fold <span class="main">(*)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> eval_primfun <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">fs</span><span class="main">)</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eval_primfuns_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fold_plus_prod_list_rev<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fold <span class="main">(*)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> eval_primfun <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">fs</span><span class="main">)</span> <span class="main">=</span> fold <span class="main">(*)</span> <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> eval_primfun <span class="bound">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">gs</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> fold_multiset_equiv ext<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">1</span> <span class="main">=</span> eval_primfuns <span class="skolem">gs</span> <span class="skolem">x</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eval_primfuns_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fold_plus_prod_list_rev<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eval_primfuns <span class="skolem">fs</span> <span class="skolem">x</span> <span class="main">=</span> eval_primfuns <span class="skolem">gs</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> fun_eq_iff eval_merge_primfun eval_primfuns_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nonneg_primfun_list_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"nonneg_primfun_list <span class="free">fs</span> <span class="main">=</span> nonneg_list <span class="main">(</span>map snd <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">fs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> nonneg_primfun_list.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> pos_primfun_list_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"pos_primfun_list <span class="free">fs</span> <span class="main">=</span> pos_list <span class="main">(</span>map snd <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">fs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> pos_primfun_list.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> iszero_primfun_list_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"iszero_primfun_list <span class="free">fs</span> <span class="main">=</span> list_all <span class="main">(</span><span class="main">(=)</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map snd <span class="free">fs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">fs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> iszero_primfun_list.induct<span class="main">)</span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemma</span></span> landau_primfuns_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>eval_primfuns <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nonneg_primfun_list <span class="main">(</span>group_primfuns <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span>"</span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span>eval_primfuns <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> pos_primfun_list <span class="main">(</span>group_primfuns <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span>"</span></span><span class="main">)</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span>eval_primfuns <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> iszero_primfun_list <span class="main">(</span>group_primfuns <span class="free">fs</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">interpret</span></span> landau_function_family_chain <span class="quoted">at_top</span> <span class="quoted"><span class="quoted">"group_primfuns <span class="free">fs</span>"</span></span> <span class="quoted">snd</span> <span class="quoted"><span class="quoted">"eval_primfun' <span class="keyword1">o</span> fst"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_function_family_chain_primfuns<span class="main">)</span>
       <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> group_primfuns_def groupsort_primfun.sorted_group_sort
                      groupsort_primfun.distinct_group_sort<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>eval_primfuns <span class="free">fs</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span>eval_primfuns <span class="main">(</span>group_primfuns <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> groupsort_primfun.g_group_sort group_primfuns_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> nonneg_list <span class="main">(</span>map snd <span class="main">(</span>group_primfuns <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bigo_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_primfuns_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> eval_primfun_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nonneg_primfun_list_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span>eval_primfuns <span class="free">fs</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span>eval_primfuns <span class="main">(</span>group_primfuns <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> groupsort_primfun.g_group_sort group_primfuns_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> pos_list <span class="main">(</span>map snd <span class="main">(</span>group_primfuns <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> smallo_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_primfuns_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> eval_primfun_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pos_primfun_list_iff<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span>eval_primfuns <span class="free">fs</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span>eval_primfuns <span class="main">(</span>group_primfuns <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> groupsort_primfun.g_group_sort group_primfuns_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⟷</span> list_all <span class="main">(</span><span class="main">(=)</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>map snd <span class="main">(</span>group_primfuns <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bigtheta_iff
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eval_primfuns_def<span class="main"><span class="main">[</span></span><span class="operator">abs_def</span><span class="main"><span class="main">]</span></span> eval_primfun_altdef<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> iszero_primfun_list_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> LANDAU_PROD_bigo_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"LANDAU_PROD <span class="main">(</span>bigo at_top<span class="main">)</span> <span class="free">c1</span> <span class="free">c2</span> <span class="free">fs</span> <span class="main">⟷</span> <span class="free">c1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="free">c2</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> nonneg_primfun_list <span class="main">(</span>group_primfuns <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> LANDAU_PROD_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> landau_primfuns_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> LANDAU_PROD_smallo_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"LANDAU_PROD <span class="main">(</span>smallo at_top<span class="main">)</span> <span class="free">c1</span> <span class="free">c2</span> <span class="free">fs</span> <span class="main">⟷</span> <span class="free">c1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="main">(</span><span class="free">c2</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> pos_primfun_list <span class="main">(</span>group_primfuns <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> LANDAU_PROD_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c1</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c2</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> landau_primfuns_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> LANDAU_PROD_bigtheta_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"LANDAU_PROD <span class="main">(</span>bigtheta at_top<span class="main">)</span> <span class="free">c1</span> <span class="free">c2</span> <span class="free">fs</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">c1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">c2</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">c1</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">c2</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">∧</span>
     iszero_primfun_list <span class="main">(</span>group_primfuns <span class="free">fs</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> eval_primfuns <span class="free">fs</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">with</span></span> eval_primfuns_nonzero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">fs</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> False<span class="main">)</span> at_top"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> B <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> A<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c1</span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">case_product</span> A<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">c2</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                  <span class="main">(</span><span class="operator">insert</span> B<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> LANDAU_PROD_def landau_primfuns_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> LANDAU_PROD_iff <span class="main">=</span> LANDAU_PROD_bigo_iff LANDAU_PROD_smallo_iff LANDAU_PROD_bigtheta_iff


<span class="keyword1"><span class="command">lemmas</span></span> landau_real_prod_simps <span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span>
  groupsort_primfun.group_part_def
  group_primfuns_def groupsort_primfun.group_sort.simps
  groupsort_primfun.group_part_aux.simps pos_primfun_list.simps
  nonneg_primfun_list.simps iszero_primfun_list.simps

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Landau_Simprocs">
<div class="head">
<h1>Theory Landau_Simprocs</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:   Landau_Simprocs.thy
  Author: Manuel Eberl &lt;eberlm@in.tum.de&gt;

  Simplification procedures for Landau symbols, with a particular focus on functions into the reals.
*)</span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Simplification procedures›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Landau_Simprocs
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Landau_Real_Products.html">Landau_Real_Products</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Simplification under Landau symbols›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following can be seen as simpset for terms under Landau symbols. 
  When given a rule <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">∈</span></span> <span class="keyword1"><span class="keyword1">Θ(</span></span><span class="free"><span class="free">g</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, the simproc will attempt to rewrite any occurrence of 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">f</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> under a Landau symbol to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">g</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> landau_simp <span class="quoted">"BigTheta rules for simplification of Landau symbols"</span>
<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">eq_thms</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> landau_theta.cong_bigtheta<span class="antiquote">}</span></span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">eq_rule</span> <span class="entity">thm</span> <span class="main">=</span> get_first <span class="main">(</span>try <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">eq_thm</span> <span class="main">=&gt;</span> <span class="entity">eq_thm</span> OF <span class="main">[</span><span class="entity">thm</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="entity">eq_thms</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    Global_Theory.add_thms_dynamic
      <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> landau_simps<span class="antiquote">}</span></span></span><span class="main">,</span>
        <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">context</span> <span class="main">=&gt;</span>
          <span class="entity">Named_Theorems.get</span> <span class="main">(</span>Context.proof_of <span class="entity">context</span><span class="main">)</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">named_theorems</span> landau_simp<span class="antiquote">}</span></span>
          |&gt; map_filter <span class="entity">eq_rule</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>
›</span>


<span class="keyword1"><span class="command">lemma</span></span> bigtheta_const <span class="main">[</span><span class="operator">landau_simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">1</span> <span class="free">c</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> <span class="main">[</span><span class="operator">landau_simp</span><span class="main">]</span> <span class="main">=</span> bigtheta_const_ln bigtheta_const_ln_powr bigtheta_const_ln_pow

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_const_ln' <span class="main">[</span><span class="operator">landau_simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span>ln<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> bigtheta_const_ln<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_const_ln_powr' <span class="main">[</span><span class="operator">landau_simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> bigtheta_const_ln_powr<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_const_ln_pow' <span class="main">[</span><span class="operator">landau_simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> ln <span class="main">(</span><span class="bound">x</span> <span class="main">*</span> <span class="free">a</span><span class="main">)</span> <span class="main">^</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">^</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> bigtheta_const_ln_pow<span class="main">)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Simproc setup›</span></span>


<span class="keyword1"><span class="command">lemma</span></span> landau_gt_1_cong<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"landau_symbol <span class="free">L</span> <span class="free">L'</span> <span class="free">Lr</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">L</span> at_top <span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">=</span> <span class="free">L</span> at_top <span class="main">(</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> landau_symbol.cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> landau_gt_1_in_cong<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"landau_symbol <span class="free">L</span> <span class="free">L'</span> <span class="free">Lr</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">∈</span> <span class="free">L</span> at_top <span class="main">(</span><span class="free">h</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">g</span> <span class="main">∈</span> <span class="free">L</span> at_top <span class="main">(</span><span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> eventually_mono <span class="main"><span class="main">[</span></span><span class="operator">OF</span> eventually_gt_at_top<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> landau_symbol.in_cong<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> landau_prop_equalsI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"landau_symbol <span class="free">L</span> <span class="free">L'</span> <span class="free">Lr</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">f1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> <span class="free">g1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> 
     <span class="free">f1</span> <span class="main">∈</span> <span class="free">L</span> at_top <span class="main">(</span><span class="free">g1</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">f2</span> <span class="main">∈</span> <span class="free">L</span> at_top <span class="main">(</span><span class="free">g2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> landau_gt_1_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> landau_gt_1_in_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> ab_diff_conv_add_uminus'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>ab_group_add<span class="main">)</span> <span class="main">-</span> <span class="free">b</span> <span class="main">=</span> <span class="main">-</span><span class="free">b</span> <span class="main">+</span> <span class="free">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> extract_diff_middle<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="main">_</span><span class="main">::</span>ab_group_add<span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span><span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="free">a</span> <span class="main">-</span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> divide_inverse'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="main">_</span><span class="main">::</span><span class="main">{</span>division_ring<span class="main">,</span>ab_semigroup_mult<span class="main">}</span><span class="main">)</span> <span class="main">/</span> <span class="free">b</span> <span class="main">=</span> inverse <span class="free">b</span> <span class="main">*</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_inverse mult.commute<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> extract_divide_middle<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">::</span><span class="main">_</span><span class="main">::</span><span class="main">{</span>field<span class="main">}</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span><span class="free">x</span> <span class="main">*</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> inverse <span class="free">x</span> <span class="main">*</span> <span class="main">(</span><span class="free">a</span> <span class="main">/</span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_inverse <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> landau_cancel <span class="main">=</span> landau_symbol.mult_cancel_left

<span class="keyword1"><span class="command">lemmas</span></span> mult_cancel_left' <span class="main">=</span> landau_symbol.mult_cancel_left<span class="main">[</span><span class="operator">OF</span> _ bigtheta_refl eventually_nonzeroD<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> mult_cancel_left_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"landau_symbol <span class="free">L</span> <span class="free">L'</span> <span class="free">Lr</span>"</span></span> <span class="quoted"><span class="quoted">"eventually_nonzero <span class="free">F</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">L</span> <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="free">F</span> <span class="main">(</span><span class="free">g2</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="free">F</span> <span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">f2</span> <span class="main">∈</span> <span class="free">L</span> <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="free">L</span> <span class="free">F</span> <span class="main">(</span><span class="free">f</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">L</span> <span class="free">F</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mult_cancel_left'<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span>"</span></span><span class="main">]</span> mult_cancel_left'<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span>"</span></span><span class="main">]</span>
        mult_cancel_left'<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>

<span class="keyword1"><span class="command">lemmas</span></span> landau_mult_cancel_simps <span class="main">=</span> mult_cancel_left' mult_cancel_left_1

<span class="keyword1"><span class="command">ML_file</span></span> <span class="quoted">‹landau_simprocs.ML›</span>

<span class="keyword1"><span class="command">lemmas</span></span> bigtheta_simps <span class="main">=</span> 
  landau_theta.cong_bigtheta<span class="main">[</span><span class="operator">OF</span> bigtheta_const_ln<span class="main">]</span>
  landau_theta.cong_bigtheta<span class="main">[</span><span class="operator">OF</span> bigtheta_const_ln_powr<span class="main">]</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The following simproc attempts to cancel common factors in Landau symbols, i.\,e.\ in a
  goal like $f(x) h(x) \in L(g(x) h(x))$, the common factor $h(x)$ will be cancelled. This only
  works if the simproc can prove that $h(x)$ is eventually non-zero, for which it uses some
  heuristics.
›</span></span>
<span class="keyword1"><span class="command">simproc_setup</span></span> landau_cancel_factor <span class="main">(</span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">ω[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Ω[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="main">)</span> <span class="main">=</span> <span class="quoted">‹K <span class="entity">Landau.cancel_factor_simproc</span>›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  The next simproc attempts to cancel dominated summands from Landau symbols; e.\,g.\ $O(x + \ln x)$
  is simplified to $O(x)$, since $\ln x \in o(x)$. This can be very slow on large terms, so it
  is not enabled by default.
›</span></span>
<span class="keyword1"><span class="command">simproc_setup</span></span> simplify_landau_sum <span class="main">(</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ω[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">ω[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Ω[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="main">)</span> <span class="main">=</span> <span class="quoted">‹K <span class="main">(</span><span class="entity">Landau.lift_landau_simproc</span> <span class="entity">Landau.simplify_landau_sum_simproc</span><span class="main">)</span>›</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This simproc attempts to simplify factors of an expression in a Landau symbol statement
  independently from another, i.\,e.\ in something like $O(f(x) g(x)$, a simp rule that rewrites
  $O(f(x))$ to $O(f'(x))$ will also rewrite $O(f(x) g(x))$ to $O(f'(x) g(x))$ without any further
  setup.
›</span></span>
<span class="keyword1"><span class="command">simproc_setup</span></span> simplify_landau_product <span class="main">(</span>
    <span class="quoted"><span class="quoted">"<span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="keyword1">ω[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Ω[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">ω[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Ω[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="main">)</span> <span class="main">=</span> <span class="quoted">‹K <span class="main">(</span><span class="entity">Landau.lift_landau_simproc</span> <span class="entity">Landau.simplify_landau_product_simproc</span><span class="main">)</span>›</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  Lastly, the next very specialised simproc can solve goals of the form 
  $f(x) \in L(g(x))$ where $f$ and $g$ are real-valued functions consisting only of multiplications,
  powers of $x$, and powers of iterated logarithms of $x$. This is done by rewriting both sides
  into the form $x^a (\ln x)^b (\ln \ln x)^c$ etc.\ and then comparing the exponents
  lexicographically.

  Note that for historic reasons, this only works for $x\to\infty$.
›</span></span>
<span class="keyword1"><span class="command">simproc_setup</span></span> landau_real_prod <span class="main">(</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">::</span> real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">::</span> real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">::</span> real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">ω(</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">::</span> real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Ω(</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">::</span> real <span class="main">⇒</span> real<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ(</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="main">)</span> <span class="main">=</span> <span class="quoted">‹K <span class="entity">Landau.simplify_landau_real_prod_prop_simproc</span>›</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Tests›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> asymp_equiv_plus_const_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">c</span> <span class="main">+</span> real <span class="bound">n</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> asymp_equiv_add_left<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">asymp_equiv_intros</span></span> eventually_gt_at_top<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> asymp_equiv_plus_const_right<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span> <span class="main">+</span> <span class="free">c</span><span class="main">)</span> <span class="main">∼[</span>at_top<span class="main">]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> real <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> asymp_equiv_plus_const_left<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Product simplification tests›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="free">h</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span><span class="free">h</span> <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">/</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Real product decision procure tests›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="numeral">2</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="numeral">3</span> <span class="main">-</span> <span class="numeral">4</span><span class="main">*</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> landau_theta.absorb<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">r</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">&gt;</span> <span class="free">q</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="free">c</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">r</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="free">b</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ln <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">ML_val</span></span> <span class="quoted">‹
  <span class="entity">Landau.simplify_landau_real_prod_prop_conv</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> 
  <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">cterm</span> <span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="numeral">5</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">1.5</span> <span class="main">*</span> inverse <span class="numeral">2</span><span class="main">)</span> <span class="main">∈</span> 
           <span class="keyword1">ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="main">(</span>ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span><span class="antiquote">}</span></span></span>
›</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">*</span> ln <span class="bound">x</span> <span class="main">/</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="main">(</span>ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> 
         <span class="keyword1">ω(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="numeral">5</span> <span class="main">*</span> ln <span class="main">(</span>ln <span class="bound">x</span><span class="main">)</span> <span class="main">^</span> <span class="numeral">2</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">1.5</span> <span class="main">*</span> inverse <span class="numeral">2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sum cancelling tests›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="numeral">3</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">/</span>ln <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="comment1">(* TODO: tweak simproc with size threshold *)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="numeral">2</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="numeral">3</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span><span class="main">/</span>ln <span class="bound">x</span> <span class="main">+</span> <span class="numeral">42</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="numeral">9</span> <span class="main">+</span> <span class="numeral">213</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="numeral">5</span> <span class="main">-</span> <span class="numeral">4</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="numeral">7</span><span class="main">)</span> <span class="main">=</span> 
         <span class="keyword1">Θ(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">^</span> <span class="numeral">3</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">/</span> ln <span class="bound">x</span> <span class="main">*</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="numeral">3</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> <span class="numeral">2</span><span class="main">*</span><span class="bound">x</span> <span class="keyword1">powr</span> <span class="numeral">9</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">landau_sum_limit</span> <span class="main"><span class="main">=</span></span> 5<span class="main">]</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="main">(</span><span class="numeral">3</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">::</span>real<span class="main">.</span> <span class="bound">x</span><span class="main">^</span><span class="numeral">2</span> <span class="main">+</span> ln <span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="bound">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="files/landau_simprocs.ML">
<div class="head">
<h1>File ‹landau_simprocs.ML›</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:   landau_simprocs.ML
  Author: Manuel Eberl &lt;eberlm@in.tum.de&gt;

  Simprocs for Landau symbols. 
*)</span>
<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">LANDAU</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> landau_const_names <span class="main">:</span> string list
  <span class="keyword1"><span class="keyword">val</span></span> dest_landau <span class="main">:</span> term <span class="main">-&gt;</span> term * term * term

  <span class="keyword1"><span class="keyword">val</span></span> lift_landau_conv <span class="main">:</span> conv <span class="main">-&gt;</span> conv
  <span class="keyword1"><span class="keyword">val</span></span> lift_landau_simproc <span class="main">:</span> 
    <span class="main">(</span><span class="entity">Proof.context</span> <span class="main">-&gt;</span> cterm <span class="main">-&gt;</span> thm option<span class="main">)</span> <span class="main">-&gt;</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> cterm <span class="main">-&gt;</span> thm option

  <span class="keyword1"><span class="keyword">val</span></span> cancel_factor_conv <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> cterm <span class="main">-&gt;</span> thm
  <span class="keyword1"><span class="keyword">val</span></span> cancel_factor_simproc <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> cterm <span class="main">-&gt;</span> thm option

  <span class="keyword1"><span class="keyword">val</span></span> simplify_landau_sum_conv <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> conv
  <span class="keyword1"><span class="keyword">val</span></span> simplify_landau_sum_simproc <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> cterm <span class="main">-&gt;</span> thm option

  <span class="keyword1"><span class="keyword">val</span></span> simplify_landau_product_conv <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> conv
  <span class="keyword1"><span class="keyword">val</span></span> simplify_landau_product_simproc <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> cterm <span class="main">-&gt;</span> thm option

  <span class="keyword1"><span class="keyword">val</span></span> simplify_landau_real_prod_prop_conv <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> conv
  <span class="keyword1"><span class="keyword">val</span></span> simplify_landau_real_prod_prop_simproc <span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> cterm <span class="main">-&gt;</span> thm option

  <span class="keyword1"><span class="keyword">val</span></span> landau_sum_limit <span class="main">:</span> int Config.T

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">Landau</span><span class="main">:</span> <span class="entity">LANDAU</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">landau_sum_limit</span> <span class="main">=</span> <span class="entity">Attrib.setup_config_int</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">binding</span> landau_sum_limit<span class="antiquote">}</span></span></span> <span class="main">(</span>K <span class="inner_numeral">3</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">landau_simprocs</span> <span class="entity">ctxt</span> <span class="main">=</span> map <span class="main">(</span><span class="entity">Simplifier.the_simproc</span> <span class="entity">ctxt</span><span class="main">)</span> 
  <span class="main">[</span><span class="inner_quoted">"Landau_Simprocs.simplify_landau_product"</span><span class="main">]</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">landau_const_names</span> <span class="main">=</span>
  <span class="main">[</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "bigo"<span class="antiquote">}</span></span><span class="main">,</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "smallo"<span class="antiquote">}</span></span><span class="main">,</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "bigomega"<span class="antiquote">}</span></span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "smallomega"<span class="antiquote">}</span></span><span class="main">,</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "bigtheta"<span class="antiquote">}</span></span><span class="main">]</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_landau_id</span> <span class="main">(</span><span class="entity">t</span> <span class="keyword1"><span class="keyword">as</span></span> Const <span class="main">(</span><span class="entity">s</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">i</span> <span class="main">=</span> find_index <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">s'</span> <span class="main">=&gt;</span> <span class="entity">s</span> <span class="main">=</span> <span class="entity">s'</span><span class="main">)</span> <span class="entity">landau_const_names</span>
      <span class="keyword2"><span class="keyword">in</span></span>
        <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">i</span> &lt; <span class="inner_numeral">0</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"get_landau_id"</span><span class="main">,</span> <span class="main">[</span><span class="entity">t</span><span class="main">]</span><span class="main">)</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">i</span>
      <span class="keyword2"><span class="keyword">end</span></span>
  <span class="main">|</span> <span class="entity">get_landau_id</span> <span class="entity">t</span> <span class="main">=</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"get_landau_id"</span><span class="main">,</span> <span class="main">[</span><span class="entity">t</span><span class="main">]</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_landau_symbol_thm</span> <span class="entity">t</span> <span class="main">=</span> nth <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> landau_symbols<span class="antiquote">}</span></span></span> <span class="main">(</span><span class="entity">get_landau_id</span> <span class="entity">t</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_bigtheta_cong</span> <span class="entity">t</span> <span class="main">=</span> nth <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> landau_bigtheta_meta_congs<span class="antiquote">}</span></span></span> <span class="main">(</span><span class="entity">get_landau_id</span> <span class="entity">t</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">dest_landau</span> <span class="main">(</span><span class="entity">t</span> <span class="keyword1"><span class="keyword">as</span></span> Const <span class="main">(</span><span class="entity">s</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> $ <span class="entity">fltr</span> $ <span class="entity">f</span><span class="main">)</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">if</span></span> member <span class="keyword1"><span class="keyword">op</span></span><span class="main">=</span> <span class="entity">landau_const_names</span> <span class="entity">s</span> <span class="keyword2"><span class="keyword">then</span></span>
        <span class="main">(</span>Const <span class="main">(</span><span class="entity">s</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span><span class="main">,</span> <span class="entity">fltr</span><span class="main">,</span> <span class="entity">f</span><span class="main">)</span> 
      <span class="keyword2"><span class="keyword">else</span></span> 
        <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"dest_landau"</span><span class="main">,</span> <span class="main">[</span><span class="entity">t</span><span class="main">]</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">dest_landau</span> <span class="entity">t</span> <span class="main">=</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"dest_landau"</span><span class="main">,</span> <span class="main">[</span><span class="entity">t</span><span class="main">]</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">dest_bigtheta</span> <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> bigtheta<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">fltr</span> $ <span class="entity">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="entity">fltr</span><span class="main">,</span> <span class="entity">a</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">dest_bigtheta</span> <span class="entity">t</span> <span class="main">=</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"dest_bigtheta"</span><span class="main">,</span> <span class="main">[</span><span class="entity">t</span><span class="main">]</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">dest_member</span> <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Set.member<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">a</span> $ <span class="entity">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="entity">a</span><span class="main">,</span> <span class="entity">b</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">dest_member</span> <span class="entity">t</span> <span class="main">=</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"dest_member"</span><span class="main">,</span> <span class="main">[</span><span class="entity">t</span><span class="main">]</span><span class="main">)</span>

<span class="comment1">(* Turn a conversion that rewrites a Landau symbol L(f) into a conversion that 
   rewrites f ∈ L(g) *)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">lift_landau_conv</span> <span class="entity">conv</span> <span class="entity">ct</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">case</span></span> Thm.term_of <span class="entity">ct</span> <span class="keyword2"><span class="keyword">of</span></span>
    <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "Set.member"<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="main">_</span> $ <span class="main">_</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">ct</span> |&gt; <span class="main">(</span>
      Conv.rewrs_conv <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> landau_flip<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span>
      then_conv <span class="main">(</span>Conv.arg_conv <span class="entity">conv</span><span class="main">)</span>
      then_conv Conv.rewrs_conv <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> landau_flip<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span><span class="main">)</span>
  <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">conv</span> <span class="entity">ct</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">lift_landau_simproc</span> <span class="entity">simproc</span> <span class="entity">ctxt</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">conv</span> <span class="entity">ct</span> <span class="main">=</span> 
      <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">simproc</span> <span class="entity">ctxt</span> <span class="entity">ct</span> <span class="keyword2"><span class="keyword">of</span></span>
        NONE <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> CTERM <span class="main">(</span><span class="inner_quoted">"lift_landau_simproc"</span><span class="main">,</span> <span class="main">[</span><span class="entity">ct</span><span class="main">]</span><span class="main">)</span>
      <span class="main">|</span> SOME <span class="entity">thm</span> <span class="main">=&gt;</span> <span class="entity">thm</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    try <span class="main">(</span><span class="entity">lift_landau_conv</span> <span class="entity">conv</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="keyword">datatype</span></span> <span class="entity">operator</span> <span class="main">=</span> <span class="entity">MULT</span> <span class="main">|</span> <span class="entity">DIVIDE</span>
<span class="keyword1"><span class="keyword">datatype</span></span> 'a <span class="entity">breadcrumb</span> <span class="main">=</span> <span class="entity">LEFT</span> <span class="keyword2"><span class="keyword">of</span></span> 'a <span class="main">|</span> <span class="entity">RIGHT</span> <span class="keyword2"><span class="keyword">of</span></span> 'a

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">inverse</span> <span class="entity">T</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Fields.inverse<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">T</span> --&gt; <span class="entity">T</span><span class="main">)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mult</span> <span class="entity">T</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Groups.times<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">T</span> --&gt; <span class="entity">T</span> --&gt; <span class="entity">T</span><span class="main">)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">divide</span> <span class="entity">T</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Rings.divide_class.divide<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">T</span> --&gt; <span class="entity">T</span> --&gt; <span class="entity">T</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">map_crumb</span> <span class="entity">f</span> <span class="main">(</span><span class="entity">LEFT</span> <span class="entity">x</span><span class="main">)</span> <span class="main">=</span> <span class="entity">LEFT</span> <span class="main">(</span><span class="entity">f</span> <span class="entity">x</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">map_crumb</span> <span class="entity">f</span> <span class="main">(</span><span class="entity">RIGHT</span> <span class="entity">x</span><span class="main">)</span> <span class="main">=</span> <span class="entity">RIGHT</span> <span class="main">(</span><span class="entity">f</span> <span class="entity">x</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">reconstruct_crumbs</span> <span class="entity">T</span> <span class="entity">crumbs</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">binop</span> <span class="entity">MULT</span> <span class="main">(</span>SOME <span class="entity">x</span><span class="main">)</span> <span class="main">(</span>SOME <span class="entity">y</span><span class="main">)</span> <span class="main">=</span> SOME <span class="main">(</span><span class="entity">mult</span> <span class="entity">T</span> $ <span class="entity">x</span> $ <span class="entity">y</span><span class="main">)</span>
      <span class="main">|</span> <span class="entity">binop</span> <span class="entity">DIVIDE</span> <span class="main">(</span>SOME <span class="entity">x</span><span class="main">)</span> <span class="main">(</span>SOME <span class="entity">y</span><span class="main">)</span> <span class="main">=</span> SOME <span class="main">(</span><span class="entity">divide</span> <span class="entity">T</span> $ <span class="entity">x</span> $ <span class="entity">y</span><span class="main">)</span>
      <span class="main">|</span> <span class="entity">binop</span> <span class="main">_</span> <span class="entity">x</span> NONE <span class="main">=</span> <span class="entity">x</span>
      <span class="main">|</span> <span class="entity">binop</span> <span class="entity">MULT</span> NONE <span class="entity">y</span> <span class="main">=</span> <span class="entity">y</span>
      <span class="main">|</span> <span class="entity">binop</span> <span class="entity">DIVIDE</span> NONE <span class="main">(</span>SOME <span class="entity">y</span><span class="main">)</span> <span class="main">=</span> SOME <span class="main">(</span><span class="entity">inverse</span> <span class="entity">T</span> $ <span class="entity">y</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">go</span> <span class="entity">t</span> <span class="main">[</span><span class="main">]</span> <span class="main">=</span> <span class="entity">t</span>
      <span class="main">|</span> <span class="entity">go</span> <span class="entity">t</span> <span class="main">(</span><span class="entity">LEFT</span> <span class="main">(</span><span class="entity">opr</span><span class="main">,</span><span class="entity">r</span><span class="main">)</span> :: <span class="entity">crumbs</span><span class="main">)</span> <span class="main">=</span> <span class="entity">go</span> <span class="main">(</span><span class="entity">binop</span> <span class="entity">opr</span> <span class="entity">t</span> <span class="main">(</span>SOME <span class="entity">r</span><span class="main">)</span><span class="main">)</span> <span class="entity">crumbs</span>
      <span class="main">|</span> <span class="entity">go</span> <span class="entity">t</span> <span class="main">(</span><span class="entity">RIGHT</span> <span class="main">(</span><span class="entity">opr</span><span class="main">,</span><span class="entity">l</span><span class="main">)</span> :: <span class="entity">crumbs</span><span class="main">)</span> <span class="main">=</span> <span class="entity">go</span> <span class="main">(</span><span class="entity">binop</span> <span class="entity">opr</span> <span class="main">(</span>SOME <span class="entity">l</span><span class="main">)</span> <span class="entity">t</span><span class="main">)</span> <span class="entity">crumbs</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">go</span> NONE <span class="entity">crumbs</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(* Pick a leaf in the arithmetic tree (i.e. a summand), remove it and return both it and the 
   remaining tree (NONE if it is empty). Return a list of all possible results *)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">pick_leaf</span> <span class="entity">t</span> <span class="entity">T</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span> 
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">go</span> <span class="main">(</span><span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "Groups.times"<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span><span class="main">)</span> $ <span class="entity">a</span> $ <span class="entity">b</span><span class="main">)</span> <span class="entity">neg</span> <span class="entity">crumbs</span> <span class="entity">acc</span> <span class="main">=</span>
            <span class="entity">acc</span> |&gt; <span class="entity">go</span> <span class="entity">b</span> <span class="entity">neg</span> <span class="main">(</span><span class="entity">RIGHT</span> <span class="main">(</span><span class="entity">MULT</span><span class="main">,</span><span class="entity">a</span><span class="main">)</span> :: <span class="entity">crumbs</span><span class="main">)</span> |&gt; <span class="entity">go</span> <span class="entity">a</span> <span class="entity">neg</span> <span class="main">(</span><span class="entity">LEFT</span> <span class="main">(</span><span class="entity">MULT</span><span class="main">,</span><span class="entity">b</span><span class="main">)</span> :: <span class="entity">crumbs</span><span class="main">)</span>
        <span class="main">|</span> <span class="entity">go</span> <span class="main">(</span><span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "Rings.divide_class.divide"<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span><span class="main">)</span> $ <span class="entity">a</span> $ <span class="entity">b</span><span class="main">)</span> <span class="entity">neg</span> <span class="entity">crumbs</span> <span class="entity">acc</span> <span class="main">=</span>
            <span class="entity">acc</span> |&gt; <span class="entity">go</span> <span class="entity">b</span> <span class="main">(</span>not <span class="entity">neg</span><span class="main">)</span> <span class="main">(</span><span class="entity">RIGHT</span> <span class="main">(</span><span class="entity">DIVIDE</span><span class="main">,</span><span class="entity">a</span><span class="main">)</span> :: <span class="entity">crumbs</span><span class="main">)</span> |&gt; <span class="entity">go</span> <span class="entity">a</span> <span class="entity">neg</span> <span class="main">(</span><span class="entity">LEFT</span> <span class="main">(</span><span class="entity">DIVIDE</span><span class="main">,</span><span class="entity">b</span><span class="main">)</span> :: <span class="entity">crumbs</span><span class="main">)</span>
        <span class="main">|</span> <span class="entity">go</span> <span class="entity">a</span> <span class="entity">neg</span> <span class="entity">crumbs</span> <span class="entity">acc</span> <span class="main">=</span>
            <span class="keyword2"><span class="keyword">let</span></span>
              <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">a</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">neg</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">inverse</span> <span class="entity">T</span> $ <span class="entity">a</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">a</span>
            <span class="keyword2"><span class="keyword">in</span></span>
              <span class="main">(</span><span class="entity">a</span><span class="main">,</span> <span class="entity">reconstruct_crumbs</span> <span class="entity">T</span> <span class="entity">crumbs</span><span class="main">,</span> rev <span class="main">(</span>map <span class="main">(</span><span class="entity">map_crumb</span> fst<span class="main">)</span> <span class="entity">crumbs</span><span class="main">)</span><span class="main">)</span> :: <span class="entity">acc</span>
            <span class="keyword2"><span class="keyword">end</span></span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">go</span> <span class="entity">t</span> false <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">local</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">commute_conv</span> <span class="entity">MULT</span> <span class="main">=</span> Conv.rewr_conv <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> mult.commute<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span>
    <span class="main">|</span> <span class="entity">commute_conv</span> <span class="entity">DIVIDE</span> <span class="main">=</span> Conv.rewr_conv <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> divide_inverse'<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">assoc_conv</span> <span class="entity">MULT</span> <span class="main">=</span> Conv.rewr_conv <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> mult.assoc<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span>
    <span class="main">|</span> <span class="entity">assoc_conv</span> <span class="entity">DIVIDE</span> <span class="main">=</span> Conv.rewr_conv <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> times_divide_eq_right<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">to_mult_conv</span> <span class="entity">MULT</span> <span class="main">=</span> Conv.all_conv
    <span class="main">|</span> <span class="entity">to_mult_conv</span> <span class="entity">DIVIDE</span> <span class="main">=</span> Conv.rewr_conv <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> divide_inverse<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">extract_middle_conv</span> <span class="entity">MULT</span> <span class="main">=</span> Conv.rewr_conv <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> mult.left_commute<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span>
    <span class="main">|</span> <span class="entity">extract_middle_conv</span> <span class="entity">DIVIDE</span> <span class="main">=</span> Conv.rewr_conv <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> extract_divide_middle<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">repeat_conv</span> <span class="inner_numeral">0</span> <span class="main">_</span> <span class="main">=</span> Conv.all_conv
    <span class="main">|</span> <span class="entity">repeat_conv</span> <span class="entity">n</span> <span class="entity">conv</span> <span class="main">=</span> <span class="entity">conv</span> then_conv <span class="entity">repeat_conv</span> <span class="main">(</span><span class="entity">n</span> - <span class="inner_numeral">1</span><span class="main">)</span> <span class="entity">conv</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">eliminate_double_inverse_conv</span> <span class="main">=</span> Conv.rewr_conv <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> inverse_inverse_eq<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span>
<span class="keyword2"><span class="keyword">in</span></span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">extract_leaf_conv</span> <span class="entity">path</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">count_inversions</span> <span class="main">[</span><span class="main">]</span> <span class="entity">acc</span> <span class="main">=</span> <span class="entity">acc</span> div <span class="inner_numeral">2</span>
      <span class="main">|</span> <span class="entity">count_inversions</span> <span class="main">(</span><span class="entity">RIGHT</span> <span class="entity">DIVIDE</span> :: <span class="entity">xs</span><span class="main">)</span> <span class="entity">acc</span> <span class="main">=</span> <span class="entity">count_inversions</span> <span class="entity">xs</span> <span class="main">(</span><span class="entity">acc</span>+<span class="inner_numeral">1</span><span class="main">)</span>
      <span class="main">|</span> <span class="entity">count_inversions</span> <span class="main">(</span><span class="main">_</span> :: <span class="entity">xs</span><span class="main">)</span> <span class="entity">acc</span> <span class="main">=</span> <span class="entity">count_inversions</span> <span class="entity">xs</span> <span class="entity">acc</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">l_conv</span> <span class="main">=</span> Conv.fun_conv o Conv.arg_conv
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">r_conv</span> <span class="main">=</span> Conv.arg_conv
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">go</span> <span class="main">[</span><span class="main">]</span> <span class="main">=</span> Conv.all_conv
      <span class="main">|</span> <span class="entity">go</span> <span class="main">[</span><span class="entity">LEFT</span> <span class="entity">oper</span><span class="main">]</span> <span class="main">=</span> <span class="entity">to_mult_conv</span> <span class="entity">oper</span>
      <span class="main">|</span> <span class="entity">go</span> <span class="main">[</span><span class="entity">RIGHT</span> <span class="entity">oper</span><span class="main">]</span> <span class="main">=</span> <span class="entity">commute_conv</span> <span class="entity">oper</span>
      <span class="main">|</span> <span class="entity">go</span> <span class="main">(</span><span class="entity">LEFT</span> <span class="entity">oper</span> :: <span class="entity">path</span><span class="main">)</span> <span class="main">=</span> <span class="entity">l_conv</span> <span class="main">(</span><span class="entity">go</span> <span class="entity">path</span><span class="main">)</span> then_conv <span class="entity">assoc_conv</span> <span class="entity">oper</span>
      <span class="main">|</span> <span class="entity">go</span> <span class="main">(</span><span class="entity">RIGHT</span> <span class="entity">oper</span> :: <span class="entity">path</span><span class="main">)</span> <span class="main">=</span> <span class="entity">r_conv</span> <span class="main">(</span><span class="entity">go</span> <span class="entity">path</span><span class="main">)</span> then_conv <span class="entity">extract_middle_conv</span> <span class="entity">oper</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">go</span> <span class="entity">path</span> then_conv 
      <span class="entity">repeat_conv</span> <span class="main">(</span><span class="entity">count_inversions</span> <span class="entity">path</span> <span class="inner_numeral">0</span><span class="main">)</span> <span class="main">(</span><span class="entity">l_conv</span> <span class="entity">eliminate_double_inverse_conv</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">filterT</span> <span class="entity">T</span> <span class="main">=</span> Type <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">type_name</span> Filter.filter<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">[</span><span class="entity">T</span><span class="main">]</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cancel_factor_conv'</span> <span class="entity">ctxt</span> <span class="entity">ct</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t</span> <span class="main">=</span> Thm.term_of <span class="entity">ct</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">f</span><span class="main">,</span> <span class="main">(</span><span class="entity">L</span><span class="main">,</span> <span class="entity">fltr</span><span class="main">,</span> <span class="entity">g</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="entity">dest_member</span> <span class="entity">t</span> ||&gt; <span class="entity">dest_landau</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">landau_symbol_thm</span> <span class="main">=</span> <span class="entity">get_landau_symbol_thm</span> <span class="entity">L</span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">dest_abs</span> <span class="entity">t</span> <span class="main">=</span>
      <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">t</span> <span class="keyword2"><span class="keyword">of</span></span>
        Abs <span class="entity">a</span> <span class="main">=&gt;</span> <span class="entity">a</span>
      <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> CTERM <span class="main">(</span><span class="inner_quoted">"cancel_factor_simproc"</span><span class="main">,</span> <span class="main">[</span><span class="entity">ct</span><span class="main">]</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="main">(</span><span class="entity">x_name1</span><span class="main">,</span> <span class="entity">S</span><span class="main">,</span> <span class="entity">f_body</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="entity">x_name2</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="entity">g_body</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="entity">dest_abs</span> <span class="entity">f</span><span class="main">,</span> <span class="entity">dest_abs</span> <span class="entity">g</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">T</span> <span class="main">=</span> Term.fastype_of <span class="entity">f</span> |&gt; Term.dest_funT |&gt; snd
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">abs</span> <span class="entity">x</span> <span class="entity">body</span> <span class="main">=</span> Abs <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">S</span><span class="main">,</span> <span class="entity">body</span><span class="main">)</span>

    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_eventually_nonzero</span> <span class="entity">t</span> <span class="main">=</span>
      Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> eventually_nonzero<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">filterT</span> <span class="entity">S</span> --&gt; <span class="main">(</span><span class="entity">S</span> --&gt; <span class="entity">T</span><span class="main">)</span> --&gt; <span class="entity">HOLogic.boolT</span><span class="main">)</span> $ 
        <span class="entity">fltr</span> $  <span class="entity">t</span>

    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">f_leaves</span><span class="main">,</span> <span class="entity">g_leaves</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="entity">pick_leaf</span> <span class="entity">f_body</span> <span class="entity">T</span><span class="main">,</span> <span class="entity">pick_leaf</span> <span class="entity">g_body</span> <span class="entity">T</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cancel'</span> <span class="main">(</span><span class="entity">t</span><span class="main">,</span> <span class="entity">rest1</span><span class="main">,</span> <span class="entity">path1</span><span class="main">)</span> <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="entity">rest2</span><span class="main">,</span> <span class="entity">path2</span><span class="main">)</span> <span class="main">=</span> 
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="entity">HOLogic.mk_Trueprop</span> <span class="main">(</span><span class="entity">mk_eventually_nonzero</span> <span class="main">(</span><span class="entity">abs</span> <span class="entity">x_name1</span> <span class="entity">t</span><span class="main">)</span><span class="main">)</span>
        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">tac</span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=</span> 
          <span class="keyword2"><span class="keyword">let</span></span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">simps</span> <span class="main">=</span> <span class="entity">Named_Theorems.get</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">named_theorems</span> eventually_nonzero_simps<span class="antiquote">}</span></span>
          <span class="keyword2"><span class="keyword">in</span></span>
            ALLGOALS <span class="main">(</span><span class="entity">Simplifier.asm_full_simp_tac</span> <span class="main">(</span><span class="entity">ctxt</span> addsimps <span class="entity">simps</span><span class="main">)</span><span class="main">)</span>
          <span class="keyword2"><span class="keyword">end</span></span>
        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">do_cancel</span> <span class="entity">thm</span> <span class="main">=</span>
          <span class="keyword2"><span class="keyword">let</span></span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thms</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thm'</span> <span class="main">=&gt;</span> <span class="entity">thm'</span> OF <span class="main">[</span><span class="entity">landau_symbol_thm</span><span class="main">,</span> <span class="entity">thm</span><span class="main">]</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> eq_reflection<span class="antiquote">}</span></span></span><span class="main">)</span>
                         <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> landau_mult_cancel_simps<span class="antiquote">}</span></span></span>
          <span class="keyword2"><span class="keyword">in</span></span>
            <span class="entity">ct</span> |&gt; <span class="main">(</span>
              Conv.fun_conv <span class="main">(</span>Conv.arg_conv <span class="main">(</span>Conv.abs_conv <span class="main">(</span>K <span class="main">(</span><span class="entity">extract_leaf_conv</span> <span class="entity">path1</span><span class="main">)</span><span class="main">)</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span>
              then_conv <span class="main">(</span>Conv.arg_conv <span class="main">(</span>Conv.arg_conv <span class="main">(</span>Conv.abs_conv <span class="main">(</span>K <span class="main">(</span><span class="entity">extract_leaf_conv</span> <span class="entity">path2</span><span class="main">)</span><span class="main">)</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              then_conv <span class="main">(</span>Conv.rewrs_conv <span class="entity">thms</span><span class="main">)</span>
            <span class="main">)</span>
          <span class="keyword2"><span class="keyword">end</span></span>
      <span class="keyword2"><span class="keyword">in</span></span>
        Option.map <span class="entity">do_cancel</span> <span class="main">(</span>try <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">)</span> <span class="main">=&gt;</span> Goal.prove <span class="entity">ctxt</span> <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="entity">prop</span> <span class="entity">tac</span><span class="main">)</span> <span class="main">(</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">end</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">not_one</span> <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Groups.one<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> false
      <span class="main">|</span> <span class="entity">not_one</span> <span class="main">_</span> <span class="main">=</span> true
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cancel</span> <span class="main">(</span><span class="entity">leaf1</span> <span class="keyword1"><span class="keyword">as</span></span> <span class="main">(</span><span class="entity">t1</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="entity">leaf2</span> <span class="keyword1"><span class="keyword">as</span></span> <span class="main">(</span><span class="entity">t2</span><span class="main">,</span> <span class="main">_</span><span class="main">,</span> <span class="main">_</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">t1</span> <span class="main">=</span> <span class="entity">t2</span> <span class="keyword1"><span class="keyword">andalso</span></span> <span class="entity">not_one</span> <span class="entity">t1</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">cancel'</span> <span class="entity">leaf1</span> <span class="entity">leaf2</span> <span class="keyword2"><span class="keyword">else</span></span> NONE
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="keyword2"><span class="keyword">case</span></span> <span class="main">(</span>get_first <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">leaf1</span> <span class="main">=&gt;</span> get_first <span class="main">(</span><span class="entity">cancel</span> <span class="entity">leaf1</span><span class="main">)</span> <span class="entity">g_leaves</span><span class="main">)</span> <span class="entity">f_leaves</span><span class="main">)</span> <span class="keyword2"><span class="keyword">of</span></span>
      NONE <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> CTERM <span class="main">(</span><span class="inner_quoted">"cancel_factor_conv"</span><span class="main">,</span> <span class="main">[</span><span class="entity">ct</span><span class="main">]</span><span class="main">)</span>
    <span class="main">|</span> SOME <span class="entity">thm</span> <span class="main">=&gt;</span> <span class="entity">thm</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">cancel_factor_conv</span> <span class="entity">ctxt</span> <span class="main">=</span> 
  Conv.fun_conv <span class="main">(</span>Conv.arg_conv Thm.eta_long_conversion<span class="main">)</span>
  then_conv Conv.arg_conv <span class="main">(</span>Conv.arg_conv Thm.eta_long_conversion<span class="main">)</span>
  then_conv <span class="entity">cancel_factor_conv'</span> <span class="entity">ctxt</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">cancel_factor_simproc</span> <span class="main">=</span> try o <span class="entity">cancel_factor_conv</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">plus_absorb_thms1</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> landau_symbols<span class="main">[</span><span class="operator">THEN</span> landau_symbol.plus_absorb1<span class="main">]</span><span class="antiquote">}</span></span></span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">plus_absorb_thms2</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> landau_symbols<span class="main">[</span><span class="operator">THEN</span> landau_symbol.plus_absorb2<span class="main">]</span><span class="antiquote">}</span></span></span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">minus_absorb_thms1</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> landau_symbols<span class="main">[</span><span class="operator">THEN</span> landau_symbol.diff_absorb1<span class="main">]</span><span class="antiquote">}</span></span></span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">minus_absorb_thms2</span> <span class="main">=</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> landau_symbols<span class="main">[</span><span class="operator">THEN</span> landau_symbol.diff_absorb2<span class="main">]</span><span class="antiquote">}</span></span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">sum_term_size</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">go</span> <span class="entity">acc</span> <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "Groups.plus"<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">l</span> $ <span class="entity">r</span><span class="main">)</span> <span class="main">=</span> <span class="entity">go</span> <span class="main">(</span><span class="entity">go</span> <span class="entity">acc</span> <span class="entity">l</span><span class="main">)</span> <span class="entity">r</span>
      <span class="main">|</span> <span class="entity">go</span> <span class="entity">acc</span> <span class="main">(</span>Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "Groups.minus"<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">l</span> $ <span class="entity">r</span><span class="main">)</span> <span class="main">=</span> <span class="entity">go</span> <span class="main">(</span><span class="entity">go</span> <span class="entity">acc</span> <span class="entity">l</span><span class="main">)</span> <span class="entity">r</span>
      <span class="main">|</span> <span class="entity">go</span> <span class="entity">acc</span> <span class="main">_</span> <span class="main">=</span> <span class="entity">acc</span> + <span class="inner_numeral">1</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">go</span> <span class="inner_numeral">0</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">local</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_smallo</span> <span class="entity">fltr</span> <span class="entity">S</span> <span class="entity">T</span> <span class="main">=</span> 
    Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> smallo<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">filterT</span> <span class="entity">S</span> --&gt; <span class="main">(</span><span class="entity">S</span> --&gt; <span class="entity">T</span><span class="main">)</span> --&gt; <span class="entity">HOLogic.mk_setT</span> <span class="main">(</span><span class="entity">S</span> --&gt; <span class="entity">T</span><span class="main">)</span><span class="main">)</span> $ <span class="entity">fltr</span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_member</span> <span class="entity">T</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> Set.member<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">T</span> --&gt; <span class="entity">HOLogic.mk_setT</span> <span class="entity">T</span> --&gt; <span class="entity">HOLogic.boolT</span><span class="main">)</span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_in_smallo</span> <span class="entity">fltr</span> <span class="entity">S</span> <span class="entity">T</span> <span class="entity">f</span> <span class="entity">g</span> <span class="main">=</span> <span class="entity">mk_member</span> <span class="main">(</span><span class="entity">S</span> --&gt; <span class="entity">T</span><span class="main">)</span> $ <span class="entity">f</span> $ <span class="main">(</span><span class="entity">mk_smallo</span> <span class="entity">fltr</span> <span class="entity">S</span> <span class="entity">T</span> $ <span class="entity">g</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">in</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">simplify_landau_sum_simproc</span> <span class="entity">ctxt</span> <span class="entity">ct</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t</span> <span class="main">=</span> Thm.term_of <span class="entity">ct</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">L</span><span class="main">,</span> <span class="entity">fltr</span><span class="main">,</span> <span class="entity">f</span><span class="main">)</span> <span class="main">=</span> <span class="entity">dest_landau</span> <span class="entity">t</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">L_name</span> <span class="main">=</span> dest_Const <span class="entity">L</span> |&gt; fst
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">x_name</span><span class="main">,</span> <span class="entity">S</span><span class="main">,</span> <span class="entity">f_body</span><span class="main">)</span> <span class="main">=</span> 
        <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">f</span> <span class="keyword2"><span class="keyword">of</span></span>
          Abs <span class="entity">a</span> <span class="main">=&gt;</span> <span class="entity">a</span>
        <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> CTERM <span class="main">(</span><span class="inner_quoted">"simplify_landau_sum_conv"</span><span class="main">,</span> <span class="main">[</span><span class="entity">ct</span><span class="main">]</span><span class="main">)</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">limit</span> <span class="main">=</span> Config.get <span class="entity">ctxt</span> <span class="entity">landau_sum_limit</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> 
        <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">limit</span> &lt; <span class="inner_numeral">0</span> <span class="keyword1"><span class="keyword">orelse</span></span> <span class="entity">sum_term_size</span> <span class="entity">f_body</span> &lt;= <span class="entity">limit</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="main">(</span><span class="main">)</span>
        <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword3"><span class="keyword">raise</span></span> CTERM <span class="main">(</span><span class="inner_quoted">"simplify_landau_sum_conv"</span><span class="main">,</span> <span class="main">[</span><span class="entity">ct</span><span class="main">]</span><span class="main">)</span>

      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">T</span> <span class="main">=</span> Term.fastype_of <span class="entity">f</span> |&gt; Term.dest_funT |&gt; snd
      <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">abs</span> <span class="entity">t</span> <span class="main">=</span> Abs <span class="main">(</span><span class="entity">x_name</span><span class="main">,</span> <span class="entity">S</span><span class="main">,</span> <span class="entity">t</span><span class="main">)</span>

      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">minus</span><span class="main">,</span> <span class="entity">l</span><span class="main">,</span> <span class="entity">r</span><span class="main">)</span> <span class="main">=</span>
        <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">f_body</span> <span class="keyword2"><span class="keyword">of</span></span>
          Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "Groups.plus"<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">l</span> $ <span class="entity">r</span> <span class="main">=&gt;</span> <span class="main">(</span>false<span class="main">,</span> <span class="entity">abs</span> <span class="entity">l</span><span class="main">,</span> <span class="entity">abs</span> <span class="entity">r</span><span class="main">)</span>
        <span class="main">|</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "Groups.minus"<span class="antiquote">}</span></span><span class="main">,</span> <span class="main">_</span><span class="main">)</span> $ <span class="entity">l</span> $ <span class="entity">r</span> <span class="main">=&gt;</span> <span class="main">(</span>true<span class="main">,</span> <span class="entity">abs</span> <span class="entity">l</span><span class="main">,</span> <span class="entity">abs</span> <span class="entity">r</span><span class="main">)</span>
        <span class="main">|</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> CTERM <span class="main">(</span><span class="inner_quoted">"simplify_landau_sum_simproc"</span><span class="main">,</span> <span class="main">[</span><span class="entity">ct</span><span class="main">]</span><span class="main">)</span>

      <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_absorb_thm</span> <span class="entity">absorb_thms</span> <span class="entity">thm</span> <span class="main">=</span>
        <span class="keyword2"><span class="keyword">let</span></span> 
          <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">go</span> <span class="main">(</span><span class="entity">s</span> :: <span class="entity">ss</span><span class="main">)</span> <span class="main">(</span><span class="entity">thm</span> :: <span class="entity">thms</span><span class="main">)</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">s</span> <span class="main">=</span> <span class="entity">L_name</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">thm</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">go</span> <span class="entity">ss</span> <span class="entity">thms</span>
            <span class="main">|</span> <span class="entity">go</span> <span class="main">_</span> <span class="main">_</span> <span class="main">=</span> <span class="keyword3"><span class="keyword">raise</span></span> CTERM <span class="main">(</span><span class="inner_quoted">"simplify_landau_sum_conv"</span><span class="main">,</span> <span class="main">[</span><span class="entity">ct</span><span class="main">]</span><span class="main">)</span>
        <span class="keyword2"><span class="keyword">in</span></span>
          <span class="main">(</span><span class="entity">thm</span> RS <span class="entity">go</span> <span class="entity">landau_const_names</span> <span class="entity">absorb_thms</span><span class="main">)</span> RS <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> eq_reflection<span class="antiquote">}</span></span></span>
        <span class="keyword2"><span class="keyword">end</span></span>

      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">absorb_thms1</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">minus</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">minus_absorb_thms1</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">plus_absorb_thms1</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">absorb_thms2</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">minus</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">minus_absorb_thms2</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">plus_absorb_thms2</span>
      
      <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">eliminate</span> <span class="main">(</span><span class="entity">absorb_thms</span><span class="main">,</span> <span class="entity">l</span><span class="main">,</span> <span class="entity">r</span><span class="main">)</span> <span class="main">=</span> 
        <span class="keyword2"><span class="keyword">let</span></span>
          <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">tac</span> <span class="main">{</span>context <span class="main">=</span> <span class="entity">ctxt</span><span class="main">,</span> <span class="main">...</span><span class="main">}</span> <span class="main">=</span>
                <span class="entity">Simplifier.asm_full_simp_tac</span> <span class="entity">ctxt</span> <span class="inner_numeral">1</span>
                THEN TRY <span class="main">(</span>resolve_tac <span class="entity">ctxt</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> TrueI<span class="antiquote">}</span></span></span> <span class="inner_numeral">1</span><span class="main">)</span>
          <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">prop</span> <span class="main">=</span> <span class="entity">HOLogic.mk_Trueprop</span> <span class="main">(</span><span class="entity">mk_in_smallo</span> <span class="entity">fltr</span> <span class="entity">S</span> <span class="entity">T</span> <span class="entity">l</span> <span class="entity">r</span><span class="main">)</span>
        <span class="keyword2"><span class="keyword">in</span></span>
          <span class="keyword2"><span class="keyword">case</span></span> try <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="main">)</span> <span class="main">=&gt;</span> Goal.prove <span class="entity">ctxt</span> <span class="main">[</span><span class="main">]</span> <span class="main">[</span><span class="main">]</span> <span class="entity">prop</span> <span class="entity">tac</span><span class="main">)</span> <span class="main">(</span><span class="main">)</span> <span class="keyword2"><span class="keyword">of</span></span>
            NONE <span class="main">=&gt;</span> NONE
          <span class="main">|</span> SOME <span class="entity">thm</span> <span class="main">=&gt;</span> SOME <span class="main">(</span><span class="entity">mk_absorb_thm</span> <span class="entity">absorb_thms</span> <span class="entity">thm</span><span class="main">)</span>
              
        <span class="keyword2"><span class="keyword">end</span></span>
    <span class="keyword2"><span class="keyword">in</span></span>
      get_first <span class="entity">eliminate</span> <span class="main">[</span><span class="main">(</span><span class="entity">absorb_thms1</span><span class="main">,</span> <span class="entity">l</span><span class="main">,</span> <span class="entity">r</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="entity">absorb_thms2</span><span class="main">,</span> <span class="entity">r</span><span class="main">,</span> <span class="entity">l</span><span class="main">)</span><span class="main">]</span>
    <span class="keyword2"><span class="keyword">end</span></span>
      <span class="keyword3"><span class="keyword">handle</span></span> TERM <span class="main">_</span> <span class="main">=&gt;</span> NONE <span class="main">|</span> CTERM <span class="main">_</span> <span class="main">=&gt;</span> NONE
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">simplify_landau_sum_conv</span> <span class="entity">ctxt</span> <span class="entity">ct</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">simplify_landau_sum_simproc</span> <span class="entity">ctxt</span> <span class="entity">ct</span> <span class="keyword2"><span class="keyword">of</span></span>
    SOME <span class="entity">thm</span> <span class="main">=&gt;</span> <span class="entity">thm</span>
  <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> CTERM <span class="main">(</span><span class="inner_quoted">"simplify_landau_sum_conv"</span><span class="main">,</span> <span class="main">[</span><span class="entity">ct</span><span class="main">]</span><span class="main">)</span>


<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">changed_conv</span> <span class="entity">conv</span> <span class="entity">ct</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thm</span> <span class="main">=</span> <span class="entity">conv</span> <span class="entity">ct</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">is_reflexive</span> <span class="main">(</span><span class="entity">ct1</span><span class="main">,</span> <span class="entity">ct2</span><span class="main">)</span> <span class="main">=</span> Envir.beta_eta_contract <span class="entity">ct1</span> aconv Envir.beta_eta_contract <span class="entity">ct2</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">is_reflexive</span> <span class="main">(</span>Logic.dest_equals <span class="main">(</span>Thm.prop_of <span class="entity">thm</span><span class="main">)</span><span class="main">)</span> <span class="keyword2"><span class="keyword">then</span></span>
      <span class="keyword3"><span class="keyword">raise</span></span> CTERM <span class="main">(</span><span class="inner_quoted">"changed_conv"</span><span class="main">,</span> <span class="main">[</span><span class="entity">ct</span><span class="main">]</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">else</span></span>
      <span class="entity">thm</span>
    <span class="keyword3"><span class="keyword">handle</span></span> TERM <span class="main">_</span> <span class="main">=&gt;</span> <span class="entity">thm</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">landau_conv</span> <span class="entity">conv</span> <span class="entity">ctxt</span> <span class="main">=</span> <span class="entity">changed_conv</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">ct</span> <span class="main">=&gt;</span>
  <span class="keyword2"><span class="keyword">let</span></span> 
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t</span> <span class="main">=</span> Thm.term_of <span class="entity">ct</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">L</span> <span class="keyword1"><span class="keyword">as</span></span> <span class="main">(</span>Const <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="entity">fltr</span><span class="main">,</span> <span class="entity">f</span><span class="main">)</span> <span class="main">=</span> <span class="entity">dest_landau</span> <span class="entity">t</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">cong</span> <span class="main">=</span> <span class="entity">get_bigtheta_cong</span> <span class="entity">L</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ct'</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> bigtheta<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> $ <span class="entity">fltr</span> $ <span class="entity">f</span> |&gt; Thm.cterm_of <span class="entity">ctxt</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">conv</span> <span class="entity">ct'</span> RS <span class="entity">cong</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span>
  

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">simplify_landau_product_conv</span> <span class="entity">ctxt</span> <span class="entity">ct</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt1</span> <span class="main">=</span> put_simpset <span class="entity">HOL_basic_ss</span> <span class="entity">ctxt</span> addsimps <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> bigtheta_factors_eq<span class="antiquote">}</span></span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt2</span> <span class="main">=</span> <span class="entity">ctxt</span> addsimps <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> <span class="dynamic"><span class="dynamic">landau_simps</span></span><span class="antiquote">}</span></span></span> delsimprocs <span class="main">(</span><span class="entity">landau_simprocs</span> <span class="entity">ctxt</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt3</span> <span class="main">=</span> put_simpset <span class="entity">HOL_basic_ss</span> <span class="entity">ctxt</span> addsimps <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> bigtheta_factors_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span><span class="antiquote">}</span></span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">conv</span> <span class="main">=</span> 
      <span class="entity">Simplifier.rewrite</span> <span class="entity">ctxt1</span> 
      then_conv <span class="entity">Simplifier.asm_full_rewrite</span> <span class="entity">ctxt2</span>
      then_conv <span class="entity">Simplifier.rewrite</span> <span class="entity">ctxt3</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">landau_conv</span> <span class="main">(</span><span class="entity">changed_conv</span> <span class="entity">conv</span><span class="main">)</span> <span class="entity">ctxt</span> <span class="entity">ct</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">simplify_landau_product_simproc</span> <span class="main">=</span> try o <span class="entity">simplify_landau_product_conv</span>



<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">reify_prod_bigtheta_conv</span> <span class="entity">ctxt</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ss</span> <span class="main">=</span> simpset_of <span class="main">(</span><span class="entity">ctxt</span> addsimps <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> <span class="dynamic"><span class="dynamic">eventually_nonzero_simps</span></span> eventually_nonneg_primfun<span class="antiquote">}</span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">set_subgoaler</span> <span class="main">=</span> <span class="entity">Simplifier.set_subgoaler</span> <span class="main">(</span><span class="entity">asm_full_simp_tac</span> o put_simpset <span class="entity">ss</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">put_ss</span> <span class="entity">thms</span> <span class="entity">ctxt</span> <span class="main">=</span> put_simpset <span class="entity">HOL_basic_ss</span> <span class="entity">ctxt</span> addsimps <span class="entity">thms</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt_transforms</span> <span class="main">=</span> 
      <span class="main">[</span>
        <span class="entity">set_subgoaler</span> o <span class="entity">put_ss</span> 
          <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> set_divide_inverse <span class="dynamic"><span class="dynamic">eventually_nonzero_simps</span></span> 
            bigtheta_mult_eq_set_mult bigtheta_inverse_eq_set_inverse bigtheta_divide_eq_set_divide 
            bigtheta_pow_eq_set_pow landau_product_preprocess 
            mult_1_left mult_1_right inverse_1 set_powr_mult power_one<span class="antiquote">}</span></span></span><span class="main">,</span>
        <span class="entity">put_ss</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> BIGTHETA_CONST'_tag mult_1_left mult_1_right inverse_1 power_one<span class="antiquote">}</span></span></span><span class="main">,</span>
        <span class="entity">put_ss</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> BIGTHETA_FUN_tag mult_1_left mult_1_right inverse_1 power_one<span class="antiquote">}</span></span></span><span class="main">,</span>
        <span class="entity">put_ss</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> BIGTHETA_CONST_fold mult_1_left mult_1_right inverse_1 power_one<span class="antiquote">}</span></span></span><span class="main">,</span>
        <span class="entity">put_ss</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> bigtheta_factors_eq<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> eval_inverse_primfun<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
          eval_powr_primfun<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> inverse_primfun.simps powr_primfun.simps<span class="antiquote">}</span></span></span><span class="main">,</span>
        <span class="entity">put_ss</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> LANDAU_PROD'_fold append.simps mult_1_left mult_1_right minus_minus power_one<span class="antiquote">}</span></span></span>
      <span class="main">]</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">convs</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">f</span> <span class="main">=&gt;</span> <span class="entity">Simplifier.rewrite</span> <span class="main">(</span><span class="entity">f</span> <span class="entity">ctxt</span><span class="main">)</span><span class="main">)</span> <span class="entity">ctxt_transforms</span>
  <span class="keyword2"><span class="keyword">in</span></span> 
    Conv.try_conv <span class="main">(</span>Conv.arg_conv Thm.eta_long_conversion<span class="main">)</span>
    then_conv Conv.rewr_conv <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thm</span> BIGTHETA_CONST_tag<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span>
    then_conv Conv.every_conv <span class="entity">convs</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">reify_landau_prod_prop_conv</span> <span class="entity">ctxt</span> <span class="entity">ct</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t</span> <span class="main">=</span> Thm.term_of <span class="entity">ct</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">f</span><span class="main">,</span> <span class="entity">t</span><span class="main">)</span> <span class="main">=</span> <span class="entity">dest_member</span> <span class="entity">t</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">L</span> <span class="keyword1"><span class="keyword">as</span></span> <span class="main">(</span>Const <span class="main">(</span><span class="main">_</span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="entity">fltr</span><span class="main">,</span> <span class="entity">g</span><span class="main">)</span> <span class="main">=</span> <span class="entity">dest_landau</span> <span class="entity">t</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">cong</span> <span class="main">=</span> nth <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> landau_symbols<span class="main">[</span><span class="operator">THEN</span> landau_prod_meta_cong<span class="main">]</span><span class="antiquote">}</span></span></span> <span class="main">(</span><span class="entity">get_landau_id</span> <span class="entity">L</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mk_thm</span> <span class="entity">f</span> <span class="main">=</span> Const <span class="main">(</span><span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> bigtheta<span class="antiquote">}</span></span><span class="main">,</span> <span class="entity">T</span><span class="main">)</span> $ <span class="entity">fltr</span> $ <span class="entity">f</span> |&gt;
      Thm.cterm_of <span class="entity">ctxt</span> |&gt; <span class="entity">reify_prod_bigtheta_conv</span> <span class="entity">ctxt</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">thm1</span><span class="main">,</span> <span class="entity">thm2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="entity">mk_thm</span> <span class="entity">f</span><span class="main">,</span> <span class="entity">mk_thm</span> <span class="entity">g</span><span class="main">)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">thm</span> <span class="main">=</span> <span class="entity">cong</span> OF <span class="main">[</span><span class="entity">thm1</span><span class="main">,</span> <span class="entity">thm2</span><span class="main">]</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">thm</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">simplify_landau_real_prod_prop_conv</span> <span class="entity">ctxt</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt'</span> <span class="main">=</span> put_simpset <span class="entity">HOL_ss</span> <span class="entity">ctxt</span> addsimps 
      <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> list.map inverse_primfun.simps minus_minus append.simps<span class="antiquote">}</span></span></span>
  <span class="keyword2"><span class="keyword">in</span></span>
    Conv.try_conv <span class="main">(</span>Conv.rewrs_conv <span class="main">(</span><span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> bigomega_iff_bigo<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span> 
      smallomega_iff_smallo<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span><span class="main">)</span><span class="main">)</span>
    then_conv <span class="entity">reify_landau_prod_prop_conv</span> <span class="entity">ctxt</span>
    then_conv <span class="entity">Simplifier.rewrite</span> <span class="entity">ctxt'</span>
    then_conv Conv.rewrs_conv <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">thms</span> LANDAU_PROD_iff<span class="main">[</span><span class="operator">THEN</span> eq_reflection<span class="main">]</span><span class="antiquote">}</span></span></span> 
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">simplify_landau_real_prod_prop_simproc</span> <span class="main">=</span> try o <span class="entity">simplify_landau_real_prod_prop_conv</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Landau_More">
<div class="head">
<h1>Theory Landau_More</h1>
</div>
<pre class="source"><span class="comment1">(*
  File:   Landau_More.thy
  Author: Andreas Lochbihler, Manuel Eberl &lt;eberlm@in.tum.de&gt;

  Some more facts about Landau symbols.
*)</span>
<span class="keyword1"><span class="command">theory</span></span> Landau_More
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Landau_Symbols.html">HOL-Library.Landau_Symbols</a>"</span>
  <a href="Landau_Simprocs.html">Landau_Simprocs</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(* Additional theorems, contributed by Andreas Lochbihler and adapted by Manuel Eberl *)</span>

<span class="keyword1"><span class="command">lemma</span></span> bigo_const_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">⟷</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">eventually_nonzero_simps</span></span> smallomega_iff_smallo filterlim_at_top_iff_smallomega<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">eventually_nonzero_simps</span></span> <span class="dynamic"><span class="dynamic">landau_divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> landau_o.small_refl_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> smallo_const_inverse <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">≠</span> bot <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> landau_o.small_imp_big<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> const_in_smallo_const <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main">::</span> <span class="main">_</span> <span class="main">::</span> linorder<span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> landau_o.small_refl_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> smallomega_1_conv_filterlim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> <span class="keyword1">ω[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">⟷</span> filterlim <span class="free">f</span> at_infinity <span class="free">F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> smallomegaI_filterlim_at_infinity <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> smallomegaD_filterlim_at_infinity<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> bigtheta_powr_1 <span class="main">[</span><span class="operator">landau_simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_powr_0 <span class="main">[</span><span class="operator">landau_simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_powr_nonzero <span class="main">[</span><span class="operator">landau_simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_powr_nonzero' <span class="main">[</span><span class="operator">landau_simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_powr_nonneg <span class="main">[</span><span class="operator">landau_simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bigtheta_powr_nonneg' <span class="main">[</span><span class="operator">landau_simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="free">h</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">Θ[</span><span class="free">F</span><span class="main">](</span><span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> bigthetaI_cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>    

<span class="keyword1"><span class="command">lemma</span></span> bigo_powr_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">with</span></span> assms bigo_powr<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="free">p</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr <span class="dynamic"><span class="dynamic">landau_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bigo_powr_nonneg<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> inverse_powr <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span>real<span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"inverse <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">=</span> inverse <span class="main">(</span><span class="free">x</span> <span class="keyword1">powr</span> <span class="free">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inverse <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">y</span> <span class="main">=</span> exp <span class="main">(</span><span class="free">y</span> <span class="main">*</span> ln <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ln <span class="main">(</span>inverse <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span>ln <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> x ln_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="free">y</span> <span class="main">*</span> <span class="main">-</span>ln <span class="free">x</span><span class="main">)</span> <span class="main">=</span> inverse <span class="main">(</span>exp <span class="main">(</span><span class="free">y</span> <span class="main">*</span> ln <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> exp_minus<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"exp <span class="main">(</span><span class="free">y</span> <span class="main">*</span> ln <span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="keyword1">powr</span> <span class="free">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_def<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bigo_neg_powr_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
                  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">g</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>inverse <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.big.cong_ex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_minus <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> bigo_powr_iff<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="free">g</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> landau_o.big.inverse_cancel<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> smallo_powr_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?lhs</span></span></span>
  <span class="keyword1"><span class="command">with</span></span> assms smallo_powr<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"inverse <span class="free">p</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?rhs</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr <span class="dynamic"><span class="dynamic">landau_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smallo_powr_nonneg<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> smallo_neg_powr_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
                  <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">g</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?lhs</span> <span class="main">⟷</span> <span class="var">?rhs</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span>
          <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>inverse <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">-</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> landau_o.small.cong_ex<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_minus <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> smallo_powr_iff<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⟷</span> <span class="free">g</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> landau_o.small.inverse_cancel<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>    

<span class="keyword1"><span class="command">lemma</span></span> const_smallo_powr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
     <span class="main">(</span><span class="operator">insert</span> assms smallo_powr_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="bound"><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> smallo_neg_powr_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="bound"><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">landau_simps</span></span> <span class="dynamic"><span class="dynamic">eventually_nonzero_simps</span></span> smallo_1_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">F</span></span> <span class="quoted"><span class="free">f</span></span><span class="main"><span class="main">]</span></span> not_less 
           <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> landau_o.small_asymmetric <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eventually_False landau_o.small_refl_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bigo_const_powr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> bot"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">p</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top_iff_smallomega smallomega_iff_smallo landau_o.small_imp_big<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∉</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> landau_o.small_imp_big <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> landau_o.small_big_asymmetric<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> linorder_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
       <span class="main">(</span><span class="operator">insert</span> insert assms A B bigo_powr_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="bound"><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> bigo_neg_powr_iff<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="bound"><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
        <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">landau_simps</span></span> <span class="dynamic"><span class="dynamic">eventually_nonzero_simps</span></span> not_less <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> landau_o.small_asymmetric<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> filterlim_powr_at_top<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">b</span><span class="main">::</span>real<span class="main">)</span> <span class="main">&gt;</span> <span class="main">1</span> <span class="main">⟹</span> filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">b</span> <span class="keyword1">powr</span> <span class="bound">x</span><span class="main">)</span> at_top at_top"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> powr_def mult.commute<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"ln <span class="free">b</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exp_at_top<span class="main"><span class="main">]</span></span> 
        filterlim_tendsto_pos_mult_at_top filterlim_ident<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> power_smallo_exponential<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">b</span> <span class="main">::</span> <span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">b</span> <span class="keyword1">powr</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> smalloI_tendsto<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">*</span> ln <span class="free">b</span> <span class="main">-</span> <span class="free">n</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span> at_top at_top"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> simplify_landau_sum<span class="main">]</span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top_iff_smallomega <span class="dynamic"><span class="dynamic">eventually_nonzero_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> exp <span class="main">(</span><span class="main">-</span><span class="main">(</span><span class="bound">x</span> <span class="main">*</span> ln <span class="free">b</span> <span class="main">-</span> <span class="free">n</span> <span class="main">*</span> ln <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> exp_at_bot<span class="main"><span class="main">]</span></span> 
              filterlim_compose<span class="main"><span class="main">[</span></span><span class="operator">OF</span> filterlim_uminus_at_bot_at_top<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">n</span> <span class="main">/</span> <span class="free">b</span> <span class="keyword1">powr</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span>
    <span class="keyword1"><span class="command">using</span></span> b eventually_gt_at_top<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> tendsto_cong<span class="main">)</span> 
       <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> exp_diff powr_def <span class="dynamic"><span class="dynamic">field_simps</span></span> exp_of_nat_mult <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> eventually_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">n</span> <span class="main">/</span> <span class="free">b</span> <span class="keyword1">powr</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⤏</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">eventually_nonzero_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> powr_fast_growth_tendsto<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> gf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">k</span> <span class="keyword1">powr</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> f <span class="keyword1"><span class="command">have</span></span> f'<span class="main">:</span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">eventually_nonzero_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> gf <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> norm <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> landau_o.bigE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> c<span class="main">(</span>2<span class="main">)</span> g f' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">c</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> c<span class="main">(</span>2<span class="main">)</span> g f' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> norm <span class="main">(</span><span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">n</span><span class="main">)</span> <span class="main">≤</span> norm <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">powr</span> <span class="free">n</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">F</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">eventually_elim</span> <span class="main">(</span><span class="operator">insert</span> n c<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> powr_mult <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> powr_mono2<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> landau_o.big_mono<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> c<span class="main">(</span>1<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> power_smallo_exponential f
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">k</span> <span class="keyword1">powr</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> landau_o.small.compose<span class="main">)</span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* lemma bigo_const_inverse [simp]:
  "filterlim f at_top at_top ⟹ (λ_ :: _ :: linorder. c) ∈ O(λx. inverse (f x)) ⟷ c = 0"
  for f :: "_ ⇒ real"
by simp

lemma smallo_const_inverse [simp]:
  "filterlim f at_top at_top ⟹ (λ_ :: _ :: linorder. c) ∈ o(λx. inverse (f x)) ⟷ c = 0"
  for f :: "_ ⇒ real"
by(simp)
 *)</span>
<span class="keyword1"><span class="command">lemma</span></span> bigo_abs_powr_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">O[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> bigo_powr_iff<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> smallo_abs_powr_iff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">::</span> real<span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">f</span> <span class="main">∈</span> <span class="keyword1">o[</span><span class="free">F</span><span class="main">](</span><span class="free">g</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> smallo_powr_iff<span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> const_smallo_inverse_powr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top at_top"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main">::</span> <span class="main">_</span> <span class="main">::</span> linorder<span class="main">.</span> <span class="free">c</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">p</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> real"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> p<span class="main">:</span> greater
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="main">(</span><span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span>inverse <span class="free">p</span><span class="main">)</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> landau_o.small.cong<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_rev_mp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> inverse <span class="free">p</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">…</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span>inverse <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> smallo_abs_powr_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> calculation <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span>inverse <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> equal
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> landau_o.small.cong<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equal <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_rev_mp<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> less
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> nonneg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_top<span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_top<span class="main">.</span> <span class="main">¦</span><span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span><span class="main">¦</span> <span class="main">/</span> <span class="skolem">d</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="main">_</span><span class="main">.</span> <span class="var">?c</span> <span class="main">≤</span> <span class="main">_</span>"</span></span><span class="main">)</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">d</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">d</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> spec<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="var">?c</span>"</span></span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> eventually_rev_mp<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> landau_o.smallI<span class="main">)</span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">field_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> smallo_powr_iff<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nonneg
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> landau_o.small.cong <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> eventually_rev_mp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">o(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> less <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bigo_const_inverse_powr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"filterlim <span class="free">f</span> at_top at_top"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main">::</span> <span class="main">_</span> <span class="main">::</span> linorder<span class="main">.</span> <span class="free">c</span> <span class="main">::</span> real<span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">::</span> real"</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> p_pos<span class="main">:</span> greater
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="main">(</span><span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> inverse <span class="free">p</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p_pos <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">{</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span>inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> landau_o.big.cong<span class="main">)</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_rev_mp<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> inverse <span class="free">p</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="main">…</span> <span class="main">⟷</span> 
                 <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span>inverse <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> p_pos <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bigo_abs_powr_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">note</span></span> calculation <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span>inverse <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> p_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> equal
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> at_top"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> inverse <span class="main">(</span><span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> landau_o.big.cong<span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> equal <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_rev_mp<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> equal <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> less
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">∀<span class="hidden">⇩</span><sub>F</sub></span> <span class="bound">x</span> <span class="keyword1">in</span> at_top<span class="main">.</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">f</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filterlim_at_top<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="free">f</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> bigoI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">¦</span></span></span><span class="free"><span class="free"><span class="free">c</span></span></span><span class="main"><span class="main"><span class="main">¦</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">powr</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">1</span></span></span> <span class="main"><span class="main"><span class="main">/</span></span></span> <span class="main"><span class="main"><span class="main">-</span></span></span> <span class="free"><span class="free"><span class="free">p</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ mult_left_mono<span class="main"><span class="main">,</span></span> <span class="operator">rotated</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> eventually_rev_mp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ always_eventually<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> bigo_powr_iff<span class="main">)</span> <span class="operator">simp_all</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">¦</span><span class="free">c</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> *
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> landau_o.big.cong <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> eventually_rev_mp<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">c</span><span class="main">)</span> <span class="main">∈</span> <span class="keyword1">O(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="keyword1">powr</span> <span class="main">-</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_minus<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>