<div id="Introduction">
<div class="head">
<h1>Theory Introduction</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ********************************************************************
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">chapter</span></span><span class="quoted"><span class="plain_text">‹Context›</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Introduction
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOLCF/HOLCF.html">HOLCF</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Preface›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
   This is a formalization in Isabelle/HOL of the work of Hoare and Roscoe
   on the denotational semantics of the Failure/Divergence Model of CSP. 
   It follows essentially the presentation of CSP in Roscoe's
   Book "Theory and Practice of Concurrency" <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "roscoe:csp:1998" <span class="antiquote"><span class="antiquote">}</span></span></span></span>
   and the semantic details in a joint Paper of Roscoe and Brooks
   "An improved failures model for communicating processes"
   <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "brookes-roscoe85"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.

   The original version of this formalization, called HOL-CSP 1.0 
   <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "tej.ea:corrected:1997"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, revealed minor, but omnipresent foundational errors
   in key concepts like the process invariant. A correction was
   proposed slightly before the apparition of Roscoe's book (all three authors  were
   in e-mail contact at that time).
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In recent years, a team of authors undertook the task to port HOL-CSP 1.0
  to modern Isabelle/HOL and structured proof techniques. This results in the
  present version are called HOL-CSP 2.0.
 
  The effort is motivated by the following assets of CSP:
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the theory is interesting in itself, and reworking its formal
    structure might help to make it more widely accessible, given
    that it is a particularly advanced example of the shallow embedding
    technique using the denotational semantics of a language,
  <span class="antiquoted"><span class="antiquoted">▪</span></span> it is interesting to <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹compare›</span></span> the ancient, imperative, ML-heavy 
    proof style to the more recent declarative one in Isabelle/Isar;
    this comparison (not presented here) gives a source of empirical
    evidence that such proofs are more stable wrt. the constant
    changes in the Isabelle itself,
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹semantic›</span></span> presentation of CSP lends itself to a semantically
    clean and well-understood <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹combination›</span></span> of specification languages,
    which represents a major step to our longterm goal of heterogenuous,
    yet semantically clean system specifications consisting of
    different formalisms describing components or system aspects separately,
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the resulting HOL-CSP environment could one day be used as a tool that 
    certifies traces of other CSP model-checkers such as FDR4 or PAT.
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 
  In contrast to HOL-CSP 1.0, which came with
  an own fixpoint theory partly inspired by previous work of Alberto Camilieri under 
  HOL4 <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span>"Camilleri91"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, it is the goal of the redesign of HOL-CSP 2.0  to reuse 
  the HOLCF theory  that emmerged from Franz Regensburgers work and was substantially 
  extended by Brian Huffman. Thus, the footprint of the HOL-CSP 2.0
  theory should be reduced drastically. Moreover, all proofs
  have been heavily revised or re-constructed to reflect the
  drastically improved state of the art of interactive
  theory development with Isabelle. ›</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Introduction›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹DRAWN FROM THE PAPER <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "tej.ea:corrected:1997"<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  In his invited lecture at FME'96, C.A.R. Hoare presented his view on the status 
  quo of formal methods in industry. With respect to formal proof methods, he ruled 
  that they "are now sufficiently advanced that a [...] formal methodologist could 
  occasionally detect [...] obscure latent errors before they occur in practice" 
  and asked for their publication as a possible "milestone in the acceptance of formal 
  methods" in industry.
  
  In this paper, we report of a larger verification effort as part of the  UniForM project 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "KriegBrueckner95"<span class="antiquote"><span class="antiquote">}</span></span></span></span>. It revealed an obscure latent error that was not detected 
  within a decade. It cannot be said that the object of interest is a "large software 
  system" whose failure may "cost millions", but it is a well-known subject in the center 
  of academic interest considered foundational for several formal methods tools: the 
  theory of the failure- divergence model of CSP (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Hoare:1985:CSP:3921"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "brookes-roscoe85"<span class="antiquote"><span class="antiquote">}</span></span></span></span>). And indeed we hope that this work may further encourage the use 
  of formal proof methods at least in the academic community working on formal methods.
  
  Implementations of proof support for a formal method can roughly be divided into two 
  categories. In direct tools like FDR <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "FDRTutorial2000"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, the logical rules of a 
  method (possibly integrated into complex proof techniques) are hard-wired into the code of 
  their implementation. Such tools tend to be difficult to modify and to formally reason 
  about, but can possess enviable automatic proof power in specific problem domains 
  and comfortable user interfaces. 

  The other category can be labelled as logical embeddings. Formal methods such as CSP 
  or Z can be logically embedded into an LCF-style tactical theorem prover such as HOL 
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "gordon.ea:hol:1993"<span class="antiquote"><span class="antiquote">}</span></span></span></span> or Isabelle<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "nipkow.ea:isabelle:2002"<span class="antiquote"><span class="antiquote">}</span></span></span></span>. Coming with 
  an open system design going back to Milner, these provers allow for user-programmed 
  extensions in a logically sound way. Their  strength is flexibility, generality and 
  expressiveness that makes them to symbolic programming environments.
  
  In this paper we present a tool of the latter category (as a step towards a future 
  combination with the former). After a brief introduction into the failure divergence 
  semantics in the traditional CSP-literature, we will discuss the revealed problems 
  and present a correction. Although the error is not "mathematically deep", it stings 
  since its correction affects many definitions. It is shown that the corrected CSP 
  still fulfils the desired algebraic laws. The addition of fixpoint-theory and 
  specialised tactics extends the embedding in Isabelle/HOL to a formally proven 
  consistent proof environment for CSP. Its use is demonstrated in a final example.
›</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹An Outline of Failure-Divergence Semantics›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 
  A very first approach to give denotational semantics to CSP is to view it as a kind 
  of a regular expression. This way, it can be understood as an automata and the 
  denotations are just the language of the automaton; this way, synchronization 
  and concurrency can be basically understood as the construction of a product automaton 
  with potential interleaving. The semantics becomes compositional, and internal communication
  between sub-components of a component can be modeled by the concealment operator. 

  Hoares work <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Hoare:1985:CSP:3921"<span class="antiquote"><span class="antiquote">}</span></span></span></span> was strongly inspired by this initial idea.
  However, it became quickly clear that the simplistic automata vision is not a satisfying
  paradigm for all aspects of concurrency. Particularly regarding the nature of communication,
  where one "sends" actively information and the other "receives" it, the bi-directional 
  product construction seems to be misleading. Furthermore, it is an obvious difference
  if a group of processes remains in a passive deadlock because all possible communications 
  contradict each other, or if a group of processes is too busy with internal chatter and
  never reaches the point where this component is again ready for communication. 
  
  Hoare solved these apparent problems by presenting a multi-layer approach, in which the
  denotational models were refined more and more allowing to distinguish the above 
  critical situations. An ingenious concept in the overall scheme is to distinguish
  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹non-deterministic›</span></span> choice from <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹deterministic›</span></span> one <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">⁋</span></span>‹which in itself produces
  problems with recursion which had to be overcome by some restrictions on its use.›</span></span> in order to 
  solve the sender/receiver problem. 

  Hoare proposed 3 denotational semantics for CSP:
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹trace›</span></span> model, which is basically the above naive automata model not allowing
    to distinguish non-deterministic choice from deterministic one, neither to distinguish deadlock 
    from infinite internal chatter,
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹failure›</span></span> model is able to distinguish non-deterministic choice from deterministic one by 
    different maximum refusal sets, which is however cannot differentiate deadlock from infinite 
    internal chatter,   
  <span class="antiquoted"><span class="antiquoted">▪</span></span> the <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹failure-divergence›</span></span> model overcomes additionally the unresolved problem of failure model.


In the sequel, we explain these two problems in more detail, giving some
motivation for the daunting complexity of the latter model.
It is this complexity which finally raises general interest in a 
formal verification.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Non-Determinism›</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">consts</span></span> dummyPrefix <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>cpo <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>cpo <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>cpo"</span></span>
<span class="keyword1"><span class="command">consts</span></span> dummyDet <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>cpo <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>cpo <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>cpo"</span></span>
<span class="keyword1"><span class="command">consts</span></span> dummyNDet <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>cpo <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>cpo <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>cpo"</span></span>
<span class="keyword1"><span class="command">consts</span></span> dummyHide <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span><span class="main">::</span>cpo <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>cpo"</span></span>

<span class="keyword1"><span class="command">notation</span></span> dummyPrefix <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span>  <span class="quoted">"<span class="keyword1">→</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> dummyDet    <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span>  <span class="quoted">"<span class="keyword1">□</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> dummyNDet   <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span>  <span class="quoted">"<span class="keyword1">⊓</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">notation</span></span> dummyHide   <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span>  <span class="quoted">"<span class="keyword1">∖</span>"</span> 50<span class="main">)</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
   Let a and b be any two events in some set of events <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Σ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. The two processes

   <span class="antiquoted"><span class="antiquoted">➧</span></span>    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>   <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">a</span></span> <span class="main"><span class="main">→</span></span> <span class="free"><span class="free">Stop</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">□</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">b</span></span> <span class="main"><span class="main">→</span></span> <span class="free"><span class="free">Stop</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>   \hspace{7cm}            (1)

   and

   <span class="antiquoted"><span class="antiquoted">➧</span></span>    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span>   <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="free"><span class="free">a</span></span> <span class="main"><span class="main">→</span></span> <span class="free"><span class="free">Stop</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">⊓</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">b</span></span> <span class="main"><span class="main">→</span></span> <span class="free"><span class="free">Stop</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>  \hspace{7cm}            (2)


›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
   cannot be distinguished under the trace semantics, in which both processes 
   are capable of performing the same sequences of events, i.e. both have the 
   same set of traces <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">{}</span></span><span class="main"><span class="main">,</span></span><span class="main"><span class="main">{</span></span><span class="free"><span class="free">a</span></span><span class="main"><span class="main">}</span></span><span class="main"><span class="main">,</span></span><span class="main"><span class="main">{</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">}</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This is because both processes can either 
   engage in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Stop</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, or engage in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and 
   then <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Stop</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. We would, however, like to distinguish between <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
   <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹deterministic›</span></span> choice of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> or <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (1) and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
   <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">∗</span></span>‹non-deterministic›</span></span> choice of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> or <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (2).
   
   
   This can be done by considering the events that a process can refuse to engage 
   in when these events are offered by the environment; it cannot refuse either, 
   so we say its maximal refusal set is the set containing all elements of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Σ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> other 
   than <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, written <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Σ</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">{</span></span><span class="free"><span class="free">a</span></span><span class="main"><span class="main">,</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, i.e. it can 
   refuse all elements in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Σ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> other than <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> or <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. In the case 
   of the non-deterministic process (2), however, we wish to express that if the environment 
   offers the event <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> say, the process non-deterministically chooses either to engage in 
   <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, to refuse it and engage in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (likewise for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>). We say 
   therefore, that process (2) has two maximal refusal sets, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Σ</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">{</span></span><span class="free"><span class="free">a</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and 
   <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Σ</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">{</span></span><span class="free"><span class="free">b</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, because it can refuse to engage in either <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> or 
   <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, but not both. The notion of refusal sets is in this way used to distinguish 
   non-determinism from determinism in choices.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Infinite Chatter›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
   Consider the infinite process <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">μ</span></span> <span class="bound"><span class="bound">X</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">a</span></span> <span class="main"><span class="main">→</span></span> <span class="bound"><span class="bound">X</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
   which performs an infinite stream of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>'s. If one now conceals the event a in 
   this process by writing
   <span class="antiquoted"><span class="antiquoted">➧</span></span>      <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">μ</span></span> <span class="bound"><span class="bound">X</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">a</span></span> <span class="main"><span class="main">→</span></span> <span class="bound"><span class="bound">X</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∖</span></span> <span class="free"><span class="free">a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>    \hspace{7.8cm}            (3)
›</span></span>   
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
   it no longer becomes possible to distinguish the behaviour of this process 
   from that of the deadlock process Stop. We would like to be able to make such 
   a distinction, since the former process has clearly not stopped but is engaging 
   in an unbounded sequence of internal actions invisible to the environment. We say 
   the process has diverged, and introduce the notion of a divergence set to denote 
   all sequences events that can cause a process to diverge. Hence, the process Stop 
   is assigned the divergence set <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, since it can not diverge, whereas the process 
   (3) above diverges on any sequence of events since the process begins to diverge 
   immediately, i.e. its divergence set is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Σ</span></span><span class="main"><span class="main"><span class="hidden">⇧</span><sup>*</sup></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> , where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Σ</span></span><span class="main"><span class="main"><span class="hidden">⇧</span><sup>*</sup></span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> denotes the 
   set of all  sequences with elements in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Σ</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Divergence is undesirable and so 
   it is essential to be able to express it to ensure that it is avoided.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The Global Architecture of HOL-CSP 2.0›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
   The global architecture of HOL-CSP 2.0 has been substantially simplified compared 
   to HOL-CSP 1.0: the fixpoint reasoning is now entirely based on HOLCF (which meant that
   the continuity proofs for CSP operators had basically been re-done).›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
   The theory <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Process›</span></span></span></span> establishes the basic common notions for events, traces, ticks and
   tickfree-ness, the type definitions for failures and divergences as well as the
   global constraints on them (called the "axioms" in Hoare's Book.) captured in a 
   predicate <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹is_process›</span></span></span></span>. On this basis, the set of failures and divergences satisfying
   <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹is_process›</span></span></span></span> is turned into the type <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹'a process›</span></span></span></span> via a type-definition 
   (making <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹is_process›</span></span></span></span> as the central data invariant). In the sequel, it is shown that
   <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹'a process›</span></span></span></span> belongs to the type-class <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> "cpo"<span class="antiquote"><span class="antiquote">}</span></span></span></span> stemming from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="../../HOL/HOLCF/HOLCF.html"></a><a href="../../HOL/HOLCF/HOLCF.html">HOLCF</a><span class="antiquote"><span class="antiquote">}</span></span></span></span> which 
   makes  the concepts of complete partial order, continuity, fixpoint-induction and general 
   recursion available to all expressions of type <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹'a process›</span></span></span></span>. ›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ 
   The theory <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹Process›</span></span></span></span> also establishes the two partial orderings <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="main"><span class="main">≤</span></span> <span class="free"><span class="free">P'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for 
   refinements and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> <span class="main"><span class="main">⊑</span></span> <span class="free"><span class="free">P'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for the approximation on processes used to give semantics
   to recursion. The latter is well-known to be logically weaker than the former.
   Note that, unfortunately, the use of these two symbols in HOL-CSP 2.0, where the 
   latter is already used in the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">theory</span></span> <a href="../../HOL/HOLCF/HOLCF.html"></a><a href="../../HOL/HOLCF/HOLCF.html">HOLCF</a><span class="antiquote"><span class="antiquote">}</span></span></span></span>-theory, is just the other way round as 
   in the literature. ›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
   Each CSP operator is described in an own theory which comprises:
   <span class="antiquoted"><span class="antiquoted">▪</span></span> The denotational core definition in terms of a pair of Failures and Divergences
   <span class="antiquoted"><span class="antiquoted">▪</span></span> The establishment of  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹is_process›</span></span></span></span> for the  Failures and Divergences in the
     range of the given operator (thus, the invariance of  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹is_process›</span></span></span></span> for this operator)
   <span class="antiquoted"><span class="antiquoted">▪</span></span> The proof of the projections <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹T›</span></span></span></span> and  <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹F›</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">▩</span></span><span class="raw_text"><span class="raw_text">‹D›</span></span></span></span> for this operator
   <span class="antiquoted"><span class="antiquoted">▪</span></span> The proof of continuity of the operator (which is always possible except for
     hide if applied to infinite hide-sets).›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
   Finally, the theory CSP contains the "Laws" of CSP, i.e. the derived rules 
   allowing abstractly to reason over CSP processes. The overall dependency graph 
   is shown in \autoref{fig:fig1}.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
   \begin{figure}[ht]
   	\centering
     \includegraphics[width=0.9\textwidth]{session_graph}
   	\caption{The HOL-CSP 2.0 Theory Graph}
   	\label{fig:fig1}
   \end{figure}›</span></span>

<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">no_notation</span></span> dummyPrefix  <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span>  <span class="quoted">"<span class="keyword1">→</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> dummyDet     <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span>  <span class="quoted">"<span class="keyword1">□</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> dummyNDet    <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span>  <span class="quoted">"<span class="keyword1">⊓</span>"</span> 50<span class="main">)</span>
<span class="keyword1"><span class="command">no_notation</span></span> dummyHide    <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span>  <span class="quoted">"<span class="keyword1">∖</span>"</span> 50<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
<span class="comment1">(*&gt;*)</span>
</pre>
</div><div id="Process">
<div class="head">
<h1>Theory Process</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ********************************************************************
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">chapter</span></span><span class="quoted"><span class="plain_text">‹The Notion of Processes›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹As mentioned earlier, we base the theory of CSP on HOLCF, a Isabelle/HOL library
providing a theory of continuous functions, fixpoint induction and recursion.›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Process
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOLCF/HOLCF.html">HOLCF</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Since HOLCF sets the default type class to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> "cpo"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, while our 
Process theory establishes links between standard types and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">class</span></span> "pcpo"<span class="antiquote"><span class="antiquote">}</span></span></span></span> 
types. Consequently, we reset the default type class to the default in HOL.›</span></span>

<span class="keyword1"><span class="command">default_sort</span></span> <span class="quoted">type</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Pre-Requisite: Basic Traces and tick-Freeness›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The denotational semantics of CSP assumes a distinguishable
special event, called \verb+tick+ and written $\checkmark$, that is required
to occur only in the end of traces in order to signalize successful termination of
a process. (In the original text of Hoare, this treatment was more
liberal and lead to foundational problems: the process invariant
could not be established for the sequential composition operator
of CSP; see <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "tej.ea:corrected:1997"<span class="antiquote"><span class="antiquote">}</span></span></span></span> for details.)›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'α</span> event <span class="main">=</span> ev <span class="tfree"><span class="quoted"><span class="tfree">'α</span></span></span> <span class="main">|</span> tick

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> trace <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> event<span class="main">)</span> list"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We chose as standard ordering on traces the prefix ordering.›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span>  list <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">order</span>
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">definition</span></span>  le_list_def  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">::</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">r</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">@</span> <span class="bound">r</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>  less_list_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">::</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> A <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">&lt;</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> 
<span class="keyword1"><span class="command">proof</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list"</span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def<span class="main">)</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def<span class="main">)</span>
   <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> A B<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>  
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> r ra<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">r</span><span class="main">@</span><span class="improper">ra</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> A B<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_list_def<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Some facts on the prefix ordering.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> nil_le<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">≤</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">s</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_list_def<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> nil_le2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">s</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>le_list_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nil_less<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> nil_less2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_list_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_self<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">&lt;</span> <span class="free">t</span><span class="main">@</span><span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>less_list_def le_list_def<span class="main">)</span>
   
<span class="keyword1"><span class="command">lemma</span></span> le_length_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≤</span> <span class="free">t</span> <span class="main">⟹</span> length <span class="free">s</span> <span class="main">≤</span> length <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_list_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_length_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟹</span> length <span class="free">s</span> <span class="main">&lt;</span> length <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_list_def le_list_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_cons<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">#</span> <span class="free">s</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">#</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_append<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">@</span> <span class="free">s</span> <span class="main">&lt;</span> <span class="free">a</span> <span class="main">@</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> less_tail<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">&lt;</span> <span class="free">t</span> <span class="main">⟹</span> tl <span class="free">s</span> <span class="main">&lt;</span> tl <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def<span class="main">)</span>

<span class="comment1">―‹should be in the List library›</span>
<span class="keyword1"><span class="command">lemma</span></span> list_nonMt_append<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">a</span> <span class="bound">t</span><span class="main">.</span> <span class="free">s</span> <span class="main">=</span> <span class="bound">t</span> <span class="main">@</span> <span class="main">[</span><span class="bound">a</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> rev_mp<span class="main"><span class="keyword3">,</span></span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">s</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">s</span> <span class="main">=</span> <span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> append_eq_first_pref_spec<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">@</span> <span class="free">t</span> <span class="main">=</span> <span class="free">r</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span> <span class="main">∧</span> <span class="free">t</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> <span class="free">s</span> <span class="main">≤</span> <span class="free">r</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rev_mp<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> xa<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> list<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">xa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> list.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> list_nonMt_append<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> prefixes_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">prefixes</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t2</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">t</span> <span class="main">@</span> <span class="bound">t2</span><span class="main">}</span> <span class="keyword1">in</span> finite <span class="bound">prefixes</span> <span class="main">∧</span> card <span class="bound">prefixes</span> <span class="main">=</span> length <span class="free">x</span> <span class="main">+</span> <span class="main">1</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t</span> <span class="main">@</span> <span class="bound">t2</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_add_less2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"inj_on Cons UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> injI list.inject<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Cons A B inj_on_iff_eq_card <span class="keyword1"><span class="command">have</span></span>  C<span class="main">:</span><span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span><span class="main">#</span><span class="bound">x</span><span class="main">)</span><span class="main">`</span><span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t</span> <span class="main">@</span> <span class="bound">t2</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> length <span class="skolem">x</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t2</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t</span> <span class="main">@</span> <span class="bound">t2</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span><span class="main">#</span><span class="bound">x</span><span class="main">)</span><span class="main">`</span><span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t</span> <span class="main">@</span> <span class="bound">t2</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">intro</span> set_eqI iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Cons_eq_append_conv<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> C D card_insert_if<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span><span class="main">#</span><span class="bound">x</span><span class="main">)</span><span class="main">`</span><span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t</span> <span class="main">@</span> <span class="bound">t2</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> One_nat_def Suc_eq_plus1 Un_insert_left finite.insertI 
        finite_imageI image_iff list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.size<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> local.A sup_bot.left_neutral<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sublists_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">@</span> <span class="bound">t2</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">@</span> <span class="bound">t2</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">@</span> <span class="bound">t2</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t2</span><span class="main">.</span> <span class="skolem">a</span><span class="main">#</span><span class="skolem">x</span> <span class="main">=</span> <span class="bound">t</span> <span class="main">@</span> <span class="bound">t2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_eq_append_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons prefixes_fin<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">x</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_UnI finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> suffixes_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">@</span> <span class="bound">t2</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> infinite_super sublists_fin <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For the process invariant, it is a key element to
reduce the notion of traces to traces that may only contain
one tick event at the very end. This is captured by the definition
of the predicate \verb+front_tickFree+ and its stronger version
\verb+tickFree+. Here is the theory of this concept.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tickFree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> trace <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tickFree</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span>tick <span class="main">∉</span> set <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">front_tickFree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> trace <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">front_tickFree</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> tickFree<span class="main">(</span>tl<span class="main">(</span>rev <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tickFree_Nil <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tickFree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tickFree_Cons <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">≠</span> tick <span class="main">∧</span> tickFree <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tickFree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tickFree_tl <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[|</span><span class="free">s</span> <span class="main">~=</span> <span class="main">[]</span> <span class="main">;</span> tickFree <span class="free">s</span><span class="main">|]</span> <span class="main">==&gt;</span> tickFree<span class="main">(</span>tl <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> tickFree_append<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree<span class="main">(</span><span class="free">s</span><span class="main">@</span><span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tickFree <span class="free">s</span> <span class="main">∧</span> tickFree <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tickFree_def member_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> non_tickFree_tick <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> tickFree <span class="main">[</span>tick<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tickFree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> non_tickFree_implies_nonMt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> tickFree <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tickFree_def<span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> rev_mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>  tickFree_rev <span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree<span class="main">(</span>rev <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>tickFree <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span>  <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tickFree_def member_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> front_tickFree_Nil<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="main">[]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> front_tickFree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> front_tickFree_single<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="main">[</span><span class="free">a</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> front_tickFree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tickFree_implies_front_tickFree<span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="free">s</span> <span class="main">⟹</span> front_tickFree <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tickFree_def front_tickFree_def member_def<span class="main"><span class="keyword3">,</span></span><span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_np<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span><span class="main">(</span><span class="operator">erule</span> rev_mp<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> List.rev_induct<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> front_tickFree_charn<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="bound">t</span><span class="main">.</span> <span class="free">s</span> <span class="main">=</span> <span class="bound">t</span> <span class="main">@</span> <span class="main">[</span><span class="bound">a</span><span class="main">]</span> <span class="main">∧</span> tickFree <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> front_tickFree_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> list_nonMt_append<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tickFree_rev<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> front_tickFree_implies_tickFree<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="main">(</span><span class="free">t</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span> <span class="main">⟹</span> tickFree <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tickFree_def front_tickFree_def member_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tickFree_implies_front_tickFree_single<span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="free">t</span> <span class="main">⟹</span> front_tickFree <span class="main">(</span><span class="free">t</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>front_tickFree_charn<span class="main">)</span> 


<span class="keyword1"><span class="command">lemma</span></span> nonTickFree_n_frontTickFree<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">¬</span> tickFree <span class="free">s</span><span class="main">;</span> front_tickFree <span class="free">s</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">s</span> <span class="main">=</span> <span class="bound">t</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> non_tickFree_implies_nonMt<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> front_tickFree_charn<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> front_tickFree_dw_closed <span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="main">⟹</span>  front_tickFree <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> rev_mp<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span> <span class="quoted"><span class="free">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> xs<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> List.rev_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x xs xa<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> append_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x xs xa<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">xa</span> <span class="main">@</span> <span class="improper">xs</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> all_dupE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> front_tickFree_implies_tickFree<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">xa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>tickFree_implies_front_tickFree<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> front_tickFree_append<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> tickFree <span class="free">s</span><span class="main">;</span> front_tickFree <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> front_tickFree <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> front_tickFree_charn<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> tickFree_implies_front_tickFree<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> append_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> tickFree_implies_front_tickFree_single<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> tickFree_append<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> front_tickFree_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="main">(</span><span class="free">t</span> <span class="main">@</span> <span class="free">r</span><span class="main">)</span> <span class="main">∧</span> <span class="free">r</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟶</span> tickFree <span class="free">t</span> <span class="main">∧</span> front_tickFree <span class="free">r</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> append_assoc append_butlast_last_id front_tickFree_charn 
         front_tickFree_implies_tickFree tickFree_append<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Basic Types, Traces, Failures and Divergences ›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> refusal <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> event<span class="main">)</span> set"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> failure <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> trace <span class="main">×</span> <span class="tfree">'α</span> refusal"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> divergence <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> trace set"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'α</span> process<span class="hidden">⇩</span><sub>0</sub> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> failure set <span class="main">×</span> <span class="tfree">'α</span> divergence"</span></span>
 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">FAILURES</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process<span class="hidden">⇩</span><sub>0</sub> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> failure set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">FAILURES</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> fst <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">TRACES</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process<span class="hidden">⇩</span><sub>0</sub> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> trace set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">TRACES</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">tr</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> FAILURES <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="bound">tr</span> <span class="main">=</span> fst <span class="bound">a</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">DIVERGENCES</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process<span class="hidden">⇩</span><sub>0</sub> <span class="main">⇒</span> <span class="tfree">'α</span> divergence"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">DIVERGENCES</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> snd <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">REFUSALS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process<span class="hidden">⇩</span><sub>0</sub> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> refusal set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">REFUSALS</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">ref</span><span class="main">.</span>  <span class="main">∃</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> FAILURES <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="bound">F</span> <span class="main">=</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="bound">ref</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ The Process Type Invariant ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_process</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process<span class="hidden">⇩</span><sub>0</sub> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">is_process</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span>
      <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span><span class="main">.</span>  <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟶</span> front_tickFree <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">@</span><span class="bound">t</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">&amp;</span> <span class="bound">X</span> <span class="main">&lt;=</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">∧</span> 
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">c</span><span class="main">.</span>      <span class="bound">c</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span><span class="main">@</span><span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span><span class="main">∉</span>FAILURES <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> 
                                         <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span><span class="main">∈</span>FAILURES <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span><span class="main">.</span>  <span class="main">(</span><span class="bound">s</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">:</span> FAILURES <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">-</span><span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>  <span class="bound">s</span> <span class="main">∈</span> DIVERGENCES <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> tickFree <span class="bound">s</span> <span class="main">∧</span> front_tickFree <span class="bound">t</span> 
                                      <span class="main">⟶</span> <span class="bound">s</span><span class="main">@</span><span class="bound">t</span> <span class="main">∈</span> DIVERGENCES <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>  <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> DIVERGENCES <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">:</span> DIVERGENCES <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> DIVERGENCES <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> is_process_spec<span class="main">:</span>
 <span class="quoted"><span class="quoted">"is_process <span class="free">P</span> <span class="main">=</span> 
       <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span>  FAILURES <span class="free">P</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span>  FAILURES <span class="free">P</span> <span class="main">⟶</span> front_tickFree <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> FAILURES <span class="free">P</span> <span class="main">∨</span>   <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">Y</span><span class="main">)</span>  <span class="main">∉</span>  FAILURES <span class="free">P</span> <span class="main">∨</span> <span class="main">¬</span><span class="main">(</span><span class="bound">X</span><span class="main">⊆</span><span class="bound">Y</span><span class="main">)</span> <span class="main">|</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span> <span class="main">∧</span> 
       <span class="main">(</span><span class="main">∀</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span>  <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span><span class="main">@</span><span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∉</span>  FAILURES <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span>  FAILURES <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span>  FAILURES <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span>  FAILURES <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> DIVERGENCES <span class="free">P</span> <span class="main">∨</span> <span class="main">¬</span>tickFree <span class="bound">s</span> <span class="main">∨</span> <span class="main">¬</span>front_tickFree <span class="bound">t</span> 
                                 <span class="main">∨</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∈</span> DIVERGENCES <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> DIVERGENCES <span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span>  FAILURES <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
       <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∉</span>  DIVERGENCES <span class="free">P</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">∈</span>  DIVERGENCES <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span>  <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_process_def  HOL.nnf_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span>  HOL.nnf_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span>  
                      HOL.imp_conjL<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Process_eqI <span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"FAILURES <span class="free">P</span> <span class="main">=</span> FAILURES <span class="free">Q</span> "</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"DIVERGENCES <span class="free">P</span> <span class="main">=</span> DIVERGENCES <span class="free">Q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> process<span class="hidden">⇩</span><sub>0</sub><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> A B<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> FAILURES_def DIVERGENCES_def<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> surjective_pairing<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span><span class="operator">THEN</span> subst<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> surjective_pairing<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span><span class="operator">THEN</span> subst<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> process_eq_spec<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'a</span> process<span class="hidden">⇩</span><sub>0</sub><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>FAILURES <span class="free">P</span> <span class="main">=</span> FAILURES <span class="free">Q</span> <span class="main">∧</span> DIVERGENCES <span class="free">P</span> <span class="main">=</span> DIVERGENCES <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FAILURES_def DIVERGENCES_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> surjective_pairing<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span><span class="operator">THEN</span> subst<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> surjective_pairing<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">,</span></span><span class="operator">THEN</span> subst<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> process_surj_pair<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>FAILURES <span class="free">P</span><span class="main">,</span>DIVERGENCES <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>FAILURES_def DIVERGENCES_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Fa_eq_imp_Tr_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"FAILURES <span class="free">P</span> <span class="main">=</span> FAILURES <span class="free">Q</span> <span class="main">⟹</span> TRACES <span class="free">P</span> <span class="main">=</span> TRACES <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>FAILURES_def DIVERGENCES_def TRACES_def<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> is_process1<span class="main">:</span>  <span class="quoted"><span class="quoted">"is_process <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span><span class="main">∈</span> FAILURES <span class="free">P</span> "</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_process_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process2<span class="main">:</span> <span class="quoted"><span class="quoted">"is_process <span class="free">P</span> <span class="main">⟹</span> <span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span> <span class="main">⟶</span> front_tickFree <span class="bound">s</span> "</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_process_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process3<span class="main">:</span> <span class="quoted"><span class="quoted">"is_process <span class="free">P</span> <span class="main">⟹</span> <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_process_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> is_process3_S_pref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_process <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span><span class="main">;</span> <span class="free">s</span> <span class="main">≤</span> <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_list_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_process3 <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process4<span class="main">:</span> <span class="quoted"><span class="quoted">"is_process <span class="free">P</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∉</span> FAILURES <span class="free">P</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> is_process_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process4_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_process <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span><span class="main">;</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> is_process4<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process4_S1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_process <span class="free">P</span><span class="main">;</span> <span class="free">x</span> <span class="main">∈</span> FAILURES <span class="free">P</span><span class="main">;</span> <span class="free">X</span> <span class="main">⊆</span> snd <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> is_process4_S<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process5<span class="main">:</span>
<span class="quoted"><span class="quoted">"is_process <span class="free">P</span> <span class="main">⟹</span>
    <span class="main">∀</span><span class="bound">sa</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">sa</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">sa</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> FAILURES <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">sa</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> is_process_spec<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process5_S<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_process <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">sa</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span><span class="main">;</span> <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">sa</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> FAILURES <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">sa</span><span class="main">,</span> <span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> is_process5<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process5_S1<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_process <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">sa</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">sa</span><span class="main">,</span> <span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∉</span> FAILURES <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">∧</span> <span class="main">(</span><span class="free">sa</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> contrapos_np<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> is_process5_S<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process6<span class="main">:</span> <span class="quoted"><span class="quoted">"is_process <span class="free">P</span> <span class="main">⟹</span>  <span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">-</span><span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> is_process_spec<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process6_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_process <span class="free">P</span> <span class="main">;</span><span class="main">(</span><span class="free">s</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span>  <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">X</span><span class="main">-</span><span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> is_process6<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process7<span class="main">:</span>
<span class="quoted"><span class="quoted">"is_process <span class="free">P</span> <span class="main">⟹</span> <span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> DIVERGENCES <span class="free">P</span> <span class="main">∨</span> <span class="main">¬</span> tickFree <span class="bound">s</span> <span class="main">∨</span> <span class="main">¬</span> front_tickFree <span class="bound">t</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∈</span> DIVERGENCES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> is_process_spec<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process7_S<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> is_process <span class="free">P</span><span class="main">;</span><span class="free">s</span> <span class="main">:</span> DIVERGENCES <span class="free">P</span><span class="main">;</span>tickFree <span class="free">s</span><span class="main">;</span>front_tickFree <span class="free">t</span><span class="main">⟧</span> 
 <span class="main">⟹</span>  <span class="free">s</span> <span class="main">@</span> <span class="free">t</span> <span class="main">∈</span> DIVERGENCES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> is_process7<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process8<span class="main">:</span> <span class="quoted"><span class="quoted">"is_process <span class="free">P</span> <span class="main">⟹</span> <span class="main">∀</span>  <span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> DIVERGENCES <span class="free">P</span> <span class="main">∨</span>  <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> is_process_spec<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process8_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> is_process <span class="free">P</span><span class="main">;</span> <span class="free">s</span> <span class="main">∈</span> DIVERGENCES <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">X</span><span class="main">)</span>  <span class="main">∈</span> FAILURES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> is_process8<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process9<span class="main">:</span> <span class="quoted"><span class="quoted">"is_process <span class="free">P</span> <span class="main">⟹</span> <span class="main">∀</span>  <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span> <span class="main">∉</span> DIVERGENCES <span class="free">P</span> <span class="main">∨</span>  <span class="bound">s</span> <span class="main">∈</span> DIVERGENCES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> is_process_spec<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process9_S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> is_process <span class="free">P</span><span class="main">;</span><span class="free">s</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> DIVERGENCES <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> DIVERGENCES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> is_process9<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Failures_implies_Traces<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⟦</span>is_process <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> TRACES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TRACES_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process5_sing<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> is_process <span class="free">P</span> <span class="main">;</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∉</span> FAILURES <span class="free">P</span><span class="main">;</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule_tac</span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> is_process5_S1<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_process5_singT<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> is_process <span class="free">P</span> <span class="main">;</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span> <span class="main">∉</span> FAILURES <span class="free">P</span><span class="main">;</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span><span class="main">⟧</span>  <span class="main">⟹</span> <span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">x</span><span class="main">]</span>  <span class="main">∈</span> TRACES <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> is_process5_sing<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TRACES_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> front_trace_is_tickfree<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"is_process <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">t</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">,</span><span class="free">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="free">P</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"tickFree <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree<span class="main">(</span><span class="free">t</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> A B<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> is_process2<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> front_tickFree_implies_tickFree<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">]</span></span><span class="main">)</span>   
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> trace_with_Tick_implies_tickFree_front <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>is_process <span class="free">P</span><span class="main">;</span> <span class="free">t</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> TRACES <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> tickFree <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> TRACES_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> front_trace_is_tickfree<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ The Abstraction to the process-Type ›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> 
  <span class="tfree">'α</span> process <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">p</span> <span class="main">::</span> <span class="tfree">'α</span> process<span class="hidden">⇩</span><sub>0</sub> <span class="main">.</span> is_process <span class="bound">p</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span><span class="main">}</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'α</span> process<span class="hidden">⇩</span><sub>0</sub><span class="main">.</span> is_process <span class="bound">p</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_process_def  front_tickFree_def
                     FAILURES_def TRACES_def DIVERGENCES_def <span class="main">)</span>
   <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">F</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process <span class="main">⇒</span>  <span class="main">(</span><span class="tfree">'α</span> failure set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> FAILURES <span class="main">(</span>Rep_process <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">T</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process <span class="main">⇒</span>  <span class="main">(</span><span class="tfree">'α</span> trace set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">T</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> TRACES <span class="main">(</span>Rep_process <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">D</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process <span class="main">⇒</span> <span class="tfree">'α</span> divergence"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">D</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> DIVERGENCES <span class="main">(</span>Rep_process <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> refusal set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">R</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> REFUSALS <span class="main">(</span>Rep_process <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> is_process_Rep <span class="main">:</span> <span class="quoted"><span class="quoted">"is_process <span class="main">(</span>Rep_process <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted">is_process</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> CollectD<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Rep_process<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Process_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"Abs_process<span class="main">(</span><span class="main">(</span>F <span class="free">P</span> <span class="main">,</span> D <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_def FAILURES_def D_def 
             DIVERGENCES_def Rep_process_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Process_eq_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">=</span> <span class="free">Q</span><span class="main">)</span><span class="main">=</span><span class="main">(</span>F <span class="free">P</span> <span class="main">=</span> F <span class="free">Q</span> <span class="main">∧</span> D <span class="free">P</span> <span class="main">=</span> D <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Process_spec<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subst<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Process_spec<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subst<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Process_eq_spec_optimized<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">=</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>D <span class="free">P</span> <span class="main">=</span> D <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span>D <span class="free">P</span> <span class="main">=</span> D <span class="free">Q</span> <span class="main">⟶</span> F <span class="free">P</span> <span class="main">=</span> F <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> Process_eq_spec <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span>
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟶</span> front_tickFree <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span> <span class="main">.</span><span class="main">(</span><span class="bound">s</span><span class="main">@</span><span class="bound">t</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">X</span><span class="main">⊆</span><span class="bound">Y</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="bound">s</span><span class="main">@</span><span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span><span class="main">∉</span>F <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">-</span><span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∧</span> tickFree <span class="bound">s</span> <span class="main">∧</span> front_tickFree <span class="bound">t</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
 <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> F_def D_def T_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> is_process_def<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> is_process_Rep<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> process_charn<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟶</span> front_tickFree <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span>
             <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="free">P</span> <span class="main">∨</span> <span class="main">¬</span> tickFree <span class="bound">s</span> <span class="main">∨</span> <span class="main">¬</span> front_tickFree <span class="bound">t</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∉</span> D <span class="free">P</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span> <span class="main">∨</span>  <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">have</span></span> B <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span> <span class="main">∨</span> <span class="main">¬</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span>  <span class="main">=</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">have</span></span> C <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="free">P</span> <span class="main">∨</span> <span class="main">¬</span> tickFree <span class="bound">s</span> <span class="main">∨</span> 
      <span class="main">¬</span> front_tickFree <span class="bound">t</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">)</span>  <span class="main">=</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∧</span> tickFree <span class="bound">s</span> <span class="main">∧</span> front_tickFree <span class="bound">t</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∉</span> D <span class="free">P</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">note</span></span> A B C D E 
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">note</span></span> a <span class="main">=</span> this
  <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> is_processT<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ split of \verb+is_processT+: ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>process_charn<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟶</span> front_tickFree <span class="bound">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>process_charn<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>  is_processT2_TR <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">⟶</span> front_tickFree <span class="bound">s</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_def <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> T_def TRACES_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> is_processT2<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_proT2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A <span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B <span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">s</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"tick <span class="main">∉</span> set <span class="main">(</span>tl <span class="main">(</span>rev <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> A B<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> C<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B  tickFree_def front_tickFree_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT3 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> process_charn  HOL.nnf_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT3_S_pref <span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">;</span> <span class="free">s</span> <span class="main">≤</span> <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> le_list_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> is_processT3<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span>  is_processT4 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span>  process_charn <span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT4_S1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">;</span> <span class="free">X</span> <span class="main">⊆</span> snd <span class="free">x</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> Y <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"snd <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> is_processT4<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span><span class="main">∈</span><span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">@</span><span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">∪</span><span class="bound">Y</span><span class="main">)</span><span class="main">∈</span>F <span class="free">P</span> "</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> process_charn<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT5_S1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span> <span class="main">∪</span> <span class="free">Y</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">∧</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> contrapos_np<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT5<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT5_S2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span> <span class="main">∪</span> <span class="main">{</span><span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> is_processT5<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span><span class="operator">OF</span> conjI<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> is_processT5_S2a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span> <span class="main">∪</span> <span class="main">{</span><span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_np<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> is_processT5_S2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span>  is_processT5_S3<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>     B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="main">{</span><span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> C <span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="free">c</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">{}</span> <span class="keyword1">Un</span> <span class="main">{</span><span class="free">c</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> C<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> is_processT5_S2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A B<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> is_processT5_S4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="main">{</span><span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> contrapos_np<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT5_S3<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> is_processT5_S5<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">;</span> <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">c</span><span class="main">}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule_tac</span> Q <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="free">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">c</span><span class="main">}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> contrapos_pp<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> is_processT5_S2<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> is_processT5_S6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{</span><span class="free">c</span><span class="main">}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">c</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span><span class="main">@</span><span class="main">[</span><span class="free">c</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> is_processT5_S4<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> process_charn<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> is_processT7<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∧</span> tickFree <span class="bound">s</span> <span class="main">∧</span> front_tickFree <span class="bound">t</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> process_charn<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> is_processT7_S <span class="main">=</span>  is_processT7<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span><span class="operator">OF</span> conjI<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjI<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span>  conj_commute<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> "</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> process_charn<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> is_processT8_S <span class="main">=</span> is_processT8<span class="main">[</span><span class="operator">rule_format</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT8_Pair<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="free">s</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> surjective_pairing<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> is_processT8_S<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT9<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> process_charn<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT9_S_swap<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∉</span> D <span class="free">P</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∉</span> D <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> contrapos_nn<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT9<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Some Consequences of the Process Characterization›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_Trace_implies_no_Failure<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∉</span> T <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_def TRACES_def F_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span>  NT_NF <span class="main">=</span> no_Trace_implies_no_Failure

<span class="keyword1"><span class="command">lemma</span></span> T_def_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"T <span class="free">P</span> <span class="main">=</span> <span class="main">{</span><span class="bound">tr</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="bound">tr</span> <span class="main">=</span> fst <span class="bound">a</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_def TRACES_def F_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> F_T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_def_spec split_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> F_T1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟹</span> fst <span class="free">a</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule_tac</span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"snd <span class="free">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> F_T<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> T_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_def_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> is_processT4_S1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> is_processT4_empty <span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">=</span> F_T <span class="main">[</span><span class="operator">THEN</span> T_F<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> NF_NT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∉</span> T <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> contrapos_nn<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> T_F<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>  is_processT6_S1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> tick <span class="main">∉</span> <span class="free">X</span><span class="main">;</span><span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">::</span><span class="tfree">'a</span> event list<span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> Diff_triv<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">{</span></span></span>tick<span class="main"><span class="main"><span class="main">}</span></span></span>"</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
   <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> is_processT6<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> is_processT3_ST <span class="main">=</span> T_F <span class="main">[</span><span class="operator">THEN</span> is_processT3<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span><span class="operator">THEN</span> F_T<span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> is_processT3_ST_pref <span class="main">=</span> T_F <span class="main">[</span><span class="operator">THEN</span> is_processT3_S_pref <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> F_T<span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> is_processT3_SR <span class="main">=</span> F_T <span class="main">[</span><span class="operator">THEN</span> T_F <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> is_processT3<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemmas</span></span> D_T <span class="main">=</span> is_processT8_S <span class="main">[</span><span class="operator">THEN</span> F_T<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> D_T_subset <span class="main">:</span> <span class="quoted"><span class="quoted">"D <span class="free">P</span> <span class="main">⊆</span> T <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>D_T<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> NF_ND <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∉</span> D <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> contrapos_nn<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT8_S<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> NT_ND <span class="main">=</span> D_T_subset<span class="main">[</span><span class="operator">THEN</span> Set.contra_subsetD<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> T_F_spec <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>T_F F_T<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT5_S7<span class="main">:</span>  <span class="quoted"><span class="quoted">" <span class="main">⟦</span><span class="free">t</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">t</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_np<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> is_processT5<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> conjI<span class="main"><span class="main">,</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_F_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT5_S7'<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⟦</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">X</span> <span class="main">∪</span> <span class="free">A</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free">X</span> <span class="main">∧</span> <span class="free">t</span> <span class="main">@</span> <span class="main">[</span><span class="bound">x</span><span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_np<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Un_Diff_cancel<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> is_processT5<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_F_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Nil_subset_T<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="main">[]</span><span class="main">}</span> <span class="main">⊆</span> T <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_F_spec<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> is_processT1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Nil_elem_T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nil_subset_T<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> D_imp_front_tickFree <span class="main">=</span> is_processT8_S<span class="main">[</span><span class="operator">THEN</span> is_processT2<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> D_front_tickFree_subset <span class="main">:</span> <span class="quoted"><span class="quoted">"D <span class="free">P</span> <span class="main">⊆</span> Collect front_tickFree"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_imp_front_tickFree<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> F_D_part <span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="free">P</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>is_processT8_Pair<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> D_F <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">}</span> <span class="main">⊆</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>is_processT8_Pair<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> append_T_imp_tickFree<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">t</span> <span class="main">@</span> <span class="free">s</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">;</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">⟧</span> <span class="main">⟹</span> tickFree <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">frule</span> is_processT2_TR<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
   <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> front_tickFree_def tickFree_rev<span class="main">)</span>

<span class="keyword1"><span class="command">corollary</span></span> append_single_T_imp_tickFree <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">@</span> <span class="main">[</span><span class="free">a</span><span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">⟹</span> tickFree <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_T_imp_tickFree<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> F_subset_imp_T_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="free">P</span> <span class="main">⊆</span> F <span class="free">Q</span> <span class="main">⟹</span> T <span class="free">P</span> <span class="main">⊆</span> T <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subsetD T_F_spec<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT6_S2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>tick <span class="main">∉</span> <span class="free">X</span><span class="main">;</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> is_processT6_S1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_F_spec<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> is_processT9_tick<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">;</span> front_tickFree <span class="free">s</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> append.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subst<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> is_processT7_S<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> is_processT9 <span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> T_nonTickFree_imp_decomp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">t</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">;</span> <span class="main">¬</span> tickFree <span class="free">t</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> <span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> is_processT2_TR<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> nonTickFree_n_frontTickFree<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Process Approximation is a Partial Ordering, a Cpo, and a Pcpo ›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The Failure/Divergence Model of CSP Semantics provides two orderings:
The \emph{approximation ordering} (also called \emph{process ordering})
will be used for giving semantics to recursion (fixpoints) over processes,
the \emph{refinement ordering} captures our intuition that a more concrete
process is more deterministic and more defined than an abstract one.

We start with the key-concepts of the approximation ordering, namely
the predicates $min\_elems$ and $Ra$ (abbreviating \emph{refusals after}).
The former provides just a set of minimal elements from a given set
of elements of type-class $ord$ \ldots ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">min_elems</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'s</span><span class="main">::</span>ord<span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'s</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">min_elems</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">s</span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">t</span> <span class="main">&lt;</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Nil_min_elems <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">[]</span> <span class="main">∈</span> min_elems <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_elems_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_elems_le_self<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>min_elems <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_elems_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> elem_min_elems <span class="main">=</span> Set.set_mp<span class="main">[</span><span class="operator">OF</span> min_elems_le_self<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> min_elems_Collect_ftF_is_Nil <span class="main">:</span> <span class="quoted"><span class="quoted">"min_elems <span class="main">(</span>Collect front_tickFree<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_elems_def le_list_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> front_tickFree_charn<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tickFree_implies_front_tickFree<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_elems5 <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">s</span></span><span class="main">≤</span><span class="free">x</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> min_elems <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> * <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">!!</span> <span class="main">(</span><span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">(</span><span class="bound">A</span><span class="main">::</span><span class="tfree">'a</span> list set<span class="main">)</span> <span class="main">(</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span>
                <span class="bound">x</span> <span class="main">∈</span> <span class="bound">A</span> <span class="main">∧</span> length <span class="bound">x</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">s</span></span><span class="main">≤</span><span class="bound">x</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> min_elems <span class="bound">A</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> spec<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> nat_induct<span class="main">)</span> <span class="comment1">(* quirk in induct *)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Nil_min_elems<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">y</span><span class="main">.</span>  <span class="bound">y</span> <span class="main">∈</span> <span class="improper">A</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">&lt;</span> <span class="improper">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> A na x y<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">y</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> impE<span class="main"><span class="keyword3">,</span></span><span class="operator">drule</span> less_length_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">arith</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> s<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>min_elems_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule_tac</span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"length <span class="free">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> *<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>A<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_elems4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">::</span> <span class="tfree">'a</span> trace<span class="main">)</span> <span class="main">∈</span> min_elems <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> min_elems5<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_elems_charn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">t'</span> <span class="bound">r</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> <span class="main">(</span><span class="bound">t'</span> <span class="main">@</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">t'</span> <span class="main">∈</span> min_elems <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span> min_elems5<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> le_list_def<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemmas</span></span> min_elems_ex <span class="main">=</span> min_elems_charn  <span class="comment1">(* Legacy *)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_elems_no<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">::</span><span class="tfree">'a</span> list<span class="main">)</span> <span class="main">∈</span> min_elems <span class="free">A</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">≤</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="free">t</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> less_list_def mem_Collect_eq min_elems_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ \ldots while the second returns the set of possible
refusal sets after a given trace $s$ and a given process
$P$: ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Ra</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span> process<span class="main">,</span> <span class="tfree">'α</span> trace<span class="main">]</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'α</span> refusal set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">Ra</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ In the following, we link the process theory to the underlying 
fixpoint/domain theory of HOLCF by identifying the approximation ordering 
with HOLCF's pcpo's. ›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> 
   process  <span class="main">::</span>  <span class="main">(</span><span class="quoted"><span class="quoted">"type"</span></span><span class="main">)</span> <span class="quoted">below</span>     
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ declares approximation ordering $\_ \sqsubseteq \_$ also written 
        \verb+_ &lt;&lt; _+. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span> le_approx_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⊑</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> D <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">⊆</span> D <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span>
                                    <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟶</span> Ra <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">=</span> Ra <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> 
                                     min_elems <span class="main">(</span>D <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">⊆</span> T <span class="free"><span class="bound"><span class="entity">Q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ The approximation ordering captures the fact that more concrete
processes should be more defined by ordering the divergence sets
appropriately. For defined positions in a process, the failure
sets must coincide pointwise; moreover, the minimal elements
(wrt.~prefix ordering on traces, i.e.~lists) must be contained in
the trace set of the more concrete process.›</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">lemma</span></span> le_approx1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">⊑</span><span class="free">Q</span> <span class="main">⟹</span> D <span class="free">Q</span> <span class="main">⊆</span> D <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_approx_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> le_approx2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">P</span><span class="main">⊑</span><span class="free">Q</span><span class="main">;</span> <span class="free">s</span> <span class="main">∉</span> D <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ra_def le_approx_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> le_approx3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span> <span class="main">⊆</span> T <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_approx_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_approx2T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">P</span><span class="main">⊑</span><span class="free">Q</span><span class="main">;</span> <span class="free">s</span> <span class="main">∉</span> D <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span>  <span class="free">s</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_approx2 T_F_spec<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_approx_lemma_F <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">⊑</span><span class="free">Q</span> <span class="main">⟹</span> F <span class="free">Q</span> <span class="main">⊆</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> F_D_part<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> F_D_part<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>le_approx_def Ra_def min_elems_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemmas</span></span> order_lemma <span class="main">=</span> le_approx_lemma_F

<span class="keyword1"><span class="command">lemma</span></span> le_approx_lemma_T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">⊑</span><span class="free">Q</span> <span class="main">⟹</span> T <span class="free">Q</span> <span class="main">⊆</span> T <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>le_approx_lemma_F <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_F_spec<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> proc_ord2a <span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span><span class="main">;</span> <span class="free">s</span> <span class="main">∉</span> D <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_approx_def Ra_def<span class="main">)</span>


<span class="keyword1"><span class="command">instance</span></span>
   process <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"type"</span></span><span class="main">)</span> <span class="quoted">po</span>
<span class="keyword1"><span class="command">proof</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process"</span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">⊑</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_approx_def min_elems_def <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Process.D_T<span class="main">)</span>
 <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process"</span></span> 
   <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">⊑</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">⊑</span> <span class="skolem">P</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="skolem">Q</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> A<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx1<span class="main"><span class="main">]</span></span> B<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx1<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> A<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx_lemma_F<span class="main"><span class="main">]</span></span> B<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx_lemma_F<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process_eq_spec<span class="main">)</span>
 <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="skolem">R</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process"</span></span> 
   <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">⊑</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">⊑</span> <span class="skolem">R</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">⊑</span> <span class="skolem">R</span>"</span></span> 
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> C <span class="main">:</span> <span class="quoted"><span class="quoted">"D <span class="skolem">R</span> <span class="main">⊆</span> D <span class="skolem">P</span>"</span></span> 
               <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> A<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx1<span class="main"><span class="main">]</span></span> B<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> D <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="skolem">P</span> <span class="main">⟶</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="skolem">P</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span>  F <span class="skolem">R</span><span class="main">}</span>"</span></span> 
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> A<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx1<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> Set.contra_subsetD<span class="main"><span class="main">]</span></span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> B<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx1<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> Set.contra_subsetD<span class="main"><span class="main">]</span></span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> A<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> B<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx2<span class="main"><span class="main">]</span></span><span class="main">)</span> 
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">have</span></span> E <span class="main">:</span> <span class="quoted"><span class="quoted">"min_elems <span class="main">(</span>D <span class="skolem">P</span><span class="main">)</span> <span class="main">⊆</span> T <span class="skolem">R</span>"</span></span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> B<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx3<span class="main"><span class="main">]</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx3<span class="main"><span class="main">]</span></span> <span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> B<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx_lemma_T<span class="main"><span class="main">]</span></span> A<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx1<span class="main"><span class="main">]</span></span> <span class="main">)</span> 
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_elems_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">x</span> <span class="main">∈</span> D <span class="skolem">Q</span>"</span></span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> B <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"T <span class="skolem">R</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> 
                     <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subset_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> B <span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx2T<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> B <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"T <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> 
                     <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subset_iff<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">,</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> C D E<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_approx_def Ra_def<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ At this point, we inherit quite a number of facts from the underlying
HOLCF theory, which comprises a library of facts such as \verb+chain+,
\verb+directed+(sets), upper bounds and least upper bounds, etc. ›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Some facts from the theory of complete partial orders:
\begin{itemize}
\item \verb+Porder.chainE+ : <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Porder.chainE"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\item \verb+Porder.chain_mono+ : <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Porder.chain_mono"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\item \verb+Porder.is_ubD+ : <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Porder.is_ubD"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\item \verb+Porder.ub_rangeI+ : \\ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Porder.ub_rangeI"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\item \verb+Porder.ub_imageD+ : <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Porder.ub_imageD"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\item \verb+Porder.is_ub_upward+ : <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Porder.is_ub_upward"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\item \verb+Porder.is_lubD1+ : <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Porder.is_lubD1"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\item \verb+Porder.is_lubI+ : <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Porder.is_lubI"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\item \verb+Porder.is_lub_maximal+ : <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Porder.is_lub_maximal"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\item \verb+Porder.is_lub_lub+ : <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Porder.is_lub_lub"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\item \verb+Porder.is_lub_range_shift+: \\ <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Porder.is_lub_range_shift"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\item \verb+Porder.is_lub_rangeD1+: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Porder.is_lub_rangeD1"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\item \verb+Porder.lub_eqI+: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Porder.lub_eqI"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\item \verb+Porder.is_lub_unique+:<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "Porder.is_lub_unique"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
\end{itemize}
›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lim_proc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'α</span> process<span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'α</span> process"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">lim_proc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">=</span> Abs_process <span class="main">(</span><span class="main">⋂</span> <span class="main">(</span>F <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="main">(</span>D <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_elems3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">;</span> <span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span> <span class="main">∉</span> min_elems <span class="main">(</span>D <span class="free">P</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_elems_def le_list_def less_list_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> t r<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">t</span> <span class="main">≤</span> <span class="free">s</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">r</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_processT7_S append_eq_first_pref_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> D_T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> append_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
      <span class="operator">drule</span> append_T_imp_tickFree<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tickFree_implies_front_tickFree<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_elems1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">∉</span> D <span class="free">P</span><span class="main">;</span> <span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span> <span class="main">∈</span> min_elems <span class="main">(</span>D <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> contrapos_np<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> min_elems3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> min_elems2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">∉</span> D <span class="free">P</span><span class="main">;</span> <span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">;</span> <span class="free">P</span> <span class="main">⊑</span> <span class="free">S</span><span class="main">;</span> <span class="free">Q</span> <span class="main">⊑</span> <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> le_approx_lemma_T<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_F_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"T <span class="free">S</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subsetD<span class="main"><span class="keyword3">,</span></span> <span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subsetD<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_approx_def min_elems1<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> min_elems6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">∉</span> D <span class="free">P</span><span class="main">;</span> <span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">;</span> <span class="free">P</span> <span class="main">⊑</span> <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> min_elems2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ND_F_dir2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">∉</span> D <span class="free">P</span><span class="main">;</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">;</span> <span class="free">P</span> <span class="main">⊑</span> <span class="free">S</span><span class="main">;</span> <span class="free">Q</span> <span class="main">⊑</span> <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> le_approx_lemma_T<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_approx_def Ra_def T_F_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> eqset_imp_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_F_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> <span class="comment1">―‹orig version›</span>

<span class="keyword1"><span class="command">lemma</span></span> ND_F_dir2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">s</span> <span class="main">∉</span> D <span class="free">P</span><span class="main">;</span> <span class="free">s</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">;</span> <span class="free">P</span> <span class="main">⊑</span> <span class="free">S</span><span class="main">;</span> <span class="free">Q</span> <span class="main">⊑</span> <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∈</span> T <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">S</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> le_approx_lemma_T<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_approx_def Ra_def T_F_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">s</span></span></span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> eqset_imp_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_F_spec<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> chain_lemma<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>chain <span class="free">S</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">S</span> <span class="free">i</span> <span class="main">⊑</span> <span class="free">S</span> <span class="free">k</span> <span class="main">∨</span> <span class="free">S</span> <span class="free">k</span> <span class="main">⊑</span> <span class="free">S</span> <span class="free">i</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≤</span> <span class="free">k</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>chain_mono chain_mono_less<span class="main">)</span>
 

<span class="keyword1"><span class="command">lemma</span></span> is_process_REP_LUB<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> chain<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">S</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_process <span class="main">(</span><span class="main">⋂</span> <span class="main">(</span>F <span class="main">`</span> range <span class="free">S</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="main">(</span>D <span class="main">`</span> range <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_process_def<span class="main">)</span>
   <span class="keyword3"><span class="command">show</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FAILURES_def is_processT<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trace"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event set"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> A <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>FAILURES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span> <span class="main">::</span> nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span> <span class="main">::</span> nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
   <span class="keyword3"><span class="command">thus</span></span>   <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>   DIVERGENCES_def FAILURES_def
                  <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_processT2<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>  <span class="skolem">t</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trace"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> "</span></span>
   <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  DIVERGENCES_def FAILURES_def
                  <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_processT3<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trace"</span></span>   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event set"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Y</span>"</span></span>
   <span class="keyword3"><span class="command">thus</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  DIVERGENCES_def FAILURES_def
                  <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_processT4<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trace"</span></span>   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="main">::</span><span class="quoted"><span class="quoted">" <span class="tfree">'a</span> event set"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span><span class="main">∈</span><span class="skolem">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s</span><span class="main">@</span><span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span><span class="main">∉</span>FAILURES<span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F<span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D<span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword3"><span class="command">thus</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">txt</span></span><span class="quoted"><span class="plain_text">‹ What does this mean: All trace prolongations $c$ in all $Y$, 
         which are blocking in the limit, will also occur in the refusal set 
         of the limit. ›</span></span>
   <span class="keyword1"><span class="command">using</span></span> A B chain
   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DIVERGENCES_def FAILURES_def<span class="main"><span class="keyword3">,</span></span>
          <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>range <span class="free">S</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="bound">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DIVERGENCES_def FAILURES_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rename_tac</span> a<span class="main"><span class="keyword3">,</span></span>
          <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">S</span> <span class="improper">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT8<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span><span class="main">::</span><span class="quoted">nat</span> 
      <span class="keyword3"><span class="command">assume</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">have</span></span> X_ref_at_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">S</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">using</span></span> X <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">assume</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> defined<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">S</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">::</span><span class="tfree">'a</span> trace<span class="main">,</span> <span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">S</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>X_ref_at_a
                 <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_processT5<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span>
            <span class="operator">frule</span> Y<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> spec<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> mp<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> exE<span class="main"><span class="keyword3">,</span></span>
            <span class="operator">erule_tac</span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span><span class="improper">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">S</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> contrapos_pp<span class="main">)</span>
         <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a'</span> <span class="main">::</span> <span class="quoted">nat</span>
         <span class="keyword3"><span class="command">assume</span></span> s_c_trace_not_trace_somewhere<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> F <span class="main">(</span><span class="free">S</span> <span class="skolem">a'</span><span class="main">)</span>"</span></span>
         <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> F <span class="main">(</span><span class="free">S</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">insert</span> chain_lemma<span class="main"><span class="main">[</span></span><span class="operator">OF</span> chain<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">a</span></span>"</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">a'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span><span class="operator">erule</span> disjE<span class="main">)</span>
           <span class="keyword3"><span class="command">assume</span></span> before<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">a</span> <span class="main">⊑</span> <span class="free">S</span> <span class="skolem">a'</span>"</span></span>
           <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> F <span class="main">(</span><span class="free">S</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> s_c_trace_not_trace_somewhere  before
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">c</span><span class="main">]</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">S</span> <span class="skolem">a</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span>
                   <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_F_spec before<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx2T<span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_nn<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> T_F_spec<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>min_elems6<span class="main"><span class="main">[</span></span><span class="operator">OF</span> defined<span class="main"><span class="main">]</span></span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
         <span class="keyword1"><span class="command">next</span></span>
           <span class="keyword3"><span class="command">assume</span></span> after<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="skolem">a'</span> <span class="main">⊑</span> <span class="free">S</span> <span class="skolem">a</span>"</span></span>
           <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> F <span class="main">(</span><span class="free">S</span> <span class="skolem">a</span><span class="main">)</span>"</span></span>
             <span class="keyword1"><span class="command">using</span></span> s_c_trace_not_trace_somewhere
             <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_F_spec after<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> le_approx2T<span class="main"><span class="main">]</span></span>
                         s_c_trace_not_trace_somewhere<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> NF_ND<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trace"</span></span>   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event set"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword3"><span class="command">thus</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DIVERGENCES_def FAILURES_def
                  <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span> <span class="main"><span class="main">:</span></span> is_processT6<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trace"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">:</span> DIVERGENCES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span>    <span class="quoted"><span class="quoted">"tickFree <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">" front_tickFree <span class="skolem">t</span>"</span></span>
   <span class="keyword3"><span class="command">thus</span></span>   <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span> <span class="main">∈</span> DIVERGENCES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DIVERGENCES_def FAILURES_def
                  <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_processT7<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trace"</span></span>  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event set"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> DIVERGENCES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> "</span></span>
   <span class="keyword3"><span class="command">thus</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> FAILURES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DIVERGENCES_def FAILURES_def
                       <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_processT8<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trace"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> DIVERGENCES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> "</span></span>
   <span class="keyword3"><span class="command">thus</span></span>   <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> DIVERGENCES <span class="main">(</span><span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> F <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">,</span> <span class="main">⋂</span> <span class="bound">a</span><span class="main">::</span>nat<span class="main">.</span> D <span class="main">(</span><span class="free">S</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DIVERGENCES_def FAILURES_def
                  <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_processT9<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemmas</span></span> Rep_Abs_LUB <span class="main">=</span> Abs_process_inverse<span class="main">[</span><span class="operator">simplified</span> Rep_process<span class="main">,</span> 
                                         <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> is_process_REP_LUB<span class="main">,</span>
                                         <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span> F_LUB<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">S</span> <span class="main">⟹</span> F<span class="main">(</span>lim_proc<span class="main">(</span>range <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋂</span> <span class="main">(</span>F <span class="main">`</span> range <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lim_proc_def <span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> F_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FAILURES_def Rep_Abs_LUB<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> D_LUB<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">S</span> <span class="main">⟹</span> D<span class="main">(</span>lim_proc<span class="main">(</span>range <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋂</span> <span class="main">(</span>D <span class="main">`</span> range <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lim_proc_def <span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> D_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DIVERGENCES_def Rep_Abs_LUB<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> T_LUB<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">S</span> <span class="main">⟹</span> T<span class="main">(</span>lim_proc<span class="main">(</span>range <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋂</span> <span class="main">(</span>T <span class="main">`</span> range <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lim_proc_def <span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> T_def<span class="main">)</span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TRACES_def FAILURES_def Rep_Abs_LUB<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> F_T<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> T_F<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> D_LUB_2<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">S</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">∈</span> D<span class="main">(</span>lim_proc<span class="main">(</span>range <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> D_LUB<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">schematic_goal</span></span> T_LUB_2<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> T <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="var">?X</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> T_LUB<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Process Refinement is a Partial Ordering›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ The following type instantiation declares the refinement order
$\_ \le \_ $ written \verb+_  &lt;= _+. It captures the intuition that more
concrete processes should be more deterministic and more defined.›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span>
   process <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">ord</span>          
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>  le_ref_def   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> D <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">⊆</span> D <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> F <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">⊆</span> F <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>  less_ref_def <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">::</span><span class="tfree">'a</span> process<span class="main">)</span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_approx_implies_le_ref<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'α</span> process<span class="main">)</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">≤</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_ref_def le_approx1 le_approx_lemma_F<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> le_ref1<span class="main">:</span>                     <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≤</span> <span class="free">Q</span> <span class="main">⟹</span> D <span class="free">Q</span> <span class="main">⊆</span> D <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_ref_def<span class="main">)</span> 


<span class="keyword1"><span class="command">lemma</span></span> le_ref2<span class="main">:</span>                     <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">≤</span><span class="free">Q</span> <span class="main">⟹</span> F <span class="free">Q</span> <span class="main">⊆</span> F <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_ref_def<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> le_ref2T <span class="main">:</span>                    <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">≤</span><span class="free">Q</span> <span class="main">⟹</span> T <span class="free">Q</span> <span class="main">⊆</span> T <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_F_spec<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> le_ref2<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> subsetD<span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">instance</span></span>  process <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">order</span>
<span class="keyword1"><span class="command">proof</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="skolem">R</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process"</span></span>
   <span class="keyword1"><span class="command">{</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">P</span> <span class="main">&lt;</span> <span class="skolem">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">≤</span> <span class="skolem">Q</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">Q</span> <span class="main">≤</span>  <span class="skolem">P</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_ref_def less_ref_def Process_eq_spec<span class="main">)</span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≤</span> <span class="skolem">P</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_ref_def<span class="main">)</span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≤</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">≤</span> <span class="skolem">R</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≤</span> <span class="skolem">R</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_ref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≤</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">≤</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="skolem">Q</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_ref_def Process_eq_spec<span class="main">)</span>  
   <span class="keyword1"><span class="command">}</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lim_proc_is_ub<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="free">S</span> <span class="main">⟹</span> range <span class="free">S</span> <span class="main">&lt;|</span> lim_proc <span class="main">(</span>range <span class="free">S</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_ub_def le_approx_def F_LUB D_LUB T_LUB Ra_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">using</span></span> chain_lemma is_processT8 le_approx2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">using</span></span> D_T chain_lemma le_approx2T le_approx_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lim_proc_is_lub1<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">S</span> <span class="main">⟹</span> <span class="main">∀</span> <span class="bound">u</span> <span class="main">.</span> <span class="main">(</span>range <span class="free">S</span> <span class="main">&lt;|</span> <span class="bound">u</span> <span class="main">⟶</span>  D <span class="bound">u</span> <span class="main">⊆</span> D <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_LUB<span class="main"><span class="keyword3">,</span></span> <span class="operator">frule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Porder.ub_rangeD<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> le_approx1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lim_proc_is_lub2<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"chain <span class="free">S</span> <span class="main">⟹</span> <span class="main">∀</span> <span class="bound">u</span> <span class="main">.</span> range <span class="free">S</span> <span class="main">&lt;|</span> <span class="bound">u</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">.</span>  <span class="bound">s</span> <span class="main">∉</span> D <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="free">S</span><span class="main">)</span><span class="main">)</span>
   <span class="main">⟶</span> Ra <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> Ra <span class="bound">u</span> <span class="bound">s</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_ub_def D_LUB F_LUB Ra_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> proc_ord2a <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> is_processT8_S proc_ord2a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> lim_proc_is_lub3a<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="free">s</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">∉</span> D <span class="free">P</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="free">s</span> <span class="main">@</span> <span class="main">[</span><span class="free">c</span><span class="main">]</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule</span> contrapos_np<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_list_def  less_list_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_def butlast_append butlast_snoc 
          front_tickFree_mono is_process7 is_process_Rep self_append_conv<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> lim_proc_is_lub3b<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> 1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="bound">xa</span> <span class="main">∈</span> D <span class="bound">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="bound">x</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">xa</span> <span class="main">∈</span> T <span class="free">u</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>     2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xa</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>     3 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="bound">xa</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">∈</span> D <span class="bound">xa</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>     4 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">⟶</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> T <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">xa</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="free">x</span>"</span></span><span class="main">)</span> 
      <span class="keyword3"><span class="command">case</span></span> True  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">xa</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="free">x</span>›</span></span>  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 2 3  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span><span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">xa</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="free">x</span><span class="main">)</span>›</span></span> <span class="keyword2"><span class="keyword">and</span></span> 3 4
                 <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span> <span class="bound">r</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">∉</span> D <span class="bound">y</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">∈</span> D <span class="free">xa</span> <span class="main">∧</span> <span class="bound">r</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span> <span class="main">=</span> <span class="free">x</span>"</span></span> 
                         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree front_tickFree_charn 
                                   less_self lim_proc_is_lub3a nil_less 
                                   tickFree_implies_front_tickFree<span class="main">)</span>
           <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> A<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> <span class="quoted">"3"</span> D_imp_front_tickFree lim_proc_is_lub3a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lim_proc_is_lub3c<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="free">S</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>     **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">=</span> range <span class="free">S</span>"</span></span>  <span class="comment1">―‹protection for range - otherwise auto unfolds and gets lost›</span>
<span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">u</span><span class="main">.</span> <span class="free">X</span> <span class="main">&lt;|</span> <span class="bound">u</span> <span class="main">⟶</span>  min_elems<span class="main">(</span>D<span class="main">(</span>lim_proc <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> T <span class="bound">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> B <span class="main">:</span> <span class="quoted"><span class="quoted">"D <span class="main">(</span>lim_proc <span class="free">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">⋂</span> <span class="main">(</span>D <span class="main">`</span> <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> * ** D_LUB<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_ub_def * **<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> B min_elems_def le_approx_def HOL.imp_conjR HOL.all_conj_distrib Ball_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff imp_conjL<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> lim_proc_is_lub3b<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"range <span class="free"><span class="free">S</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"**"</span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> limproc_is_lub<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">S</span> <span class="main">⟹</span> range <span class="free">S</span> <span class="main">&lt;&lt;|</span> lim_proc <span class="main">(</span>range <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_lub_def lim_proc_is_ub<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_approx_def is_lub_def lim_proc_is_ub<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lim_proc_is_lub1 lim_proc_is_lub2 lim_proc_is_lub3c<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> limproc_is_thelub<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">S</span> <span class="main">⟹</span> Lub <span class="free">S</span> <span class="main">=</span> lim_proc <span class="main">(</span>range <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">frule</span> limproc_is_lub<span class="main"><span class="keyword3">,</span></span><span class="operator">frule</span> Porder.po_class.lub_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>


<span class="keyword1"><span class="command">instance</span></span>
   process <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">cpo</span>
<span class="keyword1"><span class="command">proof</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">S</span> <span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'α</span> process"</span></span>
   <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="skolem">S</span>"</span></span> 
   <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> range <span class="skolem">S</span> <span class="main">&lt;&lt;|</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> limproc_is_lub <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span>
   process <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">)</span> <span class="quoted">pcpo</span>
<span class="keyword1"><span class="command">proof</span></span>
   <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x</span><span class="main">::</span><span class="tfree">'a</span> process<span class="main">.</span> <span class="main">∀</span> <span class="bound">y</span><span class="main">::</span><span class="tfree">'a</span> process<span class="main">.</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="bound">y</span>"</span></span> 
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> is_process_witness <span class="main">:</span> 
           <span class="quoted"><span class="quoted">"is_process<span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> front_tickFree <span class="bound">s</span><span class="main">}</span><span class="main">,</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> front_tickFree <span class="bound">d</span><span class="main">}</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>is_process_def FAILURES_def DIVERGENCES_def<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> tickFree_implies_front_tickFree front_tickFree_dw_closed
                             front_tickFree_append<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">have</span></span> bot_inverse <span class="main">:</span> 
           <span class="quoted"><span class="quoted">"Rep_process<span class="main">(</span>Abs_process<span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> front_tickFree <span class="bound">s</span><span class="main">}</span><span class="main">,</span>Collect front_tickFree<span class="main">)</span><span class="main">)</span><span class="main">=</span>
                          <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> front_tickFree <span class="bound">s</span><span class="main">}</span><span class="main">,</span> Collect front_tickFree<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> Abs_process_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_process is_process_witness<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> divergences_frontTickFree<span class="main">:</span>
           <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> snd <span class="main">(</span>Rep_process <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> front_tickFree <span class="bound">x</span>"</span></span> 
           <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> D_imp_front_tickFree<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_def DIVERGENCES_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> failures_frontTickFree<span class="main">:</span>
           <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span> <span class="bound">s</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> fst <span class="main">(</span>Rep_process <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> front_tickFree <span class="bound">s</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> is_processT2<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
              <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_def FAILURES_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> minelems_contains_mt<span class="main">:</span>
           <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> min_elems <span class="main">(</span>Collect front_tickFree<span class="main">)</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_elems_def front_tickFree_charn<span class="main"><span class="keyword3">,</span></span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> 
              <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Nil_elem_T<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"Abs_process <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> front_tickFree <span class="bound">s</span><span class="main">}</span><span class="main">,</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> front_tickFree <span class="bound">d</span><span class="main">}</span><span class="main">)</span>"</span></span> 
            <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_approx_def bot_inverse Ra_def 
                       F_def D_def FAILURES_def DIVERGENCES_def
                       divergences_frontTickFree failures_frontTickFree<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> minelems_contains_mt Nil_elem_T <span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Process Refinement is admissible ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> le_adm<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="free">u</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>cpo<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> process<span class="main">)</span> <span class="main">⟹</span> monofun <span class="free">v</span> <span class="main">⟹</span> adm<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">u</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">v</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_ref_def cont2contlubE adm_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">Y</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span>  <span class="main">⊑</span> <span class="free">v</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_ub_thelub monofunE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"D <span class="main">(</span><span class="free">v</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span><span class="main">(</span>4<span class="main">)</span> le_approx1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> D_LUB<span class="main">[</span><span class="operator">OF</span> ch2ch_cont<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> limproc_is_thelub<span class="main">[</span><span class="operator">OF</span> ch2ch_cont<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="quoted">"1"</span><span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">Y</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span>  <span class="main">⊑</span> <span class="free">v</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_ub_thelub monofunE<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="free">v</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> F <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span><span class="main">(</span>4<span class="main">)</span> le_approx_lemma_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> F_LUB<span class="main">[</span><span class="operator">OF</span> ch2ch_cont<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> limproc_is_thelub<span class="main">[</span><span class="operator">OF</span> ch2ch_cont<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="quoted">"2"</span><span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> le_adm_cont<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> le_adm<span class="main">[</span><span class="operator">OF</span> _ cont2mono<span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Conditional statement is cont ›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The conditional operator of CSP is obtained by a direct shallow embedding. Here we prove it continuous›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> if_then_else_cont<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="tfree">'c</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>cpo<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'b</span> process<span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>     **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> cont<span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">P</span> <span class="bound">x</span> <span class="keyword1">then</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span> <span class="keyword1">else</span> <span class="free">g</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> * ** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>cont_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Bot">
<div class="head">
<h1>Theory Bot</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ********************************************************************
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">chapter</span></span><span class="quoted"><span class="plain_text">‹ The CSP Operators ›</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹The Undefined Process›</span></span>

<span class="keyword1"><span class="command">theory</span></span>     Bot
<span class="keyword2"><span class="keyword">imports</span></span>    <a href="Process.html">Process</a>
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Bot</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process"</span></span>  
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">Bot</span> <span class="main">≡</span> Abs_process <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> front_tickFree <span class="bound">s</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> front_tickFree <span class="bound">d</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_process_REP_Bot <span class="main">:</span> 
  <span class="quoted"><span class="quoted">"is_process  <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> front_tickFree <span class="bound">s</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> front_tickFree <span class="bound">d</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> tickFree_implies_front_tickFree is_process_def 
              FAILURES_def DIVERGENCES_def
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Process.front_tickFree_dw_closed 
        <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> Process.front_tickFree_append<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> Rep_Abs_Bot <span class="main">:</span><span class="quoted"><span class="quoted">"Rep_process <span class="main">(</span>Abs_process <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> front_tickFree <span class="bound">s</span><span class="main">}</span><span class="main">,</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> front_tickFree <span class="bound">d</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
                    <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> front_tickFree <span class="bound">s</span><span class="main">}</span><span class="main">,</span><span class="main">{</span><span class="bound">d</span><span class="main">.</span> front_tickFree <span class="bound">d</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> Abs_process_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> CollectI Rep_process is_process_REP_Bot<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> F_Bot<span class="main">:</span> <span class="quoted"><span class="quoted">"F Bot <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> front_tickFree <span class="bound">s</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bot_def FAILURES_def F_def Rep_Abs_Bot<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> D_Bot<span class="main">:</span> <span class="quoted"><span class="quoted">"D Bot <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> front_tickFree <span class="bound">d</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bot_def DIVERGENCES_def D_def Rep_Abs_Bot<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> T_Bot<span class="main">:</span> <span class="quoted"><span class="quoted">"T Bot <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> front_tickFree <span class="bound">s</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bot_def TRACES_def T_def FAILURES_def Rep_Abs_Bot<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ This is the key result: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">⊥</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> --- which we know to exist 
from the process instantiation --- is equal Bot .
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Bot_is_UU<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Bot <span class="main">=</span> <span class="main">⊥</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Pcpo.eq_bottom_iff Process.le_approx_def Ra_def 
                 min_elems_Collect_ftF_is_Nil Process.Nil_elem_T 
                 F_Bot D_Bot T_Bot
           <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> D_imp_front_tickFree<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> Process.is_processT2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> F_UU<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="main">⊥</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> front_tickFree <span class="bound">s</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> F_Bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> D_UU<span class="main">:</span> <span class="quoted"><span class="quoted">"D <span class="main">⊥</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> front_tickFree <span class="bound">d</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> D_Bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> T_UU<span class="main">:</span> <span class="quoted"><span class="quoted">"T <span class="main">⊥</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> front_tickFree <span class="bound">s</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> T_Bot <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Skip">
<div class="head">
<h1>Theory Skip</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ******************************************************************** 
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹The SKIP Process›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Skip 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Process.html">Process</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SKIP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> process"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">SKIP</span> <span class="main">≡</span> Abs_process <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">X</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">}</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_process_REP_Skip<span class="main">:</span>
<span class="quoted"><span class="quoted">" is_process <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">X</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">}</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FAILURES_def DIVERGENCES_def front_tickFree_def is_process_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_np<span class="main"><span class="keyword3">,</span></span><span class="operator">drule</span> neq_Nil_conv<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_process_REP_Skip2<span class="main">:</span>
<span class="quoted"><span class="quoted">"is_process <span class="main">(</span><span class="main">{</span><span class="main">[]</span><span class="main">}</span> <span class="main">×</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> tick <span class="main">∉</span> <span class="bound">X</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">}</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> is_process_REP_Skip <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">lemmas</span></span> process_prover <span class="main">=</span> Rep_process Abs_process_inverse 
	                       FAILURES_def TRACES_def 
	                       DIVERGENCES_def is_process_REP_Skip

<span class="keyword1"><span class="command">lemma</span></span> F_SKIP<span class="main">:</span>
<span class="quoted"><span class="quoted">"F SKIP <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">X</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  process_prover SKIP_def F_def is_process_REP_Skip2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> D_SKIP<span class="main">:</span> <span class="quoted"><span class="quoted">"D SKIP <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  process_prover SKIP_def D_def is_process_REP_Skip2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> T_SKIP<span class="main">:</span> <span class="quoted"><span class="quoted">"T SKIP <span class="main">=</span><span class="main">{</span><span class="main">[]</span><span class="main">,</span><span class="main">[</span>tick<span class="main">]</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  process_prover SKIP_def T_def is_process_REP_Skip2<span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Stop">
<div class="head">
<h1>Theory Stop</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ******************************************************************** 
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ The STOP Process ›</span></span>

<span class="keyword1"><span class="command">theory</span></span>     Stop
<span class="keyword2"><span class="keyword">imports</span></span>    <a href="Process.html">Process</a> 
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">STOP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'α</span> process"</span></span>  
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">STOP</span> <span class="main">≡</span> Abs_process <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span><span class="main">}</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_process_REP_STOP<span class="main">:</span> <span class="quoted"><span class="quoted">"is_process <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span><span class="main">}</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_process_def FAILURES_def DIVERGENCES_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_Abs_STOP <span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_process <span class="main">(</span>Abs_process <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span><span class="main">}</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span><span class="main">}</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> Abs_process_inverse<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Rep_process is_process_REP_STOP<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> F_STOP <span class="main">:</span> <span class="quoted"><span class="quoted">"F STOP <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> STOP_def FAILURES_def F_def Rep_Abs_STOP<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> D_STOP<span class="main">:</span> <span class="quoted"><span class="quoted">"D STOP <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> STOP_def DIVERGENCES_def D_def Rep_Abs_STOP<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> T_STOP<span class="main">:</span> <span class="quoted"><span class="quoted">"T STOP <span class="main">=</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> STOP_def TRACES_def FAILURES_def T_def Rep_Abs_STOP<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Mprefix">
<div class="head">
<h1>Theory Mprefix</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ******************************************************************** 
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ The Multi-Prefix Operator Definition ›</span></span>

<span class="keyword1"><span class="command">theory</span></span>  Mprefix 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Process.html">Process</a> 
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ The Definition and some Consequences ›</span></span>

<span class="keyword1"><span class="command">definition</span></span>   <span class="entity">Mprefix</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> set<span class="main">,</span><span class="tfree">'a</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> process<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> process"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Mprefix</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span>  Abs_process<span class="main">(</span>  
                              <span class="main">{</span><span class="main">(</span><span class="bound">tr</span><span class="main">,</span><span class="bound">ref</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">ref</span> <span class="keyword1">Int</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span> <span class="main">∪</span>
                              <span class="main">{</span><span class="main">(</span><span class="bound">tr</span><span class="main">,</span><span class="bound">ref</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="bound">tr</span> <span class="main">∈</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∧</span>
                                         <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> ev <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span>hd <span class="bound">tr</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>tl <span class="bound">tr</span><span class="main">,</span><span class="bound">ref</span><span class="main">)</span><span class="main">∈</span>F<span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">,</span>
                              <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>  hd <span class="bound">d</span>  <span class="main">∈</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∧</span>
                                         <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> ev <span class="bound">a</span> <span class="main">=</span> hd <span class="bound">d</span> <span class="main">∧</span> tl <span class="bound">d</span> <span class="main">∈</span> D<span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">syntax</span></span><span class="main">(</span>xsymbols<span class="main">)</span>
  <span class="quoted">"@mprefix"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>pttrn<span class="main">,</span><span class="tfree">'a</span> set<span class="main">,</span><span class="tfree">'a</span> process<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span>	<span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">□</span><span class="keyword3">(</span>_<span class="keyword3">)</span> <span class="keyword1">∈</span> <span class="keyword3">(</span>_<span class="keyword3">)</span> <span class="keyword1">→</span> <span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">)</span>"</span><span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>64<span class="main">]</span>64<span class="main">)</span>


<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">□</span><span class="free">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> <span class="free">P</span>"</span> <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> Mprefix <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Well-foundedness of Mprefix ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_process_REP_Mp  <span class="main">:</span>
<span class="quoted"><span class="quoted">"is_process <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">tr</span><span class="main">,</span><span class="bound">ref</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr</span><span class="main">=</span><span class="main">[]</span> <span class="main">∧</span>  <span class="bound">ref</span> <span class="main">∩</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span> <span class="main">∪</span>
             <span class="main">{</span><span class="main">(</span><span class="bound">tr</span><span class="main">,</span><span class="bound">ref</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="bound">tr</span> <span class="main">∈</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> ev <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span>hd <span class="bound">tr</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>tl <span class="bound">tr</span><span class="main">,</span><span class="bound">ref</span><span class="main">)</span> <span class="main">∈</span> F<span class="main">(</span><span class="free">P</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">,</span>
             <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">≠</span>  <span class="main">[]</span> <span class="main">∧</span>  hd <span class="bound">d</span> <span class="main">∈</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> ev <span class="bound">a</span> <span class="main">=</span> hd <span class="bound">d</span>  <span class="main">∧</span> tl <span class="bound">d</span> <span class="main">∈</span> D<span class="main">(</span><span class="free">P</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
 <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"is_process<span class="main">(</span><span class="var">?f</span><span class="main">,</span> <span class="var">?d</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>is_process_def FAILURES_def DIVERGENCES_def
                  Product_Type.fst_conv Product_Type.snd_conv<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">intro</span> conjI allI impI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>  
    <span class="keyword3"><span class="command">fix</span></span>    <span class="skolem">s</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event list"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> H <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span>       <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">s</span>"</span></span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> H<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  front_tickFree_def tickFree_def
                                    <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>list_nonMt_append<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> aa ta x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">ta</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> front_tickFree_charn
                                    <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span> <span class="main"><span class="main">:</span></span> is_processT2<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tickFree_def<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event list"</span></span> 
    <span class="keyword3"><span class="command">assume</span></span>     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> is_processT3<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span>    <span class="skolem">s</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event list"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span>     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">∧</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_processT4<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span>    <span class="skolem">s</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event list"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span>     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span><span class="main">∈</span><span class="skolem">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> "</span></span>
               <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_processT1 is_processT5<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span><span class="main">::</span>    <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event list"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span>     <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_processT6<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span><span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event list"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span>     <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span>  <span class="var">?d</span> <span class="main">∧</span> tickFree <span class="skolem">s</span> <span class="main">∧</span> front_tickFree <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="var">?d</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_processT7_S<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span><span class="main">::</span>    <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event list"</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event set"</span></span>
    <span class="keyword3"><span class="command">assume</span></span>     <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="var">?d</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_processT8_S<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span><span class="main">::</span>    <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event list"</span></span> 
    <span class="keyword3"><span class="command">assume</span></span>     <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> <span class="var">?d</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="var">?d</span>"</span></span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_processT9<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(* bizarre exercise in style proposed by Makarius... *)</span>
<span class="keyword1"><span class="command">lemma</span></span> is_process_REP_Mp'  <span class="main">:</span>
     <span class="quoted"><span class="quoted">"is_process <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">tr</span><span class="main">,</span><span class="bound">ref</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr</span><span class="main">=</span><span class="main">[]</span> <span class="main">∧</span>  <span class="bound">ref</span> <span class="main">∩</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span> <span class="main">∪</span>
                  <span class="main">{</span><span class="main">(</span><span class="bound">tr</span><span class="main">,</span><span class="bound">ref</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="bound">tr</span> <span class="main">∈</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> ev <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span>hd <span class="bound">tr</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>tl <span class="bound">tr</span><span class="main">,</span><span class="bound">ref</span><span class="main">)</span> <span class="main">∈</span> F<span class="main">(</span><span class="free">P</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">,</span>
                  <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">≠</span>  <span class="main">[]</span> <span class="main">∧</span>  hd <span class="bound">d</span> <span class="main">∈</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> ev <span class="bound">a</span> <span class="main">=</span> hd <span class="bound">d</span>  <span class="main">∧</span> tl <span class="bound">d</span> <span class="main">∈</span> D<span class="main">(</span><span class="free">P</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
 <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"is_process<span class="main">(</span><span class="var">?f</span><span class="main">,</span> <span class="var">?d</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>  <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>is_process_def FAILURES_def DIVERGENCES_def
                  Product_Type.fst_conv Product_Type.snd_conv<span class="main"><span class="keyword3">,</span></span>
        <span class="operator">intro</span> conjI allI impI<span class="main"><span class="keyword3">,</span></span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>  
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">X</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">assume</span></span> H <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span>       <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> H<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>  front_tickFree_def tickFree_def
                           <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>list_nonMt_append<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> aa ta x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">ta</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> front_tickFree_charn
                           <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span> <span class="main"><span class="main">:</span></span> is_processT2<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tickFree_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">s</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">assume</span></span> H <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> H  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">elim</span><span class="main"><span class="main">:</span></span> is_processT3<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">s</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">assume</span></span> H1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">∧</span> <span class="skolem">X</span> <span class="main">⊆</span> <span class="skolem">Y</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_processT4<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">s</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>   
    <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">c</span><span class="main">∈</span><span class="skolem">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_processT1 is_processT5<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">s</span> <span class="skolem">X</span><span class="main">)</span>   
    <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_processT6<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">assume</span></span> H1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span>  <span class="var">?d</span> <span class="main">∧</span> tickFree <span class="skolem">s</span> <span class="main">∧</span> front_tickFree <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="var">?d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H1  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_processT7_S<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span> <span class="main">∈</span> <span class="var">?d</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> H1  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">s</span> <span class="skolem">X</span><span class="main">)</span>   
    <span class="keyword3"><span class="command">assume</span></span> H <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="var">?d</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_processT8_S<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">s</span><span class="main">)</span>  
    <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> <span class="var">?d</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 9<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="var">?d</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> is_processT9<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> <span class="var">?d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span>  Rep_Abs_Mp<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> Abs_process_inverse<span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> is_process_REP_Mp<span class="main">]</span>
<span class="keyword1"><span class="command">thm</span></span> Rep_Abs_Mp
   
<span class="keyword1"><span class="command">lemma</span></span> Rep_Abs_Mp'' <span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> H1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">tr</span><span class="main">,</span> <span class="bound">ref</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">ref</span> <span class="main">∩</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span> <span class="main">∪</span>
                  <span class="main">{</span><span class="main">(</span><span class="bound">tr</span><span class="main">,</span> <span class="bound">ref</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="bound">tr</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span> 
                             <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> ev <span class="bound">a</span> <span class="main">=</span> hd <span class="bound">tr</span> <span class="main">∧</span> <span class="main">(</span>tl <span class="bound">tr</span><span class="main">,</span> <span class="bound">ref</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">P</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> H2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">≠</span>  <span class="main">[]</span> <span class="main">∧</span>  hd <span class="bound">d</span> <span class="main">∈</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
                     <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> ev <span class="bound">a</span> <span class="main">=</span> hd <span class="bound">d</span>  <span class="main">∧</span> tl <span class="bound">d</span> <span class="main">∈</span> D<span class="main">(</span><span class="free">P</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Rep_process <span class="main">(</span>Abs_process <span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">d</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> Abs_process_inverse<span class="main"><span class="keyword3">,</span></span> 
   <span class="operator">simp_all</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> H1 H2 CollectI Rep_process is_process_REP_Mp<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Projections in Prefix ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> F_Mprefix <span class="main">:</span> 
<span class="quoted"><span class="quoted">"F<span class="main">(</span><span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">tr</span><span class="main">,</span><span class="bound">ref</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr</span><span class="main">=</span><span class="main">[]</span> <span class="main">∧</span>  <span class="bound">ref</span> <span class="main">∩</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span><span class="main">}</span> <span class="main">∪</span>
                     <span class="main">{</span><span class="main">(</span><span class="bound">tr</span><span class="main">,</span><span class="bound">ref</span><span class="main">)</span><span class="main">.</span> <span class="bound">tr</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="bound">tr</span> <span class="main">∈</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
                               <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> ev <span class="bound">a</span> <span class="main">=</span> <span class="main">(</span>hd <span class="bound">tr</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>tl <span class="bound">tr</span><span class="main">,</span><span class="bound">ref</span><span class="main">)</span> <span class="main">∈</span> F<span class="main">(</span><span class="free">P</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Mprefix_def F_def Rep_Abs_Mp'' FAILURES_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> D_Mprefix<span class="main">:</span>
<span class="quoted"><span class="quoted">"D<span class="main">(</span><span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">d</span><span class="main">.</span> <span class="bound">d</span> <span class="main">≠</span>  <span class="main">[]</span> <span class="main">∧</span>  hd <span class="bound">d</span> <span class="main">∈</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
                        <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> ev <span class="bound">a</span> <span class="main">=</span> hd <span class="bound">d</span>  <span class="main">∧</span> tl <span class="bound">d</span> <span class="main">∈</span> D<span class="main">(</span><span class="free">P</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Mprefix_def D_def Rep_Abs_Mp'' DIVERGENCES_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> T_Mprefix<span class="main">:</span>
 <span class="quoted"><span class="quoted">"T<span class="main">(</span><span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">=</span><span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span><span class="main">=</span><span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">∧</span> <span class="bound">s</span><span class="main">≠</span><span class="main">[]</span> <span class="main">∧</span> hd <span class="bound">s</span> <span class="main">=</span> ev <span class="bound">a</span> <span class="main">∧</span> tl <span class="bound">s</span> <span class="main">∈</span> T<span class="main">(</span><span class="free">P</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_F_spec<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> F_Mprefix<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ Basic Properties ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tick_T_Mprefix <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>tick<span class="main">]</span> <span class="main">∉</span> T<span class="main">(</span><span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_Mprefix<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> Nil_Nin_D_Mprefix <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∉</span> D<span class="main">(</span><span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_Mprefix<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Proof of Continuity Rule ›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹ Backpatch Isabelle 2009-1›</span></span>

<span class="comment1">―‹re-introduced from Isabelle/HOLCF 2009-1; clearly
   a derived concept, but still a useful shortcut›</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="entity">contlub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>cpo <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>cpo<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">contlub</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">Y</span><span class="main">.</span> chain <span class="bound">Y</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="bound">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> contlubE<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>contlub <span class="free">f</span><span class="main">;</span> chain <span class="free">Y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contlub_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> monocontlub2cont<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>monofun <span class="free">f</span><span class="main">;</span> contlub <span class="free">f</span><span class="main">⟧</span> <span class="main">⟹</span> cont <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> contI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> thelubE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ch2ch_monofun<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> contlubE <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> contlubI<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">Y</span><span class="main">.</span> chain <span class="bound">Y</span> <span class="main">⟹</span> <span class="free">f</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> contlub <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contlub_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> cont2contlub<span class="main">:</span> <span class="quoted"><span class="quoted">"cont <span class="free">f</span> <span class="main">⟹</span> contlub <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> contlubI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Porder.po_class.lub_eqI <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">erule</span> <span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> contE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹ Core of Proof  ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Mprefix1<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="bound">a</span> <span class="main">⟹</span> D <span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_Mprefix<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> le_approx1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Mprefix2<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">⟹</span>
 <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span> Ra <span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">P</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> Ra <span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">Q</span><span class="main">)</span> <span class="bound">s</span>"</span></span>          
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ra_def D_Mprefix F_Mprefix<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> proc_ord2a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Mprefix3 <span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> H<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="bound">x</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" min_elems <span class="main">(</span>D <span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> T <span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_elems_def D_Mprefix T_Mprefix image_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> H<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">,</span> <span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> le_approx3 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_elems_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="bound">t</span> <span class="main">&lt;</span> tl <span class="skolem">x</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> t<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="skolem">a</span><span class="main">)</span><span class="main">#</span><span class="improper">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> less_cons hd_Cons_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Mprefix0<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="bound">x</span> <span class="main">⟹</span> Mprefix <span class="free">A</span> <span class="free">P</span> <span class="main">⊑</span> Mprefix <span class="free">A</span> <span class="free">Q</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_approx_def mono_Mprefix1 mono_Mprefix3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> mono_Mprefix2<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_approx_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> mono_Mprefix<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"monofun<span class="main">(</span>Mprefix <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Fun_Cpo.below_fun_def monofun_def mono_Mprefix0<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> proc_ord2_set<span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_approx2<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> proc_ord_proc_eq_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> D <span class="free">P</span> <span class="main">⊆</span> D <span class="free">Q</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> below_antisym below_refl le_approx_def subset_antisym<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> mprefix_chainpreserving<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> chain <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> Mprefix <span class="free">A</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> chainI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> chainE<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_Mprefix0 fun_belowD<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> limproc_is_thelub_fun<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span>     <span class="quoted"><span class="quoted">"chain <span class="free">S</span>"</span></span> 
<span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"<span class="main">(</span>Lub <span class="free">S</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> lim_proc <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">S</span> <span class="bound">x</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span>    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xa</span><span class="main">.</span> chain <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">S</span> <span class="bound">x</span> <span class="bound">xa</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹chain <span class="free">S</span>›</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> chainI  <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> chain_def fun_belowD <span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span>     <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> contlub_lambda limproc_is_thelub<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> contlub_Mprefix <span class="main">:</span> <span class="quoted"><span class="quoted">"contlub<span class="main">(</span><span class="main">%</span><span class="bound">P</span><span class="main">.</span> Mprefix <span class="free">A</span> <span class="bound">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> contlubI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> proc_ord_proc_eq_spec<span class="main">)</span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span> 
   <span class="keyword3"><span class="command">assume</span></span> C <span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="skolem">Y</span>"</span></span> 
   <span class="keyword1"><span class="command">have</span></span>   C'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">xa</span><span class="main">.</span> chain <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">x</span> <span class="bound">xa</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> C<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> chainI<span class="main">)</span>
                 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> chain_def fun_belowD<span class="main">)</span>
   <span class="keyword3"><span class="command">show</span></span>       <span class="quoted"><span class="quoted">"Mprefix <span class="free">A</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> Mprefix <span class="free">A</span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process.le_approx_def F_Mprefix D_Mprefix T_Mprefix C C'
                               mprefix_chainpreserving limproc_is_thelub limproc_is_thelub_fun
                               D_T D_LUB D_LUB_2 F_LUB T_LUB_2 Ra_def min_elems_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span> 
   <span class="keyword3"><span class="command">assume</span></span> C <span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="skolem">Y</span>"</span></span> 
   <span class="keyword3"><span class="command">show</span></span>       <span class="quoted"><span class="quoted">"D <span class="main">(</span>Mprefix <span class="free">A</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> Mprefix <span class="free">A</span> <span class="main">(</span><span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process.le_approx_def F_Mprefix D_Mprefix T_Mprefix 
                                  C mprefix_chainpreserving limproc_is_thelub D_LUB_2<span class="main">)</span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> C fun_below_iff in_mono is_ub_thelub le_approx1<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">lemma</span></span> Mprefix_cont <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> cont <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">□</span> <span class="bound">z</span> <span class="main">∈</span>  <span class="free">A</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Cont.cont_compose<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> monocontlub2cont<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mono_Mprefix contlub_Mprefix Fun_Cpo.cont2cont_lambda<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ High-level Syntax for Read and Write ›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ The following syntax introduces the usual channel notation for CSP.
Slightly deviating from conventional wisdom, we view a channel not as a tag in
a pair, rather than as a function of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span><span class="main"><span class="main">⇒</span></span><span class="tfree"><span class="tfree">'b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This paves the way
for \emph{typed} channels over a common universe of events. ›</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">read</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">,</span><span class="tfree">'a</span> set<span class="main">,</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> process<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'b</span> process"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>      <span class="quoted"><span class="quoted">"<span class="free">read</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">≡</span> Mprefix<span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">o</span> <span class="main">(</span>inv <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity">write</span>"</span>    <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span> process<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'b</span> process"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>      <span class="quoted"><span class="quoted">"<span class="free">write</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> Mprefix <span class="main">{</span><span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">write0</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span> process<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>      <span class="quoted"><span class="quoted">"<span class="free">write0</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> Mprefix <span class="main">{</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_read"</span>   <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>id<span class="main">,</span> pttrn<span class="main">,</span> <span class="tfree">'a</span> process<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> process"</span></span>
                                        <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span>_<span class="keyword1">`?`</span>_ <span class="keyword3">/</span><span class="keyword1">→</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>28<span class="main">]</span> 28<span class="main">)</span>
  <span class="quoted">"_readX"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>id<span class="main">,</span> pttrn<span class="main">,</span> bool<span class="main">,</span><span class="tfree">'a</span> process<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> process"</span></span>
                                        <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span>_<span class="keyword1">`?`</span>_<span class="keyword1">`|`</span>_ <span class="keyword3">/</span><span class="keyword1">→</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>28<span class="main">]</span> 28<span class="main">)</span>
  <span class="quoted">"_readS"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>id<span class="main">,</span> pttrn<span class="main">,</span> <span class="tfree">'b</span> set<span class="main">,</span><span class="tfree">'a</span> process<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> process"</span></span>
                                        <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span>_<span class="keyword1">`?`</span>_<span class="keyword1">`:`</span>_ <span class="keyword3">/</span><span class="keyword1">→</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>28<span class="main">]</span> 28<span class="main">)</span>
  <span class="quoted">"_write"</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>id<span class="main">,</span> <span class="tfree">'b</span><span class="main">,</span> <span class="tfree">'a</span> process<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> process"</span></span>
                                        <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span>_<span class="keyword1">`!`</span>_ <span class="keyword3">/</span><span class="keyword1">→</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>0<span class="main">,</span>28<span class="main">]</span> 28<span class="main">)</span>
  <span class="quoted">"_writeS"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'a</span> process<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> process"</span></span>
                                        <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span>_ <span class="keyword3">/</span><span class="keyword1">→</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span>28<span class="main">]</span> 28<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹CSP$_M$-Style Syntax for Communication Primitives›</span></span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_read <span class="free">c</span> <span class="free">p</span> <span class="free">P</span>"</span>     <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> read <span class="free">c</span> <span class="keyword1">CONST</span> UNIV <span class="main">(</span><span class="main">λ</span><span class="free">p</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>
  <span class="quoted">"_write <span class="free">c</span> <span class="free">p</span> <span class="free">P</span>"</span>    <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> write <span class="free">c</span> <span class="free">p</span> <span class="free">P</span>"</span>
  <span class="quoted">"_readX <span class="free">c</span> <span class="free">p</span> <span class="free">b</span> <span class="free">P</span>"</span>  <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> read <span class="free">c</span> <span class="main">{</span><span class="free">p</span><span class="main">.</span> <span class="free">b</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="free">p</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>
  <span class="quoted">"_writeS <span class="free">a</span> <span class="free">P</span>"</span>     <span class="main">==</span> <span class="quoted">"<span class="keyword1">CONST</span> write0 <span class="free">a</span> <span class="free">P</span>"</span>
  <span class="quoted">"_readS <span class="free">c</span> <span class="free">p</span> <span class="free">A</span> <span class="free">P</span>"</span>  <span class="main">=&gt;</span> <span class="quoted">"<span class="keyword1">CONST</span> read <span class="free">c</span> <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="free">p</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">lemma</span></span> read_cont<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> cont <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> c<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>read_def o_def inv_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> write_cont<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> cont <span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>cpo <span class="main">⇒</span> <span class="tfree">'a</span> process<span class="main">)</span><span class="main">)</span><span class="main">)</span>  <span class="main">⟹</span> cont<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>c <span class="main">`!`</span> <span class="free">a</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>write_def<span class="main">)</span>


<span class="keyword1"><span class="command">corollary</span></span> write0_cont_lub <span class="main">:</span> <span class="quoted"><span class="quoted">"contlub<span class="main">(</span>Mprefix <span class="main">{</span><span class="free">a</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> contlub_Mprefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">lemma</span></span> write0_contlub <span class="main">:</span> <span class="quoted"><span class="quoted">"contlub<span class="main">(</span>write0 <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> write0_def contlub_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>   <span class="quoted"><span class="quoted">"chain <span class="skolem">Y</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> * <span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">::</span><span class="tfree">'b</span> <span class="main">⇒</span> <span class="tfree">'a</span> process<span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted"><span class="quoted">‹chain <span class="skolem">Y</span>›</span></span> fun_below_iff po_class.chain_def<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Lub <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> Lub <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span><span class="operator">metis</span> * ch2ch_fun limproc_is_thelub limproc_is_thelub_fun lub_eq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Mprefix <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Lub <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> Mprefix <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> **<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> contlubE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> contlub_Mprefix<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> write0_cont<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>cpo <span class="main">⇒</span> <span class="tfree">'a</span> process<span class="main">)</span><span class="main">)</span>  <span class="main">⟹</span> cont<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>write0_def<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Det">
<div class="head">
<h1>Theory Det</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ********************************************************************
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ Deterministic Choice Operator Definition ›</span></span>

<span class="keyword1"><span class="command">theory</span></span>  Det 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Process.html">Process</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definition›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
        <span class="entity">det</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span> process<span class="main">,</span><span class="tfree">'α</span> process<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> process"</span></span>   <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">[+]</span>"</span> 18<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">[+]</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> Abs_process<span class="main">(</span>  <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∩</span> F <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span>
                               <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∪</span> F <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span>
                               <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∪</span> D <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span>
                               <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">X</span> <span class="main">∧</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∪</span> T <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span><span class="main">,</span>
                               D <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∪</span> D <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span><span class="main">(</span>xsymbols<span class="main">)</span>
  det <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">□</span>"</span> 18<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> is_process_REP_D<span class="main">:</span>
<span class="quoted"><span class="quoted">"is_process <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∩</span> F <span class="free">Q</span><span class="main">}</span> <span class="main">∪</span>
             <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">}</span> <span class="main">∪</span>
             <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span><span class="main">}</span> <span class="main">∪</span>
             <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">X</span> <span class="main">∧</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∪</span> T <span class="free">Q</span><span class="main">}</span><span class="main">,</span>
             D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"is_process<span class="main">(</span><span class="var">?T</span><span class="main">,</span><span class="var">?D</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv snd_conv Rep_process is_process_def 
                  DIVERGENCES_def FAILURES_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?T</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?T</span> <span class="main">⟶</span> front_tickFree <span class="bound">s</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_processT2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>   <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?T</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?T</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_processT1 <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_processT3<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?T</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">Y</span>  <span class="main">⟶</span>  <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?T</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_processT4<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span><span class="operator">OF</span> conj_commute<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">,</span></span><span class="operator">OF</span> conjI<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">sa</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">sa</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?T</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">sa</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?T</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">sa</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?T</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_processT5 T_F<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?T</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?T</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> s X<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">s</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT6<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> T_F_spec<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_processT6<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> T_F_spec<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="var">?D</span> <span class="main">∧</span> tickFree <span class="bound">s</span> <span class="main">∧</span> front_tickFree <span class="bound">t</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∈</span> <span class="var">?D</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_processT7<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="var">?D</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?T</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_processT8<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> <span class="var">?D</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="var">?D</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>is_processT9<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Rep_Abs_D<span class="main">:</span>
<span class="quoted"><span class="quoted">"Rep_process
     <span class="main">(</span>Abs_process
       <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∩</span> F <span class="free">Q</span><span class="main">}</span> <span class="main">∪</span>
        <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">}</span> <span class="main">∪</span>
        <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span><span class="main">}</span> <span class="main">∪</span>
        <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">X</span> <span class="main">∧</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∪</span> T <span class="free">Q</span><span class="main">}</span><span class="main">,</span>
        D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
    <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∩</span> F <span class="free">Q</span><span class="main">}</span> <span class="main">∪</span>
     <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">}</span> <span class="main">∪</span>
     <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span><span class="main">}</span> <span class="main">∪</span>
     <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">X</span> <span class="main">∧</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∪</span> T <span class="free">Q</span><span class="main">}</span><span class="main">,</span>
     D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>CollectI Rep_process Abs_process_inverse is_process_REP_D<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The Projections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> F_det    <span class="main">:</span>
   <span class="quoted"><span class="quoted">"F<span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span>    <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∩</span> F <span class="free">Q</span><span class="main">}</span>
                 <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">}</span>
                 <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span><span class="main">}</span>
                 <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">X</span> <span class="main">∧</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∪</span> T <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> F_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> det_def Rep_Abs_D FAILURES_def fst_conv<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basic Laws›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following theorem of Commutativity helps to simplify the subsequent
continuity proof by symmetry breaking. It is therefore already developed here:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> D_det<span class="main">:</span> <span class="quoted"><span class="quoted">"D<span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> D_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> det_def Rep_Abs_D DIVERGENCES_def snd_conv<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> T_det<span class="main">:</span> <span class="quoted"><span class="quoted">"T<span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> T <span class="free">P</span> <span class="main">∪</span> T <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> det_def Rep_Abs_D TRACES_def FAILURES_def
                              fst_def snd_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_F F_T is_processT1 Nil_elem_T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_F F_T is_processT1 Nil_elem_T<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Det_commute<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">□</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process_eq_spec F_det D_det<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The Continuity-Rule›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_D1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> D <span class="main">(</span><span class="free">Q</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> le_approx1<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process_eq_spec F_det D_det<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_D2<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> ordered<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟶</span> Ra <span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> Ra <span class="main">(</span><span class="free">Q</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">[]</span> <span class="main">∉</span> D <span class="free">P</span> <span class="main">⟹</span> <span class="main">[]</span> <span class="main">∉</span> D <span class="free">S</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> 
           <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> ordered<span class="main"><span class="keyword3">,</span></span><span class="operator">frule_tac</span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> proc_ord2a<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="free">P</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="free">S</span> <span class="main">⟹</span>
          <span class="main">(</span><span class="bound">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span><span class="main">)</span> <span class="main">∧</span>
          <span class="main">(</span><span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∨</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">S</span><span class="main">)</span> <span class="main">⟶</span>
           <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span> <span class="main">∨</span> <span class="main">[]</span> <span class="main">∈</span> D <span class="free">Q</span> <span class="main">∨</span>  <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∨</span>  <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proc_ord2a<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ordered<span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE disjE<span class="main"><span class="keyword3">,</span></span><span class="operator">subst</span> le_approx2T<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ordered<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> is_processT9_S_swap<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="free">P</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="free">S</span> <span class="main">⟹</span>
                <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span> <span class="main">∨</span>
                    <span class="bound">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span><span class="main">)</span> <span class="main">∨</span>
                    <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">Q</span> <span class="main">∨</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">X</span> <span class="main">∧</span> 
                    <span class="main">(</span><span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∨</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">S</span><span class="main">)</span><span class="main">}</span>
              <span class="main">⊆</span> <span class="main">{</span><span class="bound">X</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span> <span class="main">∨</span>
                     <span class="bound">s</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span><span class="main">)</span> <span class="main">∨</span>
                     <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">X</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∨</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">S</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">frule</span> is_processT9_S_swap<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> proc_ord2a<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ordered<span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> is_processT8_S<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> le_approx1<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ordered<span class="main"><span class="main">]</span></span> le_approx_lemma_T<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ordered<span class="main"><span class="main">]</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span>   <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> proc_ord2a<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ordered<span class="main"><span class="main">,</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>    
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec F_det D_det Ra_def min_elems_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI equalityI C<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> A B<span class="main">)</span>    
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> mono_D3 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> min_elems <span class="main">(</span>D <span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> T <span class="main">(</span><span class="free">Q</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">frule</span> le_approx3<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec F_det T_det D_det Ra_def min_elems_def subset_iff<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>D_T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Det<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">Q</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_approx_def mono_D1 mono_D2 mono_D3<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> mono_Det_sym<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span> <span class="main">□</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">S</span> <span class="main">□</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Det_commute<span class="main">)</span>



<span class="keyword1"><span class="command">lemma</span></span> cont_D0 <span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> C <span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"<span class="main">(</span>lim_proc <span class="main">(</span>range <span class="free">Y</span><span class="main">)</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> lim_proc <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> C'<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>chainI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>chainE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Process_eq_spec<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_det F_det<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_LUB<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">]</span></span>  D_LUB<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">]</span></span> T_LUB<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C<span class="main"><span class="main">]</span></span> F_LUB<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C'<span class="main"><span class="main">]</span></span>  D_LUB<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C'<span class="main"><span class="main">]</span></span> T_LUB<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C'<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_det F_det T_det<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> NF_ND <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> is_processT6_S2 is_processT8 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_T append_Nil front_tickFree_single process_charn tickFree_Nil<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> NF_ND is_processT6_S2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> NF_ND is_processT6_S2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cont_D <span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">i</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> C<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> limproc_is_thelub<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> limproc_is_thelub<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> chainI<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> chainE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> cont_D0<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> cont_D' <span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> chain<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="free">Y</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">i</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> chain'<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>chainI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> chainE<span class="main"><span class="main">[</span></span><span class="operator">OF</span> chain<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"F <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="free">Y</span><span class="main">)</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊆</span>  F <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_det F_det F_LUB T_LUB D_LUB chain chain'<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.split prod.split_asm<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span><span class="quoted"><span class="quoted">"F <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> F<span class="main">(</span>lim_proc <span class="main">(</span>range <span class="free">Y</span><span class="main">)</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> C1 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ba</span> <span class="bound">ab</span> <span class="bound">ac</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span> <span class="main">∨</span> <span class="main">[]</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span>
                   <span class="main">[]</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">ab</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">[]</span> <span class="main">∉</span> D <span class="free">S</span> <span class="main">⟹</span>  tick <span class="main">∈</span> <span class="bound">ba</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">ac</span><span class="main">)</span> "</span></span>
                <span class="keyword1"><span class="command">using</span></span> is_processT8 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> C2 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ba</span> <span class="bound">ab</span> <span class="bound">ac</span> <span class="bound">ad</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span> <span class="main">∨</span> <span class="main">[]</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">a</span><span class="main">)</span> 
                               <span class="main">∨</span> tick <span class="main">∉</span> <span class="bound">ba</span> <span class="main">∧</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span>
                   <span class="main">[]</span><span class="main">∉</span>D<span class="main">(</span><span class="free">Y</span> <span class="bound">ab</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">[]</span><span class="main">∉</span>D <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="bound">ba</span><span class="main">)</span><span class="main">∉</span> F<span class="main">(</span><span class="free">Y</span> <span class="bound">ac</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">∉</span>T <span class="free">S</span> <span class="main">⟹</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">∈</span>T<span class="main">(</span><span class="free">Y</span> <span class="bound">ad</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> NF_ND is_processT6_S2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> C3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ba</span> <span class="bound">ab</span> <span class="bound">ac</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">[]</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∨</span> tick <span class="main">∉</span> <span class="bound">ba</span> <span class="main">∧</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">a</span><span class="main">)</span> <span class="main">⟹</span>
                   <span class="main">[]</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">ab</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">[]</span> <span class="main">∉</span> D <span class="free">S</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">ba</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">S</span> <span class="main">⟹</span> 
                   <span class="main">[</span>tick<span class="main">]</span> <span class="main">∉</span> T <span class="free">S</span> <span class="main">⟹</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">ac</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_T append_Nil front_tickFree_single process_charn tickFree_Nil<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_det F_det F_LUB T_LUB D_LUB chain chain'<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.split prod.split_asm<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C3 is_processT6_S2 is_processT8_S<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span><span class="quoted"><span class="quoted">"D <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="free">Y</span><span class="main">)</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> D <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_det F_det F_LUB T_LUB D_LUB chain chain'<span class="main">)</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain chain' limproc_is_thelub Process_eq_spec equalityI B C D<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> det_cont<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"cont <span class="free">f</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>     g<span class="main">:</span><span class="quoted"><span class="quoted">"cont <span class="free">g</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">□</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> A <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> cont <span class="free">f</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">□</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> contI2<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> monofunI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Det_commute<span class="main"><span class="keyword3">,</span></span><span class="operator">subst</span> cont_D<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Det_commute<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   <span class="keyword1"><span class="command">have</span></span> B <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> cont <span class="free">f</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">y</span> <span class="main">□</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="improper">y</span> <span class="main">□</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> cont_compose<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> contI2<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> monofunI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Det_commute<span class="main"><span class="keyword3">,</span></span><span class="operator">subst</span> cont_D<span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Det_commute<span class="main">)</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f g 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">g</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">□</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> cont_apply<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>contI2 monofunI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Det_commute A B<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Ndet">
<div class="head">
<h1>Theory Ndet</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ********************************************************************
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ Nondeterministic Choice Operator Definition ›</span></span>

<span class="keyword1"><span class="command">theory</span></span>  Ndet 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Process.html">Process</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Definition and Consequences ›</span></span>
<span class="keyword1"><span class="command">definition</span></span>
        <span class="entity">ndet</span>     <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span> process<span class="main">,</span><span class="tfree">'α</span> process<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> process"</span></span>   <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">|-|</span>"</span> 16<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">|-|</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> Abs_process<span class="main">(</span>F <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∪</span> F <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">,</span> D <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∪</span> D <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">notation</span></span><span class="main">(</span>xsymbols<span class="main">)</span>
  ndet <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1">⊓</span>"</span> 16<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> is_process_REP_ND<span class="main">:</span>
<span class="quoted"><span class="quoted">"is_process <span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span> <span class="main">,</span> D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv snd_conv Rep_process is_process_def DIVERGENCES_def FAILURES_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">intro</span> conjI<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">)</span> <span class="main">⟶</span> front_tickFree <span class="bound">s</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_processT2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span>   <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span><span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_processT1 <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> is_processT3<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> is_processT4<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">,</span></span><span class="operator">OF</span> conj_commute<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> conjI<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">sa</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">sa</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">sa</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⟶</span> <span class="main">(</span><span class="bound">sa</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_processT5 T_F<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> s X<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">s</span><span class="main">=</span><span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT6<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> T_F_spec<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT6<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> T_F_spec<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT6<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span> T_F_spec<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span> <span class="main">∧</span> tickFree <span class="bound">s</span> <span class="main">∧</span> front_tickFree <span class="bound">t</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_processT7<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_processT8<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>is_processT9<span class="main"><span class="main">[</span></span><span class="operator">rule_format</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> Rep_Abs_ND<span class="main">:</span>
<span class="quoted"><span class="quoted">"Rep_process<span class="main">(</span>Abs_process<span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span> <span class="main">,</span> D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span> <span class="main">,</span> D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>CollectI Rep_process Abs_process_inverse is_process_REP_ND<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Some Laws›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The commutativity of the operator helps to simplify the subsequent
      continuity proof and is therefore developed here: ›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> F_ndet <span class="main">:</span> <span class="quoted"><span class="quoted">"F<span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> F <span class="free">P</span> <span class="main">∪</span> F <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> F_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ndet_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FAILURES_def Rep_Abs_ND<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> D_ndet <span class="main">:</span> <span class="quoted"><span class="quoted">"D<span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> D <span class="free">P</span> <span class="main">∪</span> D <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> D_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ndet_def Rep_Abs_ND DIVERGENCES_def snd_conv<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> T_ndet <span class="main">:</span> <span class="quoted"><span class="quoted">"T<span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> T <span class="free">P</span> <span class="main">∪</span> T <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ndet_def Rep_Abs_ND TRACES_def FAILURES_def
                             fst_def snd_conv<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_F F_T is_processT1 Nil_elem_T<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{}</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_F F_T is_processT1 Nil_elem_T<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> Ndet_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⊓</span> <span class="free">P</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process_eq_spec F_ndet D_ndet<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The Continuity Rule›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>  mono_Ndet1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> D <span class="main">(</span><span class="free">Q</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> le_approx1<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process_eq_spec F_ndet D_ndet<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Ndet2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟶</span> Ra <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> Ra <span class="main">(</span><span class="free">Q</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> le_approx_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process_eq_spec F_ndet D_ndet Ra_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Ndet3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> min_elems <span class="main">(</span>D <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> T <span class="main">(</span><span class="free">Q</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>le_approx3 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> min_elems_def subset_iff F_ndet D_ndet T_ndet<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> less_list_def Nil_elem_T D_T<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Ndet<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>le_approx_def mono_Ndet1 mono_Ndet2 mono_Ndet3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Ndet_sym<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span> <span class="main">⊓</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">S</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ndet_commute<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> cont_Ndet1<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> chain<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="free">Y</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">i</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> A <span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> chain<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> chainI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> chainE<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> chain
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> limproc_is_thelub Process_eq_spec D_ndet F_ndet F_LUB D_LUB A<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> ndet_cont<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"cont <span class="free">f</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>     g<span class="main">:</span> <span class="quoted"><span class="quoted">"cont <span class="free">g</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>      <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> cont <span class="free">f</span> <span class="main">⟹</span> cont <span class="free">g</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="main">λ</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">⊓</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> contI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> monofunI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Ndet_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> cont_Ndet1<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span>   <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Ndet_commute<span class="main">)</span>
   <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> cont <span class="free">f</span> <span class="main">⟹</span> cont <span class="free">g</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">g</span> <span class="main">⊓</span> <span class="improper">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> cont_compose<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> contI2<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> monofunI<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span>   <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont_Ndet1<span class="main">)</span>
   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f g
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">g</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">⊓</span> <span class="bound">g</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> cont_apply<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A B<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Seq">
<div class="head">
<h1>Theory Seq</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ******************************************************************** 
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹The Sequence Operator›</span></span>

<span class="keyword1"><span class="command">theory</span></span>  Seq
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Process.html">Process</a> 
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definition›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">div_seq</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>   <span class="main">≡</span> <span class="main">{</span><span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">|</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> D <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> tickFree <span class="bound">t1</span> <span class="main">∧</span> front_tickFree <span class="bound">t2</span><span class="main">}</span>
                            <span class="main">∪</span> <span class="main">{</span><span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">|</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="bound">t2</span> <span class="main">∈</span> D <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>  <span class="entity">seq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> process<span class="main">,</span><span class="tfree">'a</span> process<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span>  <span class="quoted">"<span class="keyword1">`;`</span>"</span> 24<span class="main">)</span>  
<span class="keyword2"><span class="keyword">where</span></span>       <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">`;`</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> Abs_process
                            <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> tickFree <span class="bound">t</span><span class="main">}</span> <span class="main">∪</span>
                             <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span> <span class="main">∪</span>
                             <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> div_seq <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span><span class="main">,</span>
                             div_seq <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span>  seq_maintains_is_process<span class="main">:</span>
      <span class="quoted"><span class="quoted">"is_process     <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> tickFree <span class="bound">t</span><span class="main">}</span> <span class="main">∪</span>
                       <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span><span class="main">}</span> <span class="main">∪</span>
                       <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> div_seq <span class="free">P</span> <span class="free">Q</span><span class="main">}</span><span class="main">,</span>
                       div_seq <span class="free">P</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
       <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"is_process<span class="main">(</span><span class="var">?f</span><span class="main">,</span> <span class="var">?d</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv snd_conv F_def is_process_def FAILURES_def DIVERGENCES_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">fold</span> FAILURES_def DIVERGENCES_def<span class="main"><span class="keyword3">,</span></span><span class="operator">fold</span> F_def<span class="main"><span class="keyword3">,</span></span><span class="operator">intro</span> conjI<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT1<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> F_T is_processT5_S6 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>        
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">⟶</span> front_tickFree <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>is_processT2 append_T_imp_tickFree front_tickFree_append D_imp_front_tickFree<span class="main">)</span>   
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>       
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> F_T append_Nil2 is_processT is_processT3_SR is_processT5_S3<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>append_eq_append_conv2<span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> T_F_spec append_Nil2 is_processT is_processT5_S4<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append_self_conv front_tickFree_append front_tickFree_mono is_processT2_TR 
              no_Trace_implies_no_Failure non_tickFree_implies_nonMt non_tickFree_tick<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> F_T append_Nil2 is_processT5_S3 process_charn<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_append front_tickFree_mono self_append_conv<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>append_eq_append_conv2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> T_F_spec append_Nil2 is_processT is_processT5_S4<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree append_T_imp_tickFree front_tickFree_append 
               front_tickFree_mono not_Cons_self2 self_append_conv<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> insert_mono is_processT4_S1 prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> is_processT4<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_T_imp_tickFree<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> process_charn<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">sa</span> <span class="skolem">X</span> <span class="skolem">Y</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">sa</span><span class="main">,</span> <span class="skolem">X</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟹</span>
            tickFree <span class="skolem">sa</span> <span class="main">⟹</span>
            <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">≠</span> tick <span class="main">⟶</span> <span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span> <span class="main">⟹</span> 
            <span class="main">(</span><span class="skolem">sa</span><span class="main">,</span> <span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> tickFree <span class="skolem">sa</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> t<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Y</span><span class="main">-</span><span class="main">{</span>tick<span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> subst<span class="main"><span class="keyword3">,</span></span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span>   <span class="main">(</span><span class="operator">metis</span> DiffE Un_insert_left is_processT5 singletonI<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> is_processT5_SEQH3 <span class="main">=</span> this
  <span class="keyword1"><span class="command">have</span></span> is_processT5_SEQH4 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">sa</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">sa</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">⟹</span>
                                         tickFree <span class="bound">sa</span> <span class="main">⟹</span>
                                         <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">sa</span><span class="main">@</span><span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span><span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span> <span class="main">∨</span> <span class="main">¬</span> tickFree<span class="main">(</span><span class="bound">sa</span><span class="main">@</span><span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">)</span> <span class="main">⟹</span>
                                         <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">sa</span><span class="main">@</span><span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">≠</span><span class="bound">t1</span><span class="main">@</span><span class="bound">t2</span> <span class="main">∨</span> <span class="bound">t1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">∉</span>T <span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span><span class="main">∉</span>F <span class="free">Q</span><span class="main">)</span> <span class="main">⟹</span>
                                         <span class="main">(</span><span class="bound">sa</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> tickFree <span class="bound">sa</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 is_processT1 is_processT5_S3 is_processT5_SEQH3 
                         no_Trace_implies_no_Failure tickFree_Cons tickFree_append<span class="main">)</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> tickFree <span class="bound">t</span><span class="main">}</span> <span class="main">∪</span> 
             <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> is_processT5_SEQ2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">sa</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">sa</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f1</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">sa</span><span class="main">@</span><span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∉</span><span class="var">?f</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">sa</span><span class="main">,</span> <span class="bound">X</span><span class="main">∪</span><span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f1</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> is_processT5_SEQH4<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_processT5<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?f</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE UnE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rev_subsetD<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> is_processT5_SEQ2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">using</span></span> is_processT5_S1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_T_imp_tickFree<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> is_processT5<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> conjI<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> append_T_imp_tickFree butlast_append 
                     butlast_snoc is_processT2 is_processT6 nonTickFree_n_frontTickFree 
                     non_tickFree_tick tickFree_append<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append_T_imp_tickFree front_tickFree_append front_tickFree_mono 
                    is_processT2 non_tickFree_implies_nonMt non_tickFree_tick<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> process_charn<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_append front_tickFree_implies_tickFree<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_T T_nonTickFree_imp_decomp append_T_imp_tickFree append_assoc 
                 append_same_eq non_tickFree_implies_nonMt non_tickFree_tick process_charn 
                 tickFree_append<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span>    <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree append_T_imp_tickFree front_tickFree_append 
                    front_tickFree_mono non_tickFree_implies_nonMt non_tickFree_tick<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="var">?d</span> <span class="main">∧</span> tickFree <span class="bound">s</span> <span class="main">∧</span> front_tickFree <span class="bound">t</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∈</span> <span class="var">?d</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command">using</span></span> front_tickFree_append <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>     
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> process_charn<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="var">?d</span> <span class="main">⟶</span>  <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> <span class="var">?d</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="var">?d</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>      
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 front_tickFree_implies_tickFree process_charn<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append1_eq_conv append_assoc front_tickFree_implies_tickFree is_processT2_TR 
                nonTickFree_n_frontTickFree non_tickFree_tick process_charn tickFree_append<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The Projections›</span></span>


<span class="keyword1"><span class="command">lemmas</span></span>  Rep_Abs_Seq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> Abs_process_inverse<span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> seq_maintains_is_process<span class="main">]</span>

<span class="keyword1"><span class="command">lemma</span></span>  
    F_seq   <span class="main">:</span> <span class="quoted"><span class="quoted">"F<span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span>  <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> tickFree <span class="bound">t</span><span class="main">}</span> <span class="main">∪</span>
                             <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span><span class="main">}</span> <span class="main">∪</span>
                             <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∧</span> tickFree <span class="bound">t1</span> <span class="main">∧</span> front_tickFree <span class="bound">t2</span><span class="main">}</span> <span class="main">∪</span>
                             <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="bound">t2</span> <span class="main">∈</span> D <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> seq_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> F_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>Rep_Abs_Seq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FAILURES_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
    D_seq   <span class="main">:</span> <span class="quoted"><span class="quoted">"D<span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span>  <span class="main">{</span><span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">|</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∧</span> tickFree <span class="bound">t1</span> <span class="main">∧</span> front_tickFree <span class="bound">t2</span><span class="main">}</span> <span class="main">∪</span>
                             <span class="main">{</span><span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">|</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="bound">t2</span> <span class="main">∈</span> D <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> seq_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> D_def<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>Rep_Abs_Seq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DIVERGENCES_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
    T_seq   <span class="main">:</span> <span class="quoted"><span class="quoted">"T<span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span>  <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> tickFree <span class="bound">t</span><span class="main">}</span> <span class="main">∪</span>  
                             <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="bound">t2</span> <span class="main">∈</span> T <span class="free">Q</span><span class="main">}</span> <span class="main">∪</span>
                             <span class="main">{</span><span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">|</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∧</span> tickFree <span class="bound">t1</span> <span class="main">∧</span> front_tickFree <span class="bound">t2</span><span class="main">}</span> <span class="main">∪</span>
                             <span class="main">{</span><span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">|</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="bound">t2</span> <span class="main">∈</span> D <span class="free">Q</span><span class="main">}</span> <span class="main">∪</span>
                             <span class="main">{</span><span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">|</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∧</span> tickFree <span class="bound">t1</span> <span class="main">∧</span> front_tickFree <span class="bound">t2</span><span class="main">}</span> <span class="main">∪</span>
                             <span class="main">{</span><span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">|</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="bound">t2</span> <span class="main">∈</span> D <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> seq_def  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Rep_Abs_Seq<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>TRACES_def FAILURES_def<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> F_T <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_T_imp_tickFree<span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> F_T <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">using</span></span> T_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Continuity Rule ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_D11<span class="main">:</span>  
<span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> D <span class="main">(</span><span class="free">Q</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_seq<span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> le_approx1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> le_approx_lemma_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_D12<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> ordered<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟶</span> Ra <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> Ra <span class="main">(</span><span class="free">Q</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> mono_SEQI2a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟶</span> Ra <span class="main">(</span><span class="free">Q</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⊆</span> Ra <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ra_def D_seq F_seq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> le_approx_lemma_F<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span> le_approx_lemma_T<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> le_approx1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> mono_SEQI2b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟶</span> Ra <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⊆</span> Ra <span class="main">(</span><span class="free">Q</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ra_def D_seq F_seq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> le_approx_lemma_F<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span> le_approx_lemma_T<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span> 
          le_approx1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span> le_approx2T<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> le_approx2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_implies_tickFree is_processT2_TR process_charn<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_T_imp_tickFree<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_implies_tickFree is_processT2_TR process_charn<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> ordered mono_SEQI2a mono_SEQI2b <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> minSeqInclu<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"min_elems<span class="main">(</span>D <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">t1</span><span class="main">@</span><span class="bound">t2</span><span class="main">|</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">∈</span>T <span class="free">P</span><span class="main">∧</span><span class="bound">t1</span><span class="main">∉</span>D <span class="free">P</span><span class="main">∧</span><span class="bound">t2</span><span class="main">∈</span>min_elems<span class="main">(</span>D <span class="free">S</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_seq min_elems_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> process_charn<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 front_tickFree_Nil front_tickFree_append front_tickFree_mono 
           le_list_def less_list_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> D_imp_front_tickFree Nil_is_append_conv append_T_imp_tickFree 
          append_butlast_last_id butlast_append process_charn less_self lim_proc_is_lub3a 
          list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nil_less<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree append_Nil2 front_tickFree_Nil front_tickFree_mono process_charn 
      list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nonTickFree_n_frontTickFree<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_D13 <span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> ordered<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>        <span class="quoted"><span class="quoted">"min_elems <span class="main">(</span>D <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> T <span class="main">(</span><span class="free">Q</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> ordered<span class="main"><span class="keyword3">,</span></span> <span class="operator">frule</span> le_approx3<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> subset_trans <span class="main"><span class="main">[</span></span><span class="operator">OF</span> minSeqInclu<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F_seq T_seq min_elems_def append_T_imp_tickFree<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> is_processT5_S3<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> T_F elem_min_elems le_approx3 less_list_def min_elems5 subset_eq<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> Nil_elem_T no_Trace_implies_no_Failure <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> less_self nonTickFree_n_frontTickFree process_charn<span class="main">)</span>  
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> le_approx2T process_charn<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> less_self nonTickFree_n_frontTickFree process_charn<span class="main">)</span>  

<span class="keyword1"><span class="command">lemma</span></span> mono_Seq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">Q</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_approx_def mono_D11 mono_D12 mono_D13<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_D21<span class="main">:</span>  
<span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> D <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> le_approx1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_D22<span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> ordered<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span> Ra <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">P</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> Ra <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> mono_SEQI2a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span> Ra <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⊆</span> Ra <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">P</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ra_def D_seq F_seq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> le_approx_lemma_F<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span> le_approx_lemma_T<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> le_approx1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> mono_SEQI2b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟶</span> Ra <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">P</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⊆</span> Ra <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ra_def D_seq F_seq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> le_approx_lemma_F<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span> le_approx_lemma_T<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span> 
            le_approx1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span> le_approx2T<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> le_approx2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> ordered mono_SEQI2a mono_SEQI2b <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_D23 <span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> ordered<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>       <span class="quoted"><span class="quoted">"min_elems <span class="main">(</span>D <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> T <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> ordered<span class="main"><span class="keyword3">,</span></span> <span class="operator">frule</span> le_approx3<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>D_seq T_seq min_elems_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> D_imp_front_tickFree Nil_elem_T append.assoc below_refl 
            front_tickFree_charn less_self min_elems2 no_Trace_implies_no_Failure<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_T_imp_tickFree<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> D_def D_imp_front_tickFree append_butlast_last_id append_is_Nil_conv 
        butlast_append butlast_snoc is_process9 is_process_Rep less_self nonTickFree_n_frontTickFree<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Seq_sym<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_approx_def mono_D21 mono_D22 mono_D23<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> chain_Seq1<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> chain <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_def<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> chain_Seq2<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> chain <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">S</span> <span class="main">`;`</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_def<span class="main">)</span>  

<span class="keyword1"><span class="command">lemma</span></span> limproc_Seq_D1<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> D <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="free">Y</span><span class="main">)</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> D <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Process_eq_spec D_seq F_seq F_LUB D_LUB T_LUB chain_Seq1<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∧</span> tickFree <span class="bound">t1</span> <span class="main">∧</span> front_tickFree <span class="bound">t2</span><span class="main">)</span> <span class="main">∨</span>
                <span class="main">(</span><span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">t2</span> <span class="main">∈</span> D <span class="free">S</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">t2</span> <span class="main">∉</span> D <span class="free">S</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> tickFree <span class="bound">t1</span> <span class="main">∧</span> front_tickFree <span class="bound">t2</span>"</span></span>        
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">t1</span></span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">t1</span></span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> A B C <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_list_def<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_T chain_lemma is_processT le_approx2T<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">from</span></span> False <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">t</span></span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">t</span> <span class="main">≤</span> <span class="skolem">t1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">t1</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 append_T_imp_tickFree front_tickFree_append front_tickFree_mono 
                    is_processT le_list_def local.A not_Cons_self2<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> A B C D E <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree T_def append_Nil2 front_tickFree_append 
                    front_tickFree_implies_tickFree front_tickFree_mono is_processT 
                    is_process_Rep le_list_def nonTickFree_n_frontTickFree 
                    trace_with_Tick_implies_tickFree_front<span class="main">)</span>          
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> limproc_Seq_F1<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> F <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="free">Y</span><span class="main">)</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> F <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec D_seq F_seq F_LUB D_LUB T_LUB chain_Seq1<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> disjE exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_processT7 is_processT8_S<span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> t1 t2<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_T append_T_imp_tickFree chain_lemma is_processT le_approx2T not_Cons_self2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_T append_T_imp_tickFree chain_lemma is_processT le_approx2T not_Cons_self2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> A1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">t2</span> <span class="main">∉</span> D <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>  A2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span><span class="main">.</span> tickFree <span class="bound">t1</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t2</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> front_tickFree <span class="bound">t2</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>  A3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">S</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>  B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> insert tick <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> tickFree <span class="skolem">a</span> <span class="main">∨</span>
               <span class="main">(</span><span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span><span class="main">)</span> <span class="main">∨</span>
               <span class="main">(</span><span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> tickFree <span class="bound">t1</span> <span class="main">∧</span> front_tickFree <span class="bound">t2</span><span class="main">)</span> <span class="main">∨</span>
               <span class="main">(</span><span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">t2</span> <span class="main">∈</span> D <span class="free">S</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>  C<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="free">Y</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> tickFree <span class="skolem">a</span> <span class="main">⟹</span> False"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> F<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">¬</span> tickFree <span class="skolem">a</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t2</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span><span class="main">}</span>
                                      <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> tickFree <span class="bound">t1</span> <span class="main">∧</span> front_tickFree <span class="bound">t2</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> B F <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="var">?S</span> <span class="skolem">f</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> NF_ND <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="var">?S</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_set_def<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> E<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t2</span><span class="main">∈</span><span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t</span><span class="main">}</span> <span class="main">∧</span> infinite <span class="main">(</span><span class="skolem">f</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suffixes_fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> E1<span class="main">:</span><span class="quoted"><span class="quoted">"infinite<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="skolem">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t2</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"infinite <span class="var">?E1</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> E <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">@</span> <span class="skolem">t2</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t2</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D not_finite_existsD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> A3 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> G<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> E1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="var">?E1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_nat_set_iff_bounded_le nat_le_linear<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">t1</span><span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> G C <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> le_approx_lemma_T chain_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> E1 <span class="main">=</span> this
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> E2<span class="main">:</span><span class="quoted"><span class="quoted">"infinite<span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="skolem">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> tickFree <span class="bound">t1</span> <span class="main">∧</span> front_tickFree <span class="skolem">t2</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"infinite <span class="var">?E2</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> E <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">@</span> <span class="skolem">t2</span> <span class="main">∧</span> tickFree <span class="skolem">t1</span> <span class="main">∧</span> front_tickFree <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D not_finite_existsD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> A2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> G<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> E2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="var">?E2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_nat_set_iff_bounded_le nat_le_linear<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">t1</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> G C <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> le_approx1 chain_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> E2 <span class="main">=</span> this      
        <span class="keyword1"><span class="command">from</span></span> D E E1 E2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> E <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cont_left_D <span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">i</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec chain_Seq1 limproc_Seq_D1 limproc_Seq_F1 limproc_is_thelub<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> limproc_Seq_D2<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> D <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> lim_proc <span class="main">(</span>range <span class="free">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> D <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">S</span> <span class="main">`;`</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec D_seq F_seq F_LUB D_LUB T_LUB chain_Seq2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">t2</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∧</span> <span class="bound">t2</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t2</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∧</span> <span class="bound">t2</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="var">?S</span> <span class="skolem">f</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="var">?S</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> E<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t2</span><span class="main">∈</span><span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t</span><span class="main">}</span> <span class="main">∧</span> infinite <span class="main">(</span><span class="skolem">f</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suffixes_fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">@</span> <span class="skolem">t2</span> <span class="main">∧</span> <span class="skolem">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D not_finite_existsD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A F <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> G<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> E <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_nat_set_iff_bounded_le nat_le_linear<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">t2</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> G C <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> le_approx1 po_class.chain_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span> tickFree <span class="bound">t1</span> <span class="main">∧</span> front_tickFree <span class="bound">t2</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>       
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> limproc_Seq_F2<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> F <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> lim_proc <span class="main">(</span>range <span class="free">Y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> F <span class="main">(</span>lim_proc <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">S</span> <span class="main">`;`</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Process_eq_spec D_seq F_seq T_seq F_LUB D_LUB D_LUB_2 T_LUB T_LUB_2 chain_Seq2 <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">X</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∉</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span>
                <span class="main">(</span><span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∧</span> <span class="bound">t2</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> D<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> NF_ND<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">t2</span><span class="main">.</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B NF_ND <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t</span><span class="main">}</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Sup_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword">where</span></span> E<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t2</span><span class="main">∈</span><span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t</span><span class="main">}</span> <span class="main">∧</span> infinite <span class="main">(</span><span class="skolem">f</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suffixes_fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">@</span> <span class="skolem">t2</span> <span class="main">∧</span> <span class="skolem">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D not_finite_existsD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A F <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> G<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t2</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∉</span> F <span class="main">(</span><span class="free">Y</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> E <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">t2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_nat_set_iff_bounded_le nat_le_linear<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> D <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t2</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> G C <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> is_processT8 po_class.chain_mono proc_ord2a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> insert tick <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span> <span class="main">∧</span> tickFree <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">..</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cont_right_D <span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">S</span> <span class="main">`;`</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec chain_Seq2 limproc_Seq_D2 limproc_Seq_F2 limproc_is_thelub<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Seq_cont<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"cont <span class="free">f</span>"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>     g<span class="main">:</span><span class="quoted"><span class="quoted">"cont <span class="free">g</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">`;`</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> cont <span class="free">g</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">`;`</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> contI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> monofunI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont_left_D<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> B <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> cont <span class="free">g</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">y</span> <span class="main">`;`</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="improper">y</span> <span class="main">`;`</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> cont_compose<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> contI2<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> monofunI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_Seq2 cont_right_D<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f g 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">`;`</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> cont_apply<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>contI2 monofunI <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>A B<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Hide">
<div class="head">
<h1>Theory Hide</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ******************************************************************** 
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">chapter</span></span><span class="quoted"><span class="plain_text">‹Concurrent CSP Operators›</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹The Hiding Operator›</span></span>

<span class="keyword1"><span class="command">theory</span></span>  Hide
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Process.html">Process</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Preliminaries : primitives and lemmas›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">trace_hide</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hiding_tickFree <span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="free">s</span> <span class="main">⟷</span> tickFree <span class="main">(</span>trace_hide <span class="free">s</span> <span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tickFree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hiding_fronttickFree <span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="free">s</span> <span class="main">⟹</span> front_tickFree <span class="main">(</span>trace_hide <span class="free">s</span> <span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> front_tickFree_charn tickFree_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hiding_tickFree list_nonMt_append tickFree_append tickFree_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> trace_hide_union<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"trace_hide <span class="free">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="main">(</span>trace_hide <span class="free">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">isInfHiddenRun</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> strict_mono <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span> <span class="main">∈</span> T <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="main">∧</span> 
                                      <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> trace_hide <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> isInfHiddenRun_1<span class="main">:</span> <span class="quoted"><span class="quoted">"isInfHiddenRun <span class="free">f</span> <span class="free">P</span> <span class="free">A</span> <span class="main">⟷</span> strict_mono <span class="free">f</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>  
                                                  <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∧</span> set <span class="bound">t</span> <span class="main">⊆</span>  <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
                         <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⟷</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">f</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> strict_mono_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span> <span class="main">@</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trace_hide <span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span>trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_self_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∧</span> set <span class="bound">t</span> <span class="main">⊆</span>  <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filter_empty_conv<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">from</span></span> B <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="free">f</span> <span class="main">0</span> <span class="main">@</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">t</span> <span class="main">⊆</span>  <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="free">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trace_hide <span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> B <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹The Hiding Operator Definition›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">div_hide</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> front_tickFree <span class="bound">u</span> <span class="main">∧</span>
                                        tickFree <span class="bound">t</span> <span class="main">∧</span> <span class="bound">s</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="bound">u</span> <span class="main">∧</span> 
                                        <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">f</span><span class="main">.</span> isInfHiddenRun <span class="bound">f</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hiding</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span> process <span class="main">,</span><span class="tfree">'α</span> set<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'α</span> process"</span></span>     <span class="main">(</span><span class="quoted">"_ \<span class="keyword1">\</span> _"</span> <span class="main">[</span>73<span class="main">,</span>72<span class="main">]</span> 72<span class="main">)</span>  <span class="keyword2"><span class="keyword">where</span></span>  
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> \<span class="main"><span class="free">\</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> Abs_process <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev<span class="main">`</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">X</span> <span class="main">∪</span> <span class="main">(</span>ev<span class="main">`</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> F <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span> <span class="main">∪</span>
                          <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> div_hide <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">}</span><span class="main">,</span> div_hide <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inf_hidden<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> as1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="free">s</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∉</span> F <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> as2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span><span class="main">.</span> isInfHiddenRun <span class="bound">f</span> <span class="free">P</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">∈</span> range <span class="bound">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> rec_nat <span class="free">s</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">e</span> <span class="main">=</span> <span class="keyword1">SOME</span> <span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> ev<span class="main">`</span><span class="free">A</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">@</span> <span class="main">[</span><span class="bound">e</span><span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="keyword1">in</span> <span class="bound">t</span> <span class="main">@</span> <span class="main">[</span><span class="bound">e</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>strict_mono_def lift_Suc_mono_less_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> range <span class="skolem">f</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> old.nat.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> range_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> trace_hide <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>trace_hide <span class="free">s</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A Nil_elem_T as2<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> as1<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> ev<span class="main">`</span><span class="free">A</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="skolem">i</span> <span class="main">@</span> <span class="main">[</span><span class="bound">e</span><span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> is_processT5_S7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">e</span> <span class="main">=</span> <span class="keyword1">SOME</span> <span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> ev<span class="main">`</span><span class="free">A</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="skolem">i</span> <span class="main">@</span> <span class="main">[</span><span class="bound">e</span><span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="keyword1">in</span>  <span class="skolem">f</span> <span class="skolem">i</span> <span class="main">@</span> <span class="main">[</span><span class="bound">e</span><span class="main">]</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> Suc a<span class="main">[</span><span class="operator">THEN</span> someI_ex<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> 
  <span class="keyword1"><span class="command">with</span></span> B C <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">f</span> <span class="free">P</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">∈</span> range <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Consequences›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> trace_hide_append<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">@</span> <span class="free">t</span> <span class="main">=</span> trace_hide <span class="free">ta</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">ss</span> <span class="bound">tt</span><span class="main">.</span> <span class="free">ta</span> <span class="main">=</span> <span class="bound">ss</span><span class="main">@</span><span class="bound">tt</span> <span class="main">∧</span> 
                                                                     <span class="free">s</span> <span class="main">=</span> trace_hide <span class="bound">ss</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
                                                                     <span class="free">t</span> <span class="main">=</span> trace_hide <span class="bound">tt</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">ta</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">t</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">ta</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span> <span class="main">=</span> trace_hide <span class="skolem">ta</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ta</span> <span class="main">=</span> <span class="skolem">ss</span> <span class="main">@</span> <span class="skolem">tt</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">=</span> trace_hide <span class="skolem">ss</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> 
                                  <span class="main">∧</span> <span class="skolem">t</span> <span class="main">=</span> trace_hide <span class="skolem">tt</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> True Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">ss</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Cons2<span class="main">:</span><span class="main">(</span>Cons <span class="skolem">aa</span> <span class="skolem">tls</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">∧</span> <span class="skolem">tls</span> <span class="main">@</span> <span class="skolem">t</span> <span class="main">=</span> trace_hide <span class="skolem">ta</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ta</span> <span class="main">=</span> <span class="skolem">ss</span> <span class="main">@</span> <span class="skolem">tt</span> <span class="main">∧</span> <span class="skolem">tls</span> <span class="main">=</span> trace_hide <span class="skolem">ss</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> 
                                  <span class="main">∧</span> <span class="skolem">t</span> <span class="main">=</span> trace_hide <span class="skolem">tt</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> Cons2 A False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">ss</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hiding_maintains_is_process<span class="main">:</span>
      <span class="quoted"><span class="quoted">"is_process     <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">X</span> <span class="main">∪</span> <span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">}</span> <span class="main">∪</span>
                          <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> div_hide <span class="free">P</span> <span class="free">A</span><span class="main">}</span><span class="main">,</span> div_hide <span class="free">P</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"is_process<span class="main">(</span><span class="var">?f</span><span class="main">,</span> <span class="var">?d</span><span class="main">)</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv snd_conv F_def is_process_def FAILURES_def DIVERGENCES_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">fold</span> FAILURES_def DIVERGENCES_def<span class="main"><span class="keyword3">,</span></span><span class="operator">fold</span> F_def<span class="main"><span class="keyword3">,</span></span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> not_not<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">from</span></span> inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">f</span> <span class="free">P</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">[]</span> <span class="main">∈</span> range <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span><span class="main">(</span>2<span class="main">)</span> Nil_elem_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> A 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> filter.simps<span class="main">(</span>1<span class="main">)</span> tickFree_Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> is_processT2 hiding_fronttickFree front_tickFree_append hiding_tickFree <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">ta</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">s</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ta</span> <span class="main">=</span> <span class="skolem">ss</span><span class="main">@</span><span class="skolem">tt</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">=</span> trace_hide <span class="skolem">ss</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ss</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> trace_hide_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">ta</span></span><span class="main">,</span> <span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F_T is_processT3_SR<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="skolem">ss</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter_set imageE member_filter tickFree_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">)</span> A B inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">ss</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 front_tickFree_Nil<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">ss</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span> <span class="main">∧</span> <span class="skolem">ta</span> <span class="main">=</span> <span class="skolem">tt</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 contra_subsetD filter_is_subset front_tickFree_mono 
                  hiding_fronttickFree is_processT nonTickFree_n_frontTickFree tickFree_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ss</span> <span class="main">=</span> trace_hide <span class="skolem">tt</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> butlast_append butlast_snoc contra_subsetD 
                  filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> filter_append filter_is_subset front_tickFree_implies_tickFree 
                  front_tickFree_single is_processT nonTickFree_n_frontTickFree non_tickFree_tick 
                  self_append_conv2 tickFree_append tickFree_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> False 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 front_tickFree_mono hiding_fronttickFree is_processT<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">ta</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">s</span> <span class="main">≤</span> length <span class="main">(</span>trace_hide <span class="skolem">ta</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> append_eq_append_conv2<span class="main">[</span><span class="operator">THEN</span> iffD1<span class="main">,</span> <span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> 
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">@</span><span class="skolem">tt</span> <span class="main">=</span> trace_hide <span class="skolem">ta</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="skolem"><span class="skolem">ttt</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ta</span> <span class="main">=</span> <span class="skolem">ss</span><span class="main">@</span><span class="skolem">ttt</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="main">=</span> trace_hide <span class="skolem">ss</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ss</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> trace_hide_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">tt</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">ta</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_T imageE is_processT3_ST<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="skolem">ss</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tickFree_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> A B inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">ss</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> append_Nil2 is_processT<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uu</span></span> <span class="skolem"><span class="skolem">uuu</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> trace_hide <span class="skolem">ta</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">uu</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">uu</span> <span class="main">@</span> <span class="skolem">uuu</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_eq_append_conv2<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> le_length_mono le_list_def<span class="main">)</span>          
      <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> 2<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">ta</span></span> <span class="quoted"><span class="skolem">uu</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> front_tickFree_dw_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 4 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> Un_subset_iff is_processT4 sup.cobounded2 sup.coboundedI1<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 5 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro</span> impI allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> not_not<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> iffD1<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> notI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>3<span class="main">)</span> 1<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="keyword2"><span class="keyword">where</span></span> A1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∈</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">∉</span> <span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span>"</span></span> 
                                                           <span class="keyword2"><span class="keyword">and</span></span> A3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="skolem">c</span><span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> is_processT5_S7'<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∪</span> <span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UnCI sup_commute sup_left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">c</span><span class="main">]</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="skolem">c</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> A1<span class="main">]</span> inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="skolem">c</span><span class="main">]</span>"</span></span><span class="main">,</span> <span class="operator">rotated</span><span class="main">,</span> <span class="operator">OF</span> A3<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> append.right_neutral append_T_imp_tickFree 
                                    front_tickFree_Nil is_processT5_S7 not_Cons_self2 rangeE<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 6 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span> <span class="skolem">X</span> <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>is_processT2<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t'</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> filter_is_subset nonTickFree_n_frontTickFree non_tickFree_tick 
          subset_iff tickFree_append tickFree_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> trace_hide <span class="skolem">t'</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tickFree_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> is_processT6<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span><span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t'</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">A</span>"</span></span><span class="main">]</span> 
         is_processT4_empty<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="quoted">"ev <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Un_Diff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">X</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u'</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> filter_is_subset nonTickFree_n_frontTickFree non_tickFree_tick           
          subset_iff tickFree_append tickFree_def<span class="main">)</span>
     <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u'</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tickFree_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
     <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>5<span class="main">)</span> 2<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">u'</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> front_tickFree_dw_closed A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">s</span> <span class="skolem">X</span> <span class="skolem">u</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u'</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> filter_is_subset nonTickFree_n_frontTickFree non_tickFree_tick           
          subset_iff tickFree_append tickFree_def<span class="main">)</span>
     <span class="keyword1"><span class="command">with</span></span> 3<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u'</span>"</span></span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>tickFree_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
     <span class="keyword1"><span class="command">with</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> 3<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="skolem">u'</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
       <span class="keyword1"><span class="command">using</span></span> front_tickFree_dw_closed<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span>tick<span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 7 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> front_tickFree_append <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span> <span class="main"><span class="keyword3">+</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 8 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 9 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u'</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hiding_tickFree nonTickFree_n_frontTickFree non_tickFree_tick tickFree_append<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> front_tickFree_dw_closed <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Rep_Abs_Hiding<span class="main">:</span> <span class="quoted"><span class="quoted">"Rep_process <span class="main">(</span>Abs_process 
                                  <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">X</span> <span class="main">∪</span> <span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">}</span> <span class="main">∪</span>
                                   <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> div_hide <span class="free">P</span> <span class="free">A</span><span class="main">}</span><span class="main">,</span> div_hide <span class="free">P</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>
                                  <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">X</span> <span class="main">∪</span> <span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">}</span> <span class="main">∪</span>
                                     <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> div_hide <span class="free">P</span> <span class="free">A</span><span class="main">}</span><span class="main">,</span> div_hide <span class="free">P</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>CollectI Rep_process Abs_process_inverse hiding_maintains_is_process<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Projections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> F_hiding<span class="main">:</span> <span class="quoted"><span class="quoted">"F<span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">X</span> <span class="main">∪</span> <span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">}</span> <span class="main">∪</span>
                              <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> div_hide <span class="free">P</span> <span class="free">A</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> F_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> hiding_def Rep_Abs_Hiding FAILURES_def fst_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> D_hiding<span class="main">:</span> <span class="quoted"><span class="quoted">"D<span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> div_hide <span class="free">P</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> D_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> hiding_def Rep_Abs_Hiding DIVERGENCES_def snd_conv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> T_hiding<span class="main">:</span> <span class="quoted"><span class="quoted">"T<span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∧</span>  <span class="main">(</span><span class="bound">t</span><span class="main">,</span> ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">}</span> <span class="main">∪</span> div_hide <span class="free">P</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>Rep_Abs_Hiding hiding_def TRACES_def FAILURES_def fst_conv<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> is_processT sup.cobounded2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> FAILURES_def F_def NF_NT range_eqI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> sup.idem<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> FAILURES_def F_T F_def range_eqI<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Continuity Rule›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_hiding<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span><span class="main">::</span><span class="tfree">'a</span> process<span class="main">)</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>le_approx_def D_hiding Ra_def F_hiding T_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">u</span> <span class="skolem">f</span> <span class="skolem">xa</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">xa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_T Ra_def le_approx2T le_approx_def rangeI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">t</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> is_processT2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">t</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> front_tickFree_charn mem_Collect_eq self_append_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t'</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nonTickFree_n_frontTickFree <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> front_tickFree_mono
          front_tickFree_Nil filter_append is_processT9 list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> local.A mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">x</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> NF_ND <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">x</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">x</span> <span class="skolem">u</span> <span class="skolem">f</span> <span class="skolem">xa</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_T Ra_def le_approx2T le_approx_def rangeI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 7<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> min_elems <span class="main">(</span>div_hide <span class="free">P</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> elem_min_elems<span class="main">[</span><span class="operator">OF</span> 7<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">u</span></span> 
    <span class="keyword2"><span class="keyword">where</span></span> B1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B2<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B3<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
             B4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">f</span><span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> event list<span class="main">)</span><span class="main">.</span> strict_mono <span class="bound">f</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">)</span> <span class="main">∧</span>
             <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> trace_hide <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="bound">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">∈</span> range <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">t''</span></span> <span class="keyword2"><span class="keyword">where</span></span> C1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">@</span><span class="skolem">t''</span><span class="main">=</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> C2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">∈</span> min_elems <span class="main">(</span>D <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> min_elems_charn<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> C3<span class="main">:</span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">t'</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> div_hide <span class="free">P</span> <span class="free">A</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> B2 elem_min_elems tickFree_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> C1 B1 <span class="keyword1"><span class="command">have</span></span> D1<span class="main">:</span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">t'</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> trace_hide <span class="skolem">t''</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> B1 C1 D1 min_elems_no<span class="main">[</span><span class="operator">OF</span> A C3<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> E1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span>trace_hide <span class="skolem">t'</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> append.assoc le_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> B1 B2 B3 C1 D1 7<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">have</span></span> E2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">f</span><span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> event list<span class="main">)</span><span class="main">.</span> strict_mono <span class="bound">f</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">∉</span> T <span class="free">Q</span><span class="main">)</span> <span class="main">∨</span>
              <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> trace_hide <span class="main">(</span><span class="bound">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≠</span> trace_hide <span class="main">(</span><span class="bound">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">t'</span> <span class="main">∉</span> range <span class="bound">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">using</span></span> front_tickFree_append hiding_tickFree tickFree_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> E1 7<span class="main">(</span>3<span class="main">)</span> C2 inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">t'</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> contra_subsetD<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> B1 B2 B3 B4 <span class="keyword1"><span class="command">have</span></span>  C<span class="main">:</span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> div_hide <span class="free">P</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> B1 min_elems_no<span class="main">[</span><span class="operator">OF</span> A C<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> E1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span>trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> B4 False 7<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">,</span> <span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> T <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F_T T_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> E1 7<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> E1 B2<span class="main">]</span> inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cont_hiding1 <span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> chain <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">i</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> po_class.chain_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> KoenigLemma<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="free">Tr</span><span class="main">::</span><span class="tfree">'a</span> list set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> finite<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">∈</span><span class="free">Tr</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> take <span class="bound">i</span> <span class="bound">t'</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">f</span><span class="main">::</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> list<span class="main">)</span><span class="main">.</span> strict_mono <span class="bound">f</span> <span class="main">∧</span> range <span class="bound">f</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">∈</span><span class="free">Tr</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≤</span> <span class="bound">t'</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Tr'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Tr'</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">∈</span><span class="free">Tr</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≤</span> <span class="bound">t'</span><span class="main">}</span>"</span></span> <span class="comment1">(* prefix closure *)</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"infinite <span class="skolem">Tr'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> * Tr'_def infinite_super mem_Collect_eq order_refl subsetI<span class="main">)</span> 
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">t</span></span> <span class="main">∈</span> <span class="skolem">Tr'</span><span class="main">.</span> length <span class="bound">t</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">∈</span><span class="free">Tr</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="bound">t'</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Tr'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> append_eq_conv_conj le_list_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> ** <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span><span class="main">{</span><span class="bound"><span class="bound">t</span></span><span class="main">∈</span><span class="skolem">Tr'</span><span class="main">.</span> length <span class="bound">t</span> <span class="main">=</span> <span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infinite_super <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>     
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> b<span class="main">=</span>this
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span> <span class="main">{</span><span class="bound">e</span> <span class="main">|</span><span class="bound">e</span><span class="main">.</span> <span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="bound">e</span><span class="main">]</span><span class="main">∈</span> <span class="skolem">Tr'</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="skolem">E</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj_on <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="skolem">t</span> <span class="main">@</span> <span class="main">[</span><span class="bound">e</span><span class="main">]</span><span class="main">)</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>
        
        <span class="keyword1"><span class="command">with</span></span> b<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>length <span class="skolem">t</span><span class="main">)</span>"</span></span><span class="main">]</span> inj_on_finite<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="bound">e</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">E</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">t'</span></span> <span class="main">∈</span> <span class="skolem">Tr'</span><span class="main">.</span> length <span class="bound">t'</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="skolem">t</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> E_def image_Collect_subsetI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">hence</span></span> bb<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="bound">e</span><span class="main">]</span> <span class="main">|</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span><span class="skolem">E</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">t'</span></span><span class="main">∈</span><span class="skolem">Tr'</span><span class="main">.</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="bound">t'</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="bound">e</span><span class="main">]</span> <span class="main">|</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span><span class="skolem">E</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">e</span><span class="main">∈</span><span class="skolem">E</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">t'</span></span><span class="main">∈</span><span class="skolem">Tr'</span><span class="main">.</span> <span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="bound">e</span><span class="main">]</span> <span class="main">&lt;</span> <span class="bound">t'</span><span class="main">}</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Let_def E_def Tr'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">xa</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">t</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">u</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A append_Cons append_Nil append_Nil2 le_list_def list.exhaust<span class="main">)</span> 
        <span class="keyword1"><span class="command">with</span></span> 1 1<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_assoc le_list_def less_list_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">xa</span> <span class="skolem">xb</span> <span class="skolem">xc</span><span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_self less_trans<span class="main">)</span> 
      <span class="keyword1"><span class="command">qed</span></span>     
    <span class="keyword1"><span class="command">with</span></span> aa bb <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound"><span class="bound">t'</span></span><span class="main">∈</span><span class="skolem">Tr'</span><span class="main">.</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="bound">t'</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">e</span><span class="main">.</span> infinite <span class="main">{</span><span class="bound"><span class="bound">t'</span></span><span class="main">∈</span><span class="skolem">Tr'</span><span class="main">.</span> <span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="bound">e</span><span class="main">]</span> <span class="main">&lt;</span> <span class="bound">t'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> c<span class="main">=</span>this
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">=</span>rec_nat <span class="main">[]</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">e</span> <span class="main">=</span> <span class="keyword1">SOME</span> <span class="bound">e</span><span class="main">.</span> infinite <span class="main">{</span><span class="bound"><span class="bound">t'</span></span><span class="main">∈</span><span class="skolem">Tr'</span><span class="main">.</span> <span class="bound">t</span><span class="main">@</span><span class="main">[</span><span class="bound">e</span><span class="main">]</span> <span class="main">&lt;</span> <span class="bound">t'</span><span class="main">}</span> <span class="keyword1">in</span> <span class="bound">t</span> <span class="main">@</span> <span class="main">[</span><span class="bound">e</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">hence</span></span> dd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">ff</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="comment1">(* funny *)</span>
  <span class="keyword1"><span class="command">hence</span></span> e<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="skolem">ff</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lift_Suc_mono_less strict_monoI<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="skolem">Tr'</span> <span class="main">∧</span> infinite <span class="main">{</span><span class="bound"><span class="bound">t'</span></span> <span class="main">∈</span> <span class="skolem">Tr'</span><span class="main">.</span> <span class="skolem">ff</span> <span class="skolem">n</span> <span class="main">&lt;</span> <span class="bound">t'</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 0
      <span class="keyword1"><span class="command">from</span></span> a Tr'_def <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">Tr'</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">t'</span></span> <span class="main">∈</span> <span class="skolem">Tr'</span><span class="main">.</span> <span class="main">[]</span> <span class="main">&lt;</span> <span class="bound">t'</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_neq_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">{</span><span class="bound"><span class="bound">t'</span></span> <span class="main">∈</span> <span class="skolem">Tr'</span><span class="main">.</span> <span class="main">[]</span> <span class="main">&lt;</span> <span class="bound">t'</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> finite.emptyI finite.insertI finite_UnI<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> d Tr'_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> d <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">e</span> <span class="main">=</span> <span class="keyword1">SOME</span> <span class="bound">e</span><span class="main">.</span> infinite <span class="main">{</span><span class="bound"><span class="bound">t'</span></span><span class="main">∈</span><span class="skolem">Tr'</span><span class="main">.</span> <span class="skolem">ff</span> <span class="skolem">n</span><span class="main">@</span><span class="main">[</span><span class="bound">e</span><span class="main">]</span> <span class="main">&lt;</span> <span class="bound">t'</span><span class="main">}</span> <span class="keyword1">in</span> <span class="skolem">ff</span> <span class="skolem">n</span> <span class="main">@</span> <span class="main">[</span><span class="bound">e</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">with</span></span> c<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ff</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">∧</span> infinite <span class="main">{</span><span class="bound"><span class="bound">t'</span></span> <span class="main">∈</span> <span class="skolem">Tr'</span><span class="main">.</span> <span class="skolem">ff</span> <span class="skolem">n</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">&lt;</span> <span class="bound">t'</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc.hyps someI_ex<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="skolem">Tr'</span> <span class="main">∧</span> <span class="skolem">ff</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_finite_existsD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">with</span></span> Tr'_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">Tr'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> dual_order.trans less_imp_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">with</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> g<span class="main">=</span>this
  <span class="keyword1"><span class="command">hence</span></span> h<span class="main">:</span><span class="quoted"><span class="quoted">"range <span class="skolem">ff</span> <span class="main">⊆</span> <span class="skolem">Tr'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Tr'_def e h <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> div_hiding_lub <span class="main">:</span>  <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">A</span><span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span> <span class="main">⟹</span> chain <span class="free">Y</span> <span class="main">⟹</span> D <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">i</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>limproc_is_thelub cont_hiding1 D_hiding T_hiding D_LUB T_LUB<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">u</span> <span class="main">∧</span> tickFree <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span> <span class="main">∧</span>
              isInfHiddenRun <span class="skolem">f</span> <span class="main">(</span><span class="free">Y</span> <span class="skolem">xa</span><span class="main">)</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">xa</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">∈</span> range <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> NT_ND chain_lemma le_approx2T <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> aa<span class="main">=</span>this 
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">f</span> <span class="skolem">j</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">u</span> <span class="main">∧</span> tickFree <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span> <span class="main">∧</span> 
              isInfHiddenRun <span class="skolem">f</span> <span class="main">(</span><span class="free">Y</span> <span class="skolem">xa</span><span class="main">)</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">j</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">xa</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">∈</span> range <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> front_tickFree <span class="bound">u</span> <span class="main">∧</span> tickFree <span class="bound">t</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="bound">u</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">xa</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">j</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> hiding_tickFree<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> hiding_tickFree<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> imageE<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> bb<span class="main">=</span>this
  <span class="keyword1"><span class="command">have</span></span> cc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> front_tickFree <span class="bound">u</span> <span class="main">∧</span> tickFree <span class="bound">t</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="bound">u</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">xa</span><span class="main">)</span>
           <span class="main">⟹</span> <span class="var">?case</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="var">?S</span> <span class="bound">t</span> <span class="bound">xa</span> <span class="main">⟹</span> <span class="var">?case</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> dd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> front_tickFree <span class="bound">u</span> <span class="main">∧</span> tickFree <span class="bound">t</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="bound">u</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">xa</span><span class="main">)</span>"</span></span>
             <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="var">?S</span> <span class="bound">t</span> <span class="bound">xa</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">t</span><span class="main">.</span> <span class="var">?S</span> <span class="bound">t</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>range <span class="skolem">f</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> gg<span class="main">:</span><span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_def True inf_img_fin_dom <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_nat_set_iff_bounded_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> uu<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">u</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span> <span class="main">∧</span> tickFree <span class="skolem">t</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f_def dd<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> some_eq_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="var">?S</span> <span class="bound">t</span> <span class="skolem">k</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span>
          <span class="keyword1"><span class="command">from</span></span> gg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> gg<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">-`</span> <span class="main">{</span><span class="skolem">t</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_nat_set_iff_bounded_le nat_le_linear<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_def dd<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> some_eq_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="var">?S</span> <span class="bound">t</span> <span class="skolem">n</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> gg 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> contra_subsetD le_approx_def po_class.chain_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">with</span></span> gg uu <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> range <span class="skolem">f</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_nat_set_iff_bounded_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> uu<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">u</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span> <span class="main">∧</span> tickFree <span class="skolem">t</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f_def dd<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> some_eq_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="var">?S</span> <span class="bound">t</span> <span class="skolem">k</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">t</span> <span class="main">⊆</span> set <span class="skolem">x</span> <span class="main">∪</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> ee<span class="main">=</span>this
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span>take <span class="skolem">i</span> <span class="bound">t</span><span class="main">)</span><span class="main">|</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="skolem">f</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> ff<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span>take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="bound">t</span><span class="main">|</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="skolem">f</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span>take <span class="skolem">i</span> <span class="bound">t</span><span class="main">)</span><span class="main">|</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="skolem">f</span><span class="main">}</span> <span class="main">∪</span>
                        <span class="main">(</span><span class="main">⋃</span><span class="bound">e</span><span class="main">∈</span><span class="main">(</span>set <span class="skolem">x</span> <span class="main">∪</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span>take <span class="skolem">i</span> <span class="bound">t</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="bound">e</span><span class="main">]</span><span class="main">|</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="skolem">f</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?AA</span> <span class="main">⊆</span> <span class="var">?BB</span>"</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">proof</span></span>
                <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
                <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?AA</span>"</span></span>
                <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> hh<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">∈</span> range <span class="skolem">f</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">=</span> take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">t'</span>"</span></span> 
                  <span class="keyword1"><span class="command">using</span></span> finite_nat_set_iff_bounded_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">with</span></span> ee<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t'</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?BB</span>"</span></span>
                  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">t'</span> <span class="main">&gt;</span> <span class="skolem">i</span>"</span></span><span class="main">)</span>
                    <span class="keyword3"><span class="command">case</span></span> True
                    <span class="keyword1"><span class="command">hence</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">t'</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="skolem">t'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t'</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_Suc_conv_app_nth<span class="main">)</span>
                    <span class="keyword1"><span class="command">with</span></span> ee<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t'</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">!</span><span class="skolem">i</span> <span class="main">∈</span> set <span class="skolem">x</span> <span class="main">∪</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
                      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> True contra_subsetD hh nth_mem<span class="main">)</span>
                    <span class="keyword1"><span class="command">with</span></span> ii hh <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command">next</span></span>
                    <span class="keyword3"><span class="command">case</span></span> False
                    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">t'</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                    <span class="keyword1"><span class="command">with</span></span> hh <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                  <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> 
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="skolem">f</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>take <span class="skolem">i</span> <span class="bound">t'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">|</span><span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="main">∈</span> range <span class="skolem">f</span><span class="main">}</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span><span class="main">{</span><span class="main">(</span>take <span class="skolem">i</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">|</span><span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span><span class="main">∈</span>range <span class="skolem">f</span><span class="main">}</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> finite_image_set<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span><span class="main">@</span><span class="main">[</span><span class="skolem">e</span><span class="main">]</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> Suc<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> gg<span class="main">=</span>this
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>set <span class="skolem">x</span> <span class="main">∪</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> ff gg Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> finite_UN finite_Un finite_subset<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> ff<span class="main">=</span>this
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">{</span>take <span class="bound">i</span> <span class="bound">t</span> <span class="main">|</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="skolem">f</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> take <span class="bound">i</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">t'</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> KoenigLemma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"range <span class="skolem">f</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> False<span class="main">]</span> ff
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> gg<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="main">(</span><span class="skolem">f'</span><span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> event list<span class="main">)</span> <span class="main">∧</span> 
                                            range <span class="skolem">f'</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">∈</span>range <span class="skolem">f</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≤</span> <span class="bound">t'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> <span class="main">{</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">f'</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="bound">m</span> <span class="main">}</span>"</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">M</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> l1<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">{</span>length <span class="main">(</span><span class="skolem">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">|</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> <span class="skolem">M</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">lm</span></span> <span class="keyword2"><span class="keyword">where</span></span> l2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">lm</span> <span class="main">=</span> Max <span class="main">{</span>length <span class="main">(</span><span class="skolem">f</span> <span class="bound">m</span><span class="main">)</span><span class="main">|</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> <span class="skolem">M</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">f'</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">k</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> gg lessI less_length_mono linorder_not_le 
                                        not_less_eq_eq order_trans strict_mono_def<span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">with</span></span> gg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> r1<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">f'</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">lm</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lessI less_le_trans<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> gg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">(</span>max <span class="skolem">m</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> gg <span class="keyword1"><span class="command">have</span></span> r3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> <span class="skolem">M</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> M_def max.bounded_iff mem_Collect_eq order_refl 
                                          order_trans strict_mono_less_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> l1 l2 <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">lm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Max_ge <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> r1 r2 <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">f</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">lm</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.strict_trans1 gg le_length_mono max.bounded_iff order_refl 
                      strict_mono_less_eq<span class="main">)</span> 
          <span class="keyword1"><span class="command">from</span></span> f1 f2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> ii<span class="main">=</span>this
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="skolem">n</span>
          <span class="keyword1"><span class="command">from</span></span> ii <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> jj<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="skolem">m</span> <span class="main">≥</span> <span class="skolem">f'</span> <span class="skolem">i</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_nat_set_iff_bounded_le mem_Collect_eq nat_le_linear<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> kk<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f_def dd<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">]</span> some_eq_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="var">?S</span> <span class="bound">t</span> <span class="skolem">m</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">with</span></span> jj gg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> D_T is_processT3_ST_pref<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> jj 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D_T le_approx2T po_class.chain_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> jj<span class="main">=</span>this
        <span class="keyword1"><span class="command">from</span></span> gg <span class="keyword1"><span class="command">have</span></span> kk<span class="main">:</span><span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> strict_mono_def mono_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter_append gg le_list_def mono_def strict_mono_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
          <span class="keyword1"><span class="command">from</span></span> gg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">f'</span> <span class="skolem">n</span> <span class="main">@</span> <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ii le_list_def not_finite_existsD<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> f_def dd<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> some_eq_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="var">?S</span> <span class="bound">t</span> <span class="skolem">k</span>"</span></span><span class="main">]</span> le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> ll<span class="main">=</span>this
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> llll<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">&gt;</span> trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> lll<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> length <span class="main">(</span>trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> length <span class="main">(</span>trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> less_length_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> lll'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">=</span> rec_nat <span class="main">(</span>length <span class="main">(</span>trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
                <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">n</span> <span class="main">=</span> <span class="keyword1">SOME</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span>length <span class="main">(</span>trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="bound">t</span> 
                         <span class="keyword1">in</span> length <span class="main">(</span>trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
            <span class="keyword1"><span class="command">from</span></span> lll' lll<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">ff</span> <span class="skolem">n</span>"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> old.nat.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> someI_ex<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> llll less_length_mono old.nat.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> someI_ex<span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> lll''<span class="main">=</span>this
          <span class="keyword1"><span class="command">with</span></span> lll'' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">ff</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lll'' lift_Suc_mono_less strict_monoI<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> lll'''<span class="main">:</span><span class="quoted"><span class="quoted">"infinite<span class="main">(</span>range <span class="skolem">ff</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_imageD strict_mono_imp_inj_on <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> lll lll' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">ff</span> <span class="main">⊆</span> range <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> length <span class="main">(</span>trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> old.nat.exhaust old.nat.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.nat.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> range_eqI<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> lll''' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> length <span class="main">(</span>trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> length <span class="main">(</span>trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="bound">m</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> length <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> finite_nat_set_iff_bounded_le <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> not_less rangeE<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> ll <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> le_length_mono not_less <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> mm<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="bound">n</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> A kk le_cases mono_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> gg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> nn<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">k</span> <span class="main">≥</span> <span class="skolem">f'</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> oo<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">u</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span> <span class="main">∧</span> tickFree <span class="main">(</span><span class="skolem">f'</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> f_def dd<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> some_eq_ex<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="var">?S</span> <span class="bound">t</span> <span class="skolem">k</span>"</span></span><span class="main">]</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> contra_subsetD filter_is_subset front_tickFree_append 
                          front_tickFree_mono le_list_def ll tickFree_Nil tickFree_append 
                          tickFree_def tickFree_implies_front_tickFree<span class="main">)</span>        
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>oo<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> gg jj kk mm <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_mono_def dual_order.antisym mono_def<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> plus_nat.add_0 rangeI<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">xa</span> <span class="bound">t</span> <span class="bound">u</span> <span class="bound">f</span><span class="main">.</span> front_tickFree <span class="bound">u</span> <span class="main">∧</span> tickFree <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">i</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">xa</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="bound">f</span> <span class="main">∧</span>
                            <span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="bound">u</span> <span class="main">∧</span> isInfHiddenRun <span class="bound">f</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">xa</span><span class="main">)</span> <span class="free">A</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> aa <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> dd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> front_tickFree <span class="bound">u</span> <span class="main">∧</span> tickFree <span class="bound">t</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="bound">u</span> <span class="main">∧</span>
             <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> isInfHiddenRun <span class="bound">f</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">xa</span><span class="main">)</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">i</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">xa</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span> 
            <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="var">?dd</span> <span class="bound">xa</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> allI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">xa</span>
        <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
              <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">u</span> <span class="main">∧</span> tickFree <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span> <span class="main">∧</span>
              <span class="main">(</span><span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">xa</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound">f</span><span class="main">.</span> isInfHiddenRun <span class="bound">f</span> <span class="main">(</span><span class="free">Y</span> <span class="skolem">xa</span><span class="main">)</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">∈</span> range <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?dd</span> <span class="skolem">xa</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span> False NT_ND chain_lemma le_approx2T <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> ee<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> front_tickFree <span class="bound">u</span> <span class="main">∧</span> tickFree <span class="bound">t</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="bound">u</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">xa</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bb <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> cc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cont_hiding2 <span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> chain <span class="free">Y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">i</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>limproc_is_thelub cont_hiding1 Process_eq_spec 
                    D_hiding Ra_def F_hiding T_hiding F_LUB  D_LUB T_LUB<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">b</span> <span class="skolem">x</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">b</span> <span class="skolem">x</span> <span class="skolem">u</span> <span class="skolem">f</span> <span class="skolem">xa</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">s</span> <span class="skolem">X</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>limproc_is_thelub cont_hiding1 F_LUB  D_LUB T_LUB D_hiding<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">n</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> D_LUB_2 div_hiding_lub subsetCE limproc_is_thelub cont_hiding1<span class="main">)</span> 
  <span class="keyword1"><span class="command">with</span></span> 3<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">X</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> D_hiding <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_processT2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∉</span> D<span class="main">(</span><span class="free">Y</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">t</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> a b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> c <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t'</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nonTickFree_n_frontTickFree <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> a b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>tick<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> front_tickFree_implies_tickFree imageE is_processT<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>2<span class="main">)</span> NF_ND chain_lemma proc_ord2a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">xa</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">xa</span> <span class="skolem">u</span> <span class="skolem">f</span> <span class="skolem">xb</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> D <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">i</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>limproc_is_thelub cont_hiding1 6<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> D_hiding D_LUB<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> div_hiding_lub<span class="main">[</span><span class="operator">OF</span> 6<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∈</span> D <span class="main">(</span><span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>limproc_is_thelub 6<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> D_hiding D_LUB T_LUB<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cont_hiding_base<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont_def cont_hiding1 cont_hiding2 cpo_lubI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hiding_cont<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> cont <span class="free">f</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> cont_compose<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Sync">
<div class="head">
<h1>Theory Sync</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ******************************************************************** 
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ The Synchronizing Operator ›</span></span>

<span class="keyword1"><span class="command">theory</span></span>  Sync
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Process.html">Process</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Infinite_Set.html">HOL-Library.Infinite_Set</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Basic Concepts›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">setinterleaving</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trace <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> event<span class="main">)</span> set <span class="main">×</span> <span class="tfree">'a</span> trace <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> trace<span class="main">)</span>set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>

  si_empty1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">setinterleaving</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
<span class="main">|</span> si_empty2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">setinterleaving</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> 
                <span class="keyword1">then</span> <span class="main">{}</span> 
                <span class="keyword1">else</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span><span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">setinterleaving</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="main">|</span> si_empty3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">setinterleaving</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> 
                <span class="keyword1">then</span> <span class="main">{}</span> 
                <span class="keyword1">else</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span><span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">setinterleaving</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
 
<span class="main">|</span> si_neq   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">setinterleaving</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> 
                <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> 
                     <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> 
                          <span class="keyword1">then</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span><span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">setinterleaving</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">}</span> 
                          <span class="keyword1">else</span> <span class="main">{}</span>
                     <span class="keyword1">else</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span><span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">setinterleaving</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">}</span>
                <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> 
                     <span class="keyword1">then</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span><span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">setinterleaving</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span> 
                          <span class="main">∪</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span><span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">setinterleaving</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">}</span> 
                     <span class="keyword1">else</span> <span class="main">{</span><span class="bound">z</span><span class="main">.</span><span class="main">∃</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">z</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="bound">u</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> <span class="free">setinterleaving</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">setinterleavingList</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> trace <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> event<span class="main">)</span> set <span class="main">×</span> <span class="tfree">'a</span> trace <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> trace<span class="main">)</span>list"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>

  si_empty1l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">setinterleavingList</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">[]</span><span class="main">]</span>"</span></span>
<span class="main">|</span> si_empty2l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">setinterleavingList</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> 
                <span class="keyword1">then</span> <span class="main">[]</span> 
                <span class="keyword1">else</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="free">setinterleavingList</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span> si_empty3l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">setinterleavingList</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> 
                <span class="keyword1">then</span> <span class="main">[]</span> 
                <span class="keyword1">else</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="bound">z</span><span class="main">)</span> <span class="main">(</span><span class="free">setinterleavingList</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

 
 
<span class="main">|</span> si_neql   <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">setinterleavingList</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
               <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> 
                <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> 
                     <span class="keyword1">then</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">)</span> 
                          <span class="keyword1">then</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="bound">z</span><span class="main">)</span>  <span class="main">(</span><span class="free">setinterleavingList</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span>
                          <span class="keyword1">else</span> <span class="main">[]</span>
                     <span class="keyword1">else</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="bound">z</span><span class="main">)</span>  <span class="main">(</span><span class="free">setinterleavingList</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span>
                <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> 
                     <span class="keyword1">then</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="bound">z</span><span class="main">)</span>  <span class="main">(</span><span class="free">setinterleavingList</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">@</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">#</span><span class="bound">z</span><span class="main">)</span>  <span class="main">(</span><span class="free">setinterleavingList</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span> 
                     <span class="keyword1">else</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">z</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">#</span><span class="bound">z</span><span class="main">)</span>  <span class="main">(</span><span class="free">setinterleavingList</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">#</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finiteSetinterleavingList<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="main">(</span>setinterleavingList<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> sym <span class="main">:</span> <span class="quoted"><span class="quoted">"setinterleaving<span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">X</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span><span class="main">=</span> setinterleaving<span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">X</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> setinterleaving.induct<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">X</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="bound"><span class="bound"><span class="bound">t</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> setinterleaving <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">X</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">t</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span> 
  <span class="main"><span class="main"><span class="main">=</span></span></span> setinterleaving <span class="main"><span class="main"><span class="main">(</span></span></span><span class="bound"><span class="bound"><span class="bound">t</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">X</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="bound"><span class="bound"><span class="bound">s</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="free"><span class="free"><span class="free">s</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="free"><span class="free"><span class="free">X</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="free"><span class="free"><span class="free">t</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

 

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted">"<span class="entity">setinterleaves_syntax</span>"</span>  
                         <span class="main">(</span><span class="quoted">"_ <span class="keyword1">setinterleaves</span> <span class="keyword1">'(</span><span class="keyword3">(</span><span class="keyword3">)</span><span class="keyword1">'(</span>_<span class="keyword1">,</span> _<span class="keyword1">')</span><span class="keyword3">(</span><span class="keyword3">)</span><span class="keyword1">,</span> _<span class="keyword1">')</span>"</span> <span class="main">[</span>60<span class="main">,</span>0<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span>70<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="keyword1"><span class="free">setinterleaves</span></span> <span class="main"><span class="free">(</span></span><span class="main"><span class="free">(</span></span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main"><span class="free">)</span></span><span class="main"><span class="free">,</span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main"><span class="free">)</span></span> <span class="main">==</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">∈</span> setinterleaving<span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

 
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definition›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">sync</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'a</span> process<span class="main">,</span><span class="tfree">'a</span> set<span class="main">,</span><span class="tfree">'a</span> process<span class="main">]</span> <span class="main">=&gt;</span> <span class="tfree">'a</span> process"</span></span> 
           <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span>_ <span class="keyword1">⟦</span>_<span class="keyword1">⟧</span><span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>14<span class="main">,</span>0<span class="main">,</span>15<span class="main">]</span> 14<span class="main">)</span>  
<span class="keyword2"><span class="keyword">where</span></span>
 <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⟦</span></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main"><span class="free">⟧</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">==</span> 
       Abs_process<span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">R</span><span class="main">)</span><span class="main">.</span><span class="main">∃</span> <span class="bound">t</span> <span class="bound">u</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> 
                                     <span class="main">(</span><span class="bound">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>ev<span class="main">`</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                                     <span class="bound">R</span> <span class="main">=</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">(</span>ev<span class="main">`</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span><span class="main">}</span> <span class="main">∪</span> 
                   <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">R</span><span class="main">)</span><span class="main">.</span><span class="main">∃</span> <span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span><span class="main">=</span><span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> 
                                     <span class="bound">s</span> <span class="main">=</span> <span class="bound">r</span><span class="main">@</span><span class="bound">v</span> <span class="main">∧</span> 
                                     <span class="main">(</span><span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>ev<span class="main">`</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
          <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∨</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">,</span>

                   <span class="main">{</span><span class="bound">s</span><span class="main">.</span>    <span class="main">∃</span> <span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span><span class="main">=</span><span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> 
                                     <span class="bound">s</span> <span class="main">=</span> <span class="bound">r</span><span class="main">@</span><span class="bound">v</span> <span class="main">∧</span> 
                                     <span class="main">(</span><span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>ev<span class="main">`</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                                     <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∨</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Consequences›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> emptyLeftProperty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟶</span><span class="bound">s</span><span class="main">=</span><span class="free">t</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="main">)</span>  
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">lemma</span></span> emptyLeftSelf<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∀</span><span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span><span class="main">∈</span> set <span class="free">t</span><span class="main">⟶</span><span class="bound">t1</span><span class="main">∉</span><span class="free">A</span><span class="main">)</span><span class="main">⟶</span><span class="free">t</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> emptyLeftNonSync<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span><span class="main">∀</span><span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span><span class="main">∈</span> set <span class="free">t</span><span class="main">⟶</span><span class="bound">t1</span><span class="main">∉</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">list</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">list</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> set <span class="skolem">list</span> <span class="main">⟶</span> <span class="bound">t1</span> <span class="main">∉</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">t1</span> <span class="main">∉</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> th<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟶</span><span class="skolem">a</span><span class="main">∉</span><span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="keyword2"><span class="keyword">where</span></span> th1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟶</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">list</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> mem_Collect_eq th <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> a th1 <span class="keyword1"><span class="command">have</span></span> th2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span><span class="main">∈</span> set <span class="skolem">list</span><span class="main">⟶</span><span class="bound">t</span> <span class="main">∉</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> empty_iff set_ConsD setinterleaving.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>   
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
 

<span class="keyword1"><span class="command">lemma</span></span> ftf_syn1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> set<span class="main">(</span><span class="free">u</span><span class="main">)</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">∉</span> set<span class="main">(</span><span class="free">t</span><span class="main">)</span> <span class="main">∧</span> <span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">a</span> <span class="main">∉</span> set<span class="main">(</span><span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">t</span> <span class="main">+</span> length <span class="free">u</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> sym emptyLeftProperty <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> sym emptyLeftProperty <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE disjE exE<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1.hyps"</span> add_less_le_mono length_Cons lessI order_refl set_ConsD<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1.hyps"</span> add_Suc_right length_Cons lessI set_ConsD<span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1.hyps"</span> add_less_mono length_Cons lessI set_ConsD<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1.hyps"</span> add_Suc_right length_Cons lessI set_ConsD<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted">"1.hyps"</span> add.commute add_Suc_right insert_iff 
                                         length_Cons lessI list.simps<span class="main"><span class="main">(</span></span>15<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1.hyps"</span> add_less_le_mono length_Cons lessI order_refl set_ConsD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> addNonSyncEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="free">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">u</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">u</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">sa</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">list</span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&lt;</span>length <span class="skolem">u</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> length <span class="bound">x</span> <span class="main">⟶</span><span class="main">(</span><span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="bound">xa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟶</span>
       <span class="main">(</span><span class="bound">xa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">xa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">x</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> th<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟹</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">list</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> emptyLeftNonSync emptyLeftProperty emptyLeftSelf list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
        list.set_sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> a b th <span class="keyword1"><span class="command">have</span></span> th1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span><span class="main">⟶</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> 
      <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">list</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">list</span><span class="main">@</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟶</span>
        <span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span>  b th <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> addNonSync<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span><span class="main">⟶</span>
<span class="main">(</span><span class="free">sa</span><span class="main">@</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">@</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">sa</span><span class="main">@</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u</span><span class="main">@</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">t</span> <span class="main">+</span> length <span class="free">u</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">sa</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>   
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> addNonSyncEmpty<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym addNonSyncEmpty append_self_conv2<span class="main">)</span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">list</span> <span class="skolem">aa</span> <span class="skolem">lista</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&lt;</span>length <span class="skolem">t</span> <span class="main">+</span> length <span class="skolem">u</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">xa</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> length <span class="bound">x</span> <span class="main">+</span> length <span class="bound">xa</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">xb</span><span class="main">.</span> <span class="bound">xb</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟶</span><span class="main">(</span><span class="bound">xb</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="bound">xb</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">lista</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟶</span>
     <span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
       <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th0pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span>
                              <span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">from</span></span> th0pre a b c <span class="keyword1"><span class="command">have</span></span> th0pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span>
       <span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
       <span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span> <span class="skolem">lista</span><span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_mono length_Cons lessI<span class="main">)</span>  
      <span class="keyword1"><span class="command">from</span></span>  th0pre th0pre1 b c <span class="keyword1"><span class="command">have</span></span> th0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th1pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span>
                             <span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> th1pre a b c <span class="keyword1"><span class="command">have</span></span> th1pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span>
      <span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      <span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc append_Cons length_Cons lessI<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span>  th1pre th1pre1 b c  <span class="keyword1"><span class="command">have</span></span> th1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟶</span>  
      <span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th2pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span>
                             <span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> th2pre a b c <span class="keyword1"><span class="command">have</span></span> th2pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span>
      <span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      <span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span> <span class="skolem">lista</span><span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc_right append_Cons length_Cons lessI<span class="main">)</span>  
      <span class="keyword1"><span class="command">from</span></span>  th2pre th2pre1 b c <span class="keyword1"><span class="command">have</span></span> th2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟶</span> 
      <span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th3pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟹</span>
     <span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span><span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> th3pre a b c <span class="keyword1"><span class="command">have</span></span> th3pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      <span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">lista</span> <span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> 
      <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span> <span class="skolem">lista</span><span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span> <span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc_right append_Cons length_Cons lessI<span class="main">)</span>  
      <span class="keyword1"><span class="command">from</span></span> th3pre a b c <span class="keyword1"><span class="command">have</span></span> th3pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      <span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span><span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> 
      <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span> <span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc append_Cons length_Cons lessI<span class="main">)</span>         
      <span class="keyword1"><span class="command">from</span></span> th3pre th3pre1 th3pre2 a b c <span class="keyword1"><span class="command">have</span></span> th3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
      <span class="free">y1</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟶</span><span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
        <span class="keyword1"><span class="command">using</span></span> b c th0 th1 th2 th3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> addSyncEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟶</span> 
                    <span class="main">(</span><span class="free">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="free">u</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">u</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">sa</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">list</span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&lt;</span>length <span class="skolem">u</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> length <span class="bound">x</span> <span class="main">⟶</span><span class="main">(</span><span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="bound">xa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span> 
                 <span class="main">⟶</span> <span class="main">(</span><span class="bound">xa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="bound">x</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span>"</span></span>  
      <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> th<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟹</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">list</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> emptyLeftNonSync emptyLeftProperty emptyLeftSelf list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 
           list.set_sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> a th <span class="keyword1"><span class="command">have</span></span> th1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span> 
      <span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">list</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟶</span> 
           <span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> b th <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> 
 
<span class="keyword1"><span class="command">lemma</span></span> addSync<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span><span class="main">⟶</span><span class="main">(</span><span class="free">sa</span><span class="main">@</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">@</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span><span class="free">u</span><span class="main">@</span><span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">t</span> <span class="main">+</span> length <span class="free">u</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">sa</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> addSyncEmpty<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym addSyncEmpty append.left_neutral<span class="main">)</span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">list</span> <span class="skolem">aa</span> <span class="skolem">lista</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&lt;</span>length <span class="skolem">t</span> <span class="main">+</span> length <span class="skolem">u</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">xa</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> length <span class="bound">x</span> <span class="main">+</span> length <span class="bound">xa</span> <span class="main">⟶</span>
                 <span class="main">(</span><span class="main">∀</span><span class="bound">xb</span><span class="main">.</span> <span class="bound">xb</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">xb</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> 
                 <span class="main">(</span><span class="main">(</span><span class="bound">x</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="bound">xa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span> "</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">u</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">lista</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">sa</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="free">y1</span> <span class="main">∈</span><span class="free">A</span><span class="main">⟶</span><span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th0pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> th0pre a b c <span class="keyword1"><span class="command">have</span></span> th0pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span>
      <span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">lista</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_mono length_Cons lessI<span class="main">)</span>  
      <span class="keyword1"><span class="command">from</span></span>  th0pre th0pre1 b c <span class="keyword1"><span class="command">have</span></span> th0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span><span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟶</span> 
      <span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th1pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> th1pre a b c <span class="keyword1"><span class="command">have</span></span> th1pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span>
      <span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc append_Cons length_Cons lessI<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span>  th1pre th1pre1 b c  <span class="keyword1"><span class="command">have</span></span> th1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟶</span> 
      <span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th2pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> th2pre a b c <span class="keyword1"><span class="command">have</span></span> th2pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span>
      <span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">lista</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc_right append_Cons length_Cons lessI<span class="main">)</span>  
      <span class="keyword1"><span class="command">from</span></span>  th2pre th2pre1 b c <span class="keyword1"><span class="command">have</span></span> th2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟶</span> 
      <span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th3pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟹</span>
      <span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span><span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> th3pre a b c <span class="keyword1"><span class="command">have</span></span> th3pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      <span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">lista</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc_right append_Cons length_Cons lessI<span class="main">)</span>  
      <span class="keyword1"><span class="command">from</span></span> th3pre a b c <span class="keyword1"><span class="command">have</span></span> th3pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      <span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">(</span>tl <span class="skolem">sa</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc append_Cons length_Cons lessI<span class="main">)</span>         
      <span class="keyword1"><span class="command">from</span></span> th3pre th3pre1 th3pre2 a b c <span class="keyword1"><span class="command">have</span></span> th3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
      <span class="free">y1</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟶</span> <span class="main">(</span><span class="skolem">sa</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">,</span> <span class="skolem">u</span> <span class="main">@</span> <span class="main">[</span><span class="free">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
        <span class="keyword1"><span class="command">using</span></span> b c th0 th1 th2 th3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
 

<span class="keyword1"><span class="command">lemma</span></span> doubleReverse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span>rev <span class="free">s1</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="free">t</span><span class="main">,</span> rev <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">t</span> <span class="main">+</span> length <span class="free">u</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">s1</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>  
    <span class="keyword1"><span class="command">using</span></span> emptyLeftNonSync 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> emptyLeftProperty emptyLeftSelf rev.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_rev<span class="main">)</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> sym 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> emptyLeftNonSync emptyLeftProperty emptyLeftSelf 
     rev.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> set_rev<span class="main">)</span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">list</span> <span class="skolem">aa</span> <span class="skolem">lista</span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&lt;</span>length <span class="skolem">t</span> <span class="main">+</span> length <span class="skolem">u</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">xa</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> length <span class="bound">x</span> <span class="main">+</span> length <span class="bound">xa</span> <span class="main">⟶</span>
               <span class="main">(</span><span class="main">∀</span><span class="bound">xb</span><span class="main">.</span> <span class="bound">xb</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span>rev <span class="bound">xb</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="bound">x</span><span class="main">,</span> rev <span class="bound">xa</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">lista</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span>rev <span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="skolem">t</span><span class="main">,</span> rev <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th0pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟹</span>
      <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> th0pre a b c <span class="keyword1"><span class="command">have</span></span> th0pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟹</span>
      <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="skolem">list</span><span class="main">,</span> rev <span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_mono length_Cons lessI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span>  th0pre th0pre1 b c <span class="keyword1"><span class="command">have</span></span> th0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span>
      rev <span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="skolem">t</span><span class="main">,</span> rev <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>   <span class="keyword1"><span class="command">using</span></span> addSync <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th1pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟹</span>
      <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> th1pre a b c <span class="keyword1"><span class="command">have</span></span> th1pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟹</span>
      <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="skolem">list</span><span class="main">,</span> rev <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_mono1 length_Cons lessI<span class="main">)</span>          
      <span class="keyword1"><span class="command">from</span></span>  th1pre th1pre1 b c <span class="keyword1"><span class="command">have</span></span> th1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span>
      rev <span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="skolem">t</span><span class="main">,</span> rev <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> addNonSync <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th2pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟹</span>
      <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> th2pre a b c <span class="keyword1"><span class="command">have</span></span> th2pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟹</span>
      <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span><span class="main">,</span> rev <span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc_right length_Cons lessI<span class="main">)</span>        
      <span class="keyword1"><span class="command">from</span></span>  th2pre th2pre1 b c <span class="keyword1"><span class="command">have</span></span> th2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span>
      rev <span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="skolem">t</span><span class="main">,</span> rev <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> addNonSync <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th3pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟹</span>
      <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> th3pre a b c <span class="keyword1"><span class="command">have</span></span> th3pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span><span class="main">,</span> rev <span class="main">(</span><span class="skolem">lista</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>   
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc_right length_Cons lessI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> th3pre a b c <span class="keyword1"><span class="command">have</span></span> th3pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span><span class="skolem">list</span><span class="main">)</span><span class="main">,</span> rev <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_mono1 length_Cons lessI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span>  th3pre1 <span class="keyword1"><span class="command">have</span></span> th3pre31<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span><span class="main">,</span> rev <span class="main">(</span><span class="skolem">lista</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span>
      <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="skolem">aa</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>rev <span class="main">(</span><span class="skolem">lista</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="skolem">aa</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> addNonSync<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span>  th3pre2 <span class="keyword1"><span class="command">have</span></span> th3pre32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span><span class="skolem">list</span><span class="main">)</span><span class="main">,</span> rev <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span>
      <span class="main">(</span><span class="main">(</span>rev <span class="main">(</span>tl <span class="skolem">s1</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>rev <span class="main">(</span><span class="skolem">list</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>rev <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> addNonSync<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> th3pre th3pre1 th3pre2 th3pre31 th3pre32 a b c <span class="keyword1"><span class="command">have</span></span> th3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span>
      <span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span>rev <span class="skolem">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="skolem">t</span><span class="main">,</span> rev <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">show</span></span><span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
        <span class="keyword1"><span class="command">using</span></span> b c th0 th1 th2 th3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
 
 
<span class="keyword1"><span class="command">lemma</span></span>  ftf_syn21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">∈</span>set<span class="main">(</span><span class="free">u</span><span class="main">)</span><span class="main">∧</span><span class="free">a</span><span class="main">∉</span>set<span class="main">(</span><span class="free">t</span><span class="main">)</span><span class="main">∨</span><span class="free">a</span><span class="main">∈</span>set<span class="main">(</span><span class="free">t</span><span class="main">)</span><span class="main">∧</span><span class="free">a</span><span class="main">∉</span>set<span class="main">(</span><span class="free">u</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="free">a</span><span class="main">∈</span><span class="free">A</span><span class="main">⟶</span>setinterleaving<span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">A</span> <span class="main">,</span><span class="free">t</span><span class="main">)</span><span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">t</span> <span class="main">+</span> length <span class="free">u</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>  
    <span class="keyword1"><span class="command">using</span></span> Sync.sym emptyLeftNonSync <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>  
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE disjE exE<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>  
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>  
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>  
    <span class="keyword1"><span class="command">using</span></span> less_SucI <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>  
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>  
    <span class="keyword1"><span class="command">using</span></span> list.simps<span class="main">(</span>15<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ftf_syn32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">=</span><span class="free">u1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">∧</span><span class="free">t</span><span class="main">=</span><span class="free">t1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">∧</span><span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">⟹</span>
                  <span class="main">∃</span><span class="bound">s1</span><span class="main">.</span> <span class="bound">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span> <span class="free">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span><span class="free">s</span><span class="main">=</span><span class="bound">s1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">=</span><span class="free">u1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">∧</span><span class="free">t</span><span class="main">=</span><span class="free">t1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">∧</span><span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s1</span><span class="main">.</span> <span class="bound">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span> <span class="free">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span><span class="free">s</span><span class="main">=</span><span class="bound">s1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"rev <span class="free">u</span><span class="main">=</span>tick<span class="main">#</span>rev <span class="free">u1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"rev <span class="free">t</span><span class="main">=</span>tick<span class="main">#</span>rev <span class="free">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rev <span class="free">s</span><span class="main">)</span>  <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tick<span class="main">#</span>rev <span class="free">t1</span><span class="main">,</span> tick<span class="main">#</span>rev <span class="free">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> doubleReverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ss</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ss</span>  <span class="keyword1">setinterleaves</span>  <span class="main">(</span><span class="main">(</span>rev <span class="free">t1</span><span class="main">,</span> rev <span class="free">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> 
    <span class="skolem">ss</span><span class="main">=</span>tl<span class="main">(</span>rev <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ab <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> c <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rev <span class="skolem">ss</span><span class="main">)</span>  <span class="keyword1">setinterleaves</span>  <span class="main">(</span><span class="main">(</span> <span class="free">t1</span><span class="main">,</span>  <span class="free">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> doubleReverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> d <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"rev <span class="free">s</span><span class="main">=</span>tick<span class="main">#</span><span class="skolem">ss</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> ab append_Cons_eq_iff c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> d e <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> syncWithTick_imp_NTF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span><span class="free">t</span><span class="main">∈</span> T <span class="free">P</span><span class="main">⟹</span>
  <span class="free">u</span><span class="main">∈</span> T <span class="free">Q</span><span class="main">⟹</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="free">t</span><span class="main">=</span><span class="bound">t1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span> <span class="main">∧</span> <span class="free">u</span><span class="main">=</span><span class="bound">u1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">∧</span> <span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">∈</span> T <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">∈</span> T <span class="free">Q</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="free">t</span><span class="main">=</span><span class="bound">t1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span> <span class="main">∧</span> <span class="free">u</span><span class="main">=</span><span class="bound">u1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">∧</span> <span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tick<span class="main">#</span>rev <span class="free">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="free">t</span><span class="main">,</span> rev <span class="free">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> doubleReverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> h <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="skolem"><span class="skolem">uu</span></span> <span class="keyword2"><span class="keyword">where</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">=</span><span class="skolem">tt</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">∧</span><span class="free">u</span><span class="main">=</span><span class="skolem">uu</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T_nonTickFree_imp_decomp empty_iff ftf_syn1 ftf_syn21 h1 h2 insertI1 
          non_tickFree_tick tickFree_append tickFree_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> h b <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tt</span><span class="main">,</span> <span class="skolem">uu</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> ftf_syn32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> b d <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> synPrefix1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">ta</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">ta</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> 
                    <span class="bound">t1</span> <span class="main">≤</span> <span class="free">ta</span> <span class="main">∧</span> <span class="bound">u1</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">∧</span> <span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ta</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> th<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span><span class="main">=</span><span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> th2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">ta</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span><span class="main">=</span> <span class="free">u</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a emptyLeftProperty<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> th3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">ta</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span><span class="main">∈</span>set <span class="free">u</span><span class="main">⟶</span><span class="bound">t1</span><span class="main">∉</span><span class="free">A</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emptyLeftNonSync<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a th <span class="keyword1"><span class="command">have</span></span> th1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">ta</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">[]</span> <span class="main">≤</span> <span class="free">ta</span> <span class="main">∧</span> <span class="skolem">u1</span> <span class="main">≤</span> <span class="free">u</span> "</span></span> 
    <span class="keyword1"><span class="command">using</span></span> le_list_def th2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> a th <span class="keyword1"><span class="command">have</span></span> thh1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">ta</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t1</span><span class="main">.</span> <span class="bound">t1</span><span class="main">∈</span>set <span class="skolem">u1</span><span class="main">⟶</span><span class="bound">t1</span><span class="main">∉</span><span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> 
  <span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emptyLeftSelf<span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">ta</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">t1</span> <span class="main">≤</span> <span class="free">ta</span> <span class="main">∧</span> <span class="bound">u1</span> <span class="main">≤</span> <span class="free">u</span> <span class="main">∧</span> 
  <span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> th th1 th2 th3 thh1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
<span class="keyword1"><span class="command">qed</span></span>
 

<span class="keyword1"><span class="command">lemma</span></span> synPrefix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">ta</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟶</span>
                  <span class="bound">t1</span><span class="main">≤</span><span class="free">ta</span><span class="main">∧</span><span class="bound">u1</span><span class="main">≤</span><span class="free">u</span><span class="main">∧</span><span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">ta</span> <span class="main">+</span> length <span class="free">u</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">ta</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">ta</span></span><span class="main">)</span>  
     <span class="keyword1"><span class="command">using</span></span> synPrefix1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command">using</span></span> sym synPrefix1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span> 
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">list</span> <span class="skolem">aa</span> <span class="skolem">lista</span> <span class="skolem">s</span> <span class="skolem">t</span>
     <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&lt;</span>length <span class="skolem">ta</span> <span class="main">+</span> length <span class="skolem">u</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span> <span class="bound">xa</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> length <span class="bound">x</span> <span class="main">+</span> length <span class="bound">xa</span> <span class="main">⟶</span>
                 <span class="main">(</span><span class="main">∀</span><span class="bound">xb</span> <span class="bound">xc</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="main">(</span><span class="bound">xb</span> <span class="main">@</span> <span class="bound">xc</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span>
                 <span class="bound">t1</span> <span class="main">≤</span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">u1</span> <span class="main">≤</span> <span class="bound">xa</span> <span class="main">∧</span> <span class="bound">xb</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ta</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">lista</span> "</span></span> 
     <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">t1</span> <span class="main">≤</span> <span class="skolem">ta</span> <span class="main">∧</span> <span class="bound">u1</span> <span class="main">≤</span> <span class="skolem">u</span> <span class="main">∧</span> 
            <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
       <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> th0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">xb</span> <span class="bound">xc</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="main">(</span><span class="bound">xb</span> <span class="main">@</span> <span class="bound">xc</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span> <span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span>
                                  <span class="bound">t1</span> <span class="main">≤</span> <span class="skolem">list</span> <span class="main">∧</span> <span class="bound">u1</span> <span class="main">≤</span> <span class="skolem">lista</span> <span class="main">∧</span> <span class="bound">xb</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_le_mono b c impossible_Cons le_cases not_le_imp_less<span class="main">)</span>
       <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yb</span></span> <span class="keyword2"><span class="keyword">where</span></span> thp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span><span class="main">@</span><span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>length <span class="skolem">s</span> <span class="main">&gt;</span><span class="main">1</span> <span class="main">⟹</span>
       <span class="skolem">yb</span><span class="main">=</span>tl <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">with</span></span> b c <span class="keyword1"><span class="command">have</span></span> thp4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>length <span class="skolem">s</span> <span class="main">&gt;</span><span class="main">1</span> <span class="main">⟹</span><span class="skolem">s</span><span class="main">=</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">yb</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Cons_eq_append_conv list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> not_less0<span class="main">)</span>
       <span class="keyword1"><span class="command">have</span></span> thp5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>length <span class="skolem">s</span> <span class="main">&gt;</span><span class="main">1</span> <span class="main">⟹</span>
       <span class="main">(</span><span class="skolem">yb</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span> <span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> b c thp4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
       <span class="keyword1"><span class="command">from</span></span> th0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yt</span></span> <span class="skolem"><span class="skolem">yu</span></span> <span class="keyword2"><span class="keyword">where</span></span> thp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
       <span class="main">1</span> <span class="main">&lt;</span> length <span class="skolem">s</span><span class="main">⟹</span><span class="skolem">yb</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">yt</span><span class="main">,</span> <span class="skolem">yu</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="skolem">yt</span><span class="main">≤</span><span class="skolem">list</span><span class="main">∧</span><span class="skolem">yu</span><span class="main">≤</span><span class="skolem">lista</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> thp5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
       <span class="keyword1"><span class="command">from</span></span> thp thp1 <span class="keyword1"><span class="command">have</span></span> thp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> length <span class="skolem">s</span> <span class="main">&gt;</span><span class="main">1</span><span class="main">⟶</span> 
       <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">yt</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">yu</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> thp4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
       <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> thp3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">s</span><span class="main">=</span><span class="main">1</span><span class="main">⟶</span>
       <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[</span><span class="skolem">a</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="skolem">aa</span><span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> append_eq_append_conv2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">aa</span><span class="main">]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> append_Nil2 
         append_eq_append_conv length_Cons list.size<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">have</span></span> thp6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> length <span class="skolem">s</span><span class="main">=</span><span class="main">0</span><span class="main">⟶</span>
       <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">from</span></span> thp1 <span class="keyword1"><span class="command">have</span></span> thp7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> length <span class="skolem">s</span> <span class="main">&gt;</span><span class="main">1</span><span class="main">⟹</span>
       <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">yt</span><span class="main">)</span><span class="main">≤</span><span class="skolem">ta</span> <span class="main">∧</span><span class="main">(</span><span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">yu</span><span class="main">)</span><span class="main">≤</span><span class="skolem">u</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b c le_less less_cons<span class="main">)</span>  
       <span class="keyword1"><span class="command">have</span></span> th<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="main">∃</span><span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> 
       <span class="bound">t1</span> <span class="main">≤</span> <span class="skolem">ta</span> <span class="main">∧</span> <span class="bound">u1</span> <span class="main">≤</span> <span class="skolem">u</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
         <span class="keyword3"><span class="command">assume</span></span> dd<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span> <span class="main">∧</span> <span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span>"</span></span>
         <span class="keyword1"><span class="command">consider</span></span> <span class="main">(</span>aa<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="main">(</span>bb<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">s</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="main">|</span> <span class="main">(</span>cc<span class="main">)</span> <span class="quoted"><span class="quoted">"length <span class="skolem">s</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
         <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
         <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span> 
           <span class="keyword3"><span class="command">case</span></span> aa
           <span class="keyword1"><span class="command">with</span></span> thp6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
         <span class="keyword1"><span class="command">next</span></span>
           <span class="keyword3"><span class="command">case</span></span> bb
           <span class="keyword1"><span class="command">with</span></span> dd thp3 b c <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">a</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def<span class="main">)</span>            
         <span class="keyword1"><span class="command">next</span></span>
           <span class="keyword3"><span class="command">case</span></span> cc
           <span class="keyword1"><span class="command">with</span></span> dd thp2 thp7 b c <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">yt</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">yu</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def<span class="main">)</span>   
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th1pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span>
      tl <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>hd <span class="main">(</span><span class="skolem">s</span><span class="main">@</span><span class="skolem">t</span><span class="main">)</span><span class="main">=</span><span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> a b c <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yt1</span></span> <span class="skolem"><span class="skolem">yu1</span></span> <span class="keyword2"><span class="keyword">where</span></span> th1pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      length <span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟶</span><span class="skolem">yt1</span><span class="main">≤</span><span class="skolem">list</span><span class="main">∧</span> <span class="skolem">yu1</span> <span class="main">≤</span> <span class="skolem">u</span><span class="main">∧</span> tl <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">yt1</span><span class="main">,</span> <span class="skolem">yu1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> length_Cons length_greater_0_conv lessI plus_nat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
        th1pre tl_append2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> th1pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yt1</span><span class="main">≤</span><span class="skolem">list</span><span class="main">⟶</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">yt1</span><span class="main">≤</span><span class="skolem">ta</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_less less_cons<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th1pre3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span>tl <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">yt1</span><span class="main">,</span> <span class="skolem">yu1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟶</span>
      <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">yt1</span><span class="main">,</span> <span class="skolem">yu1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> addNonSync doubleReverse rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rev_rev_ident<span class="main">)</span>  
      <span class="keyword1"><span class="command">from</span></span> b c th1pre1 th1pre2 <span class="keyword1"><span class="command">have</span></span> th1pre4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      length <span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟶</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">yt1</span><span class="main">≤</span><span class="skolem">ta</span><span class="main">∧</span> <span class="skolem">yu1</span> <span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">yt1</span><span class="main">,</span> <span class="skolem">yu1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> th1pre th1pre3  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
      <span class="keyword1"><span class="command">have</span></span> th1pre5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>length <span class="skolem">s</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span><span class="main">[]</span><span class="main">≤</span><span class="skolem">ta</span><span class="main">∧</span> <span class="main">[]</span> <span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span> 
      <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> th1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="main">∃</span><span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> 
      <span class="bound">t1</span> <span class="main">≤</span> <span class="skolem">ta</span> <span class="main">∧</span> <span class="bound">u1</span> <span class="main">≤</span> <span class="skolem">u</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> th1pre4 th1pre5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th2pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span>
      tl <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>hd <span class="main">(</span><span class="skolem">s</span><span class="main">@</span><span class="skolem">t</span><span class="main">)</span><span class="main">=</span><span class="skolem">aa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> a b c <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yt2</span></span> <span class="skolem"><span class="skolem">yu2</span></span> <span class="keyword2"><span class="keyword">where</span></span> th2pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      length <span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟶</span><span class="skolem">yt2</span><span class="main">≤</span><span class="skolem">ta</span><span class="main">∧</span> <span class="skolem">yu2</span> <span class="main">≤</span> <span class="skolem">lista</span><span class="main">∧</span> <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">yt2</span><span class="main">,</span> <span class="skolem">yu2</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_Suc_right length_Cons length_greater_0_conv lessI 
        th2pre tl_append2<span class="main">)</span>  
      <span class="keyword1"><span class="command">from</span></span> c <span class="keyword1"><span class="command">have</span></span> th2pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yu2</span><span class="main">≤</span><span class="skolem">lista</span><span class="main">⟶</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">yu2</span><span class="main">≤</span><span class="skolem">u</span>"</span></span>   
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_less less_cons<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th2pre3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span>tl <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">yt2</span><span class="main">,</span> <span class="skolem">yu2</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟶</span>
      <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">yt2</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">yu2</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> addNonSync doubleReverse rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rev_rev_ident<span class="main">)</span>  
      <span class="keyword1"><span class="command">from</span></span> b c th2pre1 th2pre2 <span class="keyword1"><span class="command">have</span></span> th2pre4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      length <span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟶</span><span class="skolem">yt2</span><span class="main">≤</span><span class="skolem">ta</span><span class="main">∧</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">yu2</span> <span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">yt2</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">yu2</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> th2pre th2pre3  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
      <span class="keyword1"><span class="command">have</span></span> th2pre5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>length <span class="skolem">s</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span>
      <span class="main">[]</span><span class="main">≤</span><span class="skolem">ta</span><span class="main">∧</span> <span class="main">[]</span> <span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> th2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="main">∃</span><span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> 
      <span class="bound">t1</span> <span class="main">≤</span> <span class="skolem">ta</span> <span class="main">∧</span> <span class="bound">u1</span> <span class="main">≤</span> <span class="skolem">u</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> th2pre4 th2pre5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th3pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟶</span>tl <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> 
      <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>hd <span class="main">(</span><span class="skolem">s</span><span class="main">@</span><span class="skolem">t</span><span class="main">)</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∨</span>tl <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span><span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>hd<span class="main">(</span><span class="skolem">s</span><span class="main">@</span><span class="skolem">t</span><span class="main">)</span><span class="main">=</span><span class="skolem">a</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> a b c th3pre <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yt31</span></span> <span class="skolem"><span class="skolem">yu31</span></span> <span class="keyword2"><span class="keyword">where</span></span> th3pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">∧</span>
      <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>tl <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      hd <span class="main">(</span><span class="skolem">s</span><span class="main">@</span><span class="skolem">t</span><span class="main">)</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span>length <span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟶</span><span class="skolem">yt31</span><span class="main">≤</span><span class="skolem">ta</span><span class="main">∧</span> <span class="skolem">yu31</span> <span class="main">≤</span> <span class="skolem">lista</span><span class="main">∧</span> <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">yt31</span><span class="main">,</span> <span class="skolem">yu31</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span><span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span>lifting<span class="main"><span class="main">)</span></span>add_Suc_right length_Cons length_greater_0_conv lessI tl_append2<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> a b c th3pre <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yt32</span></span> <span class="skolem"><span class="skolem">yu32</span></span> <span class="keyword2"><span class="keyword">where</span></span> th3pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span><span class="main">@</span><span class="skolem">t</span><span class="main">)</span><span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      tl <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>hd <span class="main">(</span><span class="skolem">s</span><span class="main">@</span><span class="skolem">t</span><span class="main">)</span><span class="main">=</span><span class="skolem">a</span><span class="main">∧</span>length <span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟶</span><span class="skolem">yt32</span><span class="main">≤</span><span class="skolem">list</span><span class="main">∧</span> <span class="skolem">yu32</span> <span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span> 
      <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">yt32</span><span class="main">,</span> <span class="skolem">yu32</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_mono1 impossible_Cons le_neq_implies_less length_greater_0_conv 
        nat_le_linear tl_append2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th3pre3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">∧</span>tl <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">yt31</span><span class="main">,</span> <span class="skolem">yu31</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟶</span>
      <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">yt31</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">yu31</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> addNonSync doubleReverse rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rev_rev_ident<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> b c th3pre1 th3pre2 <span class="keyword1"><span class="command">have</span></span> th3pre4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      length <span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span><span class="main">∧</span>tl <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>hd <span class="main">(</span><span class="skolem">s</span><span class="main">@</span><span class="skolem">t</span><span class="main">)</span><span class="main">=</span><span class="skolem">aa</span> <span class="main">⟶</span><span class="skolem">yt31</span><span class="main">≤</span><span class="skolem">ta</span><span class="main">∧</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">yu31</span> <span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span> 
      <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">yt31</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">yu31</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hd_append2 le_less length_greater_0_conv less_cons list.exhaust_sel th3pre3<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th3pre5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">∧</span>tl <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">yt32</span><span class="main">,</span> <span class="skolem">yu32</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟶</span>
      <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">yt32</span><span class="main">,</span> <span class="skolem">yu32</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> addNonSync doubleReverse rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rev_rev_ident<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> b c th3pre1 th3pre2 <span class="keyword1"><span class="command">have</span></span> th3pre6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      length <span class="skolem">s</span><span class="main">&gt;</span><span class="main">0</span><span class="main">∧</span>tl <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>hd <span class="main">(</span><span class="skolem">s</span><span class="main">@</span><span class="skolem">t</span><span class="main">)</span><span class="main">=</span><span class="skolem">a</span> <span class="main">⟶</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">yt32</span><span class="main">≤</span><span class="skolem">ta</span><span class="main">∧</span> <span class="skolem">yu32</span> <span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span> 
      <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">yt32</span><span class="main">,</span> <span class="skolem">yu32</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> th3pre th3pre5  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hd_append2 le_less length_greater_0_conv less_cons 
        list.exhaust_sel<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> th3pre7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>length <span class="skolem">s</span><span class="main">=</span><span class="main">0</span> <span class="main">⟶</span>
      <span class="main">[]</span><span class="main">≤</span><span class="skolem">ta</span><span class="main">∧</span> <span class="main">[]</span> <span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> th3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="main">∃</span><span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="main">(</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶</span> 
      <span class="bound">t1</span> <span class="main">≤</span> <span class="skolem">ta</span> <span class="main">∧</span> <span class="bound">u1</span> <span class="main">≤</span> <span class="skolem">u</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> th3pre th3pre4 th3pre6 th3pre7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">with</span></span> a b c th th1 th2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> syncWithTick_imp_NTF1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
<span class="free">t</span><span class="main">∈</span> T <span class="free">P</span><span class="main">⟹</span><span class="free">u</span><span class="main">∈</span> T <span class="free">Q</span><span class="main">⟹</span> <span class="main">∃</span> <span class="bound">t</span> <span class="bound">u</span> <span class="bound">Xa</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">Xa</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span> <span class="free">s</span> <span class="keyword1">setinterleaves</span> 
<span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="bound">Xa</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">Xa</span> <span class="main">∩</span> <span class="bound">Y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> syncWithTick_imp_NTF<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> T <span class="free">Q</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">∧</span><span class="free">u</span> <span class="main">=</span> <span class="bound">u1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">∧</span><span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> C <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∧</span> <span class="free">u</span> <span class="main">=</span> <span class="skolem">u1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∧</span> <span class="free">s</span> <span class="keyword1">setinterleaves</span> 
  <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> A B D <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="free">X</span><span class="main">-</span><span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">∧</span><span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="free">X</span><span class="main">-</span><span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_F process_charn<span class="main">)</span>  
  <span class="keyword3"><span class="command">thus</span></span>  <span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">Xa</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">Xa</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span> <span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> 
          <span class="main">∧</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="bound">Xa</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">Xa</span> <span class="main">∩</span> <span class="bound">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A B C D E <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> ftf_syn<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="free">u</span><span class="main">⟹</span>front_tickFree <span class="free">t</span><span class="main">⟹</span><span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>
      <span class="main">⟹</span>front_tickFree <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="free">u</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="free">t</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"front_tickFree <span class="free">s</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">u2</span><span class="main">.</span> <span class="skolem">u1</span><span class="main">≤</span><span class="free">u</span><span class="main">∧</span>tickFree <span class="skolem">u1</span><span class="main">∧</span>  <span class="main">(</span><span class="bound">u2</span><span class="main">≤</span><span class="free">u</span><span class="main">∧</span>tickFree <span class="bound">u2</span><span class="main">⟶</span><span class="bound">u2</span><span class="main">≤</span><span class="skolem">u1</span><span class="main">)</span>"</span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.right_neutral append_eq_first_pref_spec front_tickFree_charn le_list_def 
         tickFree_Nil<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> A A1 <span class="keyword1"><span class="command">have</span></span> AA1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span><span class="main">=</span><span class="free">u</span><span class="main">∨</span><span class="free">u</span><span class="main">=</span><span class="skolem">u1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> antisym append_Nil2 append_eq_first_pref_spec append_is_Nil_conv 
      front_tickFree_charn le_list_def less_list_def less_self nonTickFree_n_frontTickFree<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> B <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> B1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">t2</span><span class="main">.</span> <span class="skolem">t1</span><span class="main">≤</span><span class="free">t</span><span class="main">∧</span>tickFree <span class="skolem">t1</span><span class="main">∧</span>  <span class="main">(</span><span class="bound">t2</span><span class="main">≤</span><span class="free">t</span><span class="main">∧</span>tickFree <span class="bound">t2</span><span class="main">⟶</span><span class="bound">t2</span><span class="main">≤</span><span class="skolem">t1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.right_neutral append_eq_first_pref_spec front_tickFree_charn le_list_def 
      tickFree_Nil<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> B B1 <span class="keyword1"><span class="command">have</span></span> BB1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">=</span><span class="free">t</span><span class="main">∨</span><span class="free">t</span><span class="main">=</span><span class="skolem">t1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> antisym append_Nil2 append_eq_first_pref_spec append_is_Nil_conv 
      front_tickFree_charn le_list_def less_list_def less_self nonTickFree_n_frontTickFree<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> A1 B1 <span class="keyword1"><span class="command">have</span></span> C1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s1</span><span class="main">.</span> <span class="bound">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span>tickFree <span class="bound">s1</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ftf_syn1 tickFree_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> AA1 BB1 <span class="keyword1"><span class="command">have</span></span> CC1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span><span class="main">=</span><span class="free">u</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span><span class="free">t</span><span class="main">⟶</span>tickFree <span class="free">s</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C C1<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> AA1 BB1 <span class="keyword1"><span class="command">have</span></span> CC2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span><span class="main">=</span><span class="free">u</span><span class="main">∧</span><span class="free">t</span><span class="main">=</span><span class="skolem">t1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">⟶</span>tickFree <span class="free">s</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> ftf_syn21  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A1 C equals0D insertI1 non_tickFree_tick tickFree_append tickFree_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> AA1 BB1 <span class="keyword1"><span class="command">have</span></span> CC3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">=</span><span class="skolem">u1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span><span class="free">t</span><span class="main">⟶</span>tickFree <span class="free">s</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> ftf_syn21 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> B1 C insertI1 insert_not_empty mk_disjoint_insert non_tickFree_tick tickFree_append 
      tickFree_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> AA1 BB1 <span class="keyword1"><span class="command">have</span></span> CC4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">=</span><span class="skolem">u1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">∧</span><span class="free">t</span><span class="main">=</span><span class="skolem">t1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">⟹</span>
    <span class="main">∃</span><span class="bound">s1</span><span class="main">.</span> <span class="bound">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">s</span><span class="main">=</span><span class="bound">s1</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> C ftf_syn32 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">from</span></span> C1 CC4 <span class="keyword1"><span class="command">have</span></span> CC5<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="free">s</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> AA1 BB1 CC1 CC2 CC3 tickFree_implies_front_tickFree 
      tickFree_implies_front_tickFree_single <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> A1 B1 C1 AA1 BB1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> CC1 CC2 CC3 tickFree_implies_front_tickFree <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> is_processT5_SYNC2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">sa</span> <span class="bound">Y</span> <span class="bound">t</span> <span class="bound">u</span> <span class="bound">Xa</span> <span class="bound">Ya</span><span class="main">.</span>  <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">Xa</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">Ya</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span>  
<span class="main">(</span><span class="bound">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span><span class="main">(</span><span class="main">∀</span> <span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="main">(</span><span class="bound">sa</span><span class="main">@</span><span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> 
<span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span><span class="bound">u1</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span><span class="main">∈</span>F <span class="free">P</span><span class="main">⟶</span><span class="main">(</span><span class="bound">u1</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∉</span>F <span class="free">Q</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span><span class="main">∈</span>F <span class="free">Q</span><span class="main">⟶</span><span class="main">(</span><span class="bound">u1</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∉</span>F <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">∃</span><span class="bound">t2</span> <span class="bound">u2</span> <span class="bound">Xb</span><span class="main">.</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="bound">Xb</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Yb</span><span class="main">.</span><span class="main">(</span><span class="bound">u2</span><span class="main">,</span> <span class="bound">Yb</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span><span class="bound">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="bound">u2</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> 
<span class="main">∧</span><span class="main">(</span><span class="bound">Xa</span> <span class="main">∪</span> <span class="bound">Ya</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">Xa</span> <span class="main">∩</span> <span class="bound">Ya</span> <span class="main">∪</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">(</span><span class="bound">Xb</span> <span class="main">∪</span> <span class="bound">Yb</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">Xb</span> <span class="main">∩</span> <span class="bound">Yb</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">sa</span> <span class="skolem">Y</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">Xa</span> <span class="skolem">Ya</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">Xa</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">u</span><span class="main">,</span><span class="skolem">Ya</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span><span class="main">(</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">⟶</span><span class="main">(</span><span class="main">∀</span> <span class="bound">t1</span> <span class="bound">u1</span><span class="main">.</span> <span class="main">(</span><span class="skolem">sa</span><span class="main">@</span><span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span><span class="bound">u1</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span>
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span><span class="main">∈</span>F <span class="free">P</span><span class="main">⟶</span><span class="main">(</span><span class="bound">u1</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∉</span>F <span class="free">Q</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span><span class="main">∈</span>F <span class="free">Q</span><span class="main">⟶</span><span class="main">(</span><span class="bound">u1</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∉</span>F <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t2</span> <span class="bound">u2</span> <span class="bound">Xb</span><span class="main">.</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="bound">Xb</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Yb</span><span class="main">.</span> <span class="main">(</span><span class="bound">u2</span><span class="main">,</span> <span class="bound">Yb</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span> <span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> 
  <span class="main">(</span><span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="bound">u2</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span><span class="skolem">Xa</span> <span class="main">∪</span> <span class="skolem">Ya</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">Xa</span> <span class="main">∩</span> <span class="skolem">Ya</span> <span class="main">∪</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="main">(</span><span class="bound">Xb</span> <span class="main">∪</span> <span class="bound">Yb</span><span class="main">)</span> <span class="main">∩</span> 
  insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">Xb</span> <span class="main">∩</span> <span class="bound">Yb</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> A B <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Y1</span></span> <span class="skolem"><span class="skolem">Y2</span></span> <span class="keyword2"><span class="keyword">where</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Y1</span><span class="main">=</span><span class="main">(</span><span class="skolem">Y</span><span class="main">∩</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="skolem">Y2</span><span class="main">=</span><span class="main">(</span><span class="skolem">Y</span> <span class="main">-</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> AA1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y1</span> <span class="main">∪</span> <span class="skolem">Y2</span> <span class="main">=</span> <span class="skolem">Y</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> newAA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">Y1</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> newAAA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">Y2</span><span class="main">.</span> <span class="bound">y</span><span class="main">∉</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> B A1 <span class="keyword1"><span class="command">have</span></span> AA2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">Y1</span><span class="main">.</span><span class="main">(</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="bound">z</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∉</span>F <span class="free">P</span><span class="main">∨</span><span class="main">(</span><span class="skolem">u</span><span class="main">@</span><span class="main">[</span><span class="bound">z</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∉</span>F <span class="free">Q</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">Y1</span><span class="main">.</span> <span class="main">(</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="bound">z</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∈</span>F <span class="free">P</span><span class="main">∧</span><span class="main">(</span><span class="skolem">u</span><span class="main">@</span><span class="main">[</span><span class="bound">z</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∈</span>F <span class="free">Q</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z1</span></span> <span class="keyword2"><span class="keyword">where</span></span> TrA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z1</span><span class="main">∈</span><span class="skolem">Y1</span><span class="main">∧</span><span class="main">(</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="skolem">z1</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∈</span>F <span class="free">P</span><span class="main">∧</span><span class="main">(</span><span class="skolem">u</span><span class="main">@</span><span class="main">[</span><span class="skolem">z1</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∈</span>F <span class="free">Q</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> TrA A <span class="keyword1"><span class="command">have</span></span> TrB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span>insert tick<span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="skolem">z1</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">⟧</span>
      <span class="main">⟹</span><span class="main">(</span><span class="skolem">sa</span><span class="main">@</span><span class="main">[</span><span class="skolem">z1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="skolem">z1</span><span class="main">]</span><span class="main">,</span><span class="main">(</span><span class="skolem">u</span><span class="main">@</span><span class="main">[</span><span class="skolem">z1</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>    
      <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
        <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>rev <span class="skolem">sa</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>rev <span class="skolem">t</span><span class="main">,</span>rev <span class="skolem">u</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>  
          <span class="keyword1"><span class="command">using</span></span> local.A doubleReverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z1</span><span class="main">#</span>rev <span class="skolem">sa</span><span class="main">)</span>  <span class="keyword1">setinterleaves</span>  <span class="main">(</span><span class="main">(</span><span class="skolem">z1</span><span class="main">#</span>rev <span class="skolem">t</span><span class="main">,</span><span class="skolem">z1</span><span class="main">#</span> rev <span class="skolem">u</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>  
          <span class="keyword1"><span class="command">using</span></span> TrA a newAA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
          <span class="keyword1"><span class="command">using</span></span> b doubleReverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
        <span class="keyword1"><span class="command">using</span></span> A1 B TrA local.A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> A B A1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Z1</span></span> <span class="skolem"><span class="skolem">Z2</span></span> <span class="keyword2"><span class="keyword">where</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Z1</span><span class="main">=</span><span class="skolem">Y1</span><span class="main">∩</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span><span class="main">(</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="bound">z</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∉</span>F <span class="free">P</span><span class="main">}</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="skolem">Z2</span><span class="main">=</span><span class="skolem">Y1</span><span class="main">-</span><span class="main">{</span><span class="bound">z</span><span class="main">.</span><span class="main">(</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="bound">z</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∉</span>F <span class="free">P</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A2 <span class="keyword1"><span class="command">have</span></span> BA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y1</span><span class="main">=</span><span class="skolem">Z1</span><span class="main">∪</span><span class="skolem">Z2</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A2 <span class="keyword1"><span class="command">have</span></span> BAA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">Z1</span><span class="main">.</span> <span class="main">(</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="bound">z</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∉</span>F <span class="free">P</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A2 <span class="keyword1"><span class="command">have</span></span> BAAA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">Z2</span><span class="main">.</span> <span class="main">(</span><span class="skolem">u</span><span class="main">@</span><span class="main">[</span><span class="bound">z</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∉</span>F <span class="free">Q</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> AA2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A2 BA BAA <span class="keyword1"><span class="command">have</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">Z1</span><span class="main">)</span><span class="main">∈</span> F <span class="free">P</span>"</span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> F_T NF_NT is_processT5_S7 local.A<span class="main">)</span>  
    <span class="keyword1"><span class="command">from</span></span> A A1 <span class="keyword1"><span class="command">have</span></span> A43<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">Y2</span><span class="main">.</span> <span class="main">(</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="bound">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∉</span> F <span class="free">P</span><span class="main">∧</span><span class="main">(</span><span class="skolem">u</span><span class="main">@</span><span class="main">[</span><span class="bound">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∉</span> F <span class="free">Q</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">Y2</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="bound">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∈</span> F <span class="free">P</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="main">(</span><span class="skolem">u</span><span class="main">@</span><span class="main">[</span><span class="bound">y</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∈</span> F <span class="free">Q</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y1</span></span> <span class="keyword2"><span class="keyword">where</span></span> innAA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span><span class="main">∈</span><span class="skolem">Y2</span><span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="skolem">y1</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∈</span> F <span class="free">P</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="main">(</span><span class="skolem">u</span><span class="main">@</span><span class="main">[</span><span class="skolem">y1</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∈</span> F <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> innAA <span class="keyword1"><span class="command">have</span></span> innAAA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y1</span><span class="main">∉</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> newAAA <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> innAA <span class="keyword1"><span class="command">have</span></span> innAA1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="skolem">sa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> 
      <span class="skolem">y1</span> <span class="main">∉</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">⟧</span><span class="main">⟹</span><span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="skolem">y1</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∈</span> F <span class="free">P</span><span class="main">⟶</span><span class="main">(</span><span class="skolem">sa</span><span class="main">@</span><span class="main">[</span><span class="skolem">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> 
      <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">@</span><span class="main">[</span><span class="skolem">y1</span><span class="main">]</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="skolem">u</span><span class="main">@</span><span class="main">[</span><span class="skolem">y1</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span><span class="main">∈</span> F <span class="free">Q</span><span class="main">⟶</span><span class="main">(</span><span class="skolem">sa</span><span class="main">@</span><span class="main">[</span><span class="skolem">y1</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> 
      <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="skolem">u</span><span class="main">@</span><span class="main">[</span><span class="skolem">y1</span><span class="main">]</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> addNonSync<span class="main">)</span>        
      <span class="keyword1"><span class="command">with</span></span> A B innAA1 innAA <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A1 DiffD1 innAAA is_processT4_empty<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> A1  A2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Xbb</span></span> <span class="keyword2"><span class="keyword">where</span></span> B1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Xbb</span><span class="main">=</span><span class="main">(</span><span class="skolem">Xa</span><span class="main">∪</span><span class="skolem">Z1</span><span class="main">∪</span><span class="skolem">Y2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A B1 A3 A43  <span class="keyword1"><span class="command">have</span></span> A5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">Xbb</span><span class="main">)</span><span class="main">∈</span> F <span class="free">P</span>"</span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> BAA is_processT5_S1<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> A1 A2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Ybb</span></span> <span class="keyword2"><span class="keyword">where</span></span> B2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Ybb</span><span class="main">=</span><span class="main">(</span><span class="skolem">Ya</span><span class="main">∪</span><span class="skolem">Z2</span><span class="main">∪</span><span class="skolem">Y2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A B <span class="keyword1"><span class="command">have</span></span> A52<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">Ybb</span><span class="main">)</span><span class="main">∈</span> F <span class="free">Q</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A43 B2 BAAA is_processT5_S1<span class="main">)</span>   
    <span class="keyword1"><span class="command">from</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> A61<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Xbb</span> <span class="main">∪</span> <span class="skolem">Ybb</span><span class="main">)</span><span class="main">∩</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="main">(</span><span class="skolem">Xa</span><span class="main">∪</span><span class="skolem">Ya</span><span class="main">∪</span><span class="skolem">Y1</span><span class="main">∪</span><span class="skolem">Y2</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> B1 B2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> A62<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Y1</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">=</span><span class="skolem">Y1</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> inf.orderE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> A63<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Y2</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">=</span><span class="main">{}</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> AA1 Int_commute<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> A61 A62 A63 <span class="keyword1"><span class="command">have</span></span> A64<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">Xa</span><span class="main">∪</span><span class="skolem">Ya</span><span class="main">∪</span><span class="skolem">Y1</span><span class="main">∪</span><span class="skolem">Y2</span><span class="main">)</span><span class="main">∩</span>insert tick<span class="main">(</span>ev <span class="main">`</span><span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">=</span><span class="main">(</span><span class="main">(</span><span class="skolem">Xa</span><span class="main">∪</span><span class="skolem">Ya</span><span class="main">)</span><span class="main">∩</span>insert tick<span class="main">(</span>ev <span class="main">`</span><span class="free">A</span><span class="main">)</span><span class="main">∪</span><span class="skolem">Y1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_Un_distrib2<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> AA1 BA B1 B2 <span class="keyword1"><span class="command">have</span></span> A65<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Xbb</span><span class="main">∩</span><span class="skolem">Ybb</span><span class="main">)</span><span class="main">⊆</span><span class="main">(</span><span class="main">(</span><span class="skolem">Xa</span><span class="main">∩</span><span class="skolem">Ya</span><span class="main">)</span><span class="main">∪</span><span class="skolem">Y</span><span class="main">)</span> "</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">from</span></span> AA1 BA B1 B2 <span class="keyword1"><span class="command">have</span></span> A66<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Xbb</span><span class="main">∩</span><span class="skolem">Ybb</span><span class="main">)</span><span class="main">⊇</span><span class="main">(</span><span class="main">(</span><span class="skolem">Xa</span><span class="main">∩</span><span class="skolem">Ya</span><span class="main">)</span><span class="main">∪</span><span class="skolem">Y2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">from</span></span> A1 A2  <span class="keyword1"><span class="command">have</span></span> A66<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">Xa</span> <span class="main">∪</span> <span class="skolem">Ya</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">Xa</span> <span class="main">∩</span> <span class="skolem">Ya</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Xbb</span> <span class="main">∪</span> <span class="skolem">Ybb</span><span class="main">)</span> <span class="main">∩</span> 
    insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">Xbb</span> <span class="main">∩</span> <span class="skolem">Ybb</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Xa</span> <span class="main">∪</span> <span class="skolem">Ya</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">Xa</span> <span class="main">∩</span> <span class="skolem">Ya</span> <span class="main">∪</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="skolem">Y</span> <span class="main">∪</span> <span class="skolem">Xa</span> <span class="main">∩</span> <span class="skolem">Ya</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Xa</span> <span class="main">∪</span> <span class="skolem">Ya</span><span class="main">)</span> <span class="main">∩</span> 
      insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">Xbb</span> <span class="main">∩</span> <span class="skolem">Ybb</span><span class="main">)</span>"</span></span><span class="keyword1"><span class="command">using</span></span> A65 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Xa</span> <span class="main">∩</span> <span class="skolem">Ya</span> <span class="main">∪</span> <span class="skolem">Y2</span> <span class="main">∪</span> <span class="skolem">Xbb</span> <span class="main">∩</span> <span class="skolem">Ybb</span> <span class="main">=</span> <span class="skolem">Xbb</span> <span class="main">∩</span> <span class="skolem">Ybb</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> A66 le_iff_sup<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Xa</span> <span class="main">∪</span> <span class="skolem">Ya</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">Xa</span> <span class="main">∩</span> <span class="skolem">Ya</span> <span class="main">∪</span> <span class="skolem">Y</span> <span class="main">=</span> <span class="skolem">Xbb</span> <span class="main">∩</span> <span class="skolem">Ybb</span> <span class="main">∪</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Xa</span> <span class="main">∪</span> <span class="skolem">Ya</span><span class="main">)</span> <span class="main">∩</span> 
      insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">Y1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f1 A1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> A61 A64 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> A5 A52 A66 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> local.A <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> pt3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ta</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">⟹</span><span class="free">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">ta</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">⟹</span>
        <span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span><span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span><span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                 tick <span class="main">∉</span> <span class="bound">X</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">Y</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ta</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∈</span> T <span class="free">Q</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">ta</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ta</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">⟹</span><span class="free">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span> <span class="main">@</span> <span class="free">t</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">ta</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">⟹</span>
                <span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span><span class="main">(</span><span class="bound">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∧</span><span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> is_processT3_ST_pref synPrefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span><span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span><span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
                 tick <span class="main">∉</span> <span class="bound">X</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">Y</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> NF_NT a1 a2 a3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="keyword1"><span class="command">lemma</span></span> sync_maintains_is_process<span class="main">:</span>
 <span class="quoted"><span class="quoted">"is_process <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">R</span><span class="main">)</span><span class="main">.</span><span class="main">∃</span> <span class="bound">t</span> <span class="bound">u</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span> 
                                     <span class="main">(</span><span class="bound">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                                     <span class="bound">R</span> <span class="main">=</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span><span class="main">}</span> <span class="main">∪</span> 
                   <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">R</span><span class="main">)</span><span class="main">.</span><span class="main">∃</span> <span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span><span class="main">=</span><span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> 
                                     <span class="bound">s</span> <span class="main">=</span> <span class="bound">r</span><span class="main">@</span><span class="bound">v</span> <span class="main">∧</span> 
                                     <span class="main">(</span><span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>      
          <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∨</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">Q</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">)</span><span class="main">}</span><span class="main">,</span>

                   <span class="main">{</span><span class="bound">s</span><span class="main">.</span>    <span class="main">∃</span> <span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span><span class="main">=</span><span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> 
                                     <span class="bound">s</span> <span class="main">=</span> <span class="bound">r</span><span class="main">@</span><span class="bound">v</span> <span class="main">∧</span> 
                                     <span class="main">(</span><span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
                                     <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∨</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">Q</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"is_process<span class="main">(</span><span class="var">?f</span><span class="main">,</span> <span class="var">?d</span><span class="main">)</span>"</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fst_conv snd_conv F_def is_process_def FAILURES_def DIVERGENCES_def<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">fold</span> FAILURES_def DIVERGENCES_def<span class="main"><span class="keyword3">,</span></span><span class="operator">fold</span> F_def<span class="main"><span class="keyword3">,</span></span><span class="operator">intro</span> conjI<span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_commute Int_empty_right Sync.si_empty1 Un_empty empty_iff insert_iff is_processT1<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">⟶</span> front_tickFree <span class="bound">s</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>is_processT2 append_T_imp_tickFree front_tickFree_append D_imp_front_tickFree<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> ftf_syn is_processT2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command">using</span></span> D_imp_front_tickFree ftf_syn is_processT2_TR <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> D_imp_front_tickFree ftf_syn is_processT2_TR <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>   
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> F_T<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> F_T<span class="main">)</span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">ta</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> pt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">ta</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">v</span> <span class="main">⟹</span><span class="skolem">s</span><span class="main">@</span><span class="skolem">t</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span>insert tick<span class="main">(</span>ev <span class="main">`</span><span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">s</span><span class="main">=</span><span class="bound">r</span><span class="main">@</span><span class="bound">v</span><span class="main">⟶</span>front_tickFree <span class="bound">v</span><span class="main">⟶</span><span class="main">¬</span>tickFree <span class="bound">r</span> 
  <span class="main">∧</span> <span class="bound">v</span><span class="main">≠</span><span class="main">[]</span><span class="main">∨</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">⟶</span><span class="bound">u</span> <span class="main">∉</span> T <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">Q</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>tickFree <span class="skolem">r</span> <span class="main">⟹</span><span class="skolem">ta</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">⟹</span><span class="skolem">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">⟹</span><span class="skolem">s</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_eq_append_conv2<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 front_tickFree_Nil front_tickFree_dw_closed le_list_def less_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> Sync.sym aa <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> aaa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>tickFree <span class="skolem">r</span> <span class="main">⟹</span><span class="skolem">ta</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">⟹</span>
  <span class="skolem">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">⟹</span><span class="skolem">s</span><span class="main">&lt;</span><span class="skolem">r</span><span class="main">⟹</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span><span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> 
  <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>tick <span class="main">∉</span> <span class="bound">X</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">Y</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> D_T<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def<span class="main">)</span>  
    <span class="keyword1"><span class="command">using</span></span> Sync.sym pt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> aab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span><span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> 
  <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">X</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">Y</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> aa aaa Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">ta</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">v</span> <span class="main">⟹</span><span class="skolem">s</span> <span class="main">@</span> <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">⟹</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">⟹</span><span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span><span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">s</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">⟶</span>front_tickFree <span class="bound">v</span> 
  <span class="main">⟶</span><span class="main">¬</span> tickFree <span class="bound">r</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">Q</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">Q</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>tickFree <span class="skolem">r</span> <span class="main">⟹</span>
  <span class="skolem">ta</span> <span class="main">∈</span> D <span class="free">Q</span> <span class="main">⟹</span><span class="skolem">u</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">⟹</span><span class="skolem">s</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> append_eq_append_conv2<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 front_tickFree_Nil front_tickFree_dw_closed le_list_def less_list_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> aaa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>tickFree <span class="skolem">r</span> <span class="main">⟹</span><span class="skolem">ta</span> <span class="main">∈</span> D <span class="free">Q</span> <span class="main">⟹</span><span class="skolem">u</span> <span class="main">∈</span> T <span class="free">P</span> 
  <span class="main">⟹</span><span class="skolem">s</span><span class="main">&lt;</span><span class="skolem">r</span><span class="main">⟹</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span><span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">∧</span>tick <span class="main">∉</span> <span class="bound">X</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">Y</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> D_T<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def<span class="main">)</span>  
    <span class="keyword1"><span class="command">using</span></span> Sync.sym pt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> Sync.sym aa <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> aab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> 
  <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">X</span> <span class="main">∧</span> tick <span class="main">∉</span> <span class="bound">Y</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> aa aaa Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">ta</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ta</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_T<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"4"</span><span class="main">(</span>1<span class="main">)</span> <span class="quoted">"4"</span><span class="main">(</span>4<span class="main">)</span> pt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">ta</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ta</span> <span class="main">∈</span> T <span class="free">Q</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_T<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"5"</span><span class="main">(</span>1<span class="main">)</span> <span class="quoted">"5"</span><span class="main">(</span>4<span class="main">)</span> Sync.sym pt3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>      
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>   
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span> <span class="skolem">X</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">Xa</span> <span class="skolem">Ya</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">(</span><span class="skolem">Xa</span> <span class="main">∪</span> <span class="skolem">Ya</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">Xa</span> <span class="main">∩</span> <span class="skolem">Ya</span> <span class="main">)</span><span class="main">⟹</span><span class="main">∃</span><span class="bound">x1</span> <span class="bound">y1</span><span class="main">.</span> <span class="bound">x1</span><span class="main">⊆</span><span class="skolem">Xa</span> <span class="main">∧</span> <span class="bound">y1</span><span class="main">⊆</span><span class="skolem">Ya</span> <span class="main">∧</span> 
    <span class="skolem">X</span><span class="main">=</span><span class="main">(</span><span class="main">(</span><span class="bound">x1</span> <span class="main">∪</span> <span class="bound">y1</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">x1</span> <span class="main">∩</span> <span class="bound">y1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set.subset_iff_psubset_eq<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">⊂</span> <span class="main">(</span><span class="skolem">Xa</span> <span class="main">∪</span> <span class="skolem">Ya</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">Xa</span> <span class="main">∩</span> <span class="skolem">Ya</span>"</span></span> 
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X1</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X1</span><span class="main">=</span><span class="main">(</span><span class="main">(</span><span class="skolem">Xa</span> <span class="main">∪</span> <span class="skolem">Ya</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">Xa</span> <span class="main">∩</span> <span class="skolem">Ya</span><span class="main">)</span><span class="main">-</span><span class="skolem">X</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">Xa</span><span class="main">-</span><span class="skolem">X1</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">=</span><span class="skolem">Ya</span><span class="main">-</span><span class="skolem">X1</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> A B C D <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">∪</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">x</span> <span class="main">∩</span> <span class="skolem">y</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="bound">x1</span> <span class="main">⊂</span> <span class="skolem">Xa</span> <span class="main">∨</span> <span class="bound">x1</span> <span class="main">=</span> <span class="skolem">Xa</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">y1</span><span class="main">.</span> <span class="main">(</span><span class="bound">y1</span> <span class="main">⊂</span> <span class="skolem">Ya</span> <span class="main">∨</span> <span class="bound">y1</span> <span class="main">=</span> <span class="skolem">Ya</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">X</span> <span class="main">=</span> <span class="main">(</span><span class="bound">x1</span> <span class="main">∪</span> <span class="bound">y1</span><span class="main">)</span> <span class="main">∩</span> 
      insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">x1</span> <span class="main">∩</span> <span class="bound">y1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> A B C D E <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_Diff_Int inf.strict_order_iff inf_sup_absorb<span class="main">)</span> 
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> process_charn<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">next</span></span>  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">R</span><span class="main">)</span><span class="main">.</span><span class="main">∃</span> <span class="bound">t</span> <span class="bound">u</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">s</span> <span class="keyword1">setinterleaves</span> 
  <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="bound">R</span> <span class="main">=</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> is_processT5_SYNC3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">sa</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span><span class="main">(</span><span class="bound">sa</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span><span class="var">?f1</span> <span class="main">⟹</span><span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span><span class="main">∈</span><span class="bound">Y</span><span class="main">⟶</span><span class="main">(</span><span class="bound">sa</span><span class="main">@</span><span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span><span class="main">{}</span><span class="main">)</span><span class="main">∉</span><span class="var">?f</span><span class="main">)</span><span class="main">⟹</span><span class="main">(</span><span class="bound">sa</span><span class="main">,</span> <span class="bound">X</span><span class="main">∪</span><span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f1</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> is_processT5_SYNC2<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>is_processT5<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym Un_empty_right inf_sup_absorb inf_sup_aci<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> insert_absorb insert_not_empty<span class="main">)</span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">.</span> <span class="bound">c</span> <span class="main">∈</span> <span class="bound">Y</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="main">[</span><span class="bound">c</span><span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∉</span> <span class="var">?f</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> conjE UnE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rev_subsetD<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> is_processT5_SYNC3<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">,</span> <span class="main">{}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> F_T<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> F_T<span class="main">)</span>  
        <span class="keyword1"><span class="command">using</span></span> syncWithTick_imp_NTF1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> append_assoc append_same_eq front_tickFree_dw_closed nonTickFree_n_frontTickFree 
       non_tickFree_tick tickFree_append<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> butlast_append butlast_snoc front_tickFree_charn non_tickFree_tick tickFree_append 
      tickFree_implies_front_tickFree<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> NT_ND append_Nil2 front_tickFree_Nil is_processT3_ST is_processT9_S_swap 
     syncWithTick_imp_NTF<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NT_ND append_Nil2 front_tickFree_Nil is_processT3_ST is_processT9_S_swap 
    syncWithTick_imp_NTF<span class="main">)</span>
    
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="var">?d</span> <span class="main">∧</span> tickFree <span class="bound">s</span> <span class="main">∧</span> front_tickFree <span class="bound">t</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∈</span> <span class="var">?d</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">using</span></span> front_tickFree_append <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">using</span></span> front_tickFree_append <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span> <span class="bound">X</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∈</span> <span class="var">?d</span> <span class="main">⟶</span>  <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> <span class="var">?d</span> <span class="main">⟶</span> <span class="bound">s</span> <span class="main">∈</span> <span class="var">?d</span>"</span></span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> butlast_append butlast_snoc front_tickFree_charn non_tickFree_tick 
       tickFree_append tickFree_implies_front_tickFree<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> butlast_append butlast_snoc front_tickFree_charn non_tickFree_tick 
      tickFree_append tickFree_implies_front_tickFree<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_T append.right_neutral front_tickFree_Nil is_processT3_ST is_processT9 
     syncWithTick_imp_NTF<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_T append.right_neutral front_tickFree_Nil is_processT3_ST is_processT9 
    syncWithTick_imp_NTF<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemmas</span></span>  Rep_Abs_Sync<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">=</span> Abs_process_inverse<span class="main">[</span><span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> sync_maintains_is_process<span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Projections›</span></span>

<span class="keyword1"><span class="command">lemma</span></span>
  F_sync    <span class="main">:</span> <span class="quoted"><span class="quoted">"F<span class="main">(</span><span class="free">P</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> 
                   <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">R</span><span class="main">)</span><span class="main">.</span><span class="main">∃</span> <span class="bound">t</span> <span class="bound">u</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span> <span class="main">∧</span> 
                                       <span class="main">(</span><span class="bound">u</span><span class="main">,</span><span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span> <span class="main">∧</span> 
                                       <span class="bound">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∧</span> 
                                       <span class="bound">R</span> <span class="main">=</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span><span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span><span class="main">}</span> <span class="main">∪</span> 
                   <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">R</span><span class="main">)</span><span class="main">.</span><span class="main">∃</span> <span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> 
                                       <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span><span class="main">=</span><span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> 
                                       <span class="bound">s</span> <span class="main">=</span> <span class="bound">r</span><span class="main">@</span><span class="bound">v</span> <span class="main">∧</span> 
                                       <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span><span class="main">∪</span><span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∧</span> 
                                       <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∨</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">Q</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">)</span><span class="main">}</span>"</span></span>
       
       
  <span class="keyword1"><span class="command">unfolding</span></span> sync_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> F_def<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Rep_Abs_Sync<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> FAILURES_def<span class="main">)</span>
   

<span class="keyword1"><span class="command">lemma</span></span>
  D_sync    <span class="main">:</span> <span class="quoted"><span class="quoted">"D<span class="main">(</span><span class="free">P</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> 
                   <span class="main">{</span><span class="bound">s</span><span class="main">.</span>    <span class="main">∃</span> <span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span><span class="main">=</span><span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> 
                            <span class="bound">s</span> <span class="main">=</span> <span class="bound">r</span><span class="main">@</span><span class="bound">v</span> <span class="main">∧</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∧</span> 
                            <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∨</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">Q</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">unfolding</span></span> sync_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> D_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Rep_Abs_Sync<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DIVERGENCES_def<span class="main">)</span>
 

<span class="keyword1"><span class="command">lemma</span></span>
  T_sync    <span class="main">:</span> <span class="quoted"><span class="quoted">"T<span class="main">(</span><span class="free">P</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> 
                   <span class="main">{</span><span class="bound">s</span><span class="main">.</span>    <span class="main">∃</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∧</span> 
                                 <span class="bound">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">}</span><span class="main">∪</span>
 <span class="main">{</span><span class="bound">s</span><span class="main">.</span>    <span class="main">∃</span> <span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span><span class="main">=</span><span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> 
                            <span class="bound">s</span> <span class="main">=</span> <span class="bound">r</span><span class="main">@</span><span class="bound">v</span> <span class="main">∧</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span><span class="main">(</span>ev<span class="main">`</span><span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∧</span> 
                            <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∨</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">Q</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">)</span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">unfolding</span></span> sync_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Rep_Abs_Sync<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>TRACES_def FAILURES_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> F_T<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> T_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Syntax for Interleave and Parallel Operator ›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Inter_syntax</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">|||</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>14<span class="main">,</span>15<span class="main">]</span> 14<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">|||</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">==</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟦</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">Par_syntax</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">||</span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>14<span class="main">,</span>15<span class="main">]</span> 14<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">||</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">==</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟦</span> UNIV <span class="main">⟧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Continuity Rule ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Sync_D1<span class="main">:</span>  
<span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> D <span class="main">(</span><span class="free">Q</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_sync<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> le_approx1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> le_approx_lemma_T <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 le_approx1 subsetCE tickFree_Nil tickFree_implies_front_tickFree<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 le_approx_lemma_T subsetCE tickFree_Nil tickFree_implies_front_tickFree<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Sync_D2<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span><span class="main">⟹</span><span class="main">(</span><span class="main">∀</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">P</span>  <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span>  <span class="free">S</span><span class="main">)</span> <span class="main">⟶</span> Ra <span class="main">(</span><span class="free">P</span>  <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span>  <span class="free">S</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> Ra <span class="main">(</span><span class="free">Q</span>  <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span>  <span class="free">S</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ra_def D_sync F_sync<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> F_T append_Nil2 front_tickFree_Nil le_approx2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ra_def D_sync F_sync<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> le_approx_lemma_F<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span> le_approx_lemma_T<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span> le_approx1<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span> 
  le_approx2T<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> interPrefixEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="free">t1</span><span class="main">&lt;</span><span class="free">t</span><span class="main">⟹</span><span class="main">∃</span><span class="bound"><span class="bound">s1</span></span><span class="main">&lt;</span><span class="free">s</span><span class="main">.</span> <span class="bound">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym emptyLeftProperty le_list_def nil_le2 
  order.strict_implies_order synPrefix1<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> interPrefix<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u1</span> <span class="bound">s1</span><span class="main">.</span> <span class="free">s</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="free">t1</span><span class="main">&lt;</span><span class="free">t</span><span class="main">⟶</span><span class="bound">u1</span><span class="main">≤</span><span class="free">u</span><span class="main">∧</span><span class="bound">s1</span><span class="main">&lt;</span><span class="free">s</span><span class="main">∧</span><span class="bound">s1</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="bound">u1</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">t</span> <span class="main">+</span> length <span class="free">u</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">t1</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>   
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> interPrefixEmpty nil_le2<span class="main">)</span>   
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">list</span> <span class="skolem">aa</span> <span class="skolem">lista</span> 
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">&lt;</span>length <span class="skolem">t</span> <span class="main">+</span> length <span class="skolem">u</span><span class="main">.</span>  <span class="main">∀</span><span class="bound">x</span> <span class="bound">xa</span><span class="main">.</span> <span class="bound">m</span> <span class="main">=</span> length <span class="bound">x</span> <span class="main">+</span> length <span class="bound">xa</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">xb</span> <span class="bound">xc</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u1</span> <span class="bound">s1</span><span class="main">.</span> 
    <span class="bound">xb</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">xa</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="bound">xc</span> <span class="main">&lt;</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">u1</span> <span class="main">≤</span> <span class="bound">xa</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">&lt;</span> <span class="bound">xb</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">xc</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">lista</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u1</span> <span class="bound">s1</span><span class="main">.</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">&lt;</span><span class="skolem">t</span><span class="main">⟶</span><span class="bound">u1</span> <span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span><span class="bound">s1</span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">∧</span><span class="bound">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th0pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
      <span class="keyword1"><span class="command">from</span></span> a <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yu</span></span> <span class="skolem"><span class="skolem">ys</span></span>  <span class="keyword2"><span class="keyword">where</span></span> th0pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">∧</span>
      length <span class="skolem">t1</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟹</span><span class="skolem">yu</span><span class="main">≤</span><span class="skolem">lista</span><span class="main">∧</span><span class="skolem">ys</span><span class="main">&lt;</span>tl <span class="skolem">s</span><span class="main">∧</span><span class="skolem">ys</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t1</span><span class="main">,</span> <span class="skolem">yu</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>    
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def append_eq_Cons_conv<span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_less_mono b c length_Cons lessI list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> th0pre<span class="main">)</span>        
      <span class="keyword1"><span class="command">from</span></span> th0pre th0pre1  b c <span class="keyword1"><span class="command">have</span></span> th0pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span><span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> 
      <span class="skolem">t1</span><span class="main">&lt;</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">∧</span>length <span class="skolem">t1</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟹</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">ys</span><span class="main">)</span><span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span>tl <span class="skolem">t1</span><span class="main">,</span> <span class="skolem">a</span><span class="main">#</span><span class="skolem">yu</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">ys</span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">∧</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">yu</span><span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span><span class="skolem">a</span><span class="main">#</span>tl <span class="skolem">t1</span>"</span></span>   
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def  Cons_eq_append_conv<span class="main">)</span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons list.exhaust_sel list.inject list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> th0pre3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span><span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">∧</span>length <span class="skolem">t1</span><span class="main">=</span><span class="main">0</span><span class="main">⟹</span>
      <span class="main">[]</span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">∧</span><span class="main">[]</span><span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span> <span class="main">[]</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span>  th0pre2 th0pre3 c  <span class="keyword1"><span class="command">have</span></span> th0 <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span><span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> 
      <span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">⟹</span><span class="main">∃</span><span class="bound"><span class="bound">u1</span></span><span class="main">≤</span><span class="skolem">u</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">s1</span></span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">.</span> <span class="bound">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th1pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> a <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yu1</span></span> <span class="skolem"><span class="skolem">ys1</span></span>  <span class="keyword2"><span class="keyword">where</span></span> th1pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> 
      <span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">∧</span>length <span class="skolem">t1</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟹</span><span class="skolem">yu1</span><span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span><span class="skolem">ys1</span><span class="main">&lt;</span>tl <span class="skolem">s</span><span class="main">∧</span><span class="skolem">ys1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t1</span><span class="main">,</span> <span class="skolem">yu1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def append_eq_Cons_conv<span class="main">)</span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc b c length_Cons lessI list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> th1pre<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> th1pre1 <span class="keyword1"><span class="command">have</span></span> th1pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">ys1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t1</span><span class="main">,</span> <span class="skolem">yu1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟹</span>
      <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">ys1</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span>tl <span class="skolem">t1</span><span class="main">,</span> <span class="skolem">yu1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> addNonSync doubleReverse rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rev_rev_ident<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> th1pre th1pre1  b c <span class="keyword1"><span class="command">have</span></span> th1pre3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> 
      <span class="skolem">t1</span><span class="main">&lt;</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">∧</span>length <span class="skolem">t1</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟹</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">ys1</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span>tl <span class="skolem">t1</span><span class="main">,</span> <span class="skolem">yu1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">ys1</span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">∧</span><span class="skolem">yu1</span><span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span><span class="skolem">a</span><span class="main">#</span>tl <span class="skolem">t1</span>"</span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def <span class="main">)</span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons list.exhaust_sel list.inject list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> th1pre2<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> th1preEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">∧</span>length <span class="skolem">t1</span><span class="main">=</span><span class="main">0</span>
      <span class="main">⟹</span><span class="main">[]</span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">∧</span><span class="main">[]</span><span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span> <span class="main">[]</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def<span class="main">)</span> 
        <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> c <span class="keyword1"><span class="command">have</span></span> th1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">⟹</span>
      <span class="main">∃</span><span class="bound"><span class="bound">u1</span></span><span class="main">≤</span><span class="skolem">u</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">s1</span></span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">.</span> <span class="bound">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>   <span class="keyword1"><span class="command">using</span></span> th1pre3 th1preEmpty <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th2pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> a  th2pre <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yu2</span></span> <span class="skolem"><span class="skolem">ys2</span></span>  <span class="keyword2"><span class="keyword">where</span></span> th2pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">∧</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> 
      <span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">∧</span>length <span class="skolem">t1</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟹</span><span class="skolem">yu2</span><span class="main">≤</span><span class="skolem">lista</span><span class="main">∧</span><span class="skolem">ys2</span><span class="main">&lt;</span>tl <span class="skolem">s</span><span class="main">∧</span><span class="skolem">ys2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">yu2</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def<span class="main">)</span>   
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_Suc_right b c length_Cons lessI<span class="main">)</span>    
      <span class="keyword1"><span class="command">from</span></span> th2pre1 <span class="keyword1"><span class="command">have</span></span> th2pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">ys2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">yu2</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟹</span>
      <span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">ys2</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">yu2</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> addNonSync doubleReverse rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rev_rev_ident<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> th2pre th2pre1  b c <span class="keyword1"><span class="command">have</span></span> th2pre3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> 
      <span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">∧</span>length <span class="skolem">t1</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟹</span><span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">ys2</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">yu2</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">ys2</span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">yu2</span><span class="main">≤</span><span class="skolem">u</span>"</span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def <span class="main">)</span>  <span class="keyword1"><span class="command">using</span></span> th2pre2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> th2preEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">∧</span>length <span class="skolem">t1</span><span class="main">=</span><span class="main">0</span>
      <span class="main">⟹</span><span class="main">[]</span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">∧</span><span class="main">[]</span><span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span> <span class="main">[]</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def<span class="main">)</span> 
        <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> th2pre3 b c <span class="keyword1"><span class="command">have</span></span> th2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">⟹</span>
      <span class="main">∃</span><span class="bound"><span class="bound">u1</span></span><span class="main">≤</span><span class="skolem">u</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">s1</span></span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">.</span> <span class="bound">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> th2preEmpty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> b c <span class="keyword1"><span class="command">have</span></span> th3pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">s</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∨</span><span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">s</span><span class="main">=</span><span class="skolem">a</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> a c b th3pre <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yu3</span></span> <span class="skolem"><span class="skolem">ys3</span></span>  <span class="keyword2"><span class="keyword">where</span></span> th3pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">∧</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> 
      <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">∧</span>length <span class="skolem">t1</span><span class="main">&gt;</span><span class="main">0</span><span class="main">∧</span><span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">⟶</span>
      <span class="skolem">yu3</span><span class="main">≤</span><span class="skolem">lista</span><span class="main">∧</span><span class="skolem">ys3</span><span class="main">&lt;</span>tl <span class="skolem">s</span><span class="main">∧</span><span class="skolem">ys3</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span><span class="skolem">yu3</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_list_def less_list_def<span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_Suc length_Cons lessI<span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> adsmallPrefix<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">&lt;</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">∧</span>length <span class="skolem">t1</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟹</span>tl <span class="skolem">t1</span><span class="main">&lt;</span><span class="skolem">list</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> less_tail <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">from</span></span> a b c th3pre adsmallPrefix <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yu30</span></span> <span class="skolem"><span class="skolem">ys30</span></span>   <span class="keyword2"><span class="keyword">where</span></span> th3pre12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span>
      <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">s</span><span class="main">=</span><span class="skolem">a</span><span class="main">∧</span>tl <span class="skolem">t1</span><span class="main">&lt;</span> <span class="skolem">list</span><span class="main">⟶</span><span class="skolem">yu30</span><span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span><span class="skolem">ys30</span><span class="main">&lt;</span>tl <span class="skolem">s</span><span class="main">∧</span>
      <span class="skolem">ys30</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t1</span><span class="main">,</span> <span class="skolem">yu30</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def<span class="main">)</span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_Suc_right length_Cons lessI<span class="main">)</span>  
      <span class="keyword1"><span class="command">have</span></span> th3pre1more1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yu3</span><span class="main">≤</span><span class="skolem">lista</span> <span class="main">⟹</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">yu3</span><span class="main">≤</span><span class="skolem">u</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> c  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_less less_cons<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> th3pre1more2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">∧</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">s</span><span class="main">=</span><span class="skolem">aa</span><span class="main">∧</span><span class="skolem">ys3</span><span class="main">&lt;</span>tl <span class="skolem">s</span> <span class="main">⟹</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">ys3</span><span class="main">&lt;</span><span class="skolem">s</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> c 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_cons list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nil_less<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  th3pre1more21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">∧</span><span class="skolem">a</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">ys3</span><span class="main">&lt;</span>tl <span class="skolem">s</span><span class="main">∧</span><span class="skolem">ys3</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">yu3</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
      hd <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">⟶</span><span class="main">(</span><span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">ys3</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">aa</span> <span class="main">#</span> <span class="skolem">yu3</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> addNonSync doubleReverse rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rev_rev_ident<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> th3pre1more1 th3pre1more2 th3pre1more21 th3pre1 <span class="keyword1"><span class="command">have</span></span> th3pre1more3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">∧</span>
      <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">∧</span>length <span class="skolem">t1</span><span class="main">&gt;</span><span class="main">0</span><span class="main">∧</span><span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> 
      <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">s</span><span class="main">=</span><span class="skolem">aa</span><span class="main">⟶</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">yu3</span><span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">ys3</span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">∧</span><span class="main">(</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">ys3</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">yu3</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>     
      <span class="keyword1"><span class="command">have</span></span> th3pre1more32<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">∧</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">s</span><span class="main">=</span><span class="skolem">a</span><span class="main">∧</span><span class="skolem">ys30</span><span class="main">&lt;</span>tl <span class="skolem">s</span> <span class="main">⟹</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">ys30</span><span class="main">&lt;</span><span class="skolem">s</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> c 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_cons list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nil_less<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span>  th3pre1more213<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">∧</span><span class="skolem">a</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">ys30</span><span class="main">&lt;</span>tl <span class="skolem">s</span><span class="main">∧</span><span class="skolem">ys30</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t1</span><span class="main">,</span> <span class="skolem">yu30</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
      hd <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">∧</span><span class="skolem">t1</span><span class="main">&lt;</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span><span class="main">⟶</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ys30</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span>tl <span class="skolem">t1</span><span class="main">,</span> <span class="skolem">yu30</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> addNonSync doubleReverse rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> rev_rev_ident<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span>  th3pre1more32 th3pre12 th3pre1more213 <span class="keyword1"><span class="command">have</span></span> th3pre1more33<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">∧</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> 
      <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">∧</span>length <span class="skolem">t1</span><span class="main">&gt;</span><span class="main">0</span><span class="main">∧</span><span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">list</span><span class="main">,</span><span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span>
      hd <span class="skolem">s</span><span class="main">=</span><span class="skolem">a</span><span class="main">⟶</span><span class="skolem">yu30</span><span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">ys30</span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">∧</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">ys30</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">yu30</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> adsmallPrefix c hd_append2 le_list_def length_greater_0_conv list.exhaust_sel 
        list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> order.strict_implies_order<span class="main">)</span>  
      <span class="keyword1"><span class="command">from</span></span> th3pre1more3 th3pre1more33 b c th3pre  <span class="keyword1"><span class="command">have</span></span> th3NoEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> 
      <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">∧</span>length <span class="skolem">t1</span><span class="main">&gt;</span><span class="main">0</span><span class="main">⟹</span><span class="main">∃</span><span class="bound"><span class="bound">u1</span></span><span class="main">≤</span><span class="skolem">u</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">s1</span></span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">.</span> <span class="bound">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def<span class="main">)</span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>   
      <span class="keyword1"><span class="command">have</span></span> th3preEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">&lt;</span> <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">∧</span>length <span class="skolem">t1</span><span class="main">=</span><span class="main">0</span>
      <span class="main">⟹</span><span class="main">[]</span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">∧</span><span class="main">[]</span><span class="main">≤</span><span class="skolem">u</span><span class="main">∧</span> <span class="main">[]</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def less_list_def<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
      <span class="keyword1"><span class="command">from</span></span> th3NoEmpty th3preEmpty <span class="keyword1"><span class="command">have</span></span> th3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">∉</span><span class="free">A</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span><span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">&lt;</span> 
      <span class="skolem">a</span> <span class="main">#</span> <span class="skolem">list</span><span class="main">⟹</span><span class="main">∃</span><span class="bound"><span class="bound">u1</span></span><span class="main">≤</span><span class="skolem">u</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">s1</span></span><span class="main">&lt;</span><span class="skolem">s</span><span class="main">.</span> <span class="bound">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
      <span class="keyword3"><span class="command">show</span></span><span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
        <span class="keyword1"><span class="command">using</span></span> b c th0 th1 th2 th3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_sync2a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">r</span><span class="main">∈</span>min_elems<span class="main">(</span>D <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">⟹</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="free">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>
<span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∨</span> <span class="bound">t</span> <span class="main">∈</span> min_elems<span class="main">(</span>D <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">(</span>T <span class="free">P</span><span class="main">-</span><span class="main">(</span>D <span class="free">P</span><span class="main">-</span>min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> min_elems<span class="main">(</span>D <span class="main">(</span><span class="free">P</span>  <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> 
  T <span class="free">S</span> <span class="main">∨</span> <span class="bound">t</span> <span class="main">∈</span> min_elems<span class="main">(</span>D <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> <span class="main">(</span>T <span class="free">P</span><span class="main">-</span><span class="main">(</span>D <span class="free">P</span><span class="main">-</span>min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r1</span><span class="main">.</span> <span class="bound">r1</span><span class="main">≤</span><span class="skolem">r</span><span class="main">∧</span> <span class="bound">r1</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span><span class="bound">t</span> <span class="main">∉</span> min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∉</span> min_elems<span class="main">(</span>D <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> AA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">∈</span> D <span class="main">(</span><span class="free">P</span>  <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> elem_min_elems <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> AA <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">r1</span></span><span class="main">≤</span><span class="skolem">r</span><span class="main">.</span> <span class="bound">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>
    <span class="main">(</span><span class="skolem">t1</span><span class="main">∈</span>D <span class="free">P</span><span class="main">∨</span><span class="skolem">t1</span><span class="main">∈</span>D <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_sync<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> True A1 <span class="keyword1"><span class="command">have</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t1</span> <span class="main">∉</span> min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t1</span> <span class="main">∉</span> min_elems<span class="main">(</span>D <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A1 A2 min_elems5 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tm1</span></span> <span class="skolem"><span class="skolem">tm2</span></span> <span class="keyword2"><span class="keyword">where</span></span> tmA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t1</span><span class="main">∈</span>D <span class="free">P</span><span class="main">⟶</span><span class="main">(</span><span class="skolem">tm1</span><span class="main">≤</span><span class="skolem">t1</span><span class="main">∧</span><span class="skolem">tm1</span><span class="main">∈</span> min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>
    <span class="main">(</span><span class="skolem">t1</span><span class="main">∈</span>D <span class="free">S</span><span class="main">⟶</span><span class="main">(</span><span class="skolem">tm2</span><span class="main">≤</span><span class="skolem">t1</span><span class="main">∧</span><span class="skolem">tm2</span><span class="main">∈</span> min_elems<span class="main">(</span>D <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">from</span></span> A2 tmA <span class="keyword1"><span class="command">have</span></span> AB1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t1</span><span class="main">∈</span>D <span class="free">P</span><span class="main">⟶</span><span class="skolem">tm1</span><span class="main">&lt;</span><span class="skolem">t1</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="skolem">t1</span><span class="main">∈</span>D <span class="free">S</span><span class="main">⟶</span><span class="skolem">tm2</span><span class="main">&lt;</span><span class="skolem">t1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> A1 order.not_eq_order_implies_strict<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> A1 AB1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">um1</span></span> <span class="skolem"><span class="skolem">rm1</span></span> <span class="skolem"><span class="skolem">um2</span></span> <span class="skolem"><span class="skolem">rm2</span></span> <span class="keyword2"><span class="keyword">where</span></span> AB2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">t1</span><span class="main">∈</span>D <span class="free">P</span><span class="main">⟶</span><span class="skolem">um1</span><span class="main">≤</span><span class="skolem">u1</span> <span class="main">∧</span> <span class="skolem">rm1</span> <span class="keyword1">setinterleaves</span> 
    <span class="main">(</span><span class="main">(</span><span class="skolem">tm1</span><span class="main">,</span> <span class="skolem">um1</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="skolem">t1</span><span class="main">∈</span>D <span class="free">S</span><span class="main">⟶</span><span class="skolem">um2</span><span class="main">≤</span><span class="skolem">u1</span> <span class="main">∧</span> <span class="skolem">rm2</span> <span class="keyword1">setinterleaves</span> 
    <span class="main">(</span><span class="main">(</span><span class="skolem">tm2</span><span class="main">,</span> <span class="skolem">um2</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> interPrefix<span class="main">)</span>     
    <span class="keyword1"><span class="command">from</span></span> A1 A2 True tmA AB1 <span class="keyword1"><span class="command">have</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t1</span><span class="main">∈</span>D <span class="free">P</span><span class="main">⟶</span><span class="skolem">rm1</span><span class="main">&lt;</span><span class="skolem">r</span><span class="main">∧</span><span class="skolem">rm1</span><span class="main">∈</span>D<span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span><span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="skolem">t1</span><span class="main">∈</span>D <span class="free">S</span><span class="main">⟶</span><span class="skolem">rm2</span><span class="main">&lt;</span><span class="skolem">r</span><span class="main">∧</span><span class="skolem">rm2</span><span class="main">∈</span> D<span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span><span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.strict_implies_order interPrefix order_trans<span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> A3 AA <span class="keyword1"><span class="command">have</span></span> ATrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∉</span> min_elems<span class="main">(</span>D <span class="main">(</span><span class="free">P</span>  <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> min_elems_def  
      <span class="keyword1"><span class="command">using</span></span> A1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
    <span class="keyword1"><span class="command">with</span></span> A ATrue <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> dsync<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">∈</span>D <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.A elem_min_elems<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> dsync <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">≤</span><span class="skolem">r</span><span class="main">∧</span> <span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t2</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>
    <span class="main">(</span><span class="main">(</span><span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">∧</span><span class="skolem">u2</span><span class="main">∈</span>T <span class="free">S</span><span class="main">)</span><span class="main">∨</span><span class="main">(</span><span class="skolem">t2</span><span class="main">∈</span>D <span class="free">S</span><span class="main">∧</span><span class="skolem">u2</span><span class="main">∈</span> T <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_sync<span class="main">)</span>  
      <span class="keyword1"><span class="command">using</span></span> le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> C <span class="keyword1"><span class="command">have</span></span> r1D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">∈</span>D <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_sync<span class="main">)</span>  
      <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A C r1D <span class="keyword1"><span class="command">have</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">=</span><span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_elems_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> le_neq_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> A False <span class="keyword1"><span class="command">have</span></span> minAa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">P</span><span class="main">∧</span><span class="skolem">u2</span><span class="main">∈</span>T <span class="free">S</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span><span class="skolem">t2</span> <span class="main">∈</span> min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∧</span><span class="skolem">u2</span><span class="main">∈</span>T <span class="free">S</span><span class="main">∧</span> <span class="skolem">t2</span> <span class="main">∉</span> min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t3</span></span> <span class="keyword2"><span class="keyword">where</span></span> inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t3</span><span class="main">&lt;</span><span class="skolem">t2</span><span class="main">∧</span><span class="skolem">t3</span><span class="main">∈</span>min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_imp_less_or_eq min_elems5<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> inA <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r3</span></span> <span class="skolem"><span class="skolem">u3</span></span> <span class="keyword2"><span class="keyword">where</span></span> inA1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u3</span><span class="main">≤</span><span class="skolem">u2</span><span class="main">∧</span><span class="skolem">r3</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="skolem">t3</span><span class="main">,</span><span class="skolem">u3</span><span class="main">)</span><span class="main">,</span>insert tick<span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="skolem">r3</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> C eq interPrefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">from</span></span> inA1 <span class="keyword1"><span class="command">have</span></span> inA3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u3</span><span class="main">∈</span>T <span class="free">S</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> True is_processT3_ST_pref <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> inA1 <span class="keyword1"><span class="command">have</span></span> inA2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r3</span><span class="main">∈</span>D <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_sync<span class="main">)</span>  
        <span class="keyword1"><span class="command">using</span></span> elem_min_elems front_tickFree_Nil inA inA3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">with</span></span> A eq inA1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_elems_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> A False <span class="keyword1"><span class="command">have</span></span> minAb1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">S</span><span class="main">∧</span><span class="skolem">u2</span><span class="main">∈</span> T <span class="free">P</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span><span class="skolem">t2</span> <span class="main">∈</span> min_elems<span class="main">(</span>D <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span><span class="skolem">u2</span><span class="main">∈</span>T <span class="free">P</span><span class="main">∧</span> <span class="skolem">t2</span> <span class="main">∉</span> min_elems<span class="main">(</span>D <span class="free">S</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t3</span></span> <span class="skolem"><span class="skolem">r3</span></span> <span class="skolem"><span class="skolem">u3</span></span> <span class="keyword2"><span class="keyword">where</span></span> inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t3</span><span class="main">&lt;</span><span class="skolem">t2</span><span class="main">∧</span><span class="skolem">t3</span><span class="main">∈</span>min_elems<span class="main">(</span>D <span class="free">S</span><span class="main">)</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> inA1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u3</span><span class="main">≤</span><span class="skolem">u2</span><span class="main">∧</span><span class="skolem">r3</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t3</span><span class="main">,</span> <span class="skolem">u3</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="skolem">r3</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C eq interPrefix le_less min_elems5<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> inA1 <span class="keyword1"><span class="command">have</span></span> inA3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u3</span><span class="main">∈</span>T <span class="free">P</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> True is_processT3_ST_pref <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> inA1 <span class="keyword1"><span class="command">have</span></span> inA2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r3</span><span class="main">∈</span>D <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_sync<span class="main">)</span>  
        <span class="keyword1"><span class="command">using</span></span> elem_min_elems front_tickFree_Nil inA inA3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">with</span></span> A eq inA1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_elems_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">from</span></span> A False <span class="keyword1"><span class="command">have</span></span> minAb2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">S</span><span class="main">∧</span><span class="skolem">u2</span><span class="main">∈</span> T <span class="free">P</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span><span class="skolem">u2</span> <span class="main">∈</span> <span class="main">(</span>T <span class="free">P</span><span class="main">-</span><span class="main">(</span>D <span class="free">P</span><span class="main">-</span>min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span><span class="skolem">u2</span><span class="main">∈</span>T <span class="free">P</span><span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span><span class="main">(</span>D <span class="free">P</span><span class="main">-</span>min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> inAAA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u2</span><span class="main">∈</span>D <span class="free">P</span><span class="main">∧</span><span class="skolem">u2</span><span class="main">∉</span>min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> inAAA <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u3</span></span>  <span class="keyword2"><span class="keyword">where</span></span> inA<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u3</span><span class="main">&lt;</span><span class="skolem">u2</span><span class="main">∧</span><span class="skolem">u3</span><span class="main">∈</span>min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_neq_trans min_elems5<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> inA <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t3</span></span> <span class="skolem"><span class="skolem">r3</span></span> <span class="keyword2"><span class="keyword">where</span></span> inA1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t3</span><span class="main">≤</span><span class="skolem">t2</span><span class="main">∧</span><span class="skolem">r3</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="skolem">t3</span><span class="main">,</span><span class="skolem">u3</span><span class="main">)</span><span class="main">,</span>insert tick<span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="skolem">r3</span><span class="main">&lt;</span><span class="skolem">r</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> C Sync.sym eq interPrefix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> inA1 <span class="keyword1"><span class="command">have</span></span> inA3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u3</span><span class="main">∈</span>D <span class="free">P</span><span class="main">∧</span><span class="skolem">t3</span><span class="main">∈</span>T <span class="free">S</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> D_T True elem_min_elems inA is_processT3_ST_pref <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">from</span></span> inA1 <span class="keyword1"><span class="command">have</span></span> inA2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r3</span><span class="main">∈</span>D <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_sync<span class="main">)</span>  
        <span class="keyword1"><span class="command">using</span></span> Sync.sym front_tickFree_Nil inA3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
      <span class="keyword1"><span class="command">with</span></span> A inA1 inA2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> min_elems_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">with</span></span> A C <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>   
      <span class="keyword1"><span class="command">using</span></span> eq minAa minAb1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> mono_Sync_D3<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> ordered<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"min_elems <span class="main">(</span>D <span class="main">(</span><span class="free">P</span>  <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> T <span class="main">(</span><span class="free">Q</span>  <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> mono_sync2b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span><span class="main">∀</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> min_elems<span class="main">(</span>D <span class="main">(</span><span class="free">P</span>  <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span><span class="bound">r</span><span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span>  <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> impI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_sync2a<span class="main">)</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> min_elems <span class="main">(</span>D <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">from</span></span> B <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="skolem">t</span> <span class="main">∈</span> min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="skolem">u</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∨</span> <span class="skolem">t</span> <span class="main">∈</span> min_elems<span class="main">(</span>D <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">∈</span> <span class="main">(</span>T <span class="free">P</span><span class="main">-</span><span class="main">(</span>D <span class="free">P</span><span class="main">-</span>min_elems<span class="main">(</span>D <span class="free">P</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mono_sync2a
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> E <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">∈</span>T <span class="free">Q</span><span class="main">∧</span><span class="skolem">u</span><span class="main">∈</span>T <span class="free">S</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="skolem">t</span><span class="main">∈</span> T <span class="free">S</span><span class="main">∧</span><span class="skolem">u</span><span class="main">∈</span>T <span class="free">Q</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> le_approx2T le_approx3 ordered <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>     
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> E Sync.sym T_sync UnCI Un_commute insert_is_Un mem_Collect_eq<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> ordered<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> mono_sync2b<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> mono_D_syn<span class="main">:</span> <span class="quoted"><span class="quoted">"D <span class="main">(</span><span class="free">S</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> D <span class="main">(</span><span class="free">Q</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_sync<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_T_syn<span class="main">:</span> <span class="quoted"><span class="quoted">"T <span class="main">(</span><span class="free">S</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> T <span class="main">(</span><span class="free">Q</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> T_sync<span class="main">)</span>  
  <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
   

<span class="keyword1"><span class="command">lemma</span></span> mono_F_syn<span class="main">:</span> <span class="quoted"><span class="quoted">"F <span class="main">(</span><span class="free">S</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span>  <span class="main">=</span> F <span class="main">(</span><span class="free">Q</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>  
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_sync<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_sync<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Ra_syn<span class="main">:</span> <span class="quoted"><span class="quoted">"Ra <span class="main">(</span><span class="free">S</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> Ra <span class="main">(</span><span class="free">Q</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Ra_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mono_F_syn<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Sync<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>     <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_approx_def mono_Sync_D1 mono_Sync_D2 mono_Sync_D3<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Sync_sym <span class="main">[</span><span class="operator">simp</span><span class="main">]</span>    <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">S</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Process_eq_spec mono_D_syn mono_F_syn mono_Sync<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> chain_Sync1<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> chain <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span>  <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_def<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> chain_Sync2<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> chain <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">S</span>  <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chain_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> empty_setinterleaving <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">u</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="free">u</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> inters_fin_fund<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"length <span class="free">s</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> 
  <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span> <span class="bound">list</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="bound">a</span><span class="main">#</span><span class="bound">list</span>  <span class="main">∧</span> <span class="bound">a</span> <span class="main">∉</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">=</span> <span class="main">[]</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
  <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span> <span class="bound">list</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="bound">a</span><span class="main">#</span><span class="bound">list</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∉</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">[]</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> 
  <span class="main">(</span><span class="main">∃</span> <span class="bound">a</span> <span class="bound">list</span> <span class="bound">aa</span> <span class="bound">lista</span><span class="main">.</span> <span class="bound">u</span> <span class="main">=</span> <span class="bound">a</span><span class="main">#</span><span class="bound">list</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">=</span> <span class="bound">aa</span><span class="main">#</span><span class="bound">lista</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="var">?B</span> <span class="main">∪</span> <span class="var">?C</span> <span class="main">∪</span> <span class="var">?D</span>"</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> neq_Nil_conv<span class="main">)</span>   
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Sync.si_empty2 Sync.sym empty_iff list.exhaust_sel<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> list.exhaust_sel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym emptyLeftNonSync list.exhaust_sel list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>    
      <span class="keyword1"><span class="command">using</span></span> list.exhaust_sel <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> emptyLeftNonSync list.exhaust_sel list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sync.si_empty2 Sync.sym empty_iff list.exhaust_sel<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="main">{</span> <span class="main">(</span><span class="main">(</span>hd <span class="skolem">s</span><span class="main">#</span><span class="bound">list</span><span class="main">)</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">|</span> <span class="bound">list</span><span class="main">.</span> <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">list</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>hd <span class="skolem">s</span><span class="main">)</span> <span class="main">∉</span> <span class="free">A</span><span class="main">}</span>"</span></span> 
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B</span>  <span class="main">⊆</span> <span class="var">?B1</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="main">(</span><span class="bound">u</span><span class="main">::</span><span class="tfree">'a</span> event list<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span> event<span class="main">)</span><span class="main">#</span><span class="bound">t</span><span class="main">,</span> <span class="main">(</span><span class="main">[]</span><span class="main">::</span><span class="tfree">'a</span> event list<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?B1</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span>hd <span class="skolem">s</span> <span class="main">#</span> <span class="bound">list</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span> <span class="main">|</span><span class="bound">list</span><span class="main">.</span> tl <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">list</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span> "</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?B1</span>  <span class="main">⊆</span> <span class="var">?B2</span>"</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> a1 a3 <span class="keyword1"><span class="command">have</span></span> a13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?B</span> <span class="main">⊆</span> <span class="var">?B2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> AA<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="var">?B</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> not_finite_existsD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"finite<span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">.</span><span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="keyword1"><span class="command">using</span></span> 1<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>hd <span class="skolem">s</span><span class="main">#</span><span class="bound">list</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">|</span><span class="bound">list</span><span class="main">.</span> tl <span class="skolem">s</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="bound">list</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">,</span><span class="free">A</span><span class="main">)</span><span class="main">}</span><span class="main">⊆</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span><span class="skolem">f</span><span class="main">(</span>hd <span class="skolem">s</span><span class="main">)</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span><span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> 
    tl <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?B2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_imageI <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>hd <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> aa<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> rev_finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a13 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rev_finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">⊆</span> <span class="main">{</span> <span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">(</span>hd <span class="skolem">s</span><span class="main">#</span><span class="bound">list</span><span class="main">)</span><span class="main">)</span><span class="main">|</span> <span class="bound">list</span><span class="main">.</span> <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="bound">list</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>hd <span class="skolem">s</span><span class="main">)</span> <span class="main">∉</span> <span class="free">A</span><span class="main">}</span>"</span></span> 
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span>  <span class="main">⊆</span> <span class="var">?C1</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">::</span><span class="tfree">'a</span> event list<span class="main">)</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">::</span><span class="tfree">'a</span> event list<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span> event<span class="main">)</span><span class="main">#</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?C1</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span>hd <span class="skolem">s</span> <span class="main">#</span> <span class="bound">list</span><span class="main">)</span> <span class="main">|</span><span class="bound">list</span><span class="main">.</span> tl <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="bound">list</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span> "</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C1</span>  <span class="main">⊆</span> <span class="var">?C2</span>"</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> a1 a3 <span class="keyword1"><span class="command">have</span></span> a13<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">⊆</span> <span class="var">?C2</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> AAA<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="var">?C</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> not_finite_existsD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">.</span><span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span><span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="keyword1"><span class="command">using</span></span> 1<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span>"</span></span><span class="main">]</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> hd <span class="skolem">s</span> <span class="main">#</span> <span class="bound">list</span><span class="main">)</span> <span class="main">|</span><span class="bound">list</span><span class="main">.</span> tl <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="bound">list</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> 
    <span class="skolem">f</span> <span class="main">(</span>hd <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> tl <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?C2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_imageI <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>tl <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>hd <span class="skolem">s</span><span class="main">)</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> aa<span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> rev_finite_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a13 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rev_finite_subset<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> dd0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">#</span><span class="bound">l</span><span class="main">,</span> <span class="bound">aa</span><span class="main">#</span><span class="bound">la</span><span class="main">)</span><span class="main">|</span><span class="bound">a</span> <span class="bound">aa</span> <span class="bound">l</span> <span class="bound">la</span><span class="main">.</span> <span class="skolem">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span><span class="main">#</span><span class="bound">l</span><span class="main">,</span> <span class="bound">aa</span><span class="main">#</span><span class="bound">la</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">⊆</span> <span class="var">?D1</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> AAAA<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="var">?D</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span><span class="main">[]</span><span class="main">)</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> empty_setinterleaving <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> infinite_super <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> dd1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?D1</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="bound">l</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">|</span> <span class="bound">l</span> <span class="bound">u</span><span class="main">.</span> <span class="skolem">list</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span> 
                <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="skolem">a</span><span class="main">#</span><span class="bound">la</span><span class="main">)</span><span class="main">|</span> <span class="bound">t</span> <span class="bound">la</span><span class="main">.</span> <span class="skolem">list</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">la</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span> 
                <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="bound">l</span><span class="main">,</span> <span class="skolem">a</span><span class="main">#</span><span class="bound">la</span><span class="main">)</span><span class="main">|</span><span class="bound">l</span> <span class="bound">la</span><span class="main">.</span> <span class="skolem">list</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="bound">la</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D1</span> <span class="main">⊆</span> <span class="var">?D2</span> <span class="main">∪</span> <span class="var">?D3</span> <span class="main">∪</span> <span class="var">?D4</span>"</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">list</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">list</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="main">(</span><span class="bound">u</span><span class="main">::</span><span class="tfree">'a</span> event list<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">::</span><span class="tfree">'a</span> event<span class="main">)</span><span class="main">#</span> <span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D2</span> <span class="main">⊆</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">list</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> dd2<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="var">?D2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_imageI <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">list</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">f</span></span><span class="main">,</span> <span class="operator">OF</span> aa<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rev_finite_subset<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">::</span><span class="tfree">'a</span> event list<span class="main">)</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="main">(</span><span class="skolem">a</span><span class="main">::</span><span class="tfree">'a</span> event<span class="main">)</span><span class="main">#</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D3</span> <span class="main">⊆</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">list</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> dd3<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="var">?D3</span>"</span></span>       
      <span class="keyword1"><span class="command">using</span></span> finite_imageI <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">list</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">f</span></span><span class="main">,</span> <span class="operator">OF</span> aa<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rev_finite_subset<span class="main">)</span> 
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">::</span><span class="tfree">'a</span> event<span class="main">)</span><span class="main">#</span><span class="bound">t</span><span class="main">,</span><span class="main">(</span><span class="skolem">a</span><span class="main">::</span><span class="tfree">'a</span> event<span class="main">)</span><span class="main">#</span><span class="bound">u</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> Cons <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?D4</span> <span class="main">⊆</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">list</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> dd4<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="var">?D4</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> finite_imageI <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">list</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">f</span></span><span class="main">,</span> <span class="operator">OF</span> aa<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rev_finite_subset<span class="main">)</span>       
    <span class="keyword1"><span class="command">with</span></span> dd0 dd1 dd2 dd3 dd4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>    
  <span class="keyword1"><span class="command">from</span></span> A AA AAA AAAA <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_subset<span class="main">)</span>    
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> inters_fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite<span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> 
<span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">∧</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?A</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="var">?A</span><span class="main">⊆</span><span class="main">(</span><span class="main">⋃</span><span class="bound">r</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">a</span><span class="main">=</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">∧</span><span class="bound">r</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">,</span>insert tick<span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> 
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">r</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">r</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">r</span><span class="main">::</span><span class="tfree">'a</span> event list<span class="main">)</span><span class="main">.</span> finite <span class="main">(</span><span class="var">?P</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event list"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">::</span><span class="tfree">'a</span> event list<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="bound">u</span><span class="main">::</span><span class="tfree">'a</span> event list<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">,</span><span class="skolem">r</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">r</span> <span class="main">⊆</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">)</span><span class="main">}</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?P</span> <span class="skolem">r</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> inters_fin_fund<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="quoted">"insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">]</span> finite_imageI<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> 
      <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> rev_finite_subset<span class="main">)</span>   
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t2</span><span class="main">.</span> <span class="free">x</span> <span class="main">=</span> <span class="bound">t</span> <span class="main">@</span> <span class="bound">t2</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ra</span><span class="main">.</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">ra</span> <span class="main">=</span> <span class="free">x</span><span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">≤</span> <span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prefixes_fin<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">x</span></span><span class="main">,</span> <span class="operator">simplified</span> Let_def<span class="main">,</span> <span class="operator">THEN</span> conjunct1<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_list_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">with</span></span> a b <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_UN_I infinite_super<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>  

 
<span class="keyword1"><span class="command">lemma</span></span> limproc_Sync_D<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span><span class="main">⟹</span>D<span class="main">(</span>lim_proc<span class="main">(</span>range <span class="free">Y</span><span class="main">)</span><span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span><span class="main">=</span>D<span class="main">(</span>lim_proc<span class="main">(</span>range<span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Process_eq_spec  F_sync D_sync T_sync F_LUB D_LUB T_LUB chain_Sync1<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
    <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">xa</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> 
    <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">xa</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∨</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">xa</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> 
    <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∨</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
            <span class="main">(</span><span class="bound">r</span><span class="main">≤</span><span class="skolem">x</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span> 
      <span class="keyword3"><span class="command">case</span></span> True 
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tryunion</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ctryy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tryunion</span><span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> 
      <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span><span class="main">(</span><span class="skolem">x</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">∧</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> Ctryy inters_fin <span class="keyword1"><span class="command">have</span></span> tolfin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">tryunion</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tryunion1</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ctryy1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tryunion1</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">∈</span><span class="skolem">tryunion</span><span class="main">.</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span><span class="main">∈</span>T <span class="free">S</span> <span class="main">∨</span> <span class="bound">t</span> <span class="main">∈</span> 
      D <span class="free">S</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> B Ctryy1 Ctryy <span class="keyword1"><span class="command">have</span></span> Ctryy3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span><span class="main">∈</span><span class="skolem">tryunion1</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
      <span class="keyword1"><span class="command">from</span></span> Ctryy3 <span class="keyword1"><span class="command">have</span></span> Ctryy2<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="skolem">tryunion1</span>"</span></span>   
        <span class="keyword1"><span class="command">using</span></span> finite_nat_set_iff_bounded <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">from</span></span> Ctryy2 Ctryy1 tolfin <span class="keyword3"><span class="command">obtain</span></span>  <span class="skolem"><span class="skolem">r2</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ee<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t2</span><span class="main">,</span><span class="skolem">u2</span><span class="main">,</span> <span class="skolem">r2</span><span class="main">)</span><span class="main">∈</span><span class="skolem">tryunion</span> <span class="main">∧</span>  
      infinite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">t2</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∨</span> <span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> True Ee  Ctryy <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ee1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">t2</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">x1</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">u2</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> 
      <span class="main">(</span><span class="skolem">u2</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="skolem">x2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>       
      <span class="keyword1"><span class="command">from</span></span> Ee Ee1 Ctryy <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x3</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ee2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">≤</span><span class="skolem">x3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">x2</span><span class="main">≤</span><span class="skolem">x3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t2</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">x3</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∨</span> 
      <span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="skolem">x3</span><span class="main">)</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_nat_iff_unbounded_le<span class="main">)</span>  
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t2</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r2</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">∧</span> 
        front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="skolem">r2</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">t2</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∨</span> 
        <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x3</span><span class="main">.</span> <span class="skolem">x1</span> <span class="main">≤</span> <span class="bound">x3</span> <span class="main">∧</span> <span class="skolem">x2</span> <span class="main">≤</span> <span class="bound">x3</span><span class="main">∧</span><span class="main">(</span><span class="skolem">t2</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x3</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∨</span> <span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x3</span><span class="main">)</span><span class="main">)</span> 
        <span class="main">⟹</span> <span class="skolem">thesis</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nn</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">v1</span></span><span class="main">≥</span><span class="bound">x0</span><span class="main">.</span> <span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">v1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">(</span><span class="bound">x0</span> <span class="main">≤</span> <span class="skolem">nn</span> <span class="bound">x0</span> <span class="main">∧</span> <span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="main">(</span><span class="skolem">nn</span> <span class="bound">x0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nna</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x0</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">v1</span></span><span class="main">≥</span><span class="bound">x0</span><span class="main">.</span> <span class="skolem">t2</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">v1</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="free">S</span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">(</span><span class="bound">x0</span> <span class="main">≤</span> <span class="skolem">nna</span> <span class="bound">x0</span> <span class="main">∧</span> <span class="skolem">t2</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="main">(</span><span class="skolem">nna</span> <span class="bound">x0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="free">S</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">moura</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">nna</span> <span class="bound">n</span> <span class="main">∧</span> <span class="skolem">t2</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="main">(</span><span class="skolem">nna</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">nn</span> <span class="bound">n</span> <span class="main">∧</span> <span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">S</span> 
        <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="main">(</span><span class="skolem">nn</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> f3 a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">nn</span> <span class="bound">n</span> <span class="main">∨</span> <span class="skolem">t2</span> <span class="main">∉</span> D <span class="free">S</span> <span class="main">∨</span> <span class="skolem">u2</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="main">(</span><span class="skolem">nn</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">x1</span><span class="main">.</span> <span class="skolem">x2</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t2</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> 
        <span class="skolem">u2</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∨</span> <span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_cases order.trans<span class="main">)</span> 
        <span class="keyword1"><span class="command">moreover</span></span> 
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">nn</span> <span class="bound">n</span> <span class="main">∨</span> <span class="skolem">t2</span> <span class="main">∉</span> D <span class="free">S</span> <span class="main">∨</span> <span class="skolem">u2</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="main">(</span><span class="skolem">nn</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≤</span> <span class="skolem">nna</span> <span class="bound">n</span> <span class="main">∧</span> <span class="skolem">t2</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="main">(</span><span class="skolem">nna</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="free">S</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> f4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">x1</span><span class="main">.</span> <span class="skolem">x2</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t2</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∨</span> <span class="skolem">t2</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span> <span class="skolem">u2</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> le_cases order.trans<span class="main">)</span> 
        <span class="keyword1"><span class="command">}</span></span> 
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword1"><span class="command">have</span></span> Abb1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n1</span> <span class="bound">n2</span><span class="main">.</span> <span class="bound">n1</span><span class="main">≤</span><span class="bound">n2</span> <span class="main">⟶</span> <span class="free">Y</span> <span class="bound">n1</span> <span class="main">⊑</span> <span class="free">Y</span> <span class="bound">n2</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> po_class.chain_mono<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> A Abb1 <span class="keyword1"><span class="command">have</span></span> Abb2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n1</span> <span class="bound">n2</span><span class="main">.</span> <span class="bound">n1</span><span class="main">&gt;</span><span class="bound">n2</span><span class="main">∧</span><span class="free">t</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n2</span><span class="main">)</span><span class="main">⟶</span><span class="free">t</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> le_approx1 less_imp_le_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> A Abb1 <span class="keyword1"><span class="command">have</span></span> Abb3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n1</span> <span class="bound">n2</span><span class="main">.</span> <span class="bound">n1</span><span class="main">&gt;</span><span class="bound">n2</span><span class="main">∧</span><span class="free">t</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">n2</span><span class="main">)</span><span class="main">⟶</span><span class="free">t</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">n1</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> NT_ND le_approx2T less_imp_le_nat<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Abb2 Ee2 <span class="keyword1"><span class="command">have</span></span> Ab1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">x1</span><span class="main">)</span><span class="main">⟶</span><span class="skolem">t2</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">x3</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Abb1 le_approx1 less_imp_le_nat subsetCE<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Abb3 <span class="keyword1"><span class="command">have</span></span> Ab2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u2</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="skolem">x2</span><span class="main">)</span><span class="main">⟶</span><span class="skolem">u2</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="skolem">x3</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Abb1 Ee2 NT_ND le_approx2T less_imp_le_nat<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> True Ee Ee1  Ee2 Ab1 Ab2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">case</span></span> False 
      <span class="keyword1"><span class="command">from</span></span> A B False <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> Bb1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
      <span class="skolem">r</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∨</span> <span class="skolem">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>   
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> B <span class="keyword1"><span class="command">have</span></span> Bb21<span class="main">:</span> <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">x</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree append_Nil2 front_tickFree_append ftf_syn is_processT2_TR<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> B Bb1 <span class="keyword1"><span class="command">have</span></span> Bb2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">.</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="skolem">r</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r</span> <span class="main">@</span> <span class="bound">v</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Bb21 front_tickFree_Nil front_tickFree_mono le_list_def<span class="main">)</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
        <span class="keyword1"><span class="command">using</span></span> Bb1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">qed</span></span>  
   

<span class="keyword1"><span class="command">lemma</span></span> limproc_Sync_F_annex1<span class="main">:</span> <span class="quoted"><span class="quoted">" chain <span class="free">Y</span><span class="main">⟹</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span> <span class="main">⟹</span>
<span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span> <span class="main">∧</span> <span class="free">a</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>
<span class="main">∧</span> <span class="free">b</span> <span class="main">=</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> 
        insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
    <span class="keyword1"><span class="command">from</span></span> B C <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="keyword2"><span class="keyword">where</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">x1</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> B D <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">X1</span></span> <span class="skolem"><span class="skolem">Y1</span></span> <span class="keyword2"><span class="keyword">where</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>
    <span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">X1</span><span class="main">)</span><span class="main">∈</span>F <span class="main">(</span><span class="free">Y</span> <span class="skolem">x1</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">Y1</span><span class="main">)</span><span class="main">∈</span>F <span class="free">S</span><span class="main">∧</span><span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">X1</span> <span class="main">∪</span> <span class="skolem">Y1</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">X1</span> <span class="main">∩</span> <span class="skolem">Y1</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_sync F_sync<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> B D E <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">t1</span><span class="main">∈</span>T<span class="main">(</span><span class="free">Y</span> <span class="skolem">x1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_sync<span class="main">)</span>  
      <span class="keyword1"><span class="command">using</span></span> F_T front_tickFree_Nil <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_T<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> F <span class="keyword1"><span class="command">have</span></span> ee<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">X1</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">Y1</span><span class="main">)</span><span class="main">∈</span> F <span class="free">S</span><span class="main">∧</span> <span class="skolem">a</span> <span class="keyword1">setinterleaves</span> 
    <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">X1</span> <span class="main">∪</span> <span class="skolem">Y1</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">X1</span> <span class="main">∩</span> <span class="skolem">Y1</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> E chain_lemma is_processT8_S le_approx2 local.A <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">with</span></span> A B C D E F ee  <span class="keyword3"><span class="command">show</span></span><span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> limproc_Sync_F_annex2<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span><span class="main">⟹</span><span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
<span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="free">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">⟶</span> front_tickFree <span class="bound">v</span> <span class="main">⟶</span><span class="main">¬</span> tickFree <span class="bound">r</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> 
<span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⟹</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">a</span> <span class="main">∉</span> D<span class="main">(</span><span class="free">Y</span> <span class="bound">x</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> D_sync<span class="main">)</span> 
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
  <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">⟶</span>
  front_tickFree <span class="bound">v</span> <span class="main">⟶</span> <span class="main">¬</span> tickFree <span class="bound">r</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> 
  <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span><span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">⟶</span> 
  front_tickFree <span class="bound">v</span><span class="main">⟶</span><span class="main">¬</span> tickFree <span class="bound">r</span><span class="main">∧</span><span class="bound">v</span><span class="main">≠</span><span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
    <span class="keyword1"><span class="command">from</span></span> B <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">t</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="free">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="free">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⟹</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="free">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> D_T chain_lemma le_approx1 le_approx2T subsetCE<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tryunion</span></span> <span class="keyword2"><span class="keyword">where</span></span> Ctryy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tryunion</span><span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> 
    <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">∧</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Ctryy <span class="keyword1"><span class="command">have</span></span> tolfin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">tryunion</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> inters_fin <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> B <span class="keyword1"><span class="command">have</span></span> Abb1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n1</span> <span class="bound">n2</span><span class="main">.</span> <span class="bound">n1</span><span class="main">≤</span><span class="bound">n2</span> <span class="main">⟶</span> <span class="free">Y</span> <span class="bound">n1</span> <span class="main">⊑</span> <span class="free">Y</span> <span class="bound">n2</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> po_class.chain_mono<span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> A Abb1 <span class="keyword1"><span class="command">have</span></span> Abb2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n1</span> <span class="bound">n2</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">n1</span><span class="main">&gt;</span><span class="bound">n2</span><span class="main">∧</span><span class="bound">t</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n2</span><span class="main">)</span><span class="main">⟶</span><span class="bound">t</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n1</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> le_approx1 less_imp_le_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">from</span></span> A Abb1 <span class="keyword1"><span class="command">have</span></span> Abb3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n1</span> <span class="bound">n2</span> <span class="bound">t</span><span class="main">.</span> <span class="bound">n1</span><span class="main">&gt;</span><span class="bound">n2</span><span class="main">∧</span><span class="bound">t</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">n2</span><span class="main">)</span><span class="main">⟶</span><span class="bound">t</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">n1</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> NT_ND le_approx2T less_imp_le_nat<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Abb2 Abb3 <span class="keyword1"><span class="command">have</span></span> oneIndexPre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> B D_T ND_F_dir2' chain_lemma le_approx1 subsetCE<span class="main">)</span>  
    <span class="keyword1"><span class="command">from</span></span> A B oneIndexPre Abb2 Abb3  <span class="keyword1"><span class="command">have</span></span> oneIndex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> 
    <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">⟶</span>front_tickFree <span class="bound">v</span> <span class="main">⟶</span> <span class="main">¬</span> tickFree <span class="bound">r</span><span class="main">∧</span><span class="bound">v</span><span class="main">≠</span><span class="main">[]</span> <span class="main">∨</span>
    <span class="main">(</span> <span class="main">∃</span><span class="bound">x</span><span class="main">.</span><span class="main">(</span> <span class="main">(</span><span class="main">(</span> <span class="bound">t</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">proUnion1</span></span> <span class="keyword2"><span class="keyword">where</span></span> finiUnion<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">proUnion1</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">∈</span><span class="skolem">tryunion</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> 
    <span class="main">∧</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="bound">u</span><span class="main">∉</span>T <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">m</span><span class="main">)</span><span class="main">⟶</span><span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span><span class="main">⟶</span><span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span><span class="bound">n</span><span class="main">≤</span><span class="bound">m</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> B <span class="keyword1"><span class="command">have</span></span> finiSet1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">tryunion</span> <span class="main">⟹</span> finite <span class="main">{</span><span class="bound">n1</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n1</span><span class="main">)</span><span class="main">⟶</span><span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span><span class="main">∧</span> 
    <span class="main">(</span><span class="bound">t</span><span class="main">∈</span>D <span class="free">S</span><span class="main">⟶</span><span class="bound">u</span><span class="main">∉</span>T<span class="main">(</span><span class="free">Y</span> <span class="bound">n1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="main">∀</span><span class="bound">m1</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">m1</span><span class="main">)</span><span class="main">⟶</span><span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">m1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span><span class="bound">n1</span><span class="main">≤</span><span class="bound">m1</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>  
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> infinite_nat_iff_unbounded mem_Collect_eq not_less<span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> B tolfin finiUnion oneIndex finiSet1  <span class="keyword1"><span class="command">have</span></span> finiSet<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="skolem">proUnion1</span>"</span></span>  
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
   <span class="keyword1"><span class="command">from</span></span> finiSet <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">proMax</span></span> <span class="keyword2"><span class="keyword">where</span></span> ann<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">proMax</span><span class="main">=</span>Max<span class="main">(</span><span class="skolem">proUnion1</span><span class="main">)</span>"</span></span>  
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
   <span class="keyword1"><span class="command">from</span></span> ann Abb2 <span class="keyword1"><span class="command">have</span></span> ann1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">num</span><span class="main">∈</span><span class="skolem">proUnion1</span><span class="main">.</span> <span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">num</span><span class="main">)</span><span class="main">⟶</span><span class="bound">t</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">proMax</span><span class="main">)</span>"</span></span>  
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Abb1 Max_ge finiSet le_approx1 subsetCE<span class="main">)</span>    
   <span class="keyword1"><span class="command">from</span></span> ann Abb3 <span class="keyword1"><span class="command">have</span></span> ann2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">num</span><span class="main">∈</span><span class="skolem">proUnion1</span><span class="main">.</span>  <span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">num</span><span class="main">)</span><span class="main">⟶</span><span class="bound">t</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="skolem">proMax</span><span class="main">)</span>"</span></span>  
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Abb1 D_T Max_ge finiSet le_approx2T<span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> finiUnion <span class="keyword1"><span class="command">have</span></span> ann3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">num</span><span class="main">∈</span><span class="skolem">proUnion1</span><span class="main">.</span> <span class="main">∃</span><span class="bound">r</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span><span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> 
   <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">⟶</span>front_tickFree <span class="bound">v</span> <span class="main">⟶</span> <span class="main">¬</span> tickFree <span class="bound">r</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span><span class="main">(</span><span class="main">(</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">∉</span>D<span class="main">(</span><span class="free">Y</span> <span class="bound">num</span><span class="main">)</span><span class="main">)</span><span class="main">∨</span><span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> 
   <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">num</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">proUnion2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ann0<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">proUnion2</span> <span class="main">=</span><span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">.</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">∈</span><span class="skolem">tryunion</span><span class="main">∧</span>
   <span class="main">(</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">⟶</span><span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   <span class="keyword1"><span class="command">from</span></span> ann0 Ctryy finiUnion <span class="keyword1"><span class="command">have</span></span> ann1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span>  <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">∈</span> <span class="skolem">proUnion2</span><span class="main">⟹</span><span class="main">∃</span><span class="bound">num</span><span class="main">.</span> <span class="bound">num</span><span class="main">∈</span><span class="skolem">proUnion1</span><span class="main">∧</span>
   <span class="main">(</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">num</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">num</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>    
   <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span>
     <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">,</span> <span class="skolem">r</span><span class="main">)</span><span class="main">∈</span> <span class="skolem">proUnion2</span>"</span></span>
     <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> PP<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">num</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">num</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="skolem">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">num</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">num</span><span class="main">.</span> <span class="bound">num</span><span class="main">∈</span><span class="skolem">proUnion1</span><span class="main">∧</span> <span class="skolem">P</span> <span class="bound">num</span>"</span></span> 
     <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
       <span class="keyword1"><span class="command">from</span></span> finiUnion <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">minIndexRB</span></span> <span class="keyword2"><span class="keyword">where</span></span> ann1preB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">minIndexRB</span><span class="main">=</span><span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">P</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">from</span></span> B ann1preB <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">minmin</span></span> <span class="keyword2"><span class="keyword">where</span></span> ab<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">minmin</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> Inf <span class="main">(</span><span class="skolem">minIndexRB</span><span class="main">)</span>"</span></span> 
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">from</span></span> ann0 ann1preB PP <span class="keyword1"><span class="command">have</span></span> ann1preNoEmpty1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">minIndexRB</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">from</span></span> ab ann1preNoEmpty1 <span class="keyword1"><span class="command">have</span></span> ann1pre0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">minmin</span> <span class="main">∈</span> <span class="skolem">minIndexRB</span>"</span></span> 
         <span class="keyword1"><span class="command">using</span></span> Inf_nat_def wellorder_Least_lemma<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>        
       <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">minmin</span><span class="main">∈</span> <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">∈</span><span class="skolem">tryunion</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> 
       <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">m</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">≤</span> <span class="bound">m</span><span class="main">)</span><span class="main">}</span>"</span></span>  
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> CollectI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">intro</span> conjI<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> a ann0 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>          
           <span class="keyword1"><span class="command">using</span></span> PP ann1pre0 ann1preB <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
           <span class="keyword1"><span class="command">using</span></span> PP ann1pre0 ann1preB <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_nat_def PP ab ann1preB wellorder_Least_lemma<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
       <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
         <span class="keyword1"><span class="command">using</span></span> ann1pre0 ann1preB finiUnion <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">from</span></span> ann1 <span class="keyword1"><span class="command">have</span></span> ann12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span><span class="main">∃</span><span class="bound">num</span><span class="main">.</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">∈</span> <span class="skolem">proUnion2</span><span class="main">⟶</span> <span class="bound">num</span><span class="main">∈</span><span class="skolem">proUnion1</span><span class="main">∧</span>
   <span class="main">(</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">num</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">num</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> ann0 Ctryy <span class="keyword1"><span class="command">have</span></span> ann2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">proUnion2</span><span class="main">⟶</span><span class="main">(</span><span class="bound">r</span> <span class="keyword1">setinterleaves</span> 
   <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">∧</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> 
   <span class="main">(</span><span class="main">∃</span><span class="bound">nu1</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">nu1</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">nu1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
   <span class="keyword1"><span class="command">have</span></span> ann15<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">∧</span> 
   front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nu1</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">nu1</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> 
   <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">nu1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">proUnion2</span>"</span></span>  
     <span class="keyword1"><span class="command">using</span></span> Ctryy ann0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
   <span class="keyword1"><span class="command">from</span></span>  ann12 ann15 <span class="keyword1"><span class="command">have</span></span> ann01<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
   <span class="main">(</span><span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">∧</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">nu1</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">nu1</span><span class="main">)</span><span class="main">⟶</span><span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span><span class="main">∧</span> 
   <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">nu1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span><span class="main">∃</span><span class="bound">num</span><span class="main">∈</span><span class="skolem">proUnion1</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">num</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> 
   <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">num</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
   <span class="keyword1"><span class="command">from</span></span> ann01  <span class="keyword1"><span class="command">have</span></span> annhelp<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
   <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">⟶</span> front_tickFree <span class="bound">v</span> <span class="main">⟶</span><span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span> <span class="main">∃</span><span class="bound">num</span><span class="main">∈</span><span class="skolem">proUnion1</span><span class="main">.</span><span class="main">(</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">num</span><span class="main">)</span> 
   <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">num</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> oneIndex<span class="main">)</span>     
   <span class="keyword1"><span class="command">from</span></span> Abb1 Abb2 <span class="keyword1"><span class="command">have</span></span> annHelp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">nn</span> <span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="bound">nn</span><span class="main">∈</span><span class="skolem">proUnion1</span><span class="main">∧</span><span class="main">(</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">nn</span><span class="main">)</span><span class="main">⟶</span><span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> 
   <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">nn</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span><span class="main">(</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">proMax</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="skolem">proMax</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Abb3 Max_ge ann finiSet le_neq_trans<span class="main">)</span> 
   <span class="keyword1"><span class="command">from</span></span>  annHelp2 annhelp <span class="keyword1"><span class="command">have</span></span> annHelp1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> 
   <span class="main">⟶</span><span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">⟶</span> front_tickFree <span class="bound">v</span><span class="main">⟶</span><span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span><span class="main">⟶</span><span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="skolem">proMax</span><span class="main">)</span><span class="main">⟶</span><span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> 
   <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="skolem">proMax</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>       
   <span class="keyword1"><span class="command">with</span></span> A B  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
 <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> limproc_Sync_F<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span><span class="main">⟹</span>F<span class="main">(</span>lim_proc <span class="main">(</span>range <span class="free">Y</span><span class="main">)</span><span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span><span class="free">S</span><span class="main">)</span><span class="main">=</span>F<span class="main">(</span>lim_proc <span class="main">(</span>range <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec D_sync F_sync F_LUB D_LUB T_LUB chain_Sync1<span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>     
  <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="keyword1">setinterleaves</span> 
    <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span><span class="main">)</span><span class="main">)</span><span class="main">∨</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> 
    <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">S</span> <span class="main">∨</span> <span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">⟶</span> 
    front_tickFree <span class="bound">v</span> <span class="main">⟶</span><span class="main">¬</span> tickFree <span class="bound">r</span> <span class="main">∧</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="free">S</span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∉</span> T <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span><span class="main">∃</span><span class="bound">Y</span><span class="main">.</span> <span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">S</span> <span class="main">∧</span> <span class="skolem">a</span> <span class="keyword1">setinterleaves</span> 
    <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="bound">X</span> <span class="main">∩</span> <span class="bound">Y</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="skolem">a</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">m</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span><span class="main">)</span> 
      <span class="keyword3"><span class="command">case</span></span> True 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> D<span class="main">(</span><span class="free">Y</span> <span class="skolem">m</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> A1 <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span><span class="main">∈</span> F <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> F_sync<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> A1 B C  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>    
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> limproc_Sync_F_annex2<span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> limproc_Sync_F_annex1<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span>  <span class="skolem">a</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Y</span> <span class="bound">n</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> C E B <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> limproc_Sync_F_annex2<span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> 
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> cont_left_sync <span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">Y</span> <span class="bound">i</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec chain_Sync1 limproc_Sync_D limproc_Sync_F limproc_is_thelub<span class="main">)</span> 
  
<span class="keyword1"><span class="command">lemma</span></span> cont_right_sync <span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⨆</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="free">S</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Y</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Process_eq_spec cont_left_sync lub_eq mono_D_syn mono_F_syn<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Sync_cont<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"cont <span class="free">f</span>"</span></span> 
<span class="keyword2"><span class="keyword">and</span></span>     g<span class="main">:</span><span class="quoted"><span class="quoted">"cont <span class="free">g</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>     <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">have</span></span> A <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> cont <span class="free">g</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="main">(</span><span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> contI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> monofunI<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont_left_sync<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> B <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> cont <span class="free">g</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">y</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="improper">y</span>  <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> cont_compose<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> contI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> monofunI<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> cont_right_sync<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> f g  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span>  f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">f</span><span class="main">.</span> <span class="bound">f</span>  <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> cont_apply<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>contI2 <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>A B<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Mndet">
<div class="head">
<h1>Theory Mndet</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ******************************************************************** 
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">theory</span></span> Mndet
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Process.html">Process</a> <a href="Stop.html">Stop</a> <a href="Mprefix.html">Mprefix</a> <a href="Ndet.html">Ndet</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Multiple non deterministic operator›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
        <span class="entity">mndet</span>      <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="tfree">'α</span> set<span class="main">,</span> <span class="tfree">'α</span> <span class="main">⇒</span> <span class="tfree">'α</span> process<span class="main">]</span> <span class="main">⇒</span> <span class="tfree">'α</span> process"</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">mndet</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">=</span> <span class="main">{}</span> 
                             <span class="keyword1">then</span> STOP
                             <span class="keyword1">else</span> Abs_process<span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span>  F<span class="main">(</span><span class="bound">x</span> <span class="main">→</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span>
                                              <span class="main">⋃</span> <span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span>  D<span class="main">(</span><span class="bound">x</span> <span class="main">→</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">syntax</span></span>
  <span class="quoted">"_Mndet"</span>       <span class="main">::</span> <span class="quoted"><span class="quoted">"pttrn <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> process <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span>      <span class="main">(</span><span class="quoted">"<span class="keyword3">(3</span><span class="keyword1">⊓</span>_<span class="keyword1">∈</span>_ <span class="keyword1">→</span> <span class="keyword3">/ </span>_<span class="keyword3">)</span>"</span> <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 10<span class="main">]</span> 10<span class="main">)</span>

<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"<span class="main">⊓</span><span class="free">x</span><span class="main">∈</span><span class="free">A</span><span class="main">→</span> <span class="free">P</span>"</span> <span class="main">⇌</span> <span class="quoted">"<span class="keyword1">CONST</span> mndet <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="free">x</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span>"</span>

<span class="keyword1"><span class="command">lemma</span></span> mt_mndet<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"mndet <span class="main">{}</span> <span class="free">P</span> <span class="main">=</span> STOP"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mndet_def   <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> mndet_is_process <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> is_process <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> F<span class="main">(</span><span class="bound">x</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="main">⋃</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span>   D<span class="main">(</span><span class="bound">x</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> is_process_def FAILURES_def DIVERGENCES_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">using</span></span> is_processT1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_processT2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> is_processT3_SR <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> is_processT4 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">using</span></span> is_processT5_S1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> is_processT6 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> is_processT7 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> NF_ND <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">using</span></span> is_processT9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  

<span class="keyword1"><span class="command">lemma</span></span> T_mdet1 <span class="main">:</span> <span class="quoted"><span class="quoted">"T<span class="main">(</span>mndet <span class="main">{}</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">[]</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mndet_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> T_STOP<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> rep_abs_mndet<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
     <span class="main">(</span>Rep_process <span class="main">(</span>Abs_process<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> F <span class="main">(</span><span class="bound">x</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> D <span class="main">(</span><span class="bound">x</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> F <span class="main">(</span><span class="bound">x</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> D <span class="main">(</span><span class="bound">x</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Process.process.Abs_process_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mndet_is_process<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> T_mndet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">≠</span><span class="main">{}</span> <span class="main">⟹</span> T<span class="main">(</span>mndet <span class="free">A</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> T <span class="main">(</span><span class="bound">x</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mndet_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> T_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TRACES_def FAILURES_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mndet_is_process<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> TRACES_def FAILURES_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> F_T D_T <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Nil_elem_T<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> NF_NT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> F_mndet1 <span class="main">:</span> <span class="quoted"><span class="quoted">"F<span class="main">(</span>mndet <span class="main">{}</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[]</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mndet_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_STOP<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> F_mndet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">≠</span><span class="main">{}</span> <span class="main">⟹</span> F<span class="main">(</span>mndet <span class="free">A</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> F <span class="main">(</span><span class="bound">x</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mndet_def 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> F_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="main"><span class="main">:</span></span> FAILURES_def F_mndet1<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> D_mndet1 <span class="main">:</span> <span class="quoted"><span class="quoted">"D<span class="main">(</span>mndet <span class="main">{}</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mndet_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_STOP<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> D_mndet <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">≠</span><span class="main">{}</span> <span class="main">⟹</span> D<span class="main">(</span>mndet <span class="free">A</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> D <span class="main">(</span><span class="bound">x</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> mndet_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> D_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Process.process.Abs_process_inverse<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mndet_is_process<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> DIVERGENCES_def<span class="main">)</span>
  

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ Thus we know now, that mndet yields processes. Direct consequences are the following
  distributivities: ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mndet_unit <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊓</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span> <span class="free">a</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="main"><span class="main">:</span></span> Process.Process_eq_spec F_mndet D_mndet<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mndet_distrib <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span><span class="main">{}</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">≠</span><span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⊓</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">∪</span><span class="free">B</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">⊓</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">⊓</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="main"><span class="main">:</span></span> Process.Process_eq_spec F_ndet D_ndet F_mndet D_mndet<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ The two lemmas <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> mndet_unit<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> mndet_distrib<span class="antiquote"><span class="antiquote">}</span></span></span></span> together give us that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> mndet<span class="antiquote"><span class="antiquote">}</span></span></span></span> 
      can be represented by a fold in the finite case. ›</span></span>                                         

<span class="keyword1"><span class="command">lemma</span></span> mndet_distrib_unit <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>  <span class="main">⟹</span> <span class="main">(</span><span class="main">⊓</span> <span class="bound">x</span> <span class="main">∈</span> insert <span class="free">a</span> <span class="free">A</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span> <span class="free">a</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="main">⊓</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">-</span><span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_Diff_cancel insert_is_Un insert_not_empty mndet_distrib mndet_unit<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Finite case Continuity›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ This also implies that mndet is continuous for the
      finite <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">A</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and an arbitrary body <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>: ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Mndet_cont_finite<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span>"</span></span>
 <span class="keyword2"><span class="keyword">and</span></span>    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> cont <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">⊓</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> Finite_Set.finite_induct<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹finite <span class="free">A</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">⊓</span><span class="bound">z</span><span class="main">∈</span><span class="main">{}</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">⊓</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">A</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span>   <span class="quoted"><span class="quoted">"cont <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">⊓</span><span class="bound">z</span><span class="main">∈</span>insert <span class="skolem">a</span> <span class="skolem">A</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mndet_unit True <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> cont <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span>›</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> *  <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> False <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">A</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> ** <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">-</span><span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">A</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∉</span> <span class="skolem">A</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mndet_distrib_unit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> **<span class="main">)</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹cont <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">⊓</span><span class="bound">z</span><span class="main">∈</span><span class="skolem">A</span> <span class="main">→</span> <span class="free">f</span> <span class="bound">z</span> <span class="bound">y</span><span class="main">)</span>›</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹General case Continuity›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Mndet<span class="main">[</span><span class="operator">simp</span><span class="main">]</span> <span class="main">:</span> <span class="quoted"><span class="quoted">"monofun <span class="main">(</span>mndet <span class="main">(</span><span class="free">A</span><span class="main">::</span><span class="tfree">'a</span> set<span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> monofun_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> monofun_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> allI impI<span class="main">)</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> le_approx_def
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_mndet F_mndet D_mndet<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span>  
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊑</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span>  D <span class="main">(</span><span class="bound">x</span><span class="main">→</span> <span class="skolem">y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">xa</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> D <span class="main">(</span><span class="bound">xa</span> <span class="main">→</span> <span class="skolem">x</span> <span class="bound">xa</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> SUP_mono <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">⊑</span> <span class="skolem">y</span>›</span></span> fun_below_iff le_approx1 mono_Mprefix0 write0_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span>  <span class="tfree">'a</span> process"</span></span>  
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊑</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> *** <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="bound">z</span> <span class="main">⊑</span> <span class="skolem">y</span> <span class="bound">z</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">⊑</span> <span class="skolem">y</span>›</span></span> fun_belowD<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">xa</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="bound">xa</span> <span class="main">→</span> <span class="skolem">x</span> <span class="bound">xa</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> Ra <span class="main">(</span>mndet <span class="free">A</span> <span class="skolem">x</span><span class="main">)</span> <span class="bound">s</span> <span class="main">=</span> Ra <span class="main">(</span>mndet <span class="free">A</span> <span class="skolem">y</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Ra_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>proc_ord2a mono_Mprefix0 write0_def F_mndet<span class="main">)</span> <span class="main">(</span><span class="operator">meson</span> le_approx2 mono_Mprefix0 write0_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">y</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span>  <span class="tfree">'a</span> process"</span></span>  
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">⊑</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> *** <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">z</span> <span class="main">→</span> <span class="skolem">x</span> <span class="bound">z</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="bound">z</span> <span class="main">→</span> <span class="skolem">y</span> <span class="bound">z</span><span class="main">)</span> "</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">⊑</span> <span class="skolem">y</span>›</span></span> fun_below_iff mono_Mprefix0 write0_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> * <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"min_elems <span class="main">(</span><span class="main">⋃</span><span class="bound">xa</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> D <span class="main">(</span><span class="bound">xa</span> <span class="main">→</span> <span class="skolem">x</span> <span class="bound">xa</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> T <span class="main">(</span><span class="bound">x</span> <span class="main">→</span> <span class="skolem">y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> min_elems_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Set.set_insert elem_min_elems insert_subset le_approx3 le_less min_elems5<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">lemma</span></span> mndet_chainpreserving<span class="main">:</span> <span class="quoted"><span class="quoted">"chain <span class="free">Y</span> <span class="main">⟹</span> chain <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">⊓</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">Y</span> <span class="bound">i</span> <span class="bound">z</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> chainI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> i<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> i<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">i</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> chainE<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> below_fun_def mono_Mprefix0 write0_def monofunE<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> contlub_Mndet <span class="main">:</span> <span class="quoted"><span class="quoted">"contlub <span class="main">(</span>mndet <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> contlub_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> contlubI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> proc_ord_proc_eq_spec<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="skolem">Y</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> <span class="skolem">Y</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_approx_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI allI impI<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"D <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> <span class="skolem">Y</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> Lub <span class="skolem">Y</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a False D_LUB<span class="main">[</span><span class="operator">OF</span> mndet_chainpreserving<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
              limproc_is_thelub<span class="main">[</span><span class="operator">OF</span> mndet_chainpreserving<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>write0_def D_Mprefix D_LUB<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ch2ch_fun<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> a<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> limproc_is_thelub_fun<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span> D_mndet<span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> event.inject<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event list"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">∉</span> D <span class="main">(</span><span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> Lub <span class="skolem">Y</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Ra <span class="main">(</span><span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> Lub <span class="skolem">Y</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> Ra <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> <span class="skolem">Y</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> 
        <span class="keyword1"><span class="command">unfolding</span></span> Ra_def 
        <span class="keyword1"><span class="command">using</span></span> a False F_LUB<span class="main">[</span><span class="operator">OF</span> mndet_chainpreserving<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
              limproc_is_thelub<span class="main">[</span><span class="operator">OF</span> mndet_chainpreserving<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>write0_def F_Mprefix F_LUB<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ch2ch_fun<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> a<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> limproc_is_thelub_fun<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span> F_mndet<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> event.inject<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"min_elems <span class="main">(</span>D <span class="main">(</span><span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> Lub <span class="skolem">Y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> T <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> <span class="skolem">Y</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> min_elems_def
        <span class="keyword1"><span class="command">using</span></span> a False limproc_is_thelub<span class="main">[</span><span class="operator">OF</span> mndet_chainpreserving<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span>
              D_LUB<span class="main">[</span><span class="operator">OF</span> mndet_chainpreserving<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
              F_LUB<span class="main">[</span><span class="operator">OF</span> mndet_chainpreserving<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_T write0_def D_Mprefix F_Mprefix D_mndet F_mndet D_LUB<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ch2ch_fun<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> a<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> F_LUB<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ch2ch_fun<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> a<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> limproc_is_thelub_fun<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"chain <span class="skolem">Y</span>"</span></span>      
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"D <span class="main">(</span><span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">i</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="main">⨆</span><span class="bound">i</span><span class="main">.</span> <span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span><span class="free">A</span> <span class="main">→</span> <span class="skolem">Y</span> <span class="bound">i</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a False D_LUB<span class="main">[</span><span class="operator">OF</span> mndet_chainpreserving<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
              limproc_is_thelub<span class="main">[</span><span class="operator">OF</span> mndet_chainpreserving<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>write0_def D_Mprefix D_mndet D_LUB<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ch2ch_fun<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">OF</span> a<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span> limproc_is_thelub_fun<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Mndet_cont<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> cont <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> cont <span class="main">(</span><span class="main">λ</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">⊓</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="main">(</span><span class="free">f</span> <span class="bound">z</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> f <span class="main"><span class="main">=</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">z</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="free">f</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Cont.cont_compose<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> monocontlub2cont<span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> mono_Mndet contlub_Mndet Fun_Cpo.cont2cont_lambda<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="CSP">
<div class="head">
<h1>Theory CSP</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ********************************************************************
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>


<span class="keyword1"><span class="command">chapter</span></span><span class="quoted"><span class="plain_text">‹ The "Laws" of CSP ›</span></span>

<span class="keyword1"><span class="command">theory</span></span> CSP                                               
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Bot.html">Bot</a> <a href="Skip.html">Skip</a> <a href="Stop.html">Stop</a> <a href="Mprefix.html">Mprefix</a> <a href="Det.html">Det</a> <a href="Ndet.html">Ndet</a> <a href="Seq.html">Seq</a> <a href="Hide.html">Hide</a> <a href="Sync.html">Sync</a> <a href="Mndet.html">Mndet</a> <span class="quoted">"<a href="../../HOL/HOL-Eisbach/Eisbach.html">HOL-Eisbach.Eisbach</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">method</span></span> exI <span class="keyword2"><span class="keyword">for</span></span> <span class="free">y</span><span class="main">::</span><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="operator">rule_tac</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="free">y</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ General Laws›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> skip_Neq_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"SKIP <span class="main">≠</span> STOP"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process_eq_spec F_SKIP F_STOP D_SKIP D_STOP Un_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bot_less1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">≤</span> <span class="main">(</span><span class="free">X</span><span class="main">::</span><span class="tfree">'a</span> process<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_approx_implies_le_ref<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bot_less2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"Bot <span class="main">≤</span> <span class="main">(</span><span class="free">X</span><span class="main">::</span><span class="tfree">'a</span> process<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ Deterministic Choice Operator Laws ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_det_FD_onside<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">P</span> <span class="main">≤</span> <span class="free">P'</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">P'</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> le_ref_def F_det D_det <span class="keyword1"><span class="command">using</span></span> F_subset_imp_T_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_det_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⟦</span><span class="free">P</span> <span class="main">≤</span> <span class="free">P'</span><span class="main">;</span> <span class="free">S</span> <span class="main">≤</span> <span class="free">S'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">P'</span> <span class="main">□</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Det_commute dual_order.trans mono_det_FD_onside<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_det_ref<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⟦</span><span class="free">P</span> <span class="main">⊑</span> <span class="free">P'</span><span class="main">;</span> <span class="free">S</span> <span class="main">⊑</span> <span class="free">S'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">P'</span> <span class="main">□</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> below_trans mono_Det mono_Det_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> det_bot <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="main">⊥</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec D_det F_det is_processT2 D_imp_front_tickFree F_UU D_UU<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> det_STOP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">□</span> STOP<span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec D_det F_det D_STOP F_STOP T_STOP 
                      Un_def Sigma_def is_processT8 is_processT6_S2<span class="main">)</span>  

<span class="keyword1"><span class="command">lemma</span></span> det_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process_eq_spec D_det F_det Un_def Sigma_def is_processT8 is_processT6_S2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> det_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">M</span> <span class="main">□</span> <span class="free">P</span><span class="main">)</span> <span class="main">□</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">M</span> <span class="main">□</span> <span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec D_det F_det Un_def Sigma_def T_det<span class="main">)</span>  


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ NonDeterministic Choice Operator Laws ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_ndet_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⟦</span><span class="free">P</span> <span class="main">≤</span> <span class="free">P'</span><span class="main">;</span> <span class="free">S</span> <span class="main">≤</span> <span class="free">S'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">P'</span> <span class="main">⊓</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_ref_def F_ndet D_ndet<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_ndet_FD_left<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≤</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span> <span class="main">≤</span> <span class="free">Q</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_ndet F_ndet dual_order.trans le_ref_def le_sup_iff order_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_ndet_FD_right<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≤</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">S</span> <span class="main">⊓</span> <span class="free">P</span><span class="main">)</span> <span class="main">≤</span> <span class="free">Q</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_ndet F_ndet dual_order.trans le_ref_def le_sup_iff order_refl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_ndet_ref<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⟦</span><span class="free">P</span> <span class="main">⊑</span> <span class="free">P'</span><span class="main">;</span> <span class="free">S</span> <span class="main">⊑</span> <span class="free">S'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">P'</span> <span class="main">⊓</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> below_trans mono_Ndet mono_Ndet_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> ndet_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="main">⊥</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process_eq_spec D_ndet F_ndet is_processT2 D_imp_front_tickFree F_UU D_UU<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> ndet_id<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_ndet D_ndet Process_eq_spec<span class="main">)</span>  

<span class="keyword1"><span class="command">lemma</span></span> non_det_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">M</span> <span class="main">⊓</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">M</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_ndet D_ndet  Process_eq_spec Un_assoc<span class="main">)</span>  

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Multi-Operators laws  ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> det_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span> <span class="main">□</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">M</span> <span class="main">□</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">M</span> <span class="main">□</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  Process_eq_spec F_det D_det F_ndet D_ndet Un_def T_ndet<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> non_det_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">M</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">M</span> <span class="main">⊓</span> <span class="free">P</span><span class="main">)</span> <span class="main">□</span> <span class="main">(</span><span class="free">M</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  Process_eq_spec F_det D_det F_ndet 
                      D_ndet Un_def T_ndet is_processT8 is_processT6_S2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">P</span> <span class="main">□</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_ref_def D_ndet D_det F_ndet F_det T_ndet T_det Ra_def min_elems_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">using</span></span> is_processT6_S2 NF_ND <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ Sequence Operator Laws ›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">F_minus_D_seq</span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">F_minus_D_seq</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∈</span> F <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> tickFree <span class="bound">t</span><span class="main">}</span> <span class="main">∪</span>
                                <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t1</span> <span class="bound">t2</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> <span class="bound">t1</span> <span class="main">@</span> <span class="bound">t2</span> <span class="main">∧</span> <span class="bound">t1</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t2</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> F_minus_D_seq_opt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> F<span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">∈</span> D<span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> F_minus_D_seq <span class="free">P</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>F_seq D_seq F_minus_D_seq_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Process_eq_spec_optimized_seq <span class="main">:</span> 
<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">U</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>D <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> D <span class="main">(</span><span class="free">U</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> 
                            F_minus_D_seq <span class="free">P</span> <span class="free">Q</span> <span class="main">⊆</span> F <span class="main">(</span><span class="free">U</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="main">∧</span> 
                            F_minus_D_seq <span class="free">U</span> <span class="free">S</span> <span class="main">⊆</span> F <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> Process_eq_spec_optimized<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">U</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span>"</span></span><span class="main">]</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>F_minus_D_seq_opt<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Laws›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_seq_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⟦</span><span class="free">P</span> <span class="main">≤</span> <span class="free">P'</span><span class="main">;</span> <span class="free">S</span> <span class="main">≤</span> <span class="free">S'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">P'</span> <span class="main">`;`</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_ref_def F_seq D_seq<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> F_subset_imp_T_subset subsetCE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_seq_ref<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⟦</span><span class="free">P</span> <span class="main">⊑</span> <span class="free">P'</span><span class="main">;</span> <span class="free">S</span> <span class="main">⊑</span> <span class="free">S'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">P'</span> <span class="main">`;`</span> <span class="free">S'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> below_trans mono_Seq mono_Seq_sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> Bot_SEQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊥</span> <span class="main">`;`</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec D_seq F_seq front_tickFree_append F_UU D_UU T_UU<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> front_tickFree_append front_tickFree_implies_tickFree is_processT2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command">using</span></span> D_imp_front_tickFree front_tickFree_append front_tickFree_implies_tickFree <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">using</span></span> front_tickFree_charn tickFree_Nil <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">using</span></span> D_imp_front_tickFree front_tickFree_append front_tickFree_implies_tickFree <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> SEQ_SKIP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> SKIP<span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec F_seq D_seq F_SKIP D_SKIP is_processT7 is_processT8_S T_F_spec is_processT6_S1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> insertI2 is_processT4 subsetI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> append_T_imp_tickFree is_processT5_S7 non_tickFree_tick not_Cons_self2 tickFree_append<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> T_F_spec insert_absorb is_processT5_S2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> F_T is_processT nonTickFree_n_frontTickFree<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 front_tickFree_mono is_processT nonTickFree_n_frontTickFree not_Cons_self<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> SKIP_SEQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>SKIP <span class="main">`;`</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec D_seq T_SKIP F_seq F_SKIP D_SKIP is_processT8_Pair<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> STOP_SEQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>STOP <span class="main">`;`</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> STOP"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process_eq_spec F_seq D_seq F_STOP D_STOP T_STOP Un_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Multi-Operators laws  ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> SEQ_Ndet_distrR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">Q</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec D_seq D_ndet T_ndet Un_def F_seq T_seq F_ndet<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> SEQ_Ndet_distrL<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⊓</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec D_seq D_ndet T_ndet Un_def F_seq F_ndet<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> SEQ_assoc_D<span class="main">:</span> <span class="quoted"><span class="quoted">"D<span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="main">(</span><span class="free">Q</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> D<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_seq T_seq<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc append_single_T_imp_tickFree tickFree_append<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_seq T_seq<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t2</span> <span class="skolem">t1a</span> <span class="skolem">t2a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> front_tickFree_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">t1a</span> <span class="skolem">t2a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2b</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">t2a</span> <span class="main">=</span> <span class="skolem">t2b</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T_nonTickFree_imp_decomp append_single_T_imp_tickFree non_tickFree_tick tickFree_append<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">t1a</span> <span class="skolem">t2a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_implies_tickFree process_charn<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">t1a</span> <span class="skolem">t2a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2b</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">t2a</span> <span class="main">=</span> <span class="skolem">t2b</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_T T_nonTickFree_imp_decomp append_single_T_imp_tickFree non_tickFree_tick tickFree_append<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree append.assoc butlast_snoc front_tickFree_implies_tickFree process_charn<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">t1a</span> <span class="skolem">t2a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_implies_tickFree process_charn<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">t1a</span> <span class="skolem">t2a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2b</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">t2a</span> <span class="main">=</span> <span class="skolem">t2b</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_T T_nonTickFree_imp_decomp append_single_T_imp_tickFree non_tickFree_tick tickFree_append<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree append.assoc butlast_snoc front_tickFree_implies_tickFree process_charn<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> SEQ_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="main">(</span><span class="free">Q</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process_eq_spec_optimized_seq SEQ_assoc_D<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>F_minus_D_seq_def SEQ_assoc_D F_minus_D_seq_opt append_single_T_imp_tickFree <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>conjI<span class="main"><span class="keyword3">,</span></span> 
        <span class="operator">goal_cases</span> 11 12<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> D_seq SEQ_assoc_D UnCI mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">t1</span> <span class="skolem">t1a</span> <span class="skolem">t2a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t1</span> <span class="main">@</span> <span class="skolem">t1a</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>T_seq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> 12<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">@</span><span class="skolem">t1a</span>"</span></span> <span class="quoted"><span class="skolem">t2a</span></span><span class="main">]</span> 12<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>F_minus_D_seq_def SEQ_assoc_D F_minus_D_seq_opt append_single_T_imp_tickFree T_seq <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>conjI<span class="main"><span class="keyword3">,</span></span> 
      <span class="operator">goal_cases</span> 21 22 23 24 25 26<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 21
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> D_seq UnCI append_Nil2 front_tickFree_Nil mem_Collect_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>22 <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">t1a</span> <span class="skolem">t2a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2b</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">t2a</span> <span class="main">=</span> <span class="skolem">t2b</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> T_nonTickFree_imp_decomp append_single_T_imp_tickFree non_tickFree_tick tickFree_append<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 22 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> append.assoc butlast_snoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>23 <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">t1a</span> <span class="skolem">t2a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="main">(</span><span class="free">Q</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_seq<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 front_tickFree_implies_tickFree process_charn<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 23 SEQ_assoc_D <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_implies_tickFree process_charn<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>24 <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">t1a</span> <span class="skolem">t2a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2b</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">t2a</span> <span class="main">=</span> <span class="skolem">t2b</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_T T_nonTickFree_imp_decomp append_single_T_imp_tickFree non_tickFree_tick tickFree_append<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 24 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_T append.assoc butlast_snoc<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>25 <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">t1a</span> <span class="skolem">t2a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> <span class="main">(</span><span class="free">Q</span> <span class="main">`;`</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_seq<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 front_tickFree_implies_tickFree process_charn<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 25 SEQ_assoc_D <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_implies_tickFree process_charn<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>26 <span class="skolem">t1</span> <span class="skolem">t2</span> <span class="skolem">t1a</span> <span class="skolem">t2a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2b</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">t2a</span> <span class="main">=</span> <span class="skolem">t2b</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_T T_nonTickFree_imp_decomp append_single_T_imp_tickFree non_tickFree_tick tickFree_append<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 26 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> D_T append.assoc butlast_snoc<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ The Multi-Prefix Operator Laws ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_mprefix_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">P'</span> <span class="bound">x</span> <span class="main">⟹</span> Mprefix <span class="free">A</span> <span class="free">P</span> <span class="main">≤</span> Mprefix <span class="free">A</span> <span class="free">P'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_ref_def F_Mprefix D_Mprefix<span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> mono_mprefix_ref <span class="main">=</span>  mono_Mprefix0

<span class="keyword1"><span class="command">lemma</span></span> Mprefix_STOP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Mprefix <span class="main">{}</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> STOP"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Process_eq_spec F_Mprefix D_Mprefix D_STOP F_STOP<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Multi-Operators laws  ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mprefix_Un_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Mprefix <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">P</span><span class="main">)</span> <span class="main">□</span> <span class="main">(</span>Mprefix <span class="free">B</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> Process_eq_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">elim</span> disjE conjE <span class="main"><span class="keyword3">|</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_det F_Mprefix Un_def image_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_det D_Mprefix Un_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mprefix_seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">P</span><span class="main">)</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Mprefix <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">`;`</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">unfold</span> Process_eq_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> subset_antisym<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> split_def F_seq D_seq F_Mprefix T_Mprefix D_Mprefix<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> disjE conjE exE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> tickFree_tl<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>hd_append<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command">using</span></span> tickFree_tl <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hd_append<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> split_def F_seq D_seq F_Mprefix T_Mprefix D_Mprefix<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> disjE conjE exE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> event.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.exhaust_sel tickFree_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="skolem">a</span><span class="main">)</span><span class="main">#</span><span class="skolem">t1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> hd_Cons_tl image_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>       
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="skolem">a</span><span class="main">)</span><span class="main">#</span><span class="skolem">t1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> hd_Cons_tl image_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="skolem">a</span><span class="main">)</span><span class="main">#</span><span class="skolem">t1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> hd_Cons_tl image_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 3
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>     
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_Mprefix D_seq T_Mprefix<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> tickFree_tl <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> hd_append image_iff list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> hd_append list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tl_append2<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> append_Cons event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> image_eqI list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                      list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> tickFree_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Derivative Operators laws  ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mprefix_singl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Mprefix <span class="main">{</span><span class="free">a</span><span class="main">}</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>write0_def Mprefix_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> arg_cong<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Abs_process <span class="bound">x</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_read_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> read_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_write_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">≤</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span>c <span class="main">`!`</span> <span class="free">x</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>c <span class="main">`!`</span> <span class="free">x</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_write0_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≤</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_read_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_Mprefix0 read_def<span class="main">)</span>
                                         
<span class="keyword1"><span class="command">lemma</span></span> mono_write_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟹</span>  <span class="main">(</span>c <span class="main">`!`</span> <span class="free">x</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span>c <span class="main">`!`</span> <span class="free">x</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_Mprefix0 write_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_write0_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">⊑</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_Mprefix0 write0_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> write0_non_det<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process_eq_spec write0_def D_ndet F_ndet F_Mprefix D_Mprefix Un_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> write0_det_non_det<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> <span class="main">□</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Process_eq_spec write0_def D_ndet F_ndet F_det D_det<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_Mprefix<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ The Hiding Operator Laws ›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Preliminaries ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> elemDIselemHD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">⟹</span> trace_hide <span class="free">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"tickFree <span class="free">t</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="skolem">t'</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D_imp_front_tickFree nonTickFree_n_frontTickFree <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>tick<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> front_tickFree_implies_tickFree front_tickFree_single is_processT<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> length_strict_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono <span class="main">(</span><span class="free">f</span><span class="main">::</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> list<span class="main">)</span> <span class="main">⟹</span> length <span class="main">(</span><span class="free">f</span> <span class="free">i</span><span class="main">)</span> <span class="main">≥</span> <span class="free">i</span> <span class="main">+</span> length <span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.trans lessI less_length_mono not_less not_less_eq_eq plus_nat.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> strict_mono_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_trace_hide<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> trace_hide <span class="free">a</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> trace_hide <span class="free">b</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> filter_append le_list_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_constant<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"mono <span class="main">(</span><span class="free">f</span><span class="main">::</span>nat <span class="main">⇒</span> <span class="tfree">'a</span> event list<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">≤</span> <span class="free">a</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="bound">i</span><span class="main">.</span> <span class="free">f</span> <span class="bound">j</span> <span class="main">=</span> <span class="free">f</span> <span class="bound">i</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> length <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> length <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_length_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"finite <span class="main">{</span>length <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> True<span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> finite_nat_set_iff_bounded_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">lm</span></span> <span class="keyword2"><span class="keyword">where</span></span> l2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">lm</span> <span class="main">=</span> Max <span class="main">{</span>length <span class="main">(</span><span class="free">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">|</span><span class="bound">i</span><span class="main">.</span> True<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> aa <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">im</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="free">f</span> <span class="skolem">im</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">lm</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Max_in <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> l2 assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">im</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> impI allI<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Max_ge aa antisym le_length_mono le_neq_trans less_length_mono 
              mem_Collect_eq mono_def order_less_irrefl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> elemTIselemHT<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">⟹</span> trace_hide <span class="free">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"tickFree <span class="free">t</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">ta</span><span class="main">.</span> trace_hide <span class="free">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="bound">ta</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_hiding<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> a False inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">f</span> <span class="free">P</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">t</span> <span class="main">∈</span> range <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> tt<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="skolem">t'</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T_nonTickFree_imp_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">ta</span><span class="main">.</span> trace_hide <span class="free">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="bound">ta</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">ta</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_hiding<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> False inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">f</span> <span class="free">P</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">t</span> <span class="main">∈</span> range <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>tick<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append_T_imp_tickFree list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tt<span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> tt <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> False append_T_imp_tickFree is_processT5_S7 non_tickFree_tick not_Cons_self2 tickFree_append tt<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hide_un_D1<span class="main">:</span> <span class="quoted"><span class="quoted">"D <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conj_commute D_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI subset_antisym subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> B1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B2<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B3<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
             B4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">f</span><span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> event list<span class="main">)</span><span class="main">.</span> isInfHiddenRun <span class="bound">f</span> <span class="free">P</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">∈</span> range <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span>  disjE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>hiding_tickFree tickFree_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> fc<span class="main">:</span><span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">f</span> <span class="free">P</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> take <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> fc <span class="keyword1"><span class="command">have</span></span> ffc<span class="main">:</span><span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">ff</span> <span class="free">P</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">∈</span> range <span class="skolem">ff</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">from</span></span> length_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">x</span> "</span></span><span class="main">,</span> <span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> take <span class="main">(</span><span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_Suc_conv_app_nth<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> strict_monoD<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">x</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> 
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span> <span class="main">@</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_list_def less_imp_le<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> length_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main">,</span> <span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> take <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">&lt;</span> take <span class="main">(</span>Suc <span class="skolem">x</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lift_Suc_mono_less strict_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> append_take_drop_id le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">≤</span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">⟶</span> <span class="bound">x</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_processT3_ST_pref <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span><span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">i</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> strict_mono_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute append_eq_conv_conj le_list_def take_add<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">x</span><span class="main">←</span>take <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∉</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">]</span> <span class="main">≥</span> <span class="main">[</span><span class="bound">x</span><span class="main">←</span><span class="skolem">f</span> <span class="main">0</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∉</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter_append le_list_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="skolem">i</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> append_take_drop_id le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">x</span><span class="main">←</span>take <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∉</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">]</span> <span class="main">≤</span> <span class="main">[</span><span class="bound">x</span><span class="main">←</span><span class="skolem">f</span> <span class="skolem">i</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">∉</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter_append le_list_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> a 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> dual_order.antisym<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 4
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">f</span> <span class="skolem">n</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> add_le_imp_le_diff length_strict_mono strict_mono_less_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> take <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>length <span class="main">(</span><span class="skolem">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> add.commute append_eq_conv_conj diff_is_0_eq' 
                  le_add_diff_inverse le_list_def le_zero_eq nat_le_linear strict_mono_less_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&gt;</span><span class="bound">m</span><span class="main">.</span> last <span class="main">(</span><span class="skolem">ff</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> mc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">i</span></span><span class="main">&gt;</span><span class="skolem">m</span><span class="main">.</span> last <span class="main">(</span><span class="skolem">ff</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> mc2<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="main">(</span><span class="skolem">ff</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> B2 event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ffc 
                                      image_iff mem_Collect_eq set_filter tickFree_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> mc mc2 1 ffc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">ff</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>    
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq set_filter tickFree_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> rangeE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">ff</span><span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add.commute add.right_neutral rangeI<span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_mono_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> ffc ff_def True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ff</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ff</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∧</span> set <span class="bound">t</span> <span class="main">⊆</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> 0
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> tc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ff</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ff</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">tt</span> <span class="main">∧</span> set <span class="skolem">tt</span> <span class="main">⊆</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> ffc ff_def length_strict_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">ff</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> lc<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ff</span> <span class="main">(</span>Suc <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">(</span>length <span class="main">(</span><span class="skolem">ff</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> add_Suc fc length_strict_mono length_take min.absorb2<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> True <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> lc2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> last <span class="main">(</span><span class="skolem">ff</span> <span class="main">(</span>Suc <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">l</span> <span class="main">∈</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> less_add_same_cancel2 mc zero_less_Suc<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> ffc <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> rc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">(</span>Suc <span class="skolem">i</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ff</span> <span class="main">(</span><span class="skolem">i</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">@</span><span class="skolem">r</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.commute add_Suc_right le_list_def lessI less_imp_le strict_mono_less_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> lc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="skolem">r</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 add_left_cancel length_append<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> rc lc2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">l</span><span class="main">]</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Nil_is_append_conv Suc_eq_plus1 append_butlast_last_id 
                        append_eq_append_conv append_eq_append_conv2 length_Cons length_append<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> Suc lc2 tc rc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">tt</span><span class="main">@</span><span class="main">[</span><span class="skolem">l</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> filter_empty_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">i</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> ffc <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> ttc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">ff</span> <span class="main">0</span> <span class="main">@</span> <span class="skolem">tt</span> <span class="main">∧</span> set <span class="skolem">tt</span> <span class="main">⊆</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> isInfHiddenRun_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> ffc as <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> strict_mono_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">with</span></span> ttc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"last <span class="main">(</span><span class="skolem">ff</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">hence</span></span> as2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">j</span></span><span class="main">&gt;</span><span class="bound">i</span><span class="main">.</span> last<span class="main">(</span><span class="skolem">ff</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> DiffI False UnE gr_implies_not_zero gr_zeroI image_Un<span class="main">)</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ffb</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ffb</span> <span class="main">=</span> rec_nat <span class="skolem">t</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">j</span> <span class="main">=</span> <span class="keyword1">SOME</span> <span class="bound">j</span><span class="main">.</span> <span class="skolem">ff</span> <span class="bound">j</span> <span class="main">&gt;</span> <span class="bound">t</span> <span class="main">∧</span> last<span class="main">(</span><span class="skolem">ff</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span> <span class="skolem">ff</span> <span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> as2 <span class="keyword1"><span class="command">have</span></span> ffbff<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ffb</span> <span class="bound">n</span> <span class="main">∈</span> range <span class="skolem">ff</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ffc old.nat.exhaust old.nat.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> old.nat.simps<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> rangeI<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1 ffb_def <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> filter_is_subset set_rev_mp tickFree_def<span class="main">)</span>        
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> trace_hide <span class="main">(</span><span class="skolem">ffb</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> old.nat.simps<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> rangeI<span class="main">)</span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
          <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ffb</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ff</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">j</span><span class="main">.</span> <span class="skolem">ff</span> <span class="bound">j</span> <span class="main">&gt;</span> <span class="skolem">ffb</span> <span class="skolem">n</span> <span class="main">∧</span> last<span class="main">(</span><span class="skolem">ff</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ffb_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> ffbff <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ffb</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">ff</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> as2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">j</span><span class="main">.</span> <span class="skolem">ff</span> <span class="bound">j</span> <span class="main">&gt;</span> <span class="skolem">ffb</span> <span class="skolem">n</span> <span class="main">∧</span> last<span class="main">(</span><span class="skolem">ff</span> <span class="bound">j</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ffc strict_mono_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> a0 a1 <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ffb</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="skolem">ffb</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∧</span> last <span class="main">(</span><span class="skolem">ffb</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∉</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Diff_iff tfl_some<span class="main">)</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">ffb</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="skolem">ffb</span> <span class="skolem">n</span><span class="main">)</span><span class="main">@</span><span class="skolem">r</span> <span class="main">∧</span> last <span class="skolem">r</span> <span class="main">∉</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_self_conv last_append le_list_def less_list_def<span class="main">)</span> 
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">ffb</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">&gt;</span> trace_hide <span class="main">(</span><span class="skolem">ffb</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> a append_self_conv filter_append filter_empty_conv 
                                          last_in_set le_list_def less_list_def<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> lift_Suc_mono_less_iff strict_monoI<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 3
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> elemTIselemHT ffbff ffc rangeE<span class="main">)</span>  
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 4
        <span class="keyword1"><span class="command">from</span></span> ffbff ffc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rangeE trace_hide_union<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hide_un_D2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> D <span class="main">(</span><span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>conj_commute D_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI subset_antisym subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> B1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B2<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B3<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
             B4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">f</span><span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> event list<span class="main">)</span><span class="main">.</span> isInfHiddenRun <span class="bound">f</span> <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="free">B</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">∈</span> range <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding<span class="main">)</span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule_tac</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ta</span> <span class="skolem">ua</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ta</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ua</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> front_tickFree_append tickFree_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">ua</span> <span class="skolem">f</span> <span class="skolem">xa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">xa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ua</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI disjI2<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> front_tickFree_append tickFree_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> filter_filter rangeI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">f</span> <span class="skolem">xx</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> <span class="quoted">"3a"</span> <span class="main">=</span> 3
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">i</span> <span class="skolem">ta</span> <span class="skolem">ua</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ta</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ua</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> front_tickFree_append hiding_tickFree tickFree_append<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">f</span> <span class="skolem">xx</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> filter_append filter_filter<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> filter_append filter_filter<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">i</span> <span class="skolem">ua</span> <span class="skolem">fa</span> <span class="skolem">xa</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">f</span> <span class="skolem">xx</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">fa</span> <span class="skolem">xa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ua</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> front_tickFree_append hiding_tickFree tickFree_append<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">fa</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> filter_filter<span class="main">)</span>      
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span> Falsebis<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∉</span> D <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> T_hiding<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> D_hiding<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span>trace_hide <span class="bound">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">|</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span><span class="main">}</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> UnE<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> ff0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> ff1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">SOME</span> <span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">=</span> trace_hide <span class="bound">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">ff</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> inj_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> ff0 strict_mono_eq tfl_some<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> ff2<span class="main">:</span><span class="quoted"><span class="quoted">"infinite <span class="main">(</span>range <span class="skolem">ff</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_imageD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">tt</span> <span class="skolem">i</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="main">∈</span> range <span class="skolem">ff</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">k</span> <span class="main">=</span> <span class="skolem">tt</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_nat_set_iff_bounded_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">hence</span></span> kk0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">k</span> <span class="main">=</span> trace_hide <span class="skolem">tt</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">tt</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ff1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ff0 someI_ex<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>take <span class="skolem">i</span> <span class="skolem">tt</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> le_list_def set_append strict_mono_less_eq sup.cobounded1<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> kk0 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>take <span class="skolem">i</span> <span class="skolem">tt</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> in_set_takeD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False
          <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> dual_order.trans le_add1 length_strict_mono<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3"</span><span class="main">(</span>4<span class="main">)</span> False nat_le_linear strict_mono_less_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> a <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"take <span class="skolem">i</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_conv_conj le_add_diff_inverse le_list_def take_add<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> kk0<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span>trace_hide <span class="main">(</span>take <span class="skolem">i</span> <span class="skolem">tt</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>trace_hide <span class="main">(</span>drop <span class="skolem">i</span> <span class="skolem">tt</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_take_drop_id filter_append<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>trace_hide <span class="main">(</span>take <span class="skolem">i</span> <span class="skolem">tt</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> length_filter_le length_take min.absorb2 nat_le_linear order.trans take_all<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> c1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"take <span class="skolem">i</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span>trace_hide <span class="main">(</span>take <span class="skolem">i</span> <span class="skolem">tt</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_list_def<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> c <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span>trace_hide <span class="main">(</span>take <span class="skolem">i</span> <span class="skolem">tt</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="skolem">t</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc le_list_def<span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> in_set_takeD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> ee<span class="main">=</span>this
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span>take <span class="skolem">i</span> <span class="bound">t</span><span class="main">)</span><span class="main">|</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="skolem">ff</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">i</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> ff<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">{</span>take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="bound">t</span><span class="main">|</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="skolem">ff</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span>take <span class="skolem">i</span> <span class="bound">t</span><span class="main">)</span><span class="main">|</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="skolem">ff</span><span class="main">}</span> <span class="main">∪</span>
                      <span class="main">(</span><span class="main">⋃</span><span class="bound">e</span><span class="main">∈</span><span class="main">(</span>set <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span>take <span class="skolem">i</span> <span class="bound">t</span><span class="main">)</span><span class="main">@</span><span class="main">[</span><span class="bound">e</span><span class="main">]</span><span class="main">|</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="skolem">ff</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?AA</span> <span class="main">⊆</span> <span class="var">?BB</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">proof</span></span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?AA</span>"</span></span>
              <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> hh<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">∈</span> range <span class="skolem">ff</span> <span class="main">∧</span> <span class="skolem">t</span> <span class="main">=</span> take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">t'</span>"</span></span> 
                <span class="keyword1"><span class="command">using</span></span> finite_nat_set_iff_bounded_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">with</span></span> ee<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t'</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> <span class="var">?BB</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"length <span class="skolem">t'</span> <span class="main">&gt;</span> <span class="skolem">i</span>"</span></span><span class="main">)</span>
                  <span class="keyword3"><span class="command">case</span></span> True
                  <span class="keyword1"><span class="command">hence</span></span> ii<span class="main">:</span><span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">t'</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="skolem">t'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">t'</span><span class="main">!</span><span class="skolem">i</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> take_Suc_conv_app_nth<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> ee<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t'</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">i</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span><span class="main">!</span><span class="skolem">i</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hh<span class="main">)</span>
                  <span class="keyword1"><span class="command">with</span></span> ii hh <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                <span class="keyword1"><span class="command">next</span></span>
                  <span class="keyword3"><span class="command">case</span></span> False
                  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"take <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span> <span class="skolem">t'</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword1"><span class="command">with</span></span> hh <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                <span class="keyword1"><span class="command">qed</span></span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">|</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="bound">x</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="skolem">ff</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>take <span class="skolem">i</span> <span class="bound">t'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">|</span><span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span> <span class="main">∈</span> range <span class="skolem">ff</span><span class="main">}</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span><span class="main">{</span><span class="main">(</span>take <span class="skolem">i</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">|</span><span class="bound">t'</span><span class="main">.</span> <span class="bound">t'</span><span class="main">∈</span>range <span class="skolem">ff</span><span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> finite_image_set<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span><span class="main">@</span><span class="main">[</span><span class="skolem">e</span><span class="main">]</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> Suc<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> gg<span class="main">=</span>this
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite<span class="main">(</span>set <span class="main">(</span><span class="skolem">f</span> <span class="main">(</span>Suc <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> ff gg Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> finite_UN finite_Un finite_subset<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> ff<span class="main">=</span>this
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">{</span>take <span class="bound">i</span> <span class="bound">t</span> <span class="main">|</span><span class="bound">t</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> range <span class="skolem">ff</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> take <span class="bound">i</span> <span class="main">(</span><span class="skolem">ff</span> <span class="bound">t'</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> KoenigLemma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"range <span class="skolem">ff</span>"</span></span><span class="main">]</span> ff ff2
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f'</span></span> <span class="keyword2"><span class="keyword">where</span></span> gg<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="main">(</span><span class="skolem">f'</span><span class="main">::</span> nat <span class="main">⇒</span> <span class="tfree">'a</span> event list<span class="main">)</span> <span class="main">∧</span> 
                                            range <span class="skolem">f'</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">∈</span>range <span class="skolem">ff</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≤</span> <span class="bound">t'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
        <span class="keyword1"><span class="command">from</span></span> gg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">ff</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">0</span> <span class="main">@</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3a"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> le0 le_list_def strict_mono_less_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> mono_trace_hide<span class="main">[</span><span class="operator">OF</span> aa<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> ff0 ff1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="main">0</span> <span class="main">@</span> <span class="bound">t</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> someI_ex<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> zz<span class="main">=</span>this
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ff'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff'</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> gg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"mono <span class="skolem">ff'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> monoI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_trace_hide strict_mono_less_eq<span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> aa mono_constant <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">ff'</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">ff'</span> <span class="bound">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹mono <span class="skolem">ff'</span>›</span></span> ff'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> bb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">j</span></span><span class="main">≥</span><span class="skolem">m</span><span class="main">.</span> <span class="skolem">ff'</span> <span class="bound">j</span> <span class="main">=</span> <span class="skolem">ff'</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff'</span> <span class="skolem">m</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> 1
          <span class="keyword1"><span class="command">from</span></span> gg <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">f'</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lessI strict_monoD<span class="main">)</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> gg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">ff</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">k</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ff0 ff1 someI_ex<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NF_NT append_Nil2 front_tickFree_mono is_processT le_list_def less_list_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 2
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ff'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 3
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> 1
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> gg<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> strict_monoI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_monoD<span class="main">)</span> 
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">i</span><span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> gg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">ff</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ff0 ff1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">k</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> someI_ex<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_processT3_ST_pref <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">i</span><span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> bb<span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">+</span><span class="skolem">i</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> ff'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 4
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.add_0_right rangeI<span class="main">)</span> 
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">with</span></span> gg False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Falsebis aa append_Nil2 ff'_def front_tickFree_mono is_processT is_processT2_TR le_list_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">with</span></span> zz <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> hh<span class="main">:</span><span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">f</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_append_conv2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> ff0 ff1 gg <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>T_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>3<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="skolem">m</span> <span class="main">&lt;</span> <span class="skolem">f'</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> lessI strict_monoD<span class="main">)</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> gg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">ff</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">k</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> ff0 ff1 someI_ex<span class="main">)</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NF_NT append_Nil2 front_tickFree_mono is_processT le_list_def less_list_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">from</span></span> gg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">ff</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> ff0 ff1 mono_trace_hide<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="skolem">m</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="skolem">k</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> someI_ex<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> mono_trace_hide<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> mono_trace_hide<span class="main">[</span><span class="operator">OF</span> hh<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span> 3<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> 3<span class="main">(</span>6<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> dual_order.antisym filter_filter<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f'</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> 1
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.add_0_right rangeI<span class="main">)</span> 
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">with</span></span> 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> strict_monoI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_monoD<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">i</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> gg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">ff</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> ff0 ff1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span> <span class="skolem">k</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> someI_ex<span class="main">)</span>
          <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> T <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_processT3_ST_pref <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">i</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> gg <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">ff</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> ff0 ff1 mono_trace_hide<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> ll<span class="main">:</span><span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">f'</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">f</span> <span class="skolem">k</span>"</span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> someI_ex<span class="main">)</span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">::</span><span class="tfree">'a</span> event list<span class="main">)</span> <span class="main">≤</span> <span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">≤</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≤</span> <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span><span class="keyword1"><span class="command">}</span></span>
          <span class="keyword1"><span class="command">note</span></span> jj<span class="main">=</span>this
          <span class="keyword1"><span class="command">from</span></span> jj<span class="main">[</span><span class="operator">OF</span> mono_trace_hide<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hh<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span>
                  <span class="operator">OF</span> mono_trace_hide<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> mono_trace_hide<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f'</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">B</span></span> <span class="quoted"><span class="free">A</span></span><span class="main"><span class="main">,</span></span> 
                               <span class="operator">OF</span> gg<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">THEN</span> strict_mono_mono<span class="main"><span class="main"><span class="main">,</span></span></span> 
                               <span class="operator">THEN</span> monoD<span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">+</span><span class="skolem">i</span>"</span></span><span class="main"><span class="main"><span class="main">,</span></span></span> <span class="operator">simplified</span><span class="main"><span class="main"><span class="main">]</span></span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
               mono_trace_hide<span class="main">[</span><span class="operator">OF</span> ll<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">B</span></span><span class="main">]</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted">"3a"</span><span class="main">(</span>6<span class="main">)</span> <span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">k</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hide_un_D<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> D <span class="main">(</span><span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> D <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hide_un_D1 hide_un_D2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Laws ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_hide_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≤</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="free">P</span> \<span class="main">\</span> <span class="free">A</span> <span class="main">≤</span> <span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_ref_def F_hiding D_hiding<span class="main">)</span> 
  <span class="keyword1"><span class="command">using</span></span> F_subset_imp_T_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> mono_hide_ref <span class="main">=</span> mono_hiding

<span class="keyword1"><span class="command">lemma</span></span> hide_un<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> \<span class="main">\</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> \<span class="main">\</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> F_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="var">?A</span> <span class="bound">s</span> <span class="bound">X</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="var">?B</span> <span class="bound">s</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="var">?C1</span> <span class="bound">s</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C2</span> <span class="main">∪</span> <span class="var">?C3</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="var">?D</span> <span class="bound">s</span><span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> F_hiding set_eq_subset Un_subset_iff<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> filter_filter image_Un sup_commute sup_left_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> Un_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> hide_un_D<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">B</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="var">?C1</span> <span class="bound">s</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C2</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="var">?A</span> <span class="bound">s</span> <span class="bound">X</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> filter_filter image_Un sup_commute sup_left_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="var">?C1</span> <span class="bound">s</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C3</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="var">?B</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ta</span> <span class="skolem">u</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> hiding_fronttickFree <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">u</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">u</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
         <span class="keyword1"><span class="command">using</span></span> hiding_fronttickFree <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> filter_filter rangeI<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="var">?C1</span> <span class="bound">s</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C2</span> <span class="main">∪</span> <span class="var">?C3</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> 
                                  <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="var">?C1</span> <span class="bound">s</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C2</span> <span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> 
                                  <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">X</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="var">?C1</span> <span class="bound">s</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">X</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?C3</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Un_mono<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 4
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> Un_mono<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> hide_un_D<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">B</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hide_un_D<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hide_set_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊥</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec D_hiding F_hiding F_UU D_UU<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hiding_fronttickFree <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">using</span></span> front_tickFree_append hiding_tickFree <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">using</span></span> front_tickFree_append hiding_tickFree <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> append_Nil filter.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tickFree_Nil tickFree_implies_front_tickFree<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> front_tickFree_append hiding_tickFree <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
   <span class="keyword1"><span class="command">using</span></span> front_tickFree_append hiding_tickFree <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">using</span></span> tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 

<span class="keyword1"><span class="command">lemma</span></span> hide_set_STOP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>STOP \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> STOP"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec D_hiding F_hiding F_STOP D_STOP T_STOP<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> lessI less_irrefl strict_mono_eq<span class="main">)</span> <span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hide_set_SKIP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>SKIP \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> SKIP"</span></span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec D_hiding F_hiding F_SKIP D_SKIP T_SKIP <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> filter.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> non_tickFree_tick<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> hiding_tickFree n_not_Suc_n non_tickFree_tick strict_mono_eq<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> hiding_tickFree n_not_Suc_n non_tickFree_tick strict_mono_eq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> imageE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> imageE<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> hiding_tickFree n_not_Suc_n non_tickFree_tick strict_mono_eq<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hide_set_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec D_hiding F_hiding is_processT7 is_processT8_S strict_mono_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 front_tickFree_implies_tickFree front_tickFree_single is_processT 
            nonTickFree_n_frontTickFree<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Multi-Operators laws  ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hide_ndet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> \<span class="main">\</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec D_hiding F_hiding<span class="main"><span class="keyword3">,</span></span> 
      <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_ndet T_ndet D_ndet D_hiding F_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">b</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">b</span> <span class="skolem">u</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">}</span><span class="main">)</span> <span class="main">∨</span> infinite <span class="main">(</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> T <span class="free">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_nat_set_iff_bounded <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> T <span class="free">Q</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> 3<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> finite_nat_set_iff_bounded 
            is_processT3_ST_pref mem_Collect_eq not_less strict_mono_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> 3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> rangeI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">u</span> <span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span><span class="quoted"><span class="quoted">"infinite <span class="main">(</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">}</span><span class="main">)</span> <span class="main">∨</span> infinite <span class="main">(</span><span class="main">{</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> T <span class="free">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_nat_set_iff_bounded <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> T <span class="free">Q</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> 6<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> finite_nat_set_iff_bounded 
            is_processT3_ST_pref mem_Collect_eq not_less strict_mono_less_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> 6<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">,</span></span>5<span class="main"><span class="main">)</span></span> rangeI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hide_mprefix_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">B</span> <span class="main">∩</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">P</span><span class="main">)</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Mprefix <span class="free">A</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec<span class="main"><span class="keyword3">,</span></span> 
     <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_Mprefix T_Mprefix D_Mprefix D_hiding F_hiding<span class="main"><span class="keyword3">,</span></span>
     <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">b</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                                    imageE list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.collapse neq_Nil_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">a</span><span class="main">)</span>    
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span> <span class="main">∉</span> ev <span class="main">`</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword1"><span class="command">have</span></span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> hd <span class="skolem">t</span> <span class="main">#</span> trace_hide <span class="main">(</span>tl <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.exhaust_sel<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> tickFree_tl<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">f</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> kk<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="main">(</span><span class="skolem">f</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_numeral_extra<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nil_le not_less strict_mono_less_eq<span class="main">)</span> 
    <span class="keyword1"><span class="command">with</span></span> 4<span class="main">(</span>1<span class="main">)</span> 4<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> 4<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> ev <span class="skolem">a</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject 
                                         filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl imageE list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                                        hd_Cons_tl imageE list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
                                    hd_Cons_tl imageE list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 4<span class="main">(</span>1<span class="main">,</span> 7<span class="main">)</span> aa <span class="keyword1"><span class="command">have</span></span> nf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> ev <span class="skolem">a</span>"</span></span>    
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> append_Cons le_list_def le_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> neq0_conv old.nat.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> strict_mono_less_eq<span class="main">)</span> 
    <span class="keyword1"><span class="command">with</span></span> 4<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> sm<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="main">(</span>tl <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_tail strict_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 4 aa kk nf <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Nil_is_append_conv disjoint_iff_not_equal event.inject 
                                          filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl imageE list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                                        hd_Cons_tl hd_append2 image_iff list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI disjI2<span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> disjoint_iff_not_equal event.inject filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                    hd_Cons_tl hd_append2 image_iff list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tl <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> tickFree_tl<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                                        hd_Cons_tl imageE list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> tl_append2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> disj_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjCI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tl <span class="main">∘</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>         
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_iff_not_equal inf_sup_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">t</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span>  x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="skolem">a</span><span class="main">)</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> list.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span>  x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="skolem">a</span><span class="main">)</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> list.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">f</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main">)</span>        
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="skolem">a</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command">using</span></span> hd_Cons_tl <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>ev <span class="skolem">a</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_cons strict_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ev <span class="skolem">a</span> <span class="main">∧</span> trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl 
                                    imageE list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"hd <span class="skolem">x</span> <span class="main">=</span> ev <span class="skolem">a</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tl <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> tickFree_tl <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">using</span></span> aa <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                          hd_Cons_tl imageE list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> tl_append2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">f</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> kk<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">f</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">1</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="main">(</span><span class="skolem">f</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">A</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_numeral_extra<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nil_le not_less strict_mono_less_eq<span class="main">)</span> 
    <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>1<span class="main">)</span> 2<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> 2<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">0</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">=</span> ev <span class="skolem">a</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject 
                                         filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl imageE list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                                        hd_Cons_tl imageE list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span>
                                    hd_Cons_tl imageE list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>1<span class="main">,</span> 7<span class="main">)</span> aa <span class="keyword1"><span class="command">have</span></span> nf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> ev <span class="skolem">a</span>"</span></span>    
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> append_Cons le_list_def le_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> neq0_conv old.nat.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> strict_mono_less_eq<span class="main">)</span> 
    <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> sm<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="main">(</span>tl <span class="main">∘</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_tail strict_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> nf aa kk <span class="keyword1"><span class="command">have</span></span> x1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_is_append_conv disjoint_iff_not_equal event.inject filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                hd_Cons_tl imageE list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> nf aa kk <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="main">(</span>trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ev <span class="skolem">a</span> <span class="main">∧</span> trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl 
                                    imageE list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> nf aa kk x1 <span class="keyword1"><span class="command">have</span></span> x3<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span> <span class="main">=</span> ev <span class="skolem">a</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>    
    <span class="keyword1"><span class="command">with</span></span> 2 aa kk nf sm x1  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tl <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> tickFree_tl<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> 
                                        hd_Cons_tl imageE list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> tl_append2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> disj_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjCI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tl <span class="main">∘</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>         
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">x</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span>  x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="skolem">a</span><span class="main">)</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> list.collapse <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">f</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="skolem">a</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command">using</span></span> hd_Cons_tl <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>ev <span class="skolem">a</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_cons strict_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_hide_read<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">c</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> read_def o_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> hide_mprefix_distr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> no_hide_write0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hide_mprefix_distr write0_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hide_write0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">B</span>  <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write0_def Process_eq_spec<span class="main"><span class="keyword3">,</span></span> 
       <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_Mprefix T_Mprefix D_Mprefix D_hiding F_hiding<span class="main"><span class="keyword3">,</span></span>
       <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl image_eqI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> image_eqI list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                                      list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> neq_Nil_conv tickFree_tl<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">f</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> fS<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> Suc<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> Suc_mono comp_def strict_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span>  1 <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> less_Suc_eq_le less_irrefl nil_le strict_mono_less_eq<span class="main">)</span>      
    <span class="keyword1"><span class="command">with</span></span> fS <span class="keyword1"><span class="command">have</span></span> sm<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="main">(</span>tl <span class="main">∘</span> <span class="skolem">f</span> <span class="main">∘</span> Suc<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_tail strict_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 aa <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> disj_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjCI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>        
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tl <span class="main">(</span><span class="skolem">f</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> hiding_tickFree imageE tickFree_tl<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl image_eqI rangeE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> disj_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjCI<span class="main">)</span>        
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tl <span class="main">∘</span> <span class="skolem">f</span> <span class="main">∘</span> Suc"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">aa</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>     
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> image_eqI list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                                        list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="free">a</span><span class="main">)</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">f</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main">)</span>         
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="free">a</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main">)</span>       
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>ev <span class="free">a</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_cons strict_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tl <span class="improper">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> tickFree_tl <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl image_eqI<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">f</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> fS<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono <span class="main">(</span><span class="skolem">f</span> <span class="main">∘</span> Suc<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> Suc_mono comp_def strict_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span>  1 <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> less_Suc_eq_le less_irrefl nil_le strict_mono_less_eq<span class="main">)</span>      
    <span class="keyword1"><span class="command">with</span></span> fS <span class="keyword1"><span class="command">have</span></span> sm<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="main">(</span>tl <span class="main">∘</span> <span class="skolem">f</span> <span class="main">∘</span> Suc<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_tail strict_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1 aa <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tl <span class="main">(</span><span class="skolem">f</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> hiding_tickFree imageE tickFree_tl<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl image_eqI rangeE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> disj_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjCI<span class="main">)</span>        
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tl <span class="main">∘</span> <span class="skolem">f</span> <span class="main">∘</span> Suc"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> hd_Cons_tl list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="free">a</span><span class="main">)</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">f</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="free">a</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main">)</span>       
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span>ev <span class="free">a</span><span class="main">)</span> <span class="main">#</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_cons strict_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> no_hide_write<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="free">c</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>c <span class="main">`!`</span> <span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>c <span class="main">`!`</span> <span class="free">a</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> hide_mprefix_distr<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hide_write<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">==&gt;</span> <span class="main">(</span><span class="main">(</span>c <span class="main">`!`</span> <span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">B</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write_def hide_write0 mprefix_singl<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ The Sync Operator Laws ›</span></span>  

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Preliminaries ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> syncTlEmpty<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> tl <span class="free">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> tl <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">u</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> syncHd_Tl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> hd <span class="free">t</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> hd <span class="free">u</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span> hd <span class="free">a</span> <span class="main">=</span> hd <span class="free">u</span> <span class="main">∧</span> tl <span class="free">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> tl <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> syncHdAddEmpty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="free">a</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> hd <span class="free">a</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> hd <span class="free">a</span> <span class="main">#</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">using</span></span> hd_Cons_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 

<span class="keyword1"><span class="command">lemma</span></span> syncHdAdd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="free">a</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> hd <span class="free">a</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">∧</span> hd <span class="free">t</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="free">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">⟹</span> <span class="free">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> hd <span class="free">a</span> <span class="main">#</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="free">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 

<span class="keyword1"><span class="command">lemmas</span></span> syncHdAdd1 <span class="main">=</span> syncHdAdd<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">#</span><span class="free">r</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">a</span> <span class="free">r</span>

<span class="keyword1"><span class="command">lemma</span></span> syncSameHdTl<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> hd <span class="free">t</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> hd <span class="free">u</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> hd <span class="free">t</span> <span class="main">=</span> hd <span class="free">u</span> <span class="main">∧</span> hd <span class="free">a</span> <span class="main">=</span> hd <span class="free">t</span> <span class="main">∧</span> <span class="main">(</span>tl <span class="free">a</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="free">t</span><span class="main">,</span> tl <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">t</span></span></span></span></span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> synSingleHeadAdd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h</span> <span class="main">∉</span> <span class="free">A</span><span class="main">⟹</span> <span class="main">(</span><span class="free">h</span><span class="main">#</span><span class="free">a</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">h</span><span class="main">#</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">u</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> TickLeftSync<span class="main">:</span><span class="quoted"><span class="quoted">"tick <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> front_tickFree <span class="free">t</span> <span class="main">∧</span> <span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[</span>tick<span class="main">]</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∧</span> last <span class="free">t</span> <span class="main">=</span> tick"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nil.prems<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> emptyLeftProperty <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> last_ConsR last_snoc nonTickFree_n_frontTickFree tickFree_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons append_Nil front_tickFree_mono<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> EmptyLeftSync<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="free">t</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∧</span> set <span class="free">t</span> <span class="main">∩</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Int_emptyI emptyLeftNonSync emptyLeftProperty<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tick_T_F<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">t</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">t</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span><span class="main">,</span> <span class="free">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> append_T_imp_tickFree is_processT5_S7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> event_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e</span><span class="main">::</span><span class="tfree">'a</span> event<span class="main">)</span> <span class="main">∈</span> insert tick <span class="main">(</span>range ev<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> event.exhaust insert_iff rangeI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mprefix_Par_Int_distr1_D<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">A</span> <span class="main">⊆</span> <span class="free">C</span> <span class="main">⟹</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span> <span class="main">⟹</span>  D <span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> Mprefix <span class="free">B</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span>  D <span class="main">(</span> <span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span>  <span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync F_sync F_Mprefix T_Mprefix D_Mprefix<span class="main">)</span>  
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>  
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym empty_iff image_iff insertI2 list.exhaust_sel setinterleaving.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">" hd <span class="skolem">x</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> IntI empty_setinterleaving event.inject hd_append2 image_iff syncSameHdTl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  Nil_is_append_conv aa1 empty_setinterleaving event.inject hd_append2 syncSameHdTl  tickFree_tl tl_append2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>      
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.si_empty3 equals0D imageE image_eqI insertI2 list.exhaust_sel subsetCE<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">x</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">" hd <span class="skolem">x</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> IntI empty_setinterleaving event.inject hd_append2 image_iff syncSameHdTl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  Nil_is_append_conv aa1 empty_setinterleaving event.inject hd_append2 syncSameHdTl  tickFree_tl tl_append2<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">x</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>        
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.si_empty3 equals0D imageE image_eqI insertI2 list.exhaust_sel subsetCE<span class="main">)</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">x</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">" hd <span class="skolem">x</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> IntI empty_setinterleaving event.inject hd_append2 image_iff syncSameHdTl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> 5<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  aa1 append_Nil2 empty_setinterleaving event.inject syncSameHdTl<span class="main">)</span>   
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">x</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>       
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.si_empty3 equals0D imageE image_eqI insertI2 list.exhaust_sel subsetCE<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">x</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 7<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 7<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">" hd <span class="skolem">x</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> IntI empty_setinterleaving event.inject hd_append2 image_iff syncSameHdTl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 7<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  aa1 append_Nil2 empty_setinterleaving event.inject syncSameHdTl<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>  
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span><span class="main">∧</span><span class="skolem">u1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">r1</span><span class="main">∧</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Cons_eq_appendI aa0 event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.exhaust_sel tickFree_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>   
      <span class="keyword1"><span class="command">using</span></span> aa0 subsetCE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">t1</span><span class="main">)</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>tl <span class="skolem">u1</span><span class="main">)</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span> ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">t1</span><span class="main">∧</span>ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">u1</span><span class="main">∧</span> hd <span class="skolem">t1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span> hd <span class="skolem">u1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span>"</span></span>  
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>      
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span><span class="main">(</span>6<span class="main">)</span> aa1 aa2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span><span class="main">∧</span><span class="skolem">u1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">r1</span><span class="main">∧</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Cons_eq_appendI aa0 event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.exhaust_sel tickFree_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>   
      <span class="keyword1"><span class="command">using</span></span> aa0 subsetCE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">t1</span><span class="main">)</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Q</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>tl <span class="skolem">u1</span><span class="main">)</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">P</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span> ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">t1</span><span class="main">∧</span>ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">u1</span><span class="main">∧</span> hd <span class="skolem">t1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span> hd <span class="skolem">u1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span>"</span></span>  
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>      
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span><span class="main">(</span>6<span class="main">)</span> aa1 aa2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span><span class="main">∧</span><span class="skolem">u1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>   
      <span class="keyword1"><span class="command">using</span></span> aa0 subsetCE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">t1</span><span class="main">)</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>tl <span class="skolem">u1</span><span class="main">)</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span> ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">t1</span><span class="main">∧</span>ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">u1</span><span class="main">∧</span> hd <span class="skolem">t1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span> hd <span class="skolem">u1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">∧</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  Int_lower1 Int_lower2 append_Nil2 imageE image_eqI list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subsetCE<span class="main">)</span>    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> aa2 event.inject imageE<span class="main">)</span>     
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span><span class="main">∧</span><span class="skolem">u1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>   
      <span class="keyword1"><span class="command">using</span></span> aa0 subsetCE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">t1</span><span class="main">)</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Q</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>tl <span class="skolem">u1</span><span class="main">)</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">P</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span> ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">t1</span><span class="main">∧</span>ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">u1</span><span class="main">∧</span> hd <span class="skolem">t1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span> hd <span class="skolem">u1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">∧</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  Int_lower1 Int_lower2 append_Nil2 imageE image_eqI list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subsetCE<span class="main">)</span>    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> aa2 event.inject imageE<span class="main">)</span>  
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hide_interleave<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>trace_hide <span class="free">r</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>trace_hide <span class="free">t</span> <span class="free">A</span><span class="main">,</span> trace_hide <span class="free">u</span> <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">r</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync empty_setinterleaving <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">list</span> <span class="skolem">aa</span> <span class="skolem">lista</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">list</span> <span class="skolem">aa</span> <span class="skolem">lista</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> disjE<span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">list</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> synSingleHeadAdd<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">lista</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym filter.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> synSingleHeadAdd<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span> <span class="skolem">list</span> <span class="skolem">aa</span> <span class="skolem">lista</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> non_sync_interleaving<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">t</span> <span class="main">∪</span> set <span class="free">u</span><span class="main">)</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> setinterleaving <span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">C</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="comment1">(* FINALLY NON-USED*)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_empty_left disjoint_iff_not_equal emptyLeftSelf empty_iff empty_set<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">t</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> interleave_hide<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">ra</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>trace_hide <span class="free">t</span> <span class="free">A</span><span class="main">,</span> trace_hide <span class="free">u</span> <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">ra</span> <span class="main">=</span> trace_hide <span class="bound">r</span> <span class="free">A</span> <span class="main">∧</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"length <span class="free">t</span> <span class="main">+</span> length <span class="free">u</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">ra</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span>nat_less_induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Ind<span class="main">:</span>1
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nilt<span class="main">:</span> Nil
    <span class="keyword1"><span class="command">from</span></span> Ind<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"set <span class="main">(</span>trace_hide <span class="skolem">u</span> <span class="free">A</span><span class="main">)</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> set <span class="skolem">u</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Ind<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> EmptyLeftSync Nilt disjoint_iff_not_equal emptyLeftSelf filter.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ra</span>"</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="skolem">u</span> <span class="free">A</span>"</span></span><span class="main">]</span> a b Cons Nilt Ind<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>  
    <span class="keyword3"><span class="command">case</span></span> Const<span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">ta</span> <span class="skolem">tlist</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nilu<span class="main">:</span> Nil
      <span class="keyword1"><span class="command">from</span></span> Ind<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"set <span class="main">(</span>trace_hide <span class="skolem">t</span> <span class="free">A</span><span class="main">)</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> set <span class="skolem">t</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Ind<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Nilu EmptyLeftSync disjoint_iff_not_equal emptyLeftSelf filter.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Sync.sym<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ra</span>"</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="skolem">t</span> <span class="free">A</span>"</span></span><span class="main">]</span> a b Ind Nilu <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym filter.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Consu<span class="main">:</span> <span class="main">(</span>Cons <span class="skolem">ua</span> <span class="skolem">ulist</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> Const Ind<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>setinterleaving.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">raa</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> Ind<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">tlist</span> <span class="main">+</span> length <span class="skolem">u</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> Const<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                        <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">tlist</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">,</span> <span class="operator">simplified</span> Ind<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                        <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">raa</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">raa</span> <span class="main">=</span> trace_hide <span class="skolem">r</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tlist</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span><span class="main">(</span>4<span class="main">)</span> Consu <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">raa</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> Ind<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">t</span> <span class="main">+</span> length <span class="skolem">ulist</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> Consu<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                    <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">ulist</span></span><span class="main">,</span> <span class="operator">simplified</span> Ind<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                    <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">raa</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">raa</span> <span class="main">=</span> trace_hide <span class="skolem">r</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">ulist</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span><span class="main">(</span>2<span class="main">)</span> <span class="quoted">"2"</span><span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">raa</span><span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> Ind<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">tlist</span> <span class="main">+</span> length <span class="skolem">ulist</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> Const Consu<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                      <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">tlist</span></span> <span class="quoted"><span class="skolem">ulist</span></span><span class="main">,</span> <span class="operator">simplified</span> Ind<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                      <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">raa</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">raa</span> <span class="main">=</span> trace_hide <span class="skolem">r</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tlist</span><span class="main">,</span> <span class="skolem">ulist</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3"</span><span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">raa</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> Ind<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">t</span> <span class="main">+</span> length <span class="skolem">ulist</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> Consu<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                    <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">ulist</span></span><span class="main">,</span> <span class="operator">simplified</span> Ind<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                    <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">raa</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">raa</span> <span class="main">=</span> trace_hide <span class="skolem">r</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">ulist</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"4"</span><span class="main">(</span>5<span class="main">)</span> Const <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">raa</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> Ind<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">tlist</span> <span class="main">+</span> length <span class="skolem">u</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> Const<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                        <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">tlist</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">,</span> <span class="operator">simplified</span> Ind<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                        <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">raa</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">raa</span> <span class="main">=</span> trace_hide <span class="skolem">r</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tlist</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"5"</span><span class="main">(</span>4<span class="main">)</span> Consu <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">raa</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> Ind<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">t</span> <span class="main">+</span> length <span class="skolem">ulist</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> Consu<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                    <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">ulist</span></span><span class="main">,</span> <span class="operator">simplified</span> Ind<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                    <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">raa</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">raa</span> <span class="main">=</span> trace_hide <span class="skolem">r</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">ulist</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"6"</span><span class="main">(</span>5<span class="main">)</span> Const <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">raa</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> Ind<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">tlist</span> <span class="main">+</span> length <span class="skolem">u</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> Const<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                        <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">tlist</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">,</span> <span class="operator">simplified</span> Ind<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                        <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">raa</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            <span class="quoted"><span class="quoted">"<span class="skolem">raa</span> <span class="main">=</span> trace_hide <span class="skolem">r</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tlist</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"7"</span><span class="main">(</span>4<span class="main">)</span> Consu <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">with</span></span> Ind<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">t</span> <span class="main">+</span> length <span class="skolem">ulist</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> Consu<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                      <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">ulist</span></span><span class="main">,</span> <span class="operator">simplified</span> Ind<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                      <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">ra</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">ra</span> <span class="main">=</span> trace_hide <span class="skolem">r</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">ulist</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">ua</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span><span class="main">(</span>5<span class="main">)</span> Const Ind.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 3
        <span class="keyword1"><span class="command">with</span></span> Ind<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">tlist</span> <span class="main">+</span> length <span class="skolem">u</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> Const<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                      <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">tlist</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">,</span> <span class="operator">simplified</span> Ind<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                      <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">ra</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">ra</span> <span class="main">=</span> trace_hide <span class="skolem">r</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tlist</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">ta</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3"</span><span class="main">(</span>4<span class="main">)</span> Consu Ind.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 4
        <span class="keyword1"><span class="command">with</span></span> Ind<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"length <span class="skolem">tlist</span> <span class="main">+</span> length <span class="skolem">ulist</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> Const Consu<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                      <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">tlist</span></span> <span class="quoted"><span class="skolem">ulist</span></span><span class="main">,</span> <span class="operator">simplified</span> Ind<span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> 
                      <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">ra</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">ra</span> <span class="main">=</span> trace_hide <span class="skolem">r</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tlist</span><span class="main">,</span> <span class="skolem">ulist</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">ta</span><span class="main">#</span><span class="skolem">ua</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"4"</span><span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> Consu Const Ind.prems<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
           <span class="keyword1"><span class="command">using</span></span> synSingleHeadAdd <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym synSingleHeadAdd<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> interleave_size<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> length <span class="free">s</span> <span class="main">=</span> length <span class="free">t</span> <span class="main">+</span> length <span class="free">u</span> <span class="main">-</span> length<span class="main">(</span>filter <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="free">C</span><span class="main">)</span> <span class="free">t</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync empty_setinterleaving <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> emptyLeftProperty <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym add_diff_cancel_right' emptyLeftNonSync emptyLeftProperty filter_empty_conv<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 11 12 13 14 15<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">tlist</span> <span class="skolem">ulist</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Suc_diff_le le_add1 length_filter_le order_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">ta</span> <span class="skolem">tlist</span> <span class="skolem">ulist</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 12<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ta</span><span class="main">#</span><span class="skolem">tlist</span>"</span></span> <span class="quoted"><span class="skolem">ulist</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_le le_add1 length_filter_le order_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>13 <span class="skolem">tlist</span> <span class="skolem">ua</span> <span class="skolem">ulist</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 13<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">tlist</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ua</span><span class="main">#</span><span class="skolem">ulist</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_le le_less_trans length_filter_le less_SucI less_Suc_eq_le less_add_Suc1<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>14 <span class="skolem">ta</span> <span class="skolem">tlist</span> <span class="skolem">ulist</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 14<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ta</span><span class="main">#</span><span class="skolem">tlist</span>"</span></span> <span class="quoted"><span class="skolem">ulist</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_le le_less_trans length_filter_le less_SucI less_Suc_eq_le less_add_Suc1<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>15 <span class="skolem">tlist</span> <span class="skolem">ua</span> <span class="skolem">ulist</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 15<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">tlist</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ua</span><span class="main">#</span><span class="skolem">ulist</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> Suc_diff_le le_less_trans length_filter_le less_SucI less_Suc_eq_le less_add_Suc1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> interleave_eq_size<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">s'</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> length <span class="free">s</span> <span class="main">=</span> length <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> interleave_size<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> interleave_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> set <span class="free">t</span> <span class="main">∪</span> set <span class="free">u</span> <span class="main">⊆</span> set <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync empty_setinterleaving <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> emptyLeftProperty <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym Un_empty_right emptyLeftProperty empty_set eq_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> interleave_order<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t1</span><span class="main">@</span><span class="free">t2</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> set<span class="main">(</span><span class="free">t2</span><span class="main">)</span> <span class="main">⊆</span> set<span class="main">(</span>drop <span class="main">(</span>length <span class="free">t1</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t1</span></span> <span class="quoted"><span class="free">t2</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> empty_setinterleaving <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t1</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> append_self_conv2 interleave_set <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> EmptyLeftSync Sync.sym append_eq_conv_conj order_refl<span class="main">)</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">list</span> <span class="skolem">lista</span> <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lista</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Suc_n_not_le_n contra_subsetD nat_le_linear set_drop_subset_set_drop<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">list</span> <span class="skolem">lista</span> <span class="skolem">t</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">list</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lista</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Suc_n_not_le_n contra_subsetD nat_le_linear set_drop_subset_set_drop<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> interleave_append<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t1</span><span class="main">@</span><span class="free">t2</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">u1</span> <span class="bound">u2</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="free">u</span> <span class="main">=</span> <span class="bound">u1</span><span class="main">@</span><span class="bound">u2</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">=</span> <span class="bound">s1</span><span class="main">@</span><span class="bound">s2</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="bound">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t2</span><span class="main">,</span><span class="bound">u2</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t1</span></span> <span class="quoted"><span class="free">t2</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> empty_setinterleaving <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t1</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> append_self_conv2 interleave_set <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Nil_is_append_conv append_Cons<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">list</span> <span class="skolem">lista</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lista</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">u1</span> <span class="skolem">u2</span> <span class="skolem">s1</span> <span class="skolem">s2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">u1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">u2</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> append_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>      
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">aa</span> <span class="skolem">list</span> <span class="skolem">lista</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">#</span><span class="skolem">list</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lista</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">u1</span> <span class="skolem">u2</span> <span class="skolem">s1</span> <span class="skolem">s2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">u1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">u2</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> append_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">list</span> <span class="skolem">aa</span> <span class="skolem">lista</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> 3<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">u1</span> <span class="skolem">u2</span> <span class="skolem">s1</span> <span class="skolem">s2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">u2</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons synSingleHeadAdd<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">aa</span> <span class="skolem">list</span> <span class="skolem">lista</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">#</span><span class="skolem">list</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">lista</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> 4<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">u1</span> <span class="skolem">u2</span> <span class="skolem">s1</span> <span class="skolem">s2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">u1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">u2</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> append_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">list</span> <span class="skolem">aa</span> <span class="skolem">lista</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">list</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span><span class="main">#</span><span class="skolem">lista</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> 5<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">u1</span> <span class="skolem">u2</span> <span class="skolem">s1</span> <span class="skolem">s2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">u2</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Cons synSingleHeadAdd<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> interleave_append_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u1</span><span class="main">@</span><span class="free">u2</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span> <span class="bound">t1</span> <span class="bound">t2</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="free">t</span> <span class="main">=</span> <span class="bound">t1</span><span class="main">@</span><span class="bound">t2</span> <span class="main">∧</span> <span class="free">s</span> <span class="main">=</span> <span class="bound">s1</span><span class="main">@</span><span class="bound">s2</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t1</span><span class="main">,</span><span class="free">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">s2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t2</span><span class="main">,</span><span class="free">u2</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Sync.sym interleave_append<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> interleave_append_tail<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t1</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>set <span class="free">t2</span><span class="main">)</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">@</span><span class="free">t2</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t1</span><span class="main">@</span><span class="free">t2</span><span class="main">,</span><span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">s</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t1</span></span> <span class="quoted"><span class="free">t2</span></span> <span class="quoted"><span class="free">u</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Set.set_insert Sync.sym append_Nil disjoint_insert<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> emptyLeftSelf empty_setinterleaving<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync Sync.sym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">t2</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> defined_all<span class="main">]</span><span class="main">]</span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">list</span> <span class="skolem">lista</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">list</span> <span class="skolem">aa</span> <span class="skolem">lista</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">list</span> <span class="skolem">aa</span> <span class="skolem">lista</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 3<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 3<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> 3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">list</span> <span class="skolem">aa</span> <span class="skolem">lista</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> 4<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 4<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> 4<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> interleave_append_tail_sym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u1</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>set <span class="free">u2</span><span class="main">)</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">s</span><span class="main">@</span><span class="free">u2</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span><span class="free">u1</span><span class="main">@</span><span class="free">u2</span><span class="main">)</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Sync.sym interleave_append_tail<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> interleave_assoc_1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">tuv</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">tu</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">uv</span><span class="main">.</span> <span class="bound">uv</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">tuv</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="bound">uv</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">tuv</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quoted"><span class="free">tu</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync empty_setinterleaving <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Cons_tuv<span class="main">:</span><span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">tuv</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil_t<span class="main">:</span>Nil
    <span class="keyword1"><span class="command">with</span></span> Cons_tuv<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tu</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil_u<span class="main">:</span>Nil
      <span class="keyword1"><span class="command">with</span></span> Nil_t Cons_tuv <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Cons_u<span class="main">:</span><span class="main">(</span>Cons <span class="skolem">ua</span> <span class="skolem">ulist</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> Nil_t Cons_tuv<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ua</span> <span class="main">∉</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>  
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil_v<span class="main">:</span>Nil
        <span class="keyword1"><span class="command">with</span></span> * Nil_t Cons_tuv<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> Cons_u <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Cons_v<span class="main">:</span><span class="main">(</span>Cons <span class="skolem">va</span> <span class="skolem">vlist</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> * Nil_t Cons_tuv<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> Cons_u <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">tuv</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span> 
          <span class="keyword1"><span class="command">using</span></span> Cons_tuv.hyps Cons_tuv.prems<span class="main">(</span>1<span class="main">)</span> emptyLeftProperty <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> Cons_t<span class="main">:</span><span class="main">(</span>Cons <span class="skolem">ta</span> <span class="skolem">tlist</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">u</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil_u<span class="main">:</span>Nil
      <span class="keyword1"><span class="command">with</span></span> Cons_t Cons_tuv <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym emptyLeftProperty emptyLeftSelf empty_set equals0D ftf_syn21<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> Cons_u<span class="main">:</span><span class="main">(</span>Cons <span class="skolem">ua</span> <span class="skolem">ulist</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">v</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil_v<span class="main">:</span>Nil
        <span class="keyword1"><span class="command">with</span></span> Cons_tuv<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">#</span> <span class="skolem">tuv</span> <span class="main">=</span> <span class="skolem">tu</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Nil_v EmptyLeftSync Sync.sym<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> Nil_v Cons_u Cons_t Cons_tuv <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Cons_t Nil_v Sync.sym emptyLeftNonSync list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> Cons_tuv<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">tuv</span></span> <span class="quoted"><span class="skolem">tlist</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym emptyLeftNonSync emptyLeftSelf list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> syncTlEmpty<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_t Sync.sym emptyLeftProperty<span class="main">)</span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>  
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> Cons_v<span class="main">:</span><span class="main">(</span>Cons <span class="skolem">va</span> <span class="skolem">vlist</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> Cons_t Cons_u Cons_tuv<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">tulist</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> Cons_tuv<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> 1<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uvlist</span></span> 
            <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">uvlist</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ulist</span><span class="main">,</span> <span class="skolem">vlist</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">tuv</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tlist</span><span class="main">,</span> <span class="skolem">uvlist</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">va</span><span class="main">#</span><span class="skolem">uvlist</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_tuv.hyps Cons_tuv.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Sync.sym synSingleHeadAdd<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_tuv.hyps Sync.sym synSingleHeadAdd<span class="main">)</span> 
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_tuv.hyps Cons_tuv.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Sync.sym synSingleHeadAdd<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_tuv.hyps Sync.sym synSingleHeadAdd<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_tuv.hyps Cons_tuv.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Sync.sym synSingleHeadAdd<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_tuv.hyps Sync.sym synSingleHeadAdd<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">tulist</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> Cons_tuv<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 8<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> 8<span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uvlist</span></span> 
            <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">uvlist</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">va</span><span class="main">#</span><span class="skolem">ulist</span><span class="main">,</span> <span class="skolem">va</span><span class="main">#</span><span class="skolem">vlist</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">tuv</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tlist</span><span class="main">,</span> <span class="skolem">uvlist</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> 8 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> synSingleHeadAdd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">uvlist</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_tuv.hyps Cons_tuv.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Sync.sym synSingleHeadAdd<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">tulist</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> Cons_tuv<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 10<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> 10<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uvlist</span></span> 
            <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">uvlist</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ua</span><span class="main">#</span><span class="skolem">ulist</span><span class="main">,</span> <span class="skolem">va</span><span class="main">#</span><span class="skolem">vlist</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">tuv</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tlist</span><span class="main">,</span> <span class="skolem">uvlist</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> 10 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> synSingleHeadAdd <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">uvlist</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_tuv.hyps Cons_tuv.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Sync.sym synSingleHeadAdd<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons_tuv.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>13 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_tuv.hyps Sync.sym synSingleHeadAdd<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>14 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_tuv.hyps Sync.sym synSingleHeadAdd<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>15 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_tuv.hyps Sync.sym synSingleHeadAdd<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>16 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_tuv.hyps Cons_tuv.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Sync.sym synSingleHeadAdd<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>17 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_tuv.hyps Sync.sym synSingleHeadAdd<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>18 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons_tuv.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>19 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons_tuv.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>20 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons_tuv.hyps Cons_tuv.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Sync.sym synSingleHeadAdd<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>21 <span class="skolem">u</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Cons_tuv.hyps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> interleave_assoc_2<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">uv</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">u</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
         **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">tuv</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">uv</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">tu</span><span class="main">.</span> <span class="bound">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="free">t</span><span class="main">,</span> <span class="free">u</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="free">tuv</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">tu</span><span class="main">,</span> <span class="free">v</span><span class="main">)</span><span class="main">,</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"*"</span> <span class="quoted">"**"</span> Sync.sym interleave_assoc_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Laws ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sync_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec mono_D_syn mono_F_syn<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_sync_FD_oneside<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≤</span> <span class="free">P'</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">P'</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>le_ref_def F_sync D_sync<span class="main">)</span> 
  <span class="keyword1"><span class="command">using</span></span> F_subset_imp_T_subset front_tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_sync_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">P</span> <span class="main">≤</span> <span class="free">P'</span><span class="main">;</span> <span class="free">Q</span> <span class="main">≤</span> <span class="free">Q'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">P'</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mono_sync_FD_oneside<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">P'</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">]</span> mono_sync_FD_oneside<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">Q'</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> order_trans sync_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_sync_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">P</span> <span class="main">⊑</span> <span class="free">P'</span><span class="main">;</span> <span class="free">Q</span> <span class="main">⊑</span> <span class="free">Q'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">P'</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mono_Sync_sym<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">Q'</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> mono_Sync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">P'</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">Q'</span></span><span class="main">]</span> below_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> par_Int_bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="main">⊥</span><span class="main">)</span> <span class="main">=</span> <span class="main">⊥</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync F_sync F_UU D_UU<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree append_Nil2 front_tickFree_append ftf_syn is_processT is_processT2_TR<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Nil_elem_T Sync.si_empty1 append_Nil front_tickFree_Nil insertI1 non_tickFree_implies_nonMt<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree append_Nil2 front_tickFree_append ftf_syn is_processT2_TR<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_elem_T Sync.si_empty1 append_Nil front_tickFree_Nil insertI1 non_tickFree_implies_nonMt<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> par_Int_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>SKIP <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> SKIP<span class="main">)</span> <span class="main">=</span> SKIP"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync F_sync F_SKIP D_SKIP<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Sync.si_empty1 inf.idem insertI1 sup_commute sup_inf_absorb<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>tick<span class="main">]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="main">[</span>tick<span class="main">]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> par_Int_skip_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>SKIP <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> STOP<span class="main">)</span> <span class="main">=</span> STOP"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync F_sync F_SKIP D_SKIP F_STOP D_STOP<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">elim</span> exE conjE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">-</span><span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Multi-Operators laws  ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mprefix_Par_Int_distr<span class="main">:</span> <span class="quoted"><span class="quoted">"
  <span class="main">⟦</span><span class="free">B</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">C</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟦</span> <span class="free">C</span> <span class="main">⟧</span> <span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">→</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">→</span> <span class="main">(</span><span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">⟦</span> <span class="free">C</span> <span class="main">⟧</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span>"</span></span>    
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_Mprefix T_Mprefix D_Mprefix D_sync F_sync<span class="main">)</span>  
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span> 
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>  
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">aa</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> emptyLeftProperty syncTlEmpty<span class="main">)</span>   
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym empty_iff image_iff list.exhaust_sel setinterleaving.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetCE subset_insertI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>7<span class="main">,</span>8<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span> <span class="main">∈</span>insert tick<span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span> <span class="main">∉</span>insert tick<span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> insertI2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> empty_setinterleaving syncHd_Tl<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.si_empty3 equals0D imageE list.exhaust_sel rev_image_eqI subset_eq subset_insertI<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">r</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">∧</span><span class="skolem">a</span><span class="main">≠</span> <span class="main">[]</span><span class="main">∧</span>hd <span class="skolem">t</span> <span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span> <span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"5"</span><span class="main">(</span>1<span class="main">)</span> <span class="quoted">"5"</span><span class="main">(</span>11<span class="main">)</span> <span class="quoted">"5"</span><span class="main">(</span>13<span class="main">)</span> <span class="quoted">"5"</span><span class="main">(</span>2<span class="main">)</span> <span class="quoted">"5"</span><span class="main">(</span>8<span class="main">)</span> disjoint_iff_not_equal empty_setinterleaving insert_iff set_mp <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> a1 <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">u</span><span class="main">=</span>hd <span class="skolem">a</span><span class="main">∧</span>tl <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hd_append2 syncHd_Tl<span class="main">)</span>     
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 5<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a1 a3 image_eqI tickFree_tl tl_append2<span class="main">)</span>       
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>  
    <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∧</span>tl <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"6"</span><span class="main">(</span>7<span class="main">)</span> Sync.sym emptyLeftProperty syncTlEmpty <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> 6<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  EmptyLeftSync Nil_is_append_conv Sync.sym a1 tickFree_tl tl_append2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> 7<span class="main">(</span>2<span class="main">,</span>1<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∉</span> insert tick<span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick<span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> image_eqI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
    <span class="keyword1"><span class="command">from</span></span> 7<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> a2  <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∧</span><span class="skolem">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>tl <span class="skolem">a</span> <span class="main">=</span>tl <span class="skolem">r</span> <span class="main">@</span> <span class="skolem">v</span> <span class="main">∧</span> tl <span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_is_append_conv Sync.sym empty_setinterleaving hd_append2 syncHd_Tl tl_append2<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 7<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  a3 list.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tickFree_tl<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym empty_iff image_iff insertI2 list.exhaust_sel setinterleaving.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetCE<span class="main">)</span>   
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> 9<span class="main">(</span>2<span class="main">,</span>8<span class="main">,</span>1<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∈</span> insert tick<span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∉</span> insert tick<span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> append_Nil2 empty_setinterleaving image_eqI syncHd_Tl<span class="main">)</span>   
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> EmptyLeftSync Sync.sym append_Nil2  syncTlEmpty<span class="main">)</span>      
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> 11<span class="main">(</span>2<span class="main">,</span>8<span class="main">,</span>1<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">u</span><span class="main">∈</span> insert tick<span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">t</span><span class="main">∉</span> insert tick<span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"11"</span><span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> <span class="quoted">"11"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"11"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"11"</span><span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> <span class="quoted">"11"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"11"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"11"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"11"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"11"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"11"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> Sync.sym append_Nil2 empty_setinterleaving syncHd_Tl<span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>   
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">X</span><span class="main">::</span><span class="tfree">'a</span> event set<span class="main">)</span><span class="main">=</span><span class="skolem">b</span><span class="main">-</span>ev <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∩</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="main">{}</span><span class="main">∧</span> <span class="skolem">b</span> <span class="main">∩</span> ev <span class="main">`</span> <span class="free">B</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"1"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> Int_commute<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> aa1 <span class="keyword1"><span class="command">have</span></span> a12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">b</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a21<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> a12 a21 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aa2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>7<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> event.inject imageE insertE syncHdAddEmpty<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">ab</span><span class="main">)</span>  
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">∉</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">t</span><span class="main">∈</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3"</span><span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>    
      <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> syncHdAdd<span class="main">)</span>       
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">ab</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">,</span>7<span class="main">,</span>11<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">a</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>12<span class="main">)</span> aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="skolem">aa</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span>hd <span class="skolem">a</span><span class="main">#</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd<span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> ev <span class="skolem">aa</span> <span class="main">∧</span>  <span class="skolem">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> <span class="skolem">aa</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  event.inject imageE list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> syncHdAdd1<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 4<span class="main">(</span>3<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  aa1 aa2 append_Cons list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>1<span class="main">,</span>4<span class="main">,</span>7<span class="main">,</span>9<span class="main">,</span>11<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">t</span><span class="main">)</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>tickFree <span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"5"</span><span class="main">(</span>11<span class="main">)</span> <span class="quoted">"5"</span><span class="main">(</span>7<span class="main">)</span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
      <span class="keyword1"><span class="command">using</span></span> 5<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  append_Cons list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">ab</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>1<span class="main">,</span>4<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">a</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">t</span><span class="main">)</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject event.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> imageE insertE synSingleHeadAdd tickFree_Cons<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 6<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  aa1 append_Cons list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>   
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">ab</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 7<span class="main">(</span>1<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>12<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span>hd <span class="skolem">a</span><span class="main">#</span> <span class="skolem">u</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd<span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> ev <span class="skolem">aa</span><span class="main">∧</span><span class="skolem">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> <span class="skolem">aa</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">a</span> <span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span>  insertE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> 7<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span><span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  imageE rev_image_eqI subset_iff subset_insertI syncHdAdd1<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 7<span class="main">(</span>3<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  aa1 append.right_neutral list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> 8<span class="main">(</span>1<span class="main">,</span>4<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">t</span><span class="main">)</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"8"</span><span class="main">(</span>11<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 8<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  EmptyLeftSync Sync.sym append.right_neutral list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">ab</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> 9<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">∧</span>hd <span class="skolem">a</span><span class="main">#</span> <span class="skolem">t</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span> hd<span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> ev <span class="skolem">aa</span> <span class="main">∧</span>  <span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Q</span> <span class="skolem">aa</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">a</span><span class="main">∉</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 9<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  Sync.sym append.right_neutral list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> syncHdAdd<span class="main">)</span>      
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>13 <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym empty_iff image_iff insertI2 list.exhaust_sel setinterleaving.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetCE<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span><span class="main">∧</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span>tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_is_append_conv aa0 empty_setinterleaving syncHd_Tl<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
        <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  empty_setinterleaving hd_append2 image_eqI list.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tickFree_tl tl_append2<span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span>"</span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Nil_is_append_conv Sync.sym emptyLeftProperty<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  Sync.sym  emptyLeftProperty hd_append2 syncTlEmpty tickFree_tl tl_append2<span class="main">)</span>      
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nil_is_append_conv Sync.sym aa0 empty_setinterleaving syncHd_Tl<span class="main">)</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> empty_setinterleaving hd_append2 tickFree_tl tl_append2<span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym equals0D image_iff list.exhaust_sel setinterleaving.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetCE subset_insertI<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">∧</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span>tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> aa0 empty_setinterleaving syncHd_Tl<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 5<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  aa0  image_iff self_append_conv syncHd_Tl<span class="main">)</span>    
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym append_Nil2 emptyLeftProperty syncTlEmpty<span class="main">)</span>    
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 7<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> Sync.sym append_Nil2 empty_setinterleaving syncHd_Tl<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>      
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>14 <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>   
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">,</span>4<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">x</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">)</span> aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd<span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span> <span class="main">=</span>ev <span class="skolem">a</span><span class="main">∧</span><span class="skolem">u</span><span class="main">∈</span>T<span class="main">(</span><span class="free">Q</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span><span class="free">B</span><span class="main">∧</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span><span class="main">≠</span><span class="main">[]</span><span class="main">∧</span>tickFree <span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">x</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  event.inject imageE image_eqI insertI2 list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subsetCE syncHdAdd1<span class="main">)</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
        <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  aa1  append_Cons list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>  
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">,</span>4<span class="main">,</span>7<span class="main">,</span>9<span class="main">,</span>11<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span>  Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  append_Cons list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>  
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">,</span>4<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">x</span><span class="main">∉</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">,</span>9<span class="main">,</span>11<span class="main">,</span>12<span class="main">,</span>13<span class="main">)</span> aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>tickFree <span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">x</span><span class="main">∉</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym image_subset_iff set_rev_mp subset_insertI syncHdAdd1<span class="main">)</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
        <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>   aa1 append_Cons list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>       
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd<span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span> <span class="main">=</span>ev <span class="skolem">a</span><span class="main">∧</span><span class="skolem">u</span><span class="main">∈</span>T<span class="main">(</span><span class="free">Q</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span><span class="skolem">a</span><span class="main">∈</span><span class="free">B</span><span class="main">∧</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span><span class="main">≠</span><span class="main">[]</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  event.inject imageE image_eqI insertI2 list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subsetCE syncHdAdd1<span class="main">)</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
        <span class="keyword1"><span class="command">using</span></span> 4<span class="main">(</span>3<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>   list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> self_append_conv<span class="main">)</span>  
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"14"</span><span class="main">(</span>1<span class="main">)</span> <span class="quoted">"5"</span><span class="main">(</span>11<span class="main">)</span> <span class="quoted">"5"</span><span class="main">(</span>4<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
        <span class="keyword1"><span class="command">using</span></span> 5<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  append.right_neutral list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.inject event.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> imageE insertE synSingleHeadAdd<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
        <span class="keyword1"><span class="command">using</span></span> 6<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  append_Nil2 list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>      
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mprefix_Par_Int<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">B</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> 
  <span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">P</span> <span class="main">⟦</span> <span class="free">C</span> <span class="main">⟧</span> Mprefix <span class="free">B</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span>  <span class="free">A</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">⟦</span> <span class="free">C</span> <span class="main">⟧</span> Mprefix <span class="free">B</span> <span class="free">Q</span><span class="main">)</span> <span class="main">□</span> <span class="main">(</span><span class="main">□</span> <span class="bound">y</span> <span class="main">∈</span>  <span class="free">B</span> <span class="main">→</span> <span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">P</span> <span class="main">⟦</span> <span class="free">C</span> <span class="main">⟧</span> <span class="free">Q</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync F_sync F_Mprefix T_Mprefix D_Mprefix F_det D_det<span class="main">)</span>   
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> IntE Un_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> emptyLeftProperty syncTlEmpty<span class="main">)</span>        
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym emptyLeftProperty syncTlEmpty<span class="main">)</span>     
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>7<span class="main">,</span>8<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>3<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="skolem">t1</span><span class="main">#</span><span class="skolem">t2</span><span class="main">∧</span><span class="skolem">u</span><span class="main">=</span><span class="skolem">u1</span><span class="main">#</span><span class="skolem">u2</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> list.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>6<span class="main">)</span> aa aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">a</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∨</span><span class="main">(</span>tl <span class="skolem">a</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span>tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">a</span><span class="main">=</span>hd <span class="skolem">u</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> empty_setinterleaving<span class="main">)</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> empty_setinterleaving <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span>  <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>  
     <span class="keyword1"><span class="command">using</span></span> empty_setinterleaving <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">using</span></span> Sync.sym emptyLeftProperty <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym emptyLeftProperty hd_append2 syncTlEmpty tickFree_tl tl_append2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>7<span class="main">,</span>8<span class="main">,</span>12<span class="main">,</span>13<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="skolem">t1</span><span class="main">#</span><span class="skolem">t2</span><span class="main">∧</span><span class="skolem">u</span><span class="main">=</span><span class="skolem">u1</span><span class="main">#</span><span class="skolem">u2</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span>  list.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>6<span class="main">)</span> aa aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∨</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span>tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">⟹</span>tl <span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> <span class="skolem">aa</span><span class="main">)</span><span class="main">∧</span>tl <span class="skolem">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> <span class="skolem">ab</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>hd <span class="skolem">a</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span>hd <span class="skolem">a</span><span class="main">=</span> ev <span class="skolem">aa</span><span class="main">∧</span>tl <span class="skolem">a</span>  <span class="main">=</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span><span class="main">∧</span>tickFree <span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span><span class="main">∧</span> hd <span class="skolem">u</span> <span class="main">=</span> ev <span class="skolem">ab</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Nil_is_append_conv empty_setinterleaving hd_append2 tickFree_tl tl_append2<span class="main">)</span>   
  <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span><span class="main">⟹</span> tl <span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> <span class="skolem">aa</span><span class="main">)</span><span class="main">∧</span>tl <span class="skolem">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> <span class="skolem">ab</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>hd <span class="skolem">a</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">∧</span>tl <span class="skolem">a</span>  <span class="main">=</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span><span class="main">∧</span>tickFree <span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">a</span><span class="main">=</span>ev <span class="skolem">ab</span><span class="main">∧</span> hd <span class="skolem">u</span> <span class="main">=</span> ev <span class="skolem">ab</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Nil_is_append_conv empty_setinterleaving hd_append2 image_eqI list.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tickFree_tl tl_append2<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> aa1 aa2<span class="main">)</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> empty_setinterleaving <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span>  <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span><span class="operator">simp</span><span class="main">)</span>  
     <span class="keyword1"><span class="command">using</span></span> empty_setinterleaving <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">using</span></span> Sync.sym emptyLeftProperty <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym emptyLeftProperty hd_append2 syncTlEmpty tickFree_tl tl_append2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 8<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span> "</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">from</span></span> 8<span class="main">(</span>7<span class="main">,</span>8<span class="main">,</span>12<span class="main">,</span>13<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="skolem">t1</span><span class="main">#</span><span class="skolem">t2</span><span class="main">∧</span><span class="skolem">u</span><span class="main">=</span><span class="skolem">u1</span><span class="main">#</span><span class="skolem">u2</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span>  list.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 8<span class="main">(</span>6<span class="main">)</span> aa aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∨</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span>tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">from</span></span> 8<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">⟹</span>tl <span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Q</span> <span class="skolem">aa</span><span class="main">)</span><span class="main">∧</span>tl <span class="skolem">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">P</span> <span class="skolem">ab</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>hd <span class="skolem">a</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">∧</span>hd <span class="skolem">a</span><span class="main">=</span> ev <span class="skolem">aa</span><span class="main">∧</span>tl <span class="skolem">a</span>  <span class="main">=</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span><span class="main">∧</span>tickFree <span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span><span class="main">∧</span> hd <span class="skolem">u</span> <span class="main">=</span> ev <span class="skolem">ab</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Nil_is_append_conv empty_setinterleaving hd_append2 tickFree_tl tl_append2<span class="main">)</span>   
  <span class="keyword1"><span class="command">from</span></span> 8<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span><span class="main">⟹</span> tl <span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Q</span> <span class="skolem">aa</span><span class="main">)</span><span class="main">∧</span>tl <span class="skolem">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">P</span> <span class="skolem">ab</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">a</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>hd <span class="skolem">a</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span>tl <span class="skolem">a</span>  <span class="main">=</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span><span class="main">∧</span>tickFree <span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">a</span><span class="main">=</span>ev <span class="skolem">ab</span><span class="main">∧</span> hd <span class="skolem">u</span> <span class="main">=</span> ev <span class="skolem">ab</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Nil_is_append_conv empty_setinterleaving hd_append2 image_eqI list.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tickFree_tl tl_append2<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> aa1 aa2<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym append_Nil2 emptyLeftProperty syncTlEmpty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 10<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">from</span></span> 10<span class="main">(</span>7<span class="main">,</span>8<span class="main">,</span>12<span class="main">,</span>13<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="skolem">t1</span><span class="main">#</span><span class="skolem">t2</span><span class="main">∧</span><span class="skolem">u</span><span class="main">=</span><span class="skolem">u1</span><span class="main">#</span><span class="skolem">u2</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span>  list.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 10<span class="main">(</span>6<span class="main">)</span> aa aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∨</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span>tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"10"</span><span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> <span class="quoted">"10"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"10"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"10"</span><span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> <span class="quoted">"10"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"10"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"10"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"10"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"10"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> <span class="quoted">"10"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"10"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> append_self_conv empty_setinterleaving image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym append_Nil2 emptyLeftProperty syncTlEmpty<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 12<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">from</span></span> 12<span class="main">(</span>7<span class="main">,</span>8<span class="main">,</span>12<span class="main">,</span>13<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="skolem">t1</span><span class="main">#</span><span class="skolem">t2</span><span class="main">∧</span><span class="skolem">u</span><span class="main">=</span><span class="skolem">u1</span><span class="main">#</span><span class="skolem">u2</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span>  list.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 12<span class="main">(</span>6<span class="main">)</span> aa aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∨</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span>tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"12"</span><span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> <span class="quoted">"12"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"12"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"12"</span><span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> <span class="quoted">"12"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"12"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"12"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"12"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"12"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> <span class="quoted">"12"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"12"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> append_Nil2 empty_setinterleaving image_eqI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>13 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span>  disjE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">-</span> ev <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>   
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>   
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust_sel<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">aaa</span><span class="main">)</span>   
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 7<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  list.exhaust_sel synSingleHeadAdd<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjoint_iff_not_equal event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> event.inject imageE list.exhaust_sel<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aaa</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust_sel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_iff_not_equal image_iff synSingleHeadAdd<span class="main">)</span>  
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aaa</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>tickFree <span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span> 7<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Sync.sym append_Cons list.exhaust_sel synSingleHeadAdd<span class="main">)</span>        
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
        <span class="keyword1"><span class="command">using</span></span> 5<span class="main">(</span>2<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span>  aa0 event.inject list.sel<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjoint_iff_not_equal event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> event.inject imageE list.exhaust_sel<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aaa</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust_sel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_iff_not_equal image_iff synSingleHeadAdd<span class="main">)</span>  
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aaa</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 8<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span> "</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> 8<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span> 7<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Sync.sym append_Cons list.exhaust_sel synSingleHeadAdd<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
        <span class="keyword1"><span class="command">using</span></span> 8<span class="main">(</span>2<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">X</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span>  <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>  
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust_sel<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">aaa</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 8<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym list.exhaust_sel synSingleHeadAdd<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>  
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aaa</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span> 7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>tickFree <span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span>"</span></span>   
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">,</span> 2<span class="main">,</span> 8<span class="main">,</span> 9<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span><span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span> <span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym append_Cons list.exhaust_sel synSingleHeadAdd<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
        <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>2<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span>  aa0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>  
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust_sel<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aaa</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>tickFree <span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span> 7<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Sync.sym append_Cons list.exhaust_sel synSingleHeadAdd<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> 5<span class="main">(</span>2<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> aa0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aaa</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span> 7<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Sync.sym append_Cons list.exhaust_sel synSingleHeadAdd<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> 6<span class="main">(</span>2<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>   
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> disjoint_iff_not_equal event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> event.inject imageE list.exhaust_sel<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aaa</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 8<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">a</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span> "</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> 8<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span> 7<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">a</span> <span class="main">=</span>  <span class="main">(</span>hd <span class="skolem">a</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Sync.sym append_Cons list.exhaust_sel synSingleHeadAdd<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> 8<span class="main">(</span>2<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
    <span class="keyword1"><span class="command">qed</span></span>      
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>14 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>  
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>  
        <span class="keyword1"><span class="command">using</span></span> empty_setinterleaving <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>  
       <span class="keyword1"><span class="command">using</span></span> Sync.sym emptyLeftProperty <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>     
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym emptyLeftProperty hd_append2 syncTlEmpty tickFree_tl tl_append2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>7<span class="main">,</span>8<span class="main">,</span>12<span class="main">,</span>13<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="skolem">t1</span><span class="main">#</span><span class="skolem">t2</span><span class="main">∧</span><span class="skolem">u</span><span class="main">=</span><span class="skolem">u1</span><span class="main">#</span><span class="skolem">u2</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span>  list.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>6<span class="main">)</span> aa aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∨</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span>tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">⟹</span>tl <span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span>tl <span class="skolem">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> <span class="skolem">aa</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>hd <span class="skolem">x</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span>hd <span class="skolem">x</span><span class="main">=</span> ev <span class="skolem">a</span><span class="main">∧</span>tl <span class="skolem">x</span>  <span class="main">=</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span><span class="main">∧</span>tickFree <span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span><span class="main">∧</span> hd <span class="skolem">u</span> <span class="main">=</span> ev <span class="skolem">aa</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Nil_is_append_conv empty_setinterleaving hd_append2 tickFree_tl tl_append2<span class="main">)</span>   
  <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span><span class="main">⟹</span> tl <span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span>tl <span class="skolem">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> <span class="skolem">aa</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>hd <span class="skolem">x</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">∧</span>tl <span class="skolem">x</span>  <span class="main">=</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span><span class="main">∧</span>tickFree <span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">x</span><span class="main">=</span>ev <span class="skolem">aa</span><span class="main">∧</span> hd <span class="skolem">u</span> <span class="main">=</span> ev <span class="skolem">aa</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Nil_is_append_conv empty_setinterleaving hd_append2 image_eqI list.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tickFree_tl tl_append2<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">using</span></span> aa1 aa2 aa3  2<span class="main">(</span>3<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>11<span class="main">,</span>12<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
        <span class="keyword1"><span class="command">using</span></span> empty_setinterleaving <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>  
       <span class="keyword1"><span class="command">using</span></span> Sync.sym emptyLeftProperty <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> 
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym emptyLeftProperty hd_append2 syncTlEmpty tickFree_tl tl_append2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>7<span class="main">,</span>8<span class="main">,</span>12<span class="main">,</span>13<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="skolem">t1</span><span class="main">#</span><span class="skolem">t2</span><span class="main">∧</span><span class="skolem">u</span><span class="main">=</span><span class="skolem">u1</span><span class="main">#</span><span class="skolem">u2</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span>  list.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>6<span class="main">)</span> aa aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∨</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span>tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">⟹</span>tl <span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Q</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span>tl <span class="skolem">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">P</span> <span class="skolem">aa</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>hd <span class="skolem">x</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">∧</span>hd <span class="skolem">x</span><span class="main">=</span> ev <span class="skolem">a</span><span class="main">∧</span>tl <span class="skolem">x</span>  <span class="main">=</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span><span class="main">∧</span>tickFree <span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span><span class="main">∧</span> hd <span class="skolem">u</span> <span class="main">=</span> ev <span class="skolem">aa</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Nil_is_append_conv empty_setinterleaving hd_append2 tickFree_tl tl_append2<span class="main">)</span>   
  <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span><span class="main">⟹</span> tl <span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Q</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span>tl <span class="skolem">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">P</span> <span class="skolem">aa</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">[]</span> <span class="main">∧</span>hd <span class="skolem">x</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span>tl <span class="skolem">x</span>  <span class="main">=</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span><span class="main">∧</span>tickFree <span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">x</span><span class="main">=</span>ev <span class="skolem">aa</span><span class="main">∧</span> hd <span class="skolem">u</span> <span class="main">=</span> ev <span class="skolem">aa</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Nil_is_append_conv empty_setinterleaving hd_append2 image_eqI list.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> tickFree_tl tl_append2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> aa1 aa2<span class="main">)</span>   
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> EmptyLeftSync Sync.sym append_Nil2 syncTlEmpty<span class="main">)</span>   
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>7<span class="main">,</span>8<span class="main">,</span>12<span class="main">,</span>13<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="skolem">t1</span><span class="main">#</span><span class="skolem">t2</span><span class="main">∧</span><span class="skolem">u</span><span class="main">=</span><span class="skolem">u1</span><span class="main">#</span><span class="skolem">u2</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span>  list.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>6<span class="main">)</span> aa aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∨</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span>tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> append_Nil2 empty_setinterleaving image_eqI<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> EmptyLeftSync Sync.sym append_Nil2 syncTlEmpty<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 8<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">from</span></span> 8<span class="main">(</span>7<span class="main">,</span>8<span class="main">,</span>12<span class="main">,</span>13<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="skolem">t1</span><span class="main">#</span><span class="skolem">t2</span><span class="main">∧</span><span class="skolem">u</span><span class="main">=</span><span class="skolem">u1</span><span class="main">#</span><span class="skolem">u2</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span>  list.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> 8<span class="main">(</span>6<span class="main">)</span> aa aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>tl <span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∨</span><span class="main">(</span>tl <span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span>tl <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span>"</span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"8"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> append_Nil2 empty_setinterleaving image_eqI<span class="main">)</span> 
 <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>15 <span class="skolem">x</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>     
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE <span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjoint_iff_not_equal event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> event.inject imageE list.exhaust_sel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust_sel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_iff_not_equal image_iff synSingleHeadAdd<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span><span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> "</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Sync.sym append_Cons list.exhaust_sel synSingleHeadAdd<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span>  aa0 event.inject <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjoint_iff_not_equal event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> event.inject imageE list.exhaust_sel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust_sel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_iff_not_equal image_iff synSingleHeadAdd<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span><span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> "</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Sync.sym append_Cons list.exhaust_sel synSingleHeadAdd<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
       <span class="keyword1"><span class="command">using</span></span> 6<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  event.inject imageE list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>      
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 7<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 7<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span><span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> "</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Sync.sym append_Cons list.exhaust_sel synSingleHeadAdd<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 7<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span>  aa0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>       
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust_sel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust_sel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_iff_not_equal image_iff synSingleHeadAdd<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 10<span class="main">(</span>1<span class="main">,</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">∉</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 10<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span> <span class="skolem">x</span> <span class="main">=</span><span class="main">(</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">v</span> "</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Sync.sym append_Cons list.exhaust_sel synSingleHeadAdd<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 10<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  event.inject imageE list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust_sel<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list.exhaust_sel<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> disjoint_iff_not_equal image_iff synSingleHeadAdd<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mprefix_Par_distr<span class="main">:</span> 
  <span class="quoted"><span class="quoted">" <span class="main">⟦</span><span class="free">A</span> <span class="main">⊆</span> <span class="free">C</span><span class="main">;</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">P</span> <span class="main">⟦</span> <span class="free">C</span> <span class="main">⟧</span> Mprefix <span class="free">B</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span>  <span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">⟦</span> <span class="free">C</span> <span class="main">⟧</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync F_sync F_Mprefix T_Mprefix D_Mprefix<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>  
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> 
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> empty_iff image_iff list.exhaust_sel setinterleaving.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetCE subset_insertI<span class="main">)</span>  
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym empty_iff image_iff insertI2 list.exhaust_sel setinterleaving.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetCE<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>7<span class="main">,</span>8<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">∧</span>hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span>  empty_setinterleaving <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>4<span class="main">,</span>7<span class="main">,</span>8<span class="main">)</span> a0 <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">a</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>   
    <span class="keyword1"><span class="command">using</span></span> syncSameHdTl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
     <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>11<span class="main">,</span>12<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  a0 event.inject syncSameHdTl syncSameHdTl<span class="main">)</span>   
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.si_empty3 contra_subsetD equals0D imageE list.exhaust_sel rev_image_eqI subset_insertI<span class="main">)</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">∧</span>hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Nil_is_append_conv empty_setinterleaving image_iff insertI2 subsetCE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> a0 <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">a</span><span class="main">∧</span>hd <span class="skolem">a</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> IntI empty_setinterleaving event.inject hd_append2 imageE image_eqI syncSameHdTl<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> a0 empty_setinterleaving event.inject syncSameHdTl tickFree_tl tl_append2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.si_empty3 contra_subsetD equals0D imageE list.exhaust_sel rev_image_eqI subset_insertI<span class="main">)</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">∧</span>hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Nil_is_append_conv empty_setinterleaving image_iff insertI2 subsetCE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> a0 <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">a</span><span class="main">∧</span>hd <span class="skolem">a</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"5"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"5"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"5"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> IntI empty_setinterleaving event.inject hd_append2 imageE image_eqI syncSameHdTl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"5"</span><span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> <span class="quoted">"5"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"5"</span><span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> <span class="quoted">"5"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"5"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"5"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"5"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"5"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> <span class="quoted">"5"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> a0 empty_setinterleaving event.inject syncSameHdTl tickFree_tl tl_append2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.si_empty3 contra_subsetD equals0D imageE image_eqI list.exhaust_sel subset_insertI<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 7<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">∧</span>hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Nil_is_append_conv empty_setinterleaving image_iff insertI2 subsetCE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 7<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> a0 <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">a</span><span class="main">∧</span>hd <span class="skolem">a</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> IntI append_Nil2 event.inject imageE image_eqI syncSameHdTl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"7"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> a0 event.inject self_append_conv syncSameHdTl<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym equals0D imageE image_eqI insertI2 list.exhaust_sel setinterleaving.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetCE<span class="main">)</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">aa</span> <span class="skolem">ab</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 9<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">≠</span> <span class="main">[]</span><span class="main">∧</span>hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Nil_is_append_conv empty_setinterleaving image_iff insertI2 subsetCE<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> 9<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">)</span> a0 <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">t</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">u</span><span class="main">∧</span>hd <span class="skolem">r</span><span class="main">=</span>hd <span class="skolem">a</span><span class="main">∧</span>hd <span class="skolem">a</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> IntI append_Nil2 event.inject imageE image_eqI syncSameHdTl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>13<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"9"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> a0 event.inject self_append_conv syncSameHdTl<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>  
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">X</span><span class="main">::</span><span class="tfree">'a</span> event set<span class="main">)</span><span class="main">=</span><span class="skolem">b</span><span class="main">-</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span><span class="main">(</span><span class="skolem">Y</span><span class="main">::</span><span class="tfree">'a</span> event set<span class="main">)</span><span class="main">=</span><span class="skolem">b</span><span class="main">-</span>ev <span class="main">`</span> <span class="free">B</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span><span class="main">∪</span><span class="skolem">Y</span><span class="main">=</span><span class="skolem">b</span><span class="main">∧</span><span class="skolem">X</span><span class="main">∩</span><span class="skolem">Y</span><span class="main">=</span><span class="skolem">b</span><span class="main">-</span><span class="main">(</span>ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span><span class="main">⊆</span><span class="free">C</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">from</span></span> aa0 aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"1"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Diff_disjoint Int_commute Sync.si_empty1 aa0 insert_iff<span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">=</span><span class="main">(</span>hd <span class="skolem">a</span><span class="main">)</span><span class="main">#</span><span class="skolem">t</span><span class="main">∧</span><span class="skolem">u1</span><span class="main">=</span><span class="main">(</span>hd <span class="skolem">a</span><span class="main">)</span><span class="main">#</span><span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t1</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u1</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u1</span><span class="main">=</span>hd <span class="skolem">t1</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> image_eqI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>8<span class="main">)</span> aa0 aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span>  list.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>       
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span><span class="main">≠</span><span class="main">[]</span><span class="main">∧</span><span class="skolem">u1</span><span class="main">≠</span><span class="main">[]</span><span class="main">∧</span> hd <span class="skolem">t1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span> hd <span class="skolem">u1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  aa1 aa0 aa2 list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> syncSameHdTl<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>8<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">=</span>ev <span class="skolem">aa</span><span class="main">#</span><span class="skolem">r</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span>ev <span class="skolem">aa</span><span class="main">#</span><span class="skolem">t</span><span class="main">∧</span><span class="skolem">u1</span><span class="main">=</span>ev <span class="skolem">aa</span><span class="main">#</span><span class="skolem">u</span><span class="main">∧</span><span class="skolem">a</span><span class="main">=</span><span class="skolem">r1</span><span class="main">@</span><span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> hd_Cons_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>9<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">r1</span><span class="main">∧</span>ev <span class="skolem">aa</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> IntD2 event.inject event.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> imageE image_eqI insertI2 subsetCE tickFree_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0 aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">t1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span>tl <span class="skolem">t1</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> <span class="skolem">aa</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span> <span class="main">∧</span> tl <span class="skolem">u1</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> <span class="skolem">aa</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3"</span><span class="main">(</span>10<span class="main">)</span> <span class="quoted">"3"</span><span class="main">(</span>11<span class="main">)</span> <span class="quoted">"3"</span><span class="main">(</span>4<span class="main">)</span> imageE image_eqI <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> aa0 aa1 event.inject imageE list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>   
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>8<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">=</span>ev <span class="skolem">aa</span><span class="main">#</span><span class="skolem">r</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span>ev <span class="skolem">aa</span><span class="main">#</span><span class="skolem">t</span><span class="main">∧</span><span class="skolem">u1</span><span class="main">=</span>ev <span class="skolem">aa</span><span class="main">#</span><span class="skolem">u</span><span class="main">∧</span><span class="skolem">a</span><span class="main">=</span><span class="skolem">r1</span><span class="main">@</span><span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> hd_Cons_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>9<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">r1</span><span class="main">∧</span>ev <span class="skolem">aa</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> event.distinct<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0 aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">t1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span>tl <span class="skolem">t1</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Q</span> <span class="skolem">aa</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span> <span class="main">∧</span> tl <span class="skolem">u1</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">P</span> <span class="skolem">aa</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"4"</span><span class="main">(</span>10<span class="main">)</span> <span class="quoted">"4"</span><span class="main">(</span>11<span class="main">)</span> <span class="quoted">"4"</span><span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> aa0 aa1 event.inject imageE list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>8<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">=</span>ev <span class="skolem">aa</span><span class="main">#</span><span class="skolem">r</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span>ev <span class="skolem">aa</span><span class="main">#</span><span class="skolem">t</span><span class="main">∧</span><span class="skolem">u1</span><span class="main">=</span>ev <span class="skolem">aa</span><span class="main">#</span><span class="skolem">u</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"5"</span><span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">r1</span><span class="main">@</span><span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span>  list.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0  <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">t1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span>tl <span class="skolem">t1</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> <span class="skolem">aa</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span> <span class="main">∧</span> tl <span class="skolem">u1</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> <span class="skolem">aa</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"5"</span><span class="main">(</span>10<span class="main">)</span> <span class="quoted">"5"</span><span class="main">(</span>11<span class="main">)</span> list.sel<span class="main">(</span>1<span class="main">)</span> list.sel<span class="main">(</span>3<span class="main">)</span> subsetCE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"5"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"5"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> aa aa0 aa2 event.inject imageE list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>8<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">=</span>ev <span class="skolem">aa</span><span class="main">#</span><span class="skolem">r</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span>ev <span class="skolem">aa</span><span class="main">#</span><span class="skolem">t</span><span class="main">∧</span><span class="skolem">u1</span><span class="main">=</span>ev <span class="skolem">aa</span><span class="main">#</span><span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>3<span class="main">,</span>5<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">r1</span><span class="main">@</span><span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span>  list.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> aa0  <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">t1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span>tl <span class="skolem">t1</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Q</span> <span class="skolem">aa</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span> <span class="main">∧</span> tl <span class="skolem">u1</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">P</span> <span class="skolem">aa</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"6"</span><span class="main">(</span>10<span class="main">)</span> <span class="quoted">"6"</span><span class="main">(</span>11<span class="main">)</span> IntD2 Int_lower1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"6"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> aa aa0 aa2 event.inject imageE list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span>  
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym empty_iff image_iff insertI2 list.exhaust_sel setinterleaving.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetCE<span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span>   
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">" hd <span class="skolem">x</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> IntI empty_setinterleaving event.inject hd_append2 image_iff syncSameHdTl<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  Nil_is_append_conv aa1 empty_setinterleaving event.inject hd_append2 syncSameHdTl tickFree_tl tl_append2<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.si_empty3 equals0D imageE image_eqI insertI2 list.exhaust_sel subsetCE<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">" hd <span class="skolem">x</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> IntI empty_setinterleaving event.inject hd_append2 image_iff syncSameHdTl<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">using</span></span> 3<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  Nil_is_append_conv aa1 empty_setinterleaving event.inject hd_append2 syncSameHdTl tickFree_tl tl_append2<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.si_empty3 equals0D imageE image_eqI insertI2 list.exhaust_sel subsetCE<span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">" hd <span class="skolem">x</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> IntI empty_setinterleaving event.inject hd_append2 image_iff syncSameHdTl<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 5<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  aa1 append_Nil2 empty_setinterleaving event.inject syncSameHdTl<span class="main">)</span>   
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.si_empty3 equals0D imageE image_eqI insertI2 list.exhaust_sel subsetCE<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span> <span class="skolem">aa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 7<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>6<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"hd <span class="skolem">t</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">∧</span>hd <span class="skolem">u</span><span class="main">∈</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> 7<span class="main">(</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>11<span class="main">,</span>13<span class="main">)</span> aa1 <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">" hd <span class="skolem">x</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> IntI empty_setinterleaving event.inject hd_append2 image_iff syncSameHdTl<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">using</span></span> 7<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>6<span class="main">,</span>7<span class="main">,</span>9<span class="main">,</span>10<span class="main">,</span>13<span class="main">,</span>14<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  aa1 append_Nil2 empty_setinterleaving event.inject syncSameHdTl syncSameHdTl<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE disjE conjE<span class="main">)</span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span><span class="main">∧</span><span class="skolem">u1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span><span class="main">∧</span>tickFree <span class="skolem">r1</span><span class="main">∧</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span><span class="main">(</span>3<span class="main">)</span> <span class="quoted">"1"</span><span class="main">(</span>5<span class="main">)</span> <span class="quoted">"1"</span><span class="main">(</span>7<span class="main">)</span> <span class="quoted">"1"</span><span class="main">(</span>8<span class="main">)</span> hd_Cons_tl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> aa0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">t1</span><span class="main">)</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>tl <span class="skolem">u1</span><span class="main">)</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span> ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">t1</span><span class="main">∧</span>ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">u1</span><span class="main">∧</span> hd <span class="skolem">t1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span> hd <span class="skolem">u1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>    
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"1"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> aa0 aa2 event.inject imageE<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span><span class="main">∧</span><span class="skolem">u1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa1<span class="main">:</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">r1</span><span class="main">∧</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span>  Cons_eq_appendI aa0 event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.exhaust_sel tickFree_Cons<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>   
      <span class="keyword1"><span class="command">using</span></span> aa0 subsetCE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>4<span class="main">,</span>5<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">t1</span><span class="main">)</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Q</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>tl <span class="skolem">u1</span><span class="main">)</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">P</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span> ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">t1</span><span class="main">∧</span>ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">u1</span><span class="main">∧</span> hd <span class="skolem">t1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span> hd <span class="skolem">u1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span>"</span></span>  
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>      
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span><span class="main">(</span>6<span class="main">)</span> aa1 aa2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span><span class="main">∧</span><span class="skolem">u1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>   
      <span class="keyword1"><span class="command">using</span></span> aa0 subsetCE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">t1</span><span class="main">)</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>tl <span class="skolem">u1</span><span class="main">)</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span> ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">t1</span><span class="main">∧</span>ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">u1</span><span class="main">∧</span> hd <span class="skolem">t1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span> hd <span class="skolem">u1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">∧</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  Int_lower1 Int_lower2 append_Nil2 imageE image_eqI list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subsetCE<span class="main">)</span>    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"3"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> aa2 event.inject imageE<span class="main">)</span>     
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> aa0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span><span class="main">∧</span><span class="skolem">t1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span><span class="main">∧</span><span class="skolem">u1</span><span class="main">=</span>hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">u</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>2<span class="main">,</span>4<span class="main">,</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> aa2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">∧</span><span class="skolem">t1</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>   
      <span class="keyword1"><span class="command">using</span></span> aa0 subsetCE <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 4<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">,</span>8<span class="main">,</span>10<span class="main">,</span>11<span class="main">)</span> aa0 <span class="keyword1"><span class="command">have</span></span> aa3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>tl <span class="skolem">t1</span><span class="main">)</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Q</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span><span class="main">(</span>tl <span class="skolem">u1</span><span class="main">)</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">P</span> <span class="skolem">a</span><span class="main">)</span><span class="main">∧</span> ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">t1</span><span class="main">∧</span>ev <span class="skolem">a</span> <span class="main">=</span> hd <span class="skolem">u1</span><span class="main">∧</span> hd <span class="skolem">t1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">∧</span> hd <span class="skolem">u1</span> <span class="main">∈</span> ev <span class="main">`</span> <span class="free">B</span><span class="main">∧</span><span class="skolem">x</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">v</span>"</span></span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  Int_lower1 Int_lower2 append_Nil2 imageE image_eqI list.exhaust_sel list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> subsetCE<span class="main">)</span>    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>7<span class="main"><span class="main">)</span></span> aa2 event.inject imageE<span class="main">)</span>  
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>    

<span class="keyword1"><span class="command">lemma</span></span> mprefix_Par_Int_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">P</span> <span class="main">⟦</span> <span class="free">B</span> <span class="main">⟧</span> SKIP<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span>  <span class="free">A</span> <span class="main">-</span> <span class="free">B</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">⟦</span> <span class="free">B</span> <span class="main">⟧</span> SKIP<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec_optimized<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync D_Mprefix D_SKIP T_SKIP<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">a</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span> 
          <span class="keyword1"><span class="command">using</span></span> empty_setinterleaving <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> DiffI Sync.sym emptyLeftProperty empty_iff hd_append2 image_diff_subset insertI2 list.exhaust_sel setinterleaving.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> subsetCE<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree Sync.sym TickLeftSync empty_iff empty_setinterleaving event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ftf_syn21 insertI1 list.expand list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.set_intros<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> syncHd_Tl syncSameHdTl tickFree_def<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> Sync.sym emptyLeftNonSync emptyLeftProperty hd_in_set <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> DiffI Sync.sym append_Nil2 event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> image_diff_subset insertI1 insertI2 list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> subsetCE syncHd_Tl syncSameHdTl<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">a</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym emptyLeftProperty empty_setinterleaving hd_append2 insertI1 list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> syncHd_Tl syncSameHdTl<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tl <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"tl <span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Sync.sym empty_setinterleaving event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insertI1 list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> syncHd_Tl syncSameHdTl syncTlEmpty tickFree_tl tl_append2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync D_Mprefix D_SKIP T_SKIP<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"hd <span class="skolem">x</span><span class="main">#</span><span class="skolem">r</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>      
        <span class="keyword1"><span class="command">using</span></span> hd_Cons_tl list.exhaust_sel <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>F_sync F_Mprefix F_SKIP<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span><span class="main">)</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">X</span> <span class="skolem">Y</span> <span class="skolem">A</span> <span class="skolem">B</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∩</span> ev <span class="main">`</span> <span class="skolem">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"tick <span class="main">∉</span> <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">∩</span> ev <span class="main">`</span> <span class="main">(</span><span class="skolem">A</span> <span class="main">-</span> <span class="skolem">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> equals0I<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> l1 <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE conjE disjE<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> l1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> disjI2 conjI<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> empty_setinterleaving <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> DiffI Sync.sym UnI2 contra_subsetD emptyLeftNonSync 
                emptyLeftProperty hd_in_set image_diff_subset insert_is_Un<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym Un_commute emptyLeftProperty list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> neq_Nil_conv syncTlEmpty<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> disjI2 conjI<span class="main">)</span>       
         <span class="keyword1"><span class="command">using</span></span> empty_setinterleaving <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> DiffI Sync.sym event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> event.inject 
                     imageE image_eqI insertI1 insertI2 list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> syncHd_Tl syncSameHdTl<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> insertI1 list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> syncHd_Tl syncSameHdTl<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> D <span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">P</span> <span class="main">⟦</span><span class="free">B</span><span class="main">⟧</span> SKIP<span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> T_SKIP <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> D <span class="main">(</span><span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span>  <span class="free">A</span> <span class="main">-</span> <span class="free">B</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">⟦</span> <span class="free">B</span> <span class="main">⟧</span> SKIP<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync D_Mprefix<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>  
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_sync F_Mprefix F_SKIP<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">-</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">elim</span> conjE exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> disjE exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>      
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="skolem">aa</span><span class="main">)</span><span class="main">#</span><span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">X</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> DiffE event.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> event.inject imageE insertE list.exhaust_sel synSingleHeadAdd<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">aa</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> D <span class="main">(</span><span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span>  <span class="free">A</span> <span class="main">-</span> <span class="free">B</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span> <span class="main">⟦</span> <span class="free">B</span> <span class="main">⟧</span> SKIP<span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_Mprefix D_sync<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"2"</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted">"2"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted">"2"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> D <span class="main">(</span>Mprefix <span class="free">A</span> <span class="free">P</span> <span class="main">⟦</span><span class="free">B</span><span class="main">⟧</span> SKIP<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync D_Mprefix<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> par_int_ndet_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">M</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Process_eq_spec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_sync F_sync D_ndet F_ndet T_ndet<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> prefix_Par_Int_skip1<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∉</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> SKIP<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> SKIP<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> write0_def empty_Diff insert_Diff_if mprefix_Par_Int_skip mprefix_singl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prefix_Par_Int_skip2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> SKIP<span class="main">)</span> <span class="main">=</span> STOP"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Mprefix_STOP mprefix_Par_Int_skip write0_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prefix_Par_Int_skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> SKIP<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="keyword1">then</span> STOP <span class="keyword1">else</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">A</span> <span class="main">⟧</span> SKIP<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_Par_Int_skip2 prefix_Par_Int_skip1<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> prefix_par_Int1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">b</span> <span class="main">∈</span> <span class="free">A</span><span class="main">;</span> <span class="free">a</span> <span class="main">≠</span> <span class="free">b</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="main">(</span><span class="free">b</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> STOP"</span></span>  
  <span class="keyword1"><span class="command">using</span></span> mprefix_Par_distr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">Q</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Mprefix_STOP mprefix_singl<span class="main">)</span>
   
<span class="keyword1"><span class="command">lemma</span></span> prefix_par_Int2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟦</span><span class="free">A</span><span class="main">⟧</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span> <span class="free">A</span> <span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>write0_def mprefix_Par_distr<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">Q</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prefix_Par_Int3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="main">∈</span> <span class="free">C</span><span class="main">;</span> <span class="free">b</span> <span class="main">∉</span> <span class="free">C</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="main">(</span><span class="free">b</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">→</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mprefix_Par_Int_distr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">Q</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>write0_def sync_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> hide_sync_D1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span>  D <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="main">(</span><span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>D_sync T_sync D_hiding T_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> subsetI CollectI<span class="main"><span class="keyword3">,</span></span> 
                  <span class="operator">elim</span> CollectE exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE CollectE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">ta</span> <span class="skolem">ua</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">ua</span> <span class="bound">ra</span> <span class="bound">va</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">t</span> <span class="bound">ua</span> <span class="bound">ra</span> <span class="bound">va</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>trace_hide <span class="skolem">ta</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>trace_hide <span class="skolem">ua</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>trace_hide <span class="skolem">r</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>trace_hide <span class="skolem">v</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="skolem">u</span><span class="main">)</span>"</span></span><span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>front_tickFree_append hiding_tickFree tickFree_def disjoint_iff_not_equal
                        hide_interleave<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ev <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">ta</span></span> <span class="quoted"><span class="skolem">ua</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">erule_tac</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">ta</span>"</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">meson</span> front_tickFree_charn self_append_conv tickFree_def<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree emptyLeftNonSync ftf_syn21 ftf_syn32 in_set_conv_decomp_last 
                  insertI1 is_processT2_TR nonTickFree_n_frontTickFree tickFree_Nil tickFree_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> disj_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjCI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="skolem">ua</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_implies_tickFree is_processT2_TR is_processT5_S7<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>11<span class="main">)</span> 1<span class="main">(</span>10<span class="main">)</span> inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">ua</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">ff</span> <span class="free">Q</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">ua</span> <span class="main">∈</span> range <span class="skolem">ff</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>7<span class="main">)</span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ua</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil tickFree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">ta</span>"</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">meson</span> front_tickFree_charn self_append_conv tickFree_def<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree emptyLeftNonSync ftf_syn21 ftf_syn32 in_set_conv_decomp_last 
                  insertI1 is_processT2_TR nonTickFree_n_frontTickFree tickFree_Nil tickFree_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> disj_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjCI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="skolem">ua</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_implies_tickFree is_processT2_TR is_processT5_S7<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>10<span class="main">)</span> 1<span class="main">(</span>11<span class="main">)</span> inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">ua</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">ff</span> <span class="free">P</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">ua</span> <span class="main">∈</span> range <span class="skolem">ff</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>7<span class="main">)</span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ua</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil tickFree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">x</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">f</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">ua</span> <span class="bound">ra</span> <span class="bound">va</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">t</span> <span class="bound">ua</span> <span class="bound">ra</span> <span class="bound">va</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> UnE exE conjE rangeE CollectE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 21<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>21 <span class="skolem">xa</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> aa <span class="main">=</span> 21<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">xa</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">with</span></span> 21 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> UnE exE conjE rangeE CollectE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 211 212<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>211 <span class="skolem">taa</span> <span class="skolem">uaa</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">ua</span> <span class="bound">ra</span> <span class="bound">va</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">t</span> <span class="bound">ua</span> <span class="bound">ra</span> <span class="bound">va</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∧</span> <span class="bound">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ftu</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ftu</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">u</span><span class="main">)</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ft</span></span> <span class="skolem"><span class="skolem">fu</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="main">≡</span> fst <span class="main">∘</span> <span class="skolem">ftu</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fu</span> <span class="main">≡</span> snd <span class="main">∘</span> <span class="skolem">ftu</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"inj <span class="skolem">ftu</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
          <span class="keyword3"><span class="command">assume</span></span> ftuxy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ftu</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">ftu</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> tu<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ftu</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> True<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> tu <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> ftu_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> exE_some old.prod.case tu<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="skolem">y</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> True<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> ftuxy tu <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> ftu_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> exE_some old.prod.case tu<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> interleave_eq_size<span class="main">[</span><span class="operator">OF</span> a b<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> length <span class="main">(</span><span class="skolem">f</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
          <span class="keyword1"><span class="command">with</span></span> 211<span class="main">(</span>6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.left_neutral less_length_mono linorder_neqE_nat not_add_less2 strict_mono_def<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">hence</span></span> inf_ftu<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>range <span class="skolem">ftu</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_imageD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"range <span class="skolem">ftu</span> <span class="main">⊆</span> range <span class="skolem">ft</span> <span class="main">×</span> range <span class="skolem">fu</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> comp_apply fst_conv ft_def fu_def rangeI snd_conv<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> inf_ftu <span class="keyword1"><span class="command">have</span></span> inf_ft_fu<span class="main">:</span> <span class="quoted"><span class="quoted">"infinite <span class="main">(</span>range <span class="skolem">ft</span><span class="main">)</span> <span class="main">∨</span> infinite <span class="main">(</span>range <span class="skolem">fu</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> finite_SigmaI infinite_super<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">f</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> <span class="free">A</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"2"</span><span class="main">(</span>6<span class="main">)</span> T_sync <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
          <span class="keyword1"><span class="command">from</span></span> a <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">i</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">0</span> <span class="main">@</span> <span class="skolem">t</span> <span class="main">∧</span> set <span class="skolem">t</span> <span class="main">⊆</span>  <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> isInfHiddenRun_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> b <span class="main">=</span> this
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> tu<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ftu</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> surj_pair<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="skolem">x</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span>"</span></span> 
           <span class="keyword1"><span class="command">using</span></span> True<span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> tu <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="skolem">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">unfolding</span></span> ftu_def  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> exE_some old.prod.case tu<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="skolem">x</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="skolem">fu</span> <span class="skolem">x</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ft</span> <span class="skolem">x</span><span class="main">,</span> <span class="skolem">fu</span> <span class="skolem">x</span><span class="main">)</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> comp_apply fst_conv ft_def fu_def snd_conv tu<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="skolem">x</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="skolem">fu</span> <span class="skolem">x</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∧</span> set <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span><span class="skolem">fu</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> 
                  <span class="main">∧</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ft</span> <span class="skolem">x</span><span class="main">,</span> <span class="skolem">fu</span> <span class="skolem">x</span><span class="main">)</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> interleave_set <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> ft_fu_f <span class="main">=</span> this
        <span class="keyword1"><span class="command">with</span></span> b <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="skolem">i</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="skolem">fu</span> <span class="skolem">i</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∧</span> set <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span><span class="skolem">fu</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>        
        <span class="keyword1"><span class="command">with</span></span> inf_ft_fu <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 2111 2112<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> 2111
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">∈</span>range <span class="skolem">ft</span><span class="main">.</span> <span class="skolem">t</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="bound">t'</span> <span class="main">⟶</span> <span class="main">(</span>set <span class="skolem">t</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> length <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> b<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">∈</span>range <span class="skolem">ft</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="bound">t'</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> set <span class="bound">t</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">t</span> <span class="main">≤</span> <span class="skolem">i</span><span class="main">}</span> "</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">meson</span> UnE c in_set_takeD subsetCE sup.boundedE<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>1<span class="main">)</span> finite_lists_length_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">A</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">∈</span>range <span class="skolem">ft</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="bound">t'</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> List.finite_set finite_Un finite_imageI finite_subset<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> KoenigLemma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"range <span class="skolem">ft</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> 2111<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ftf</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> event list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            d<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="skolem">ftf</span> <span class="main">∧</span> range <span class="skolem">ftf</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">∈</span>range <span class="skolem">ft</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≤</span> <span class="bound">t'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> c d<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span><span class="quoted"><span class="quoted">"range <span class="skolem">ftf</span> <span class="main">⊆</span> T <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_processT3_ST_pref <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">ftfs</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ftfs</span> <span class="main">=</span> <span class="skolem">ftf</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> e d<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span> strict_mono_def <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"range <span class="skolem">ftfs</span> <span class="main">⊆</span> T <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="skolem">ftfs</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_mono_def f<span class="main">)</span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
            <span class="keyword1"><span class="command">have</span></span> t0<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">ftfs</span> <span class="main">0</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span> add_leE comp_def f length_strict_mono<span class="main">)</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> t1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ftfs</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ftfs</span> <span class="main">0</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">tt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f2 le0 le_list_def strict_mono_less_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> d<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span> f <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> t2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ftfs</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">ft</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tt1</span></span> <span class="keyword2"><span class="keyword">where</span></span> t3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ftfs</span> <span class="main">0</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">tt</span> <span class="main">@</span> <span class="skolem">tt1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc le_list_def t1 t2<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> t0 interleave_order<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ftfs</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span><span class="main">@</span><span class="skolem">tt1</span>"</span></span> <span class="quoted"><span class="quoted">"ev <span class="main">`</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fu</span> <span class="skolem">j</span>"</span></span><span class="main">]</span> ft_fu_f 
              <span class="keyword1"><span class="command">have</span></span> t4<span class="main">:</span><span class="quoted"><span class="quoted">"set <span class="skolem">tt</span> <span class="main">⊆</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_subset_iff set_append set_drop_subset_set_drop subset_Un_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> 21 isInfHiddenRun_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="main">_</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> t5<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> ev <span class="main">`</span> <span class="free">A</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> a append_eq_conv_conj<span class="main">)</span> 
            <span class="keyword1"><span class="command">with</span></span> t4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">tt</span> <span class="main">⊆</span> ev <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> t1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">ftfs</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="skolem">ftfs</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> f3 <span class="main">=</span> this
          <span class="keyword1"><span class="command">from</span></span> d<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span> f <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ftfs</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">ft</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">fu</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 21111 21112 21113 21114 21115<span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> 21111
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 21112
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> a hiding_tickFree<span class="main">)</span> 
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 21113
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span> 
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 21114
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hide_interleave<span class="main">)</span>
               <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"211"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">using</span></span> ft_fu_f <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 21115
            <span class="keyword1"><span class="command">from</span></span> f4 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> f5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">ftfs</span> <span class="main">0</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_list_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tickFree <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> hiding_tickFree<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> ft_fu_f <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subsetCE sup.boundedE tickFree_def<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">ftfs</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">u</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> f5 front_tickFree_Nil front_tickFree_mono ft_fu_f hiding_fronttickFree is_processT2_TR<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> f5 f6 tickFree_append<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f5<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ftfs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>  
               <span class="keyword1"><span class="command">using</span></span> f1 f2 f3 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">using</span></span> elemTIselemHT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">fu</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">,</span> <span class="operator">simplified</span> T_hiding<span class="main">]</span> ft_fu_f <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 2112
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t'</span><span class="main">∈</span>range <span class="skolem">fu</span><span class="main">.</span> <span class="skolem">t</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="bound">t'</span> <span class="main">⟶</span> <span class="main">(</span>set <span class="skolem">t</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> length <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> b<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">∈</span>range <span class="skolem">fu</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="bound">t'</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> set <span class="bound">t</span> <span class="main">⊆</span> set <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">∧</span> length <span class="bound">t</span> <span class="main">≤</span> <span class="skolem">i</span><span class="main">}</span> "</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="main">(</span><span class="operator">meson</span> UnE c in_set_takeD subsetCE sup.boundedE<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>1<span class="main">)</span> finite_lists_length_le<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">A</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">∈</span>range <span class="skolem">fu</span><span class="main">.</span> <span class="bound">t</span> <span class="main">=</span> take <span class="skolem">i</span> <span class="bound">t'</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> List.finite_set finite_Un finite_imageI finite_subset<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> KoenigLemma<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"range <span class="skolem">fu</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> 2112<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">rule_format</span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fuf</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> event list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
            d<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="skolem">fuf</span> <span class="main">∧</span> range <span class="skolem">fuf</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t'</span><span class="main">∈</span>range <span class="skolem">fu</span><span class="main">.</span> <span class="bound">t</span> <span class="main">≤</span> <span class="bound">t'</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> c d<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span><span class="quoted"><span class="quoted">"range <span class="skolem">fuf</span> <span class="main">⊆</span> T <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_processT3_ST_pref <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">fufs</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">fufs</span> <span class="main">=</span> <span class="skolem">fuf</span> <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">+</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> e d<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span> strict_mono_def <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"range <span class="skolem">fufs</span> <span class="main">⊆</span> T <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="skolem">fufs</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_mono_def f<span class="main">)</span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span>
            <span class="keyword1"><span class="command">have</span></span> t0<span class="main">:</span><span class="quoted"><span class="quoted">"length <span class="main">(</span><span class="skolem">fufs</span> <span class="main">0</span><span class="main">)</span> <span class="main">≥</span> length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> d<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span> add_leE comp_def f length_strict_mono<span class="main">)</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> t1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">fufs</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">fufs</span> <span class="main">0</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">tt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f2 le0 le_list_def strict_mono_less_eq<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> d<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span> f <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> t2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">fufs</span> <span class="skolem">i</span> <span class="main">≤</span> <span class="skolem">fu</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tt1</span></span> <span class="keyword2"><span class="keyword">where</span></span> t3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">fu</span> <span class="skolem">j</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">fufs</span> <span class="main">0</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">tt</span> <span class="main">@</span> <span class="skolem">tt1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.assoc le_list_def t1 t2<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> t0 interleave_order<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">j</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fufs</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span><span class="main">@</span><span class="skolem">tt1</span>"</span></span> <span class="quoted"><span class="quoted">"ev <span class="main">`</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="skolem">j</span>"</span></span><span class="main">]</span> ft_fu_f 
              <span class="keyword1"><span class="command">have</span></span> t4<span class="main">:</span><span class="quoted"><span class="quoted">"set <span class="skolem">tt</span> <span class="main">⊆</span> set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> Sync.sym Un_subset_iff order_trans set_append set_drop_subset_set_drop<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> 21 isInfHiddenRun_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="main">_</span> <span class="quoted"><span class="free">A</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> t5<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> ev <span class="main">`</span> <span class="free">A</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> a append_eq_conv_conj<span class="main">)</span> 
            <span class="keyword1"><span class="command">with</span></span> t4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">tt</span> <span class="main">⊆</span> ev <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">with</span></span> t1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">fufs</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="skolem">fufs</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> f3 <span class="main">=</span> this
          <span class="keyword1"><span class="command">from</span></span> d<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span> f <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">i</span></span> <span class="keyword2"><span class="keyword">where</span></span> f4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">fufs</span> <span class="main">0</span> <span class="main">≤</span> <span class="skolem">fu</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">blast</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">fu</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">ft</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 21111 21112 21113 21114 21115<span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> 21111
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 21112
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> a hiding_tickFree<span class="main">)</span> 
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 21113
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span><span class="main">)</span> 
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 21114
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hide_interleave<span class="main">)</span>
               <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"211"</span><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">using</span></span> ft_fu_f <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> 21115
            <span class="keyword1"><span class="command">from</span></span> f4 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> f5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">fu</span> <span class="skolem">i</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">fufs</span> <span class="main">0</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_list_def<span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tickFree <span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> <span class="quoted">"211"</span><span class="main"><span class="main">(</span></span>9<span class="main"><span class="main">)</span></span> hiding_tickFree<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> ft_fu_f <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="main">(</span><span class="skolem">fu</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> subsetCE sup.boundedE tickFree_def<span class="main">)</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">fufs</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">u</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> f5 front_tickFree_Nil front_tickFree_mono ft_fu_f hiding_fronttickFree is_processT2_TR<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> f5 f6 tickFree_append<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> f5<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">fufs</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>  
               <span class="keyword1"><span class="command">using</span></span> f1 f2 f3 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">using</span></span> elemTIselemHT<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ft</span> <span class="skolem">i</span>"</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">A</span></span><span class="main">,</span> <span class="operator">simplified</span> T_hiding<span class="main">]</span> ft_fu_f <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>             
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xaa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">xaa</span> <span class="main">∉</span> <span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span><span class="main">.</span> <span class="bound">t</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∧</span> <span class="bound">s</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> 211<span class="main">(</span>7<span class="main">)</span><span class="main">[</span><span class="operator">rule_format</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">xaa</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ta</span></span> <span class="skolem"><span class="skolem">ua</span></span> <span class="skolem"><span class="skolem">ra</span></span> <span class="skolem"><span class="skolem">va</span></span> <span class="keyword2"><span class="keyword">where</span></span> bb<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">va</span> <span class="main">∧</span>
                  <span class="main">(</span>tickFree <span class="skolem">ra</span> <span class="main">∨</span> <span class="skolem">va</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="skolem">xaa</span> <span class="main">=</span> <span class="skolem">ra</span> <span class="main">@</span> <span class="skolem">va</span> <span class="main">∧</span> <span class="skolem">ra</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">ua</span><span class="main">)</span><span class="main">,</span> ev <span class="main">`</span> <span class="free">C</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span> <span class="main">∧</span> 
                  <span class="main">(</span><span class="skolem">ta</span> <span class="main">∈</span> D <span class="free">P</span> <span class="main">∧</span> <span class="skolem">ua</span> <span class="main">∈</span> T <span class="free">Q</span> <span class="main">∨</span> <span class="skolem">ta</span> <span class="main">∈</span> D <span class="free">Q</span> <span class="main">∧</span> <span class="skolem">ua</span> <span class="main">∈</span> T <span class="free">P</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> 211 <span class="keyword1"><span class="command">have</span></span> cc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="skolem">f</span> <span class="skolem">xaa</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">@</span> <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> bb 211<span class="main">(</span>9<span class="main">)</span> <span class="quoted">"211"</span><span class="main">(</span>8<span class="main">)</span> <span class="quoted">"21"</span><span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">ra</span> <span class="main">∧</span> tickFree <span class="skolem">va</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hiding_tickFree tickFree_append<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> cc bb 211 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>trace_hide <span class="skolem">ta</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>trace_hide <span class="skolem">ua</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>trace_hide <span class="skolem">ra</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>  <span class="main">(</span><span class="main">(</span>trace_hide <span class="skolem">va</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="skolem">u</span><span class="main">)</span>"</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>front_tickFree_append hiding_tickFree tickFree_def disjoint_iff_not_equal 
                                      hide_interleave<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ev <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">ra</span></span> <span class="quoted"><span class="skolem">ta</span></span> <span class="quoted"><span class="skolem">ua</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">ta</span>"</span></span><span class="main">)</span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">meson</span> front_tickFree_charn self_append_conv tickFree_def<span class="main">)</span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree emptyLeftNonSync ftf_syn21 ftf_syn32 in_set_conv_decomp_last 
                          insertI1 is_processT2_TR nonTickFree_n_frontTickFree tickFree_Nil tickFree_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> disj_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjCI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span> 2111<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> 2111
          <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="skolem">ua</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_implies_tickFree is_processT2_TR is_processT5_S7<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> 2111<span class="main">(</span>20<span class="main">)</span> 2111<span class="main">(</span>21<span class="main">)</span> inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">ua</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">ff</span> <span class="free">Q</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">ua</span> <span class="main">∈</span> range <span class="skolem">ff</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> 2111<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>7<span class="main">)</span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ua</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil tickFree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">ta</span>"</span></span><span class="main">)</span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">meson</span> front_tickFree_charn self_append_conv tickFree_def<span class="main">)</span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree emptyLeftNonSync ftf_syn21 ftf_syn32 in_set_conv_decomp_last 
                        insertI1 is_processT2_TR nonTickFree_n_frontTickFree tickFree_Nil tickFree_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> disj_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjCI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span> 2111<span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> 2111
            <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="skolem">ua</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_implies_tickFree is_processT2_TR is_processT5_S7<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> 2111<span class="main">(</span>20<span class="main">)</span> 2111<span class="main">(</span>21<span class="main">)</span> inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">ua</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">ff</span> <span class="free">P</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">ua</span> <span class="main">∈</span> range <span class="skolem">ff</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> 2111<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>7<span class="main">)</span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ua</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil tickFree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>      
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>212 <span class="skolem">ta</span> <span class="skolem">ua</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">ua</span> <span class="bound">ra</span> <span class="bound">va</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">t</span> <span class="bound">ua</span> <span class="bound">ra</span> <span class="bound">va</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="main">(</span>trace_hide <span class="skolem">ta</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>trace_hide <span class="skolem">ua</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>trace_hide <span class="skolem">r</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span>trace_hide <span class="skolem">v</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">@</span><span class="skolem">u</span><span class="main">)</span>"</span></span><span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>front_tickFree_append hiding_tickFree tickFree_def disjoint_iff_not_equal
                         hide_interleave<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ev <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">ta</span></span> <span class="quoted"><span class="skolem">ua</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">ta</span>"</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">meson</span> front_tickFree_charn self_append_conv tickFree_def<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree emptyLeftNonSync ftf_syn21 ftf_syn32 in_set_conv_decomp_last 
                    insertI1 is_processT2_TR nonTickFree_n_frontTickFree tickFree_Nil tickFree_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> disj_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjCI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span> 2121<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 2121
        <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="skolem">ua</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_implies_tickFree is_processT2_TR is_processT5_S7<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 2121<span class="main">(</span>14<span class="main">)</span> 2121<span class="main">(</span>13<span class="main">)</span> inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">ua</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">ff</span> <span class="free">Q</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">ua</span> <span class="main">∈</span> range <span class="skolem">ff</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> 2121<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>7<span class="main">)</span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ua</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil tickFree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">ta</span>"</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">meson</span> front_tickFree_charn self_append_conv tickFree_def<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree emptyLeftNonSync ftf_syn21 ftf_syn32 in_set_conv_decomp_last 
                    insertI1 is_processT2_TR nonTickFree_n_frontTickFree tickFree_Nil tickFree_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> disj_commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> disjCI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span> 2121<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 2121
        <span class="keyword1"><span class="command">hence</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"tickFree <span class="skolem">ua</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_implies_tickFree is_processT2_TR is_processT5_S7<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 2121<span class="main">(</span>14<span class="main">)</span> 2121<span class="main">(</span>13<span class="main">)</span> inf_hidden<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="skolem">ua</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ff</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"isInfHiddenRun <span class="skolem">ff</span> <span class="free">P</span> <span class="free">A</span> <span class="main">∧</span> <span class="skolem">ua</span> <span class="main">∈</span> range <span class="skolem">ff</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> 2121<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>7<span class="main">)</span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ua</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil tickFree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hide_sync_D2<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"D <span class="main">(</span><span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="main">(</span><span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span> <span class="skolem">Q</span>   
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">u</span> <span class="bound">r</span> <span class="bound">v</span><span class="main">.</span> front_tickFree <span class="bound">v</span> <span class="main">∧</span> <span class="main">(</span>tickFree <span class="bound">r</span> <span class="main">∨</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">[]</span><span class="main">)</span> <span class="main">∧</span>
           <span class="bound">s</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">@</span> <span class="bound">v</span> <span class="main">∧</span> <span class="bound">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="skolem">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="skolem">Q</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> D <span class="main">(</span><span class="main">(</span><span class="skolem">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="skolem">Q</span><span class="main">)</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding D_sync<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> subsetI CollectI<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE conjE CollectE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> a<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>a <span class="skolem">x</span> <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">r</span> <span class="skolem">v</span> <span class="skolem">ta1</span> <span class="skolem">ta2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>1<span class="main">,</span>3-9<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">erule_tac</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">with</span></span> interleave_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ta1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ta2</span>"</span></span> <span class="quoted"><span class="quoted">"insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u1</span> <span class="main">@</span> <span class="skolem">u2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>trace_hide <span class="skolem">ta1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta2</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>T_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 11 12 13<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">ua</span><span class="main">)</span> 
          <span class="keyword1"><span class="command">from</span></span> trace_hide_append<span class="main">[</span><span class="operator">OF</span> 11<span class="main"><span class="main">(</span></span>12<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ua1</span></span> <span class="keyword2"><span class="keyword">where</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> trace_hide <span class="skolem">ua1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ua1</span> <span class="main">≤</span> <span class="skolem">ua</span> <span class="main">∧</span> <span class="skolem">ua1</span> <span class="main">∈</span> T <span class="skolem">Q</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"11"</span><span class="main">(</span>13<span class="main">)</span> F_T is_processT3_ST_pref le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> interleave_hide<span class="main">[</span><span class="operator">OF</span> _ 11<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">simplified</span> a5<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ra1</span></span>
            <span class="keyword2"><span class="keyword">where</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">=</span> trace_hide <span class="skolem">ra1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ra1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta1</span><span class="main">,</span> <span class="skolem">ua1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>2<span class="main">)</span> 11 a5 a6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">ra1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span><span class="main">@</span><span class="skolem">v</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm_lr</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> append_Nil2 front_tickFree_append front_tickFree_mono ftf_syn is_processT2_TR<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> equals0D ftf_syn1 ftf_syn21 insertI1 tickFree_def<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">ua1</span> <span class="skolem">ua2</span><span class="main">)</span>          
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">≤</span> trace_hide <span class="skolem">ua1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uu1</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">u1</span><span class="main">@</span><span class="skolem">uu1</span> <span class="main">=</span> trace_hide <span class="skolem">ua1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> trace_hide_append<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uaa1</span></span> <span class="keyword2"><span class="keyword">where</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> trace_hide <span class="skolem">uaa1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">uaa1</span> <span class="main">≤</span> <span class="skolem">ua1</span> <span class="main">∧</span> <span class="skolem">uaa1</span> <span class="main">∈</span> T <span class="skolem">Q</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"12"</span><span class="main">(</span>15<span class="main">)</span> NT_ND is_processT3_ST_pref le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> interleave_hide<span class="main">[</span><span class="operator">OF</span> _ 12<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">simplified</span> a5<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr1</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">=</span> trace_hide <span class="skolem">rr1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">rr1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta1</span><span class="main">,</span> <span class="skolem">uaa1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>2<span class="main">)</span> 12 a5 a6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">rr1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span><span class="main">@</span><span class="skolem">v</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm_lr</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> append_Nil2 front_tickFree_append front_tickFree_mono ftf_syn is_processT2_TR<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> equals0D ftf_syn1 ftf_syn21 insertI1 tickFree_def<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">with</span></span> 12<span class="main">(</span>14<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uaa1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> trace_hide <span class="skolem">ua1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">@</span><span class="skolem">uaa1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_append_conv2 le_list_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> a3 interleave_append_sym<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r1</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ta1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ua1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">uaa1</span></span><span class="main">]</span>  
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">taa1</span></span> <span class="skolem"><span class="skolem">taa2</span></span> <span class="skolem"><span class="skolem">ra1</span></span> <span class="skolem"><span class="skolem">ra2</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> aa1<span class="main">:</span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ta1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">taa1</span> <span class="main">@</span> <span class="skolem">taa2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> aa2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">=</span> <span class="skolem">ra1</span> <span class="main">@</span> <span class="skolem">ra2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                aa3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">taa1</span><span class="main">,</span> trace_hide <span class="skolem">ua1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                aa4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">taa2</span><span class="main">,</span><span class="skolem">uaa1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> trace_hide_append<span class="main">[</span><span class="operator">OF</span> aa1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">taaa1</span></span> <span class="keyword2"><span class="keyword">where</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">taa1</span> <span class="main">=</span> trace_hide <span class="skolem">taaa1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">taaa1</span> <span class="main">≤</span> <span class="skolem">ta1</span> <span class="main">∧</span> <span class="skolem">taaa1</span> <span class="main">∈</span> T <span class="skolem">P</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"12"</span><span class="main">(</span>7<span class="main">)</span> D_T is_processT3_ST_pref le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> interleave_hide<span class="main">[</span><span class="operator">OF</span> _ aa3<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> a5<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr1</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra1</span> <span class="main">=</span> trace_hide <span class="skolem">rr1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">rr1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">taaa1</span><span class="main">,</span> <span class="skolem">ua1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>2<span class="main">)</span> 12 a5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">rr1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">ra2</span><span class="main">@</span><span class="skolem">r2</span><span class="main">@</span><span class="skolem">v</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm_lr</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> aa2 front_tickFree_append front_tickFree_mono ftf_syn hiding_tickFree self_append_conv tickFree_append<span class="main">)</span>          
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a6 ftf_syn1 le_list_def tickFree_append tickFree_def<span class="main">)</span>
               <span class="keyword1"><span class="command">using</span></span> a6 aa2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">using</span></span> Sync.sym a6 front_tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>13 <span class="skolem">ua</span> <span class="skolem">fa</span> <span class="skolem">xa</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> isInfHiddenRun_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">fa</span></span> <span class="quoted"><span class="skolem">Q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">fa</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">fa</span> <span class="main">0</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∧</span> set <span class="bound">t</span> <span class="main">⊆</span>  <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tlf</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tlf</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">i</span><span class="main">.</span> drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">fa</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fa</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> tlf_def2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fa</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">fa</span> <span class="main">0</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">tlf</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a0 append_eq_conv_conj tlf_def<span class="main">)</span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
            <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">fa</span> <span class="main">0</span> <span class="main">@</span> <span class="skolem">tlf</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">fa</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">fa</span> <span class="main">0</span> <span class="main">@</span> <span class="skolem">tlf</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> tlf_def2<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">tlf</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">tlf</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> strict_monoD<span class="main">[</span><span class="operator">OF</span> 13<span class="main"><span class="main">(</span></span>16<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A <span class="quoted">"*"</span> le_list_def<span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> tlf_strict_mono <span class="main">=</span> this
          <span class="keyword1"><span class="command">have</span></span> tlf_range<span class="main">:</span><span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">tlf</span> <span class="skolem">i</span><span class="main">)</span>  <span class="main">⊆</span>  <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a0 append_eq_conv_conj tlf_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> 13 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">≤</span> trace_hide <span class="main">(</span><span class="skolem">fa</span> <span class="skolem">xa</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uu1</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">u1</span><span class="main">@</span><span class="skolem">uu1</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="skolem">fa</span> <span class="skolem">xa</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> trace_hide_append<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uaa1</span></span> <span class="keyword2"><span class="keyword">where</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> trace_hide <span class="skolem">uaa1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">uaa1</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">fa</span> <span class="skolem">xa</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">uaa1</span> <span class="main">∈</span> T <span class="skolem">Q</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"13"</span><span class="main"><span class="main">(</span></span>17<span class="main"><span class="main">)</span></span> is_processT3_ST le_list_def<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> interleave_hide<span class="main">[</span><span class="operator">OF</span> _ 13<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">simplified</span> a5<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr1</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">=</span> trace_hide <span class="skolem">rr1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">rr1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta1</span><span class="main">,</span> <span class="skolem">uaa1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>2<span class="main">)</span> 13 a5 a6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">rr1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span><span class="main">@</span><span class="skolem">v</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm_lr</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> append_Nil2 front_tickFree_append front_tickFree_mono ftf_syn is_processT2_TR<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> equals0D ftf_syn1 ftf_syn21 insertI1 tickFree_def<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> front_tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">with</span></span> 13<span class="main">(</span>14<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uaa1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="skolem">fa</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">@</span><span class="skolem">uaa1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"13"</span><span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span> append_eq_append_conv2 le_list_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> a3 interleave_append_sym<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r1</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ta1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">fa</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">uaa1</span></span><span class="main">]</span>  
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">taa1</span></span> <span class="skolem"><span class="skolem">taa2</span></span> <span class="skolem"><span class="skolem">ra1</span></span> <span class="skolem"><span class="skolem">ra2</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> aa1<span class="main">:</span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ta1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">taa1</span> <span class="main">@</span> <span class="skolem">taa2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> aa2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">=</span> <span class="skolem">ra1</span> <span class="main">@</span> <span class="skolem">ra2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                aa3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">taa1</span><span class="main">,</span> trace_hide <span class="main">(</span><span class="skolem">fa</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                aa4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">taa2</span><span class="main">,</span><span class="skolem">uaa1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> trace_hide_append<span class="main">[</span><span class="operator">OF</span> aa1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">taaa1</span></span> <span class="keyword2"><span class="keyword">where</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">taa1</span> <span class="main">=</span> trace_hide <span class="skolem">taaa1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">taaa1</span> <span class="main">≤</span> <span class="skolem">ta1</span> <span class="main">∧</span> <span class="skolem">taaa1</span> <span class="main">∈</span> T <span class="skolem">P</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"13"</span><span class="main">(</span>7<span class="main">)</span> D_T is_processT3_ST_pref le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> interleave_hide<span class="main">[</span><span class="operator">OF</span> _ aa3<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> a5<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr1</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra1</span> <span class="main">=</span> trace_hide <span class="skolem">rr1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">rr1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">taaa1</span><span class="main">,</span> <span class="main">(</span><span class="skolem">fa</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>2<span class="main">)</span> 13 a0 a5 a6 aa1 aa2 aa3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">rr1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">ra2</span><span class="main">@</span><span class="skolem">r2</span><span class="main">@</span><span class="skolem">v</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm_lr</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_append front_tickFree_mono ftf_syn hiding_tickFree self_append_conv tickFree_append<span class="main">)</span>          
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a6 ftf_syn1 le_list_def tickFree_append tickFree_def<span class="main">)</span>
             <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">rr1</span><span class="main">@</span><span class="main">(</span><span class="skolem">tlf</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 131 132 133 134<span class="main">)</span>
               <span class="keyword3"><span class="command">case</span></span> 131
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> strict_monoI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> tlf_strict_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> less_append<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 132
               <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rr1</span><span class="main">@</span><span class="skolem">tlf</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">taaa1</span><span class="main">,</span> <span class="skolem">fa</span> <span class="skolem">i</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tlf_def2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> interleave_append_tail_sym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a6<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">tlf</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                 <span class="keyword1"><span class="command">using</span></span> * tlf_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
                 <span class="keyword1"><span class="command">unfolding</span></span> T_sync <span class="keyword1"><span class="command">using</span></span> a5 13<span class="main">(</span>17<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 133
               <span class="keyword1"><span class="command">from</span></span> tlf_range <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">y</span> <span class="main">@</span> <span class="skolem">tlf</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="skolem">y</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">y</span> 
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> filter_empty_conv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 134
               <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tlf</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tlf_def<span class="main">)</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             <span class="keyword1"><span class="command">qed</span></span>  
          <span class="keyword1"><span class="command">qed</span></span>  
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>8<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">nta</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">ff</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> event list"</span></span> 
          <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">ff</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ff<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">ff</span> <span class="bound">i</span> <span class="main">∈</span> T <span class="skolem">P</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ta1</span> <span class="main">=</span> <span class="skolem">ff</span> <span class="skolem">nta</span> <span class="main">∧</span> 
                <span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> trace_hide <span class="main">(</span><span class="skolem">ff</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="skolem">ff</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">ff</span> <span class="main">(</span><span class="bound">i</span> <span class="main">+</span> <span class="skolem">nta</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">with</span></span> ff <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span><span class="quoted"><span class="quoted">"strict_mono <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">∈</span> T <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ta1</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                f4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">i</span><span class="main">.</span> trace_hide <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="skolem">ta1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> strict_monoI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> <span class="quoted"><span class="quoted">‹strict_mono <span class="skolem">ff</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> strict_monoD<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">with</span></span> isInfHiddenRun_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">0</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∧</span> set <span class="bound">t</span> <span class="main">⊆</span>  <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tlf</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tlf</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">i</span><span class="main">.</span> drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">f</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> tlf_def2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ta1</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">tlf</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a0 f3 append_eq_conv_conj tlf_def<span class="main">)</span>
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
          <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">0</span> <span class="main">@</span> <span class="skolem">tlf</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">0</span> <span class="main">@</span> <span class="skolem">tlf</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f3 tlf_def2<span class="main">)</span>
          <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">tlf</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">tlf</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> strict_monoD<span class="main">[</span><span class="operator">OF</span> f1<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A <span class="quoted">"*"</span> le_list_def<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> tlf_strict_mono <span class="main">=</span> this
        <span class="keyword1"><span class="command">have</span></span> tlf_range<span class="main">:</span><span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">tlf</span> <span class="skolem">i</span><span class="main">)</span>  <span class="main">⊆</span>  <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a0 append_eq_conv_conj tlf_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 2 interleave_append<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ta1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ta2</span>"</span></span> <span class="quoted"><span class="quoted">"insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="skolem">u1</span> <span class="main">@</span> <span class="skolem">u2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span>trace_hide <span class="skolem">ta1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta2</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>1-6<span class="main">)</span> f1 f2 f3 f4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>T_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 21 22 23<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>21 <span class="skolem">ua</span><span class="main">)</span> 
          <span class="keyword1"><span class="command">from</span></span> trace_hide_append<span class="main">[</span><span class="operator">OF</span> 21<span class="main"><span class="main">(</span></span>14<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ua1</span></span> <span class="keyword2"><span class="keyword">where</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> trace_hide <span class="skolem">ua1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ua1</span> <span class="main">≤</span> <span class="skolem">ua</span> <span class="main">∧</span> <span class="skolem">ua1</span> <span class="main">∈</span> T <span class="skolem">Q</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"21"</span><span class="main">(</span>15<span class="main">)</span> F_T is_processT3_ST_pref le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> interleave_hide<span class="main">[</span><span class="operator">OF</span> _ a3<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> a5<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ra1</span></span>
            <span class="keyword2"><span class="keyword">where</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">=</span> trace_hide <span class="skolem">ra1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ra1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta1</span><span class="main">,</span> <span class="skolem">ua1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>2<span class="main">)</span> 21 a5 a6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">ra1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span><span class="main">@</span><span class="skolem">v</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm_lr</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> append_Nil2 front_tickFree_append front_tickFree_mono ftf_syn is_processT2_TR<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> equals0D ftf_syn1 ftf_syn21 insertI1 tickFree_def<span class="main">)</span> 
             <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">ra1</span><span class="main">@</span><span class="main">(</span><span class="skolem">tlf</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 211 212 213 214<span class="main">)</span>
               <span class="keyword3"><span class="command">case</span></span> 211
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> strict_monoI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> tlf_strict_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> less_append<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 212
               <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ra1</span><span class="main">@</span><span class="skolem">tlf</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">,</span> <span class="skolem">ua1</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tlf_def2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> interleave_append_tail<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a6<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">tlf</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                 <span class="keyword1"><span class="command">using</span></span> * tlf_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
                 <span class="keyword1"><span class="command">unfolding</span></span> T_sync <span class="keyword1"><span class="command">using</span></span> a5 21<span class="main">(</span>15<span class="main">)</span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 213
               <span class="keyword1"><span class="command">from</span></span> tlf_range <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">y</span> <span class="main">@</span> <span class="skolem">tlf</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="skolem">y</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">y</span> 
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> filter_empty_conv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 214
               <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tlf</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tlf_def<span class="main">)</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             <span class="keyword1"><span class="command">qed</span></span>              
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>22 <span class="skolem">ua1</span> <span class="skolem">ua2</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">≤</span> trace_hide <span class="skolem">ua1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uu1</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">u1</span><span class="main">@</span><span class="skolem">uu1</span> <span class="main">=</span> trace_hide <span class="skolem">ua1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> trace_hide_append<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uaa1</span></span> <span class="keyword2"><span class="keyword">where</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> trace_hide <span class="skolem">uaa1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">uaa1</span> <span class="main">≤</span> <span class="skolem">ua1</span> <span class="main">∧</span> <span class="skolem">uaa1</span> <span class="main">∈</span> T <span class="skolem">Q</span>"</span></span> 
              <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"22"</span><span class="main">(</span>17<span class="main">)</span> D_T is_processT3_ST le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> interleave_hide<span class="main">[</span><span class="operator">OF</span> _ a3<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> a5<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ra1</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">=</span> trace_hide <span class="skolem">ra1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">ra1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta1</span><span class="main">,</span> <span class="skolem">uaa1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>2<span class="main">)</span> 22 a5 a6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">ra1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span><span class="main">@</span><span class="skolem">v</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm_lr</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> append_Nil2 front_tickFree_append front_tickFree_mono ftf_syn is_processT2_TR<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> equals0D ftf_syn1 ftf_syn21 insertI1 tickFree_def<span class="main">)</span>
             <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">ra1</span><span class="main">@</span><span class="main">(</span><span class="skolem">tlf</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 211 212 213 214<span class="main">)</span>
               <span class="keyword3"><span class="command">case</span></span> 211
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> strict_monoI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> tlf_strict_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> less_append<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 212
               <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ra1</span><span class="main">@</span><span class="skolem">tlf</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">,</span> <span class="skolem">uaa1</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tlf_def2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> interleave_append_tail<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a6<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">tlf</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                 <span class="keyword1"><span class="command">using</span></span> * tlf_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
                 <span class="keyword1"><span class="command">unfolding</span></span> T_sync <span class="keyword1"><span class="command">using</span></span> a5 22<span class="main">(</span>15<span class="main">)</span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 213
               <span class="keyword1"><span class="command">from</span></span> tlf_range <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">y</span> <span class="main">@</span> <span class="skolem">tlf</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="skolem">y</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">y</span> 
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> filter_empty_conv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 214
               <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tlf</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tlf_def<span class="main">)</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             <span class="keyword1"><span class="command">qed</span></span>  
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">with</span></span> 22<span class="main">(</span>16<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uaa1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> trace_hide <span class="skolem">ua1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">@</span><span class="skolem">uaa1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_eq_append_conv2 le_list_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> a3 interleave_append_sym<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r1</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ta1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ua1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">uaa1</span></span><span class="main">]</span>  
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">taa1</span></span> <span class="skolem"><span class="skolem">taa2</span></span> <span class="skolem"><span class="skolem">ra1</span></span> <span class="skolem"><span class="skolem">ra2</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> aa1<span class="main">:</span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ta1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">taa1</span> <span class="main">@</span> <span class="skolem">taa2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> aa2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">=</span> <span class="skolem">ra1</span> <span class="main">@</span> <span class="skolem">ra2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                aa3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">taa1</span><span class="main">,</span> trace_hide <span class="skolem">ua1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                aa4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">taa2</span><span class="main">,</span><span class="skolem">uaa1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> trace_hide_append<span class="main">[</span><span class="operator">OF</span> aa1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">taaa1</span></span> <span class="keyword2"><span class="keyword">where</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">taa1</span> <span class="main">=</span> trace_hide <span class="skolem">taaa1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">taaa1</span> <span class="main">≤</span> <span class="skolem">ta1</span> <span class="main">∧</span> <span class="skolem">taaa1</span> <span class="main">∈</span> T <span class="skolem">P</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> f2 f3 is_processT3_ST_pref le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
            <span class="keyword1"><span class="command">with</span></span> interleave_hide<span class="main">[</span><span class="operator">OF</span> _ aa3<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> a5<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr1</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra1</span> <span class="main">=</span> trace_hide <span class="skolem">rr1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">rr1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">taaa1</span><span class="main">,</span> <span class="skolem">ua1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>2<span class="main">)</span> 22 a5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">rr1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">ra2</span><span class="main">@</span><span class="skolem">r2</span><span class="main">@</span><span class="skolem">v</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm_lr</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> a<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> aa2 front_tickFree_append front_tickFree_mono ftf_syn hiding_tickFree 
                              is_processT2_TR self_append_conv tickFree_append<span class="main">)</span>                
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a6 ftf_syn1 le_list_def tickFree_append tickFree_def<span class="main">)</span>
               <span class="keyword1"><span class="command">using</span></span> a6 aa2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> 
              <span class="keyword1"><span class="command">using</span></span> Sync.sym a6<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span> front_tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2<span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>23 <span class="skolem">ua</span> <span class="skolem">fa</span> <span class="skolem">xa</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> isInfHiddenRun_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">fa</span></span> <span class="quoted"><span class="skolem">Q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> a0<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">fa</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">fa</span> <span class="main">0</span> <span class="main">@</span> <span class="bound">t</span> <span class="main">∧</span> set <span class="bound">t</span> <span class="main">⊆</span>  <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">tlfa</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tlfa</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">i</span><span class="main">.</span> drop <span class="main">(</span>length <span class="main">(</span><span class="skolem">fa</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">fa</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> tlfa_def2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">fa</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">fa</span> <span class="main">0</span><span class="main">)</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">tlfa</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a0 append_eq_conv_conj tlfa_def<span class="main">)</span>
          <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
            <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">y</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">fa</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">fa</span> <span class="main">0</span> <span class="main">@</span> <span class="skolem">tlfa</span> <span class="skolem">x</span> <span class="main">∧</span> <span class="skolem">fa</span> <span class="skolem">y</span> <span class="main">=</span> <span class="skolem">fa</span> <span class="main">0</span> <span class="main">@</span> <span class="skolem">tlfa</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> tlfa_def2<span class="main">)</span>
            <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">tlfa</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">tlfa</span> <span class="skolem">y</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> strict_monoD<span class="main">[</span><span class="operator">OF</span> 23<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A <span class="quoted">"*"</span> le_list_def<span class="main">)</span>
          <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> tlfa_strict_mono <span class="main">=</span> this
          <span class="keyword1"><span class="command">have</span></span> tlfa_range<span class="main">:</span><span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">tlfa</span> <span class="skolem">i</span><span class="main">)</span>  <span class="main">⊆</span>  <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> a0 append_eq_conv_conj tlfa_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> 23 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">≤</span> trace_hide <span class="main">(</span><span class="skolem">fa</span> <span class="skolem">xa</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> True
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uu1</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">u1</span><span class="main">@</span><span class="skolem">uu1</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="skolem">fa</span> <span class="skolem">xa</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_list_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> trace_hide_append<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uaa1</span></span> <span class="keyword2"><span class="keyword">where</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> trace_hide <span class="skolem">uaa1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">uaa1</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">fa</span> <span class="skolem">xa</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">uaa1</span> <span class="main">∈</span> T <span class="skolem">Q</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"23"</span><span class="main"><span class="main">(</span></span>19<span class="main"><span class="main">)</span></span> is_processT3_ST le_list_def<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> interleave_hide<span class="main">[</span><span class="operator">OF</span> _ a3<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> a5<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr1</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">=</span> trace_hide <span class="skolem">rr1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">rr1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta1</span><span class="main">,</span> <span class="skolem">uaa1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>2<span class="main">)</span> 23 a5 a6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">rr1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span><span class="main">@</span><span class="skolem">v</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm_lr</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> append_Nil2 front_tickFree_append front_tickFree_mono ftf_syn is_processT2_TR<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> equals0D ftf_syn1 ftf_syn21 insertI1 tickFree_def<span class="main">)</span>
            <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">rr1</span><span class="main">@</span><span class="main">(</span><span class="skolem">tlf</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 211 212 213 214<span class="main">)</span>
               <span class="keyword3"><span class="command">case</span></span> 211
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> strict_monoI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> tlf_strict_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> less_append<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 212
               <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rr1</span><span class="main">@</span><span class="skolem">tlf</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">f</span> <span class="skolem">i</span><span class="main">,</span> <span class="skolem">uaa1</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tlf_def2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> interleave_append_tail<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a6<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">tlf</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                 <span class="keyword1"><span class="command">using</span></span> * tlf_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
                 <span class="keyword1"><span class="command">unfolding</span></span> T_sync <span class="keyword1"><span class="command">using</span></span> a5 23<span class="main">(</span>17<span class="main">)</span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 213
               <span class="keyword1"><span class="command">from</span></span> tlf_range <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">y</span> <span class="main">@</span> <span class="skolem">tlf</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="skolem">y</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">y</span> 
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> filter_empty_conv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 214
               <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tlf</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tlf_def<span class="main">)</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             <span class="keyword1"><span class="command">qed</span></span>  
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> False
            <span class="keyword1"><span class="command">with</span></span> 23<span class="main">(</span>16<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uaa1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u1</span> <span class="main">=</span> trace_hide <span class="main">(</span><span class="skolem">fa</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">@</span><span class="skolem">uaa1</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"23"</span><span class="main"><span class="main">(</span></span>20<span class="main"><span class="main">)</span></span> append_eq_append_conv2 le_list_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> a3 interleave_append_sym<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r1</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ta1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">fa</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">uaa1</span></span><span class="main">]</span>  
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">taa1</span></span> <span class="skolem"><span class="skolem">taa2</span></span> <span class="skolem"><span class="skolem">ra1</span></span> <span class="skolem"><span class="skolem">ra2</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> aa1<span class="main">:</span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">ta1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">taa1</span> <span class="main">@</span> <span class="skolem">taa2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> aa2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="main">=</span> <span class="skolem">ra1</span> <span class="main">@</span> <span class="skolem">ra2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                aa3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">taa1</span><span class="main">,</span> trace_hide <span class="main">(</span><span class="skolem">fa</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
                aa4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">taa2</span><span class="main">,</span><span class="skolem">uaa1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">with</span></span> trace_hide_append<span class="main">[</span><span class="operator">OF</span> aa1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">taaa1</span></span> <span class="keyword2"><span class="keyword">where</span></span> a5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">taa1</span> <span class="main">=</span> trace_hide <span class="skolem">taaa1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">taaa1</span> <span class="main">≤</span> <span class="skolem">ta1</span> <span class="main">∧</span> <span class="skolem">taaa1</span> <span class="main">∈</span> T <span class="skolem">P</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> f2 f3 is_processT3_ST le_list_def<span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> interleave_hide<span class="main">[</span><span class="operator">OF</span> _ aa3<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> a5<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">rr1</span></span>
              <span class="keyword2"><span class="keyword">where</span></span> a6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">ra1</span> <span class="main">=</span> trace_hide <span class="skolem">rr1</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">rr1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">taaa1</span><span class="main">,</span> <span class="main">(</span><span class="skolem">fa</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>2<span class="main">)</span> 23 a0 a5 a6 aa1 aa2 aa3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">rr1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">ra2</span><span class="main">@</span><span class="skolem">r2</span><span class="main">@</span><span class="skolem">v</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm_lr</span><span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> a<span class="main"><span class="main">(</span></span>8<span class="main"><span class="main">)</span></span> front_tickFree_append front_tickFree_mono ftf_syn hiding_tickFree is_processT2_TR self_append_conv<span class="main">)</span>
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> a6 ftf_syn1 le_list_def tickFree_append tickFree_def<span class="main">)</span>
             <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">rr1</span><span class="main">@</span><span class="main">(</span><span class="skolem">tlfa</span> <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 131 132 133 134<span class="main">)</span>
               <span class="keyword3"><span class="command">case</span></span> 131
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> strict_monoI<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule_tac</span> tlfa_strict_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> less_append<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 132
               <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">rr1</span><span class="main">@</span><span class="skolem">tlfa</span> <span class="skolem">i</span><span class="main">)</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">taaa1</span><span class="main">,</span> <span class="skolem">fa</span> <span class="skolem">i</span><span class="main">)</span><span class="main">,</span>insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tlfa_def2<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> interleave_append_tail_sym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a6<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">tlfa</span> <span class="skolem">i</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                 <span class="keyword1"><span class="command">using</span></span> * tlfa_range <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
                 <span class="keyword1"><span class="command">unfolding</span></span> T_sync <span class="keyword1"><span class="command">using</span></span> a5 23<span class="main">(</span>19<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 133
               <span class="keyword1"><span class="command">from</span></span> tlfa_range <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"trace_hide <span class="main">(</span><span class="skolem">y</span> <span class="main">@</span> <span class="skolem">tlfa</span> <span class="skolem">i</span><span class="main">)</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> trace_hide <span class="skolem">y</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span> <span class="skolem">y</span> 
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">y</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> filter_empty_conv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             <span class="keyword1"><span class="command">next</span></span>
               <span class="keyword3"><span class="command">case</span></span> 134
               <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">tlfa</span> <span class="main">0</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
                 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tlfa_def<span class="main">)</span>
               <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
             <span class="keyword1"><span class="command">qed</span></span>  
          <span class="keyword1"><span class="command">qed</span></span>  
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">]</span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">P</span></span><span class="main">]</span> sync_commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync T_sync<span class="main">)</span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> hide_sync<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">A</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="main">(</span><span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Process_eq_spec_optimized subset_antisym<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hide_sync_D1 hide_sync_D2<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> 
      <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> F_sync F_hiding<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 11 12<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 11
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 111 112<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>111 <span class="skolem">c</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 111<span class="main">(</span>7<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">X</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">X</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
        c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span>  <span class="main">∪</span> ev <span class="main">`</span> <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span> d <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span><span class="quoted"><span class="quoted">"ev <span class="main">`</span> <span class="free">A</span> <span class="main">⊆</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">from</span></span> a b c d e 111<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">t</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"trace_hide <span class="skolem">u</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Int_subset_iff Un_Diff_Int Un_least is_processT4 sup_ge1<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">-</span> <span class="main">(</span><span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Int_subset_iff Un_Diff_Int Un_least is_processT4 sup_ge1<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hide_interleave<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"ev <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">u</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>112 <span class="skolem">t</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 112<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span><span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">t</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> D_imp_front_tickFree append_Nil2 
                  front_tickFree_append ftf_syn is_processT2_TR<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 112 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 112<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> D <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding<span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">t</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 1121 1122<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> 1121
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> 1122
          <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t'</span><span class="main">@</span><span class="main">[</span>tick<span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> nonTickFree_n_frontTickFree <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>tick<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
             <span class="keyword1"><span class="command">using</span></span> front_tickFree_mono <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">using</span></span> 1122<span class="main">(</span>4<span class="main">)</span> is_processT9 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hide_sync_D1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">,</span> <span class="operator">OF</span> 112<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> D_sync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> \<span class="main">\</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 12
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> D <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> hide_sync_D1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">,</span> <span class="operator">OF</span> 12<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> D_sync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> \<span class="main">\</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 21 22<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 21
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE conjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> 211 212 213 214<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>211 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ta</span></span> <span class="skolem"><span class="skolem">ua</span></span> <span class="keyword2"><span class="keyword">where</span></span> t211<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> trace_hide <span class="skolem">ta</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">X</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                              u211<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> trace_hide <span class="skolem">ua</span> <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">ua</span><span class="main">,</span> <span class="skolem">Y</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> interleave_hide<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">ta</span></span> <span class="quoted"><span class="skolem">ua</span></span><span class="main">]</span> <span class="quoted">"211"</span><span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">)</span> t211 u211 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">aa</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> a211<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> trace_hide <span class="skolem">aa</span>  <span class="main">(</span>ev <span class="main">`</span> <span class="free">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">aa</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">ta</span><span class="main">,</span> <span class="skolem">ua</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> 211<span class="main">(</span>1<span class="main">,</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> t211 u211 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">aa</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">ta</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">ua</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">X</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> is_processT4 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">∪</span> ev <span class="main">`</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> is_processT4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>212 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"212"</span><span class="main">(</span>8<span class="main">)</span> F_T elemTIselemHT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> 212<span class="main">(</span>3<span class="main">,</span>8<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> D <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="main">(</span><span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Sync.sym front_tickFree_charn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hide_sync_D2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">,</span> <span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> D_hiding<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>213 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> F_T elemTIselemHT<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 213<span class="main">(</span>3<span class="main">,</span>8<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> D <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="main">(</span><span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Sync.sym front_tickFree_charn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hide_sync_D2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">,</span> <span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> D_hiding<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>214 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">∈</span> T <span class="main">(</span><span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">∈</span> D <span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_hiding T_hiding<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 214<span class="main">(</span>3<span class="main">,</span>8<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> D <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="main">(</span><span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Sync.sym front_tickFree_charn <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> hide_sync_D2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">,</span> <span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> D_hiding<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 22
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> D <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">P</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="main">(</span><span class="free">Q</span> \<span class="main">\</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> hide_sync_D2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">,</span> <span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> D_hiding<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sync_assoc_oneside_D<span class="main">:</span> <span class="quoted"><span class="quoted">"D <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> D <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync T_sync <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span>disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> a<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>a <span class="skolem">tt</span> <span class="skolem">uu</span> <span class="skolem">rr</span> <span class="skolem">vv</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> a<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> interleave_assoc_2<span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tu</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tt</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tu</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> a<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> append.right_neutral front_tickFree_charn<span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> interleave_append_sym <span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">@</span> <span class="skolem">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
            a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t2</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> interleave_assoc_2<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> a3<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tu</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tu</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> a1 a2 a3 a<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">tu</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">r1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span><span class="main">@</span><span class="skolem">vv</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree append_Nil2 front_tickFree_append front_tickFree_mono ftf_syn<span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> D_imp_front_tickFree front_tickFree_append front_tickFree_mono ftf_syn <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> NT_ND Sync.sym append_Nil2 front_tickFree_Nil is_processT3_ST<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">v</span> <span class="skolem">u</span> <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> interleave_append_sym <span class="main">[</span><span class="operator">OF</span> 3<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">@</span> <span class="skolem">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
            a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t2</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> interleave_assoc_2<span class="main">[</span><span class="operator">OF</span> _ a3<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tu</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tu</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Sync.sym 3<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> a1 a2 a3 a<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">tu</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">r1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span><span class="main">@</span><span class="skolem">vv</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree append_Nil2 front_tickFree_append front_tickFree_mono ftf_syn<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> D_imp_front_tickFree front_tickFree_append front_tickFree_mono ftf_syn <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> D_T is_processT3_ST<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> interleave_assoc_2<span class="main">[</span><span class="operator">OF</span> 4<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> 4<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tu</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tt</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tu</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> a<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">tu</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">rr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">vv</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> NT_ND front_tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> interleave_assoc_2<span class="main">[</span><span class="operator">OF</span> _ 5<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tu</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tt</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tu</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> a<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> 5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">tu</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">rr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">vv</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> NT_ND front_tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">t</span> <span class="skolem">u</span> <span class="skolem">u1</span> <span class="skolem">u2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> interleave_append <span class="main">[</span><span class="operator">OF</span> 6<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">uu</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">@</span> <span class="skolem">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
            a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t2</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> interleave_assoc_2<span class="main">[</span><span class="operator">OF</span> 6<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> a3<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tu</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tu</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> a1 a2 a3 a<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> 6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">tu</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">r1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span><span class="main">@</span><span class="skolem">vv</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 front_tickFree_append front_tickFree_mono ftf_syn is_processT2_TR<span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> front_tickFree_append front_tickFree_mono ftf_syn is_processT2_TR<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym append_Nil2 front_tickFree_Nil is_processT3_ST<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">v</span> <span class="skolem">u</span> <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> interleave_append <span class="main">[</span><span class="operator">OF</span> 7<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">uu</span> <span class="main">=</span> <span class="skolem">u1</span> <span class="main">@</span> <span class="skolem">u2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
            a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t2</span><span class="main">,</span> <span class="skolem">u2</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> interleave_assoc_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">r1</span></span> <span class="quoted"><span class="skolem">u1</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tu</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">u1</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tu</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> 7<span class="main">(</span>5<span class="main">)</span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> a1 a2 a3 a<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> 7 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">tu</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">r1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span><span class="main">@</span><span class="skolem">vv</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append_Nil2 front_tickFree_append front_tickFree_mono ftf_syn is_processT2_TR<span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> front_tickFree_append front_tickFree_mono ftf_syn is_processT2_TR<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> D_T is_processT3_ST<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> interleave_assoc_2<span class="main">[</span><span class="operator">OF</span> 8<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">rr</span></span> <span class="quoted"><span class="skolem">uu</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tu</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">uu</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tu</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> a<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> 8 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">tu</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">u</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">rr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">vv</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Sync.sym front_tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">t</span> <span class="skolem">u</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> interleave_assoc_1<span class="main">[</span><span class="operator">OF</span> 9<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">rr</span></span> <span class="quoted"><span class="skolem">uu</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uv</span></span> 
      <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">uv</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">u</span><span class="main">,</span> <span class="skolem">uu</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">rr</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">uv</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> a<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> 9 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">exI</span> <span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">uv</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">rr</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">vv</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Sync.sym front_tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sync_assoc_oneside<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> le_ref_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> D F<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> D
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> sync_assoc_oneside_D <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> F
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> F_sync <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> Un_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span> FF DD<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>FF<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> subsetI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync T_sync split_paired_all<span class="main"><span class="keyword3">,</span></span> <span class="operator">elim</span> exE conjE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">r</span> <span class="skolem">Xtuv</span> <span class="skolem">t</span> <span class="skolem">uv</span> <span class="skolem">Xt</span> <span class="skolem">Xuv</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">Xu</span> <span class="skolem">Xv</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> interleave_assoc_2<span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tu</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tu</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>1<span class="main">,</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">,</span>7<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">tu</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Xt</span> <span class="main">∪</span> <span class="skolem">Xu</span><span class="main">)</span> <span class="main">∩</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">Xt</span> <span class="main">∩</span> <span class="skolem">Xu</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">r</span> <span class="skolem">Xtuv</span> <span class="skolem">t</span> <span class="skolem">uv</span> <span class="skolem">Xt</span> <span class="skolem">Xuv</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">uv1</span> <span class="skolem">uv2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> interleave_append_sym <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">uv1</span></span> <span class="quoted"><span class="skolem">uv2</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">@</span> <span class="skolem">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
              a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">uv1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t2</span><span class="main">,</span> <span class="skolem">uv2</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">with</span></span> interleave_assoc_2<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">OF</span> a3<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tu</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tu</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span> a1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Xt1</span></span> <span class="keyword2"><span class="keyword">where</span></span> ***<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">Xt1</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_processT3_SR <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> 2 a1 a2 a3 a4 * ** *** <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">tu</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">r1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">r2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_charn front_tickFree_mono ftf_syn is_processT2<span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> equals0D ftf_syn1 ftf_syn21 insertI1 tickFree_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> F_T Sync.sym front_tickFree_Nil <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">r</span> <span class="skolem">Xtuv</span> <span class="skolem">t</span> <span class="skolem">uv</span> <span class="skolem">Xt</span> <span class="skolem">Xuv</span> <span class="skolem">v</span> <span class="skolem">u</span> <span class="skolem">uv1</span> <span class="skolem">uv2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> interleave_append_sym <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">uv1</span></span> <span class="quoted"><span class="skolem">uv2</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">r1</span></span> <span class="skolem"><span class="skolem">r2</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">t1</span> <span class="main">@</span> <span class="skolem">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="skolem">r1</span> <span class="main">@</span> <span class="skolem">r2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
              a3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">uv1</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
              a4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t2</span><span class="main">,</span> <span class="skolem">uv2</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">with</span></span> interleave_assoc_2<span class="main">[</span><span class="operator">OF</span> _ a3<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">u</span></span> <span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tu</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tu</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"3"</span><span class="main">(</span>6<span class="main">)</span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> 3<span class="main">(</span>1<span class="main">)</span> a1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Xt1</span></span> <span class="keyword2"><span class="keyword">where</span></span> ***<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="skolem">Xt1</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_processT3_SR <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> 3 a1 a2 a3 a4 * ** *** <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">tu</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">r1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">r2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> front_tickFree_charn front_tickFree_mono ftf_syn is_processT2<span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> equals0D ftf_syn1 ftf_syn21 insertI1 tickFree_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Sync.sym F_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">r</span> <span class="skolem">Xtuv</span> <span class="skolem">t</span> <span class="skolem">uv</span> <span class="skolem">Xt</span> <span class="skolem">Xuv</span> <span class="skolem">u</span> <span class="skolem">v</span> <span class="skolem">uv1</span> <span class="skolem">uv2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> interleave_assoc_2<span class="main">[</span><span class="operator">OF</span> 4<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tu</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tu</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> 4 * **  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">tu</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">r</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"4"</span><span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> F_T Sync.sym append.right_neutral<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">r</span> <span class="skolem">Xtuv</span> <span class="skolem">t</span> <span class="skolem">uv</span> <span class="skolem">Xt</span> <span class="skolem">Xuv</span> <span class="skolem">v</span> <span class="skolem">u</span> <span class="skolem">uv1</span> <span class="skolem">uv2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 5<span class="main">(</span>2<span class="main">,</span>7<span class="main">,</span>5<span class="main">,</span>6<span class="main">)</span>  interleave_assoc_2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">uv</span></span> <span class="quoted"><span class="skolem">u</span></span> <span class="main">_</span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">tu</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">tu</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t</span><span class="main">,</span> <span class="skolem">u</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> **<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">tu</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span><span class="main">,</span> insert tick <span class="main">(</span>ev <span class="main">`</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym append_Nil2<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 5 * **  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI2<span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">v</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">tu</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="skolem">r</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">exI</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Sync.sym F_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>DD<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> sync_assoc_oneside_D<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">S</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync Collect_mono_iff sup.coboundedI2<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sync_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> antisym_conv sync_assoc_oneside sync_commute<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Derivative Operators laws  ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mono_Inter_ref<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⟦</span><span class="free">P</span> <span class="main">⊑</span> <span class="free">P'</span><span class="main">;</span> <span class="free">Q</span> <span class="main">⊑</span> <span class="free">Q'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">|||</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">P'</span><span class="main">|||</span> <span class="free">Q'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mono_sync_ref<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> mono_Par_ref<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">P</span> <span class="main">⊑</span> <span class="free">P'</span><span class="main">;</span> <span class="free">Q</span> <span class="main">⊑</span> <span class="free">Q'</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">||</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊑</span> <span class="main">(</span><span class="free">P'</span> <span class="main">||</span> <span class="free">Q'</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mono_sync_ref<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> Inter_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">|||</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">|||</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> sync_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> par_comm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">||</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span><span class="main">(</span><span class="free">Q</span> <span class="main">||</span> <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> sync_commute<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> par_id<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">||</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">oops</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Inter_skip1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">|||</span> SKIP<span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>Process_eq_spec D_sync F_sync F_SKIP D_SKIP T_SKIP<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span>tick<span class="main">}</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span> <span class="main">⊆</span> <span class="skolem">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Int_Un_distrib2<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span><span class="main">(</span>1<span class="main">)</span> is_processT2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 1 EmptyLeftSync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">)</span> aa bb <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_processT4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"front_tickFree <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>1<span class="main">)</span> is_processT2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 2 TickLeftSync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">a</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">t</span> <span class="main">∧</span> last <span class="skolem">t</span><span class="main">=</span>tick"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> T <span class="free">P</span> <span class="main">∧</span> last <span class="skolem">a</span> <span class="main">=</span> tick"</span></span> <span class="keyword1"><span class="command">using</span></span> F_T <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> tick_T_F<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"butlast <span class="skolem">a</span>"</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span>tick<span class="main">}</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"2"</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> EmptyLeftSync bb self_append_conv2 snoc_eq_iff_butlast<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> 3 EmptyLeftSync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_processT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> TickLeftSync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> D_imp_front_tickFree Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 4 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_processT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> EmptyLeftSync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_processT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> TickLeftSync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> D_imp_front_tickFree Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_processT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">a</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> emptyLeftSelf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span>"</span></span><span class="main">]</span> Sync.sym tickFree_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>tick<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> tickFree <span class="skolem">a</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> F <span class="free">P</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ees</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> event list <span class="main">⇒</span> <span class="tfree">'a</span> event list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="skolem">ees</span> <span class="skolem">a</span> <span class="main">@</span> <span class="main">[</span>tick<span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> is_processT2 nonTickFree_n_frontTickFree<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ees</span> <span class="skolem">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="main">[]</span><span class="main">,</span> <span class="skolem">ees</span> <span class="skolem">a</span><span class="main">)</span><span class="main">,</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> DiffD2 Diff_insert_absorb emptyLeftSelf front_tickFree_implies_tickFree is_processT2 tickFree_def<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="main">[</span>tick<span class="main">]</span><span class="main">)</span><span class="main">,</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> f3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> Sync.sym addSyncEmpty insertI1<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">-</span> <span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> EmptyLeftSync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 8 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_processT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> TickLeftSync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> D_imp_front_tickFree Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 9 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> is_processT <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">t</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> EmptyLeftSync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">r</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 10 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">t</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> TickLeftSync<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="quoted"><span class="skolem">t</span></span> <span class="quoted"><span class="skolem">r</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bb<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">r</span><span class="main">=</span><span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> D_imp_front_tickFree Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 11 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"tickFree <span class="skolem">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> 12 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym emptyLeftSelf singletonD tickFree_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> 12 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"butlast <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"butlast <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[</span>tick<span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> D_imp_front_tickFree append_butlast_last_id front_tickFree_mono list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tickFree_Nil<span class="main">)</span>  
      <span class="keyword1"><span class="command">using</span></span> NT_ND T_nonTickFree_imp_decomp <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> NT_ND Sync.sym append_T_imp_tickFree append_butlast_last_id emptyLeftSelf 
                    list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> singletonD tickFree_Nil tickFree_def<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> D_imp_front_tickFree is_processT9 nonTickFree_n_frontTickFree <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Inter_stop_seq_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">|||</span> STOP<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">`;`</span> STOP<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec D_sync F_sync F_STOP D_STOP T_STOP F_seq D_seq<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"insert tick <span class="main">(</span><span class="main">(</span><span class="skolem">X</span> <span class="main">∪</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">∩</span> <span class="main">{</span>tick<span class="main">}</span> <span class="main">∪</span> <span class="skolem">X</span> <span class="main">∩</span> <span class="skolem">Y</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">X</span> <span class="main">∪</span> <span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> EmptyLeftSync Sync.sym is_processT is_processT5_S2 no_Trace_implies_no_Failure<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">t</span> <span class="skolem">X</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync Sync.sym tickFree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync Sync.sym tickFree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">b</span> <span class="skolem">t</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> EmptyLeftSync Sync.sym is_processT<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">t</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync Sync.sym tickFree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">b</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> insert_iff is_processT subsetI<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> emptyLeftSelf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span>"</span></span><span class="main">]</span> Sync.sym tickFree_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">-</span><span class="main">{</span>tick<span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">intro</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> NF_NT is_processT6<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> emptyLeftSelf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span>"</span></span><span class="main">]</span> Sync.sym tickFree_def 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> append_T_imp_tickFree list.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> singletonD<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">b</span> <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t1</span> <span class="keyword1">setinterleaves</span> <span class="main">(</span><span class="main">(</span><span class="skolem">t1</span><span class="main">,</span> <span class="main">[]</span><span class="main">)</span><span class="main">,</span> <span class="main">{</span>tick<span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> emptyLeftSelf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>tick<span class="main">}</span>"</span></span><span class="main">]</span> Sync.sym tickFree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> 9<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">THEN</span> spec<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">t1</span></span> <span class="quoted"><span class="skolem">t1</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"9"</span><span class="main">(</span>2<span class="main">)</span> <span class="quoted">"9"</span><span class="main">(</span>3<span class="main">)</span> <span class="quoted">"9"</span><span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync Sync.sym <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">t</span> <span class="skolem">r</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> EmptyLeftSync Sync.sym tickFree_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">t1</span> <span class="skolem">t2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">t2</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Sync.sym emptyLeftSelf singletonD tickFree_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> par_ndet_distrib2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span> <span class="main">||</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">||</span> <span class="free">M</span><span class="main">)</span> <span class="main">⊓</span> <span class="main">(</span><span class="free">Q</span> <span class="main">||</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> par_int_ndet_distrib<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> par_stop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">≠</span> <span class="main">⊥</span>  <span class="main">⟹</span> <span class="main">(</span><span class="free">P</span> <span class="main">||</span> STOP<span class="main">)</span> <span class="main">=</span> STOP"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>Process_eq_spec<span class="main"><span class="keyword3">,</span></span> 
      <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>D_sync F_sync F_STOP D_STOP T_STOP is_processT2 D_imp_front_tickFree F_UU D_UU<span class="main"><span class="keyword3">,</span></span>
      <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">aa</span> <span class="skolem">ba</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE conjE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span><span class="main">(</span>4<span class="main">)</span> EmptyLeftSync <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> NF_ND is_processT7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">with</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> NF_ND is_processT7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">aa</span> <span class="skolem">ba</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> is_processT <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">ba</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> iffI<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> event_set <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE conjE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">with</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> NF_ND is_processT7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">with</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> NF_ND is_processT7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE conjE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">X</span> <span class="skolem">Y</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span><span class="main">(</span>4<span class="main">)</span> EmptyLeftSync <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> NF_ND is_processT7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">with</span></span> 3<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> NF_ND is_processT7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> disjI1<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> is_processT <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> set_eqI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> iffI<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> event_set <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">x</span> <span class="skolem">xa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> exE conjE disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">with</span></span> 6<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> NF_ND is_processT7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">t</span> <span class="skolem">r</span> <span class="skolem">v</span><span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span> <span class="main">∈</span> D <span class="free">P</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">t</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">list</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>if_splits<span class="main"><span class="keyword3">,</span></span> <span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">with</span></span> 6<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> NF_ND is_processT7 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> par_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">||</span> <span class="free">Q</span><span class="main">)</span> <span class="main">||</span> <span class="free">S</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">||</span> <span class="main">(</span><span class="free">Q</span> <span class="main">||</span> <span class="free">S</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sync_assoc<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prefix_par<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> <span class="main">||</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="main">||</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prefix_par_Int2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> prefix_Inter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> <span class="main">|||</span> <span class="main">(</span><span class="free">b</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="main">|||</span> <span class="main">(</span><span class="free">b</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">□</span> <span class="main">(</span><span class="free">b</span> <span class="main">→</span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> <span class="main">|||</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> mprefix_Par_Int<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">b</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">Q</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
  <span class="keyword1"><span class="command">unfolding</span></span> write0_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>

  
<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Multiple Non Deterministic Operator Laws›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Mprefix_refines_Mndet<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊓</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Mprefix_STOP<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>le_ref_def D_Mprefix write0_def F_Mprefix F_mndet D_mndet<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> mndet_refine_FD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⊓</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">a</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>le_ref_def D_mndet F_mndet<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mndet_subset_FD<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> <span class="free">A</span> <span class="main">∪</span> <span class="free">B</span> <span class="main">→</span>  <span class="free">P</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> <span class="free">A</span> <span class="main">→</span>  <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_mndet F_mndet le_ref_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> mono_mndet_FD<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span> <span class="main">≤</span> <span class="free">P'</span> <span class="bound">x</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⊓</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⊓</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="main">(</span><span class="free">P'</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>le_ref_def D_mndet F_mndet<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">meson</span> contra_subsetD le_ref_def mono_write0_FD<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> mndet_FD_subset <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">⊓</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">B</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span>  <span class="main">≤</span> <span class="main">(</span><span class="main">⊓</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span>  mndet_distrib <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">-</span> <span class="free">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bot.extremum_uniqueI mndet_distrib mono_ndet_FD_right order_refl sup.absorb_iff1<span class="main">)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ Infra-structure for Communication Primitives ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> read_read_sync<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> contained<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">c</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">C</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">⟦</span> <span class="free">C</span> <span class="main">⟧</span><span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟦</span> <span class="free">C</span> <span class="main">⟧</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
<span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="free">c</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> contained<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> read_def o_def Set.Int_absorb2 mprefix_Par_distr A<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> read_read_nonsync<span class="main">:</span>
<span class="quoted"><span class="quoted">" <span class="main">⟦</span><span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">c</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">C</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">d</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">C</span><span class="main">⟧</span> <span class="main">⟹</span> 
    <span class="main">(</span><span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="main">(</span>d <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span><span class="main">(</span><span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span> <span class="main">(</span>d <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span><span class="main">(</span><span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> read_def o_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> mprefix_Par_Int_distr<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"range <span class="free">c</span>"</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="quoted">"range <span class="free">d</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="main">(</span>inv <span class="free">d</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span>inv <span class="free">c</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> sync_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> write_read_sync<span class="main">:</span>
<span class="keyword2"><span class="keyword">assumes</span></span> contained<span class="main">:</span>    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">c</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">C</span>"</span></span>
<span class="keyword2"><span class="keyword">assumes</span></span> is_construct<span class="main">:</span> <span class="quoted"><span class="quoted">"inj <span class="free">c</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>c <span class="main">`!`</span> <span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟦</span> <span class="free">C</span> <span class="main">⟧</span> <span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>c <span class="main">`!`</span> <span class="free">a</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span> <span class="main">⟦</span> <span class="free">C</span> <span class="main">⟧</span> <span class="main">(</span><span class="free">Q</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> A <span class="main">:</span> <span class="quoted"><span class="quoted">"range <span class="free">c</span> <span class="main">⊆</span> <span class="free">C</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> contained<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> B <span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">{</span><span class="free">c</span> <span class="free">a</span><span class="main">}</span> <span class="main">∩</span> range <span class="free">c</span> <span class="main">∩</span> <span class="free">C</span> <span class="main">=</span> <span class="main">{</span><span class="free">c</span> <span class="free">a</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">insert</span> contained<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> read_def write_def o_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> mprefix_Par_distr<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> A B contained is_construct mprefix_Par_distr Hilbert_Choice.inv_f_f mprefix_singl<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> write_read_nonsync<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">d</span> <span class="free">a</span> <span class="main">∉</span> <span class="free">C</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">c</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">C</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span>d <span class="main">`!`</span> <span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span><span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span><span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>d <span class="main">`!`</span> <span class="free">a</span> <span class="main">→</span> <span class="main">(</span><span class="free">P</span><span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span><span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> read_def o_def write_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> mprefix_Par_Int_distr<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">d</span> <span class="free">a</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="free">C</span></span> <span class="quoted"><span class="quoted">"range <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="main">(</span>inv <span class="free">c</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">P</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>1 2<span class="main"><span class="main">)</span></span> sync_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 
<span class="keyword1"><span class="command">lemma</span></span> write0_read_nonsync<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">d</span> <span class="main">∈</span> <span class="free">C</span><span class="main">;</span> <span class="main">⋀</span><span class="bound">y</span><span class="main">.</span> <span class="free">c</span> <span class="bound">y</span> <span class="main">∉</span> <span class="free">C</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span><span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span><span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>c <span class="main">`?`</span> <span class="bound">x</span> <span class="main">→</span> <span class="main">(</span><span class="main">(</span><span class="free">d</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span><span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span><span class="free">Q</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> read_def o_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mprefix_singl<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mprefix_singl<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mprefix_Par_Int_distr<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">lemma</span></span> write0_write_nonsync<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">d</span> <span class="free">a</span> <span class="main">∉</span> <span class="free">C</span><span class="main">;</span> <span class="free">c</span> <span class="main">∈</span> <span class="free">C</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span><span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span><span class="main">(</span>d <span class="main">`!`</span> <span class="free">a</span> <span class="main">→</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>d <span class="main">`!`</span> <span class="free">a</span> <span class="main">→</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span> <span class="main">→</span> <span class="free">Q</span><span class="main">)</span><span class="main">⟦</span><span class="free">C</span><span class="main">⟧</span><span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> write_def <span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mprefix_singl<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> mprefix_singl<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mprefix_Par_Int_distr<span class="main">)</span>


<span class="comment1">(* ************************************************************************* *)</span>
<span class="comment1">(* 	                                                    								     *)</span>
<span class="comment1">(* Setup for rewriting							                                         *)</span>
<span class="comment1">(* 									                                                         *)</span>
<span class="comment1">(* ************************************************************************* *)</span>

<span class="keyword1"><span class="command">lemmas</span></span> sync_rules <span class="main">=</span>  prefix_par_Int2 
                     read_read_sync read_read_nonsync 
                     write_read_sync write_read_nonsync 
                     write0_read_nonsync 
                     write0_write_nonsync

<span class="keyword1"><span class="command">lemmas</span></span> hide_rules <span class="main">=</span> no_hide_read no_hide_write hide_write hide_write0

<span class="keyword1"><span class="command">lemmas</span></span> mono_rules <span class="main">=</span> mono_read_ref mono_write_ref mono_write0_ref

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Assertions">
<div class="head">
<h1>Theory Assertions</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ******************************************************************** 
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">theory</span></span> Assertions
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="CSP.html">CSP</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹CSP Assertions›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">trace_refine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> process <span class="main">⇒</span> <span class="tfree">'a</span> process <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑<span class="hidden">⇩</span><sub>T</sub></span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">⊑<span class="hidden">⇩</span><sub>T</sub></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> T <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">⊆</span> T <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">failure_refine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> process <span class="main">⇒</span> <span class="tfree">'a</span> process <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑<span class="hidden">⇩</span><sub>F</sub></span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">⊑<span class="hidden">⇩</span><sub>F</sub></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> F <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">⊆</span> F <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">failure_divergence_refine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> process <span class="main">⇒</span> <span class="tfree">'a</span> process <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⊑<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>D</sub></span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1"><span class="free">⊑<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>D</sub></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Note that this just another syntax to our standard process refinement order 
     defined in the theory Process. ›</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">DF</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">DF</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="keyword1">μ</span> <span class="bound">X</span><span class="main">.</span> <span class="main">⊓</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">→</span> <span class="bound">X</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DF_unfold <span class="main">:</span> <span class="quoted"><span class="quoted">"DF <span class="free">A</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊓</span> <span class="bound">z</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">→</span> DF <span class="free">A</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DF_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">deadlock_free</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> process <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">deadlock_free</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> DF UNIV <span class="keyword1">⊑<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>D</sub></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">DF<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>I</sub><span class="hidden">⇩</span><sub>P</sub></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">DF<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>I</sub><span class="hidden">⇩</span><sub>P</sub></span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="keyword1">μ</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">⊓</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">→</span> <span class="bound">X</span><span class="main">)</span> <span class="main">⊓</span> SKIP<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">RUN</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">RUN</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="keyword1">μ</span> <span class="bound">X</span><span class="main">.</span> <span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">→</span> <span class="bound">X</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">CHAOS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set <span class="main">⇒</span> <span class="tfree">'a</span> process"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">CHAOS</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">≡</span> <span class="keyword1">μ</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span>STOP <span class="main">⊓</span> <span class="main">(</span><span class="main">□</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="main">→</span> <span class="bound">X</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lifelock_free</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> process <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>   <span class="quoted"><span class="quoted">"<span class="free">lifelock_free</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> CHAOS UNIV <span class="keyword1">⊑<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>D</sub></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Some deadlock freeness laws›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> DF_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> DF <span class="free">B</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>D</sub></span> DF <span class="free">A</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> DF_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> failure_divergence_refine_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_ind<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> le_adm<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>monofunI<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> DF_unfold<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mndet_FD_subset mono_mndet_FD order.trans<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> DF_Univ_freeness<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="main">(</span>DF <span class="free">A</span><span class="main">)</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>D</sub></span> <span class="free">P</span>  <span class="main">⟹</span> deadlock_free <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> deadlock_free_def DF_subset failure_divergence_refine_def order.trans subset_UNIV<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deadlock_free_ndet<span class="main">:</span> <span class="quoted"><span class="quoted">"deadlock_free <span class="free">P</span> <span class="main">⟹</span> deadlock_free <span class="free">Q</span> <span class="main">⟹</span> deadlock_free <span class="main">(</span><span class="free">P</span> <span class="main">⊓</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> D_ndet F_ndet deadlock_free_def failure_divergence_refine_def le_ref_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> deadlock_free_skip<span class="main">:</span><span class="quoted"><span class="quoted">"DF<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>I</sub><span class="hidden">⇩</span><sub>P</sub> UNIV  <span class="keyword1">⊑<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>D</sub></span> SKIP"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DF<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>I</sub><span class="hidden">⇩</span><sub>P</sub>_def failure_divergence_refine_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_ind<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Conclusion">
<div class="head">
<h1>Theory Conclusion</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ******************************************************************** 
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">chapter</span></span><span class="quoted"><span class="plain_text">‹Conclusion›</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="keyword1"><span class="command">theory</span></span> Conclusion
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Assertions.html">Assertions</a> 
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Related Work›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹As mentioned earlier, this work has its very ancient roots in a first formalization 
of A. Camilieri in the early 90s in HOL. This work was reformulated and substantially
extended in HOL-CSP 1.0 published in 1997. In 2005, Roggenbach and Isobe published 
CSP-Prover, a formal theory of a (fragment of) the Failures model of CSP. This work 
led to a couple of publications culminating in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "IsobeRoggenbach2010"<span class="antiquote"><span class="antiquote">}</span></span></span></span>; emphasis was put
on actually completing the CSP theory up to the point where it is sufficiently tactically
supported to serve as a kind of tool. This theory is still maintained and last releases (the 
latest one was released on 18 February 2019) can be
found under <span class="antiquoted"><span class="antiquoted"><span class="operator"><span class="operator">🌐</span></span>‹https://staff.aist.go.jp/y-isobe/CSP-Prover/CSP-Prover.html›</span></span>. This theory
represents the first half of Roscoes theory of a Failures/Divergence model, i.e. the Failures part.
More recently, Pasquale Noce 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Noninterference_CSP-AFP" <span class="quasi_keyword"><span class="quasi_keyword">and</span></span> "Noninterference_Sequential_Composition-AFP" <span class="quasi_keyword"><span class="quasi_keyword">and</span></span> 
"Noninterference_Concurrent_Composition-AFP"<span class="antiquote"><span class="antiquote">}</span></span></span></span>
developed a theory of non-interference notions based on an abstract denotational model fragment of 
the Failure/Divergence Model of CSP (without continuity and algebraic laws); this theory could 
probably be rebuilt on top of our work.

Fairly independently from this line of Isabelle-based CSP formalizations is Circus
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "Feliachi-Wolff-Gaudel-AFP12" <span class="quasi_keyword"><span class="quasi_keyword">and</span></span> "feliachigw12"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, another process algebra 
in the line of CSP and Z specification formalisms. Circus has in contrast to CSP a
direct notion of internal state of a process, which may be constrained by the state
invariants known from Z. This work gave rise to a number of publications in the
area of process-based test generation techniques <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "feliachi-wolff:SymbTestgenCirta:2013"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.

The present work could be another, more "classic" foundation of test-generation techniques
of this kind paving the way to an interaction with FDR and its possibility to generate
labelled transition systems as output that could drive specialized tactics in HOL-CSP 2.0.
›</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Lessons learned›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We have ported a first formalization in Isabelle/HOL on the Failure/Divergence model of CSP, 
done with Isabelle93-7 in 1997, to a modern Isabelle version. Particularly, 
we use the modern declarative proof style available in Isabelle/Isar instead of imperative proof 
one, the latter being  used in the old version. On the one hand, it is worth noting that some of 
the old  theories still have a surprisingly high value: Actually it took time to develop the right 
granularity of abstraction in lemmas, which is thus still quite helpful and valuable to reconstruct 
the theory in the new version. If a substantially large body of lemmas is available, the degree of 
automation tends to increase. On the other hand, redevelopment from scratch is unavoidable in parts 
where basic libraries change. For example, this was a necessary consequence of our decision to base
HOL-CSP 2.0 on HOLCF instead of continuing the development of an older fixed-point theory; nearly
all continuity proofs had to be redeveloped. Moreover, a fresh look on old proof-obligations 
may incite unexpected generalizations and some newly proved lemmas that cannot be constructed in 
the old version even with several attempts. The influence of the chosen strategy (from scratch
or refactoring) on the proof length is inconclusive.

Note that our data does not allow to make a prediction on the length of a porting project --- 
the effort was distributed over a too long period and performed by a team with initially very 
different knowledge about CSP and interactive theorem proving.
›</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹A Summary on New Results›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Compared to the original version of HOL-CSP 1.0, the present theory is complete relative to
Roscoe's Book<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">cite</span></span> "roscoe:csp:1998" <span class="antiquote"><span class="antiquote">}</span></span></span></span>. It contains a number of new theorems and some interesting
(and unexpected) generalizations: 
<span class="antiquoted"><span class="antiquoted">▸</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> mono_hiding<span class="antiquote"><span class="antiquote">}</span></span></span></span> is now also valid for the infinite case (arbitrary hide-set A).
<span class="antiquoted"><span class="antiquoted">▸</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">P</span></span> \<span class="main"><span class="main">\</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">A</span></span> <span class="main"><span class="main">∪</span></span> <span class="free"><span class="free">B</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">P</span></span> \<span class="main"><span class="main">\</span></span> <span class="free"><span class="free">A</span></span><span class="main"><span class="main">)</span></span> \<span class="main"><span class="main">\</span></span> <span class="free"><span class="free">B</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is true for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"finite <span class="free"><span class="free">A</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> (see <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> hide_un<span class="antiquote"><span class="antiquote">}</span></span></span></span>);
  this was not even proven in HOL-CSP 1.0 for the singleton case! It can be considered as the
  most complex theorem of this theory.
<span class="antiquoted"><span class="antiquoted">▸</span></span> distribution laws of hiding over synchronisation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> hide_sync<span class="antiquote"><span class="antiquote">}</span></span></span></span>; 
  however, this works only in the finite case. A true monster proof.
<span class="antiquoted"><span class="antiquoted">▸</span></span> the synchronization operator is associative <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "sync_assoc"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
  (In HOL-CSP 1.0, this had only be shown for special cases like <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "par_assoc"<span class="antiquote"><span class="antiquote">}</span></span></span></span>).
<span class="antiquoted"><span class="antiquoted">▸</span></span> the generalized non-deterministic choice operator --- relevant for proofs of deadlock-freeness ---
  has been added to the theory <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "mndet_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span>; it is proven monotone in the general case and
  continuous for the special case <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Mndet_cont<span class="antiquote"><span class="antiquote">}</span></span></span></span> relevant for the definition of the
  deadlock reference processes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> DF_def<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> "DF<span class="hidden">⇩</span><sub>S</sub><span class="hidden">⇩</span><sub>K</sub><span class="hidden">⇩</span><sub>I</sub><span class="hidden">⇩</span><sub>P</sub>_def"<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CopyBuffer">
<div class="head">
<h1>Theory CopyBuffer</h1>
</div>
<pre class="source"><span class="comment1">(*&lt;*)</span>
<span class="comment1">―‹ ********************************************************************
 * Project         : HOL-CSP - A Shallow Embedding of CSP in  Isabelle/HOL
 * Version         : 2.0
 *
 * Author          : Burkhart Wolff, Safouan Taha, Lina Ye.
 *                   (Based on HOL-CSP 1.0 by Haykal Tej and Burkhart Wolff)
 *
 * This file       : A Combined CSP Theory
 *
 * Copyright (c) 2009 Université Paris-Sud, France
 *
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are
 * met:
 *
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *
 *     * Redistributions in binary form must reproduce the above
 *       copyright notice, this list of conditions and the following
 *       disclaimer in the documentation and/or other materials provided
 *       with the distribution.
 *
 *     * Neither the name of the copyright holders nor the names of its
 *       contributors may be used to endorse or promote products derived
 *       from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
 * "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 ******************************************************************************›</span>
<span class="comment1">(*&gt;*)</span>

<span class="keyword1"><span class="command">chapter</span></span><span class="quoted"><span class="plain_text">‹ Annex: Refinement Example with Buffer over infinite Alphabet›</span></span>

<span class="keyword1"><span class="command">theory</span></span>     CopyBuffer
 <span class="keyword2"><span class="keyword">imports</span></span>    <span class="quoted">"<a href="Assertions.html">Assertions</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span> 

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ Defining the Copy-Buffer Example ›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'a</span> channel <span class="main">=</span> left <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">|</span> right <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">|</span> mid <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span> <span class="main">|</span> ack

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SYN</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> channel<span class="main">)</span> set"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">SYN</span>  <span class="main">≡</span> <span class="main">(</span>range mid<span class="main">)</span> <span class="main">∪</span> <span class="main">{</span>ack<span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">COPY</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> channel<span class="main">)</span> process"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">COPY</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">COPY</span><span class="main">.</span> left<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>right<span class="main">`!`</span><span class="bound">x</span> <span class="main">→</span> <span class="bound">COPY</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SEND</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> channel<span class="main">)</span> process"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">SEND</span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">SEND</span><span class="main">.</span> left<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>mid<span class="main">`!`</span><span class="bound">x</span> <span class="main">→</span><span class="main">(</span> ack <span class="main">→</span> <span class="bound">SEND</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">REC</span>  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> channel<span class="main">)</span> process"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">REC</span>  <span class="main">≡</span> <span class="main">(</span><span class="keyword1">μ</span> <span class="bound">REC</span><span class="main">.</span> mid<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>right<span class="main">`!`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>ack <span class="main">→</span> <span class="bound">REC</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SYSTEM</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> channel<span class="main">)</span> process"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">SYSTEM</span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>SEND <span class="main">⟦</span> SYN <span class="main">⟧</span> REC<span class="main">)</span> \<span class="main">\</span> SYN<span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ The Standard Proof ›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Channels and Synchronization Sets›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ First part: abstract properties for these events to SYN.
       This kind of stuff could be automated easily by some
       extra-syntax for channels and SYN-sets. ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"left <span class="free">x</span>  <span class="main">∉</span>  SYN"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SYN_def<span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"right <span class="free">x</span>  <span class="main">∉</span>  SYN"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SYN_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ack <span class="main">∈</span> SYN"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SYN_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"mid <span class="free">x</span> <span class="main">∈</span> SYN"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> SYN_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"inj mid"</span></span>  
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inj_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>SYN<span class="main">::</span> <span class="tfree">'a</span> channel set<span class="main">)</span> <span class="main">⟹</span> finite <span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> True<span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> SYN_def UNIV_def channel.inject<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> finite_Un finite_imageD inj_on_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Definitions by Recursors ›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ Second part: Derive recursive process equations, which
       are easier to handle in proofs. This part IS actually
       automated if we could reuse the fixrec-syntax below. ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> COPY_rec<span class="main">:</span>
  <span class="quoted"><span class="quoted">"COPY <span class="main">=</span> <span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>right<span class="main">`!`</span><span class="bound">x</span> <span class="main">→</span> COPY<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> COPY_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> SEND_rec<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"SEND <span class="main">=</span> <span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>mid<span class="main">`!`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>ack <span class="main">→</span> SEND<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SEND_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> REC_rec<span class="main">:</span>
  <span class="quoted"><span class="quoted">"REC <span class="main">=</span> <span class="main">(</span>mid<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>right<span class="main">`!`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>ack <span class="main">→</span> REC<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> REC_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> trans<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> fix_eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ A Refinement Proof ›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ Third part: No comes the proof by fixpoint induction. 
       Not too bad in automation considering what is inferred,
       but wouldn't scale for large examples. ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> impl_refines_spec <span class="main">:</span> <span class="quoted"><span class="quoted">"COPY <span class="main">⊑</span> SYSTEM"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SYSTEM_def COPY_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> fix_ind<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> SEND_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> REC_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sync_rules hide_rules mono_rules<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> spec_refines_impl <span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>SYN<span class="main">::</span> <span class="tfree">'a</span> channel set<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>        <span class="quoted"><span class="quoted">"SYSTEM <span class="main">⊑</span> <span class="main">(</span>COPY <span class="main">::</span> <span class="tfree">'a</span> channel process<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SYSTEM_def SEND_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> fix_ind<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> adm_below hiding_cont<span class="main">[</span><span class="operator">of</span> <span class="quoted">SYN</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span> <span class="tfree">'a</span> channel process<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span> <span class="main">⟦</span>SYN<span class="main">⟧</span> REC<span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> fin<span class="main">]</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contI cont_left_sync chain_Sync1 thelubE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hide_set_bot par_Int_bot sync_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> COPY_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> REC_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sync_rules hide_rules mono_rules<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ Note that this was actually proven for the
       Process ordering, not the refinement ordering. 
       But the former implies the latter.
       And due to anti-symmetry, equality follows
       for the case of finite alphabets \ldots ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> spec_equal_impl <span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span>  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>SYN<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> channel<span class="main">)</span>set<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>         <span class="quoted"><span class="quoted">"SYSTEM <span class="main">=</span> <span class="main">(</span>COPY<span class="main">::</span><span class="tfree">'a</span> channel process<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> below_antisym fin impl_refines_spec spec_refines_impl<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Deadlock Freeness Proof ›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹HOL-CSP can be used to prove deadlock-freeness of processes with infinite alphabet. In the
case of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">COPY</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> - process, this can be formulated as the following refinement problem:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>DF <span class="main">(</span>range left <span class="main">∪</span> range right<span class="main">)</span><span class="main">)</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>F</sub><span class="hidden">⇩</span><sub>D</sub></span> COPY"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>DF_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> fix_ind2<span class="main"><span class="keyword3">,</span></span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> failure_divergence_refine_def 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"adm <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">≤</span> COPY<span class="main">)</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> le_adm<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>monofunI<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊥</span> <span class="main">≤</span> COPY"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range left <span class="main">∪</span> range right <span class="main">→</span> <span class="main">⊥</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range left <span class="main">→</span>  <span class="main">⊥</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mndet_subset_FD <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I empty_iff imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range left <span class="main">→</span>  <span class="main">⊥</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span>  <span class="main">⊥</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> read_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Mprefix_refines_Mndet comp_apply dual_order.antisym mono_mprefix_FD order_refl<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span>range left <span class="main">∪</span> range right <span class="main">→</span>  <span class="main">⊥</span><span class="main">)</span> <span class="main">≤</span> COPY"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span>  1 2 COPY_rec bot_less1 mono_read_FD order.trans<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">P</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> channel process"</span></span>
  <span class="keyword3"><span class="command">assume</span></span>  *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">≤</span> COPY"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ** <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span>range left <span class="main">∪</span> range right <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span> <span class="main">≤</span> COPY"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range left <span class="main">∪</span> range right <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range right <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mndet_subset_FD <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I Un_commute empty_iff imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range right <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>right<span class="main">`!`</span><span class="skolem">x</span> <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> mndet_subset_FD<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>right <span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"range right"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>write_def write0_def mndet_unit<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword1"><span class="command">have</span></span> ab<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range left <span class="main">∪</span> range right <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>right<span class="main">`!`</span><span class="skolem">x</span> <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> 3<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range left <span class="main">∪</span> range right <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span><span class="main">(</span>right<span class="main">`!`</span><span class="bound">x</span> <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_read_FD<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range left <span class="main">∪</span> range right <span class="main">→</span> <span class="bound">X</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range left <span class="main">→</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> mndet_subset_FD <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I empty_iff imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range left <span class="main">→</span> <span class="bound">X</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> read_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Mprefix_refines_Mndet comp_apply dual_order.antisym mono_mprefix_FD order_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 3 4<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range left <span class="main">∪</span> range right <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span>"</span></span><span class="main">]</span> 
         5  <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range left <span class="main">∪</span> range right <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span>"</span></span><span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range left <span class="main">∪</span> range right <span class="main">→</span> 
                    <span class="main">(</span><span class="main">⊓</span><span class="bound">xa</span><span class="main">∈</span> range left <span class="main">∪</span> range right <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>right<span class="main">`!`</span><span class="bound">x</span> <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> * ** <span class="keyword1"><span class="command">have</span></span> 7<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>right<span class="main">`!`</span><span class="bound">x</span> <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>right<span class="main">`!`</span><span class="bound">x</span> <span class="main">→</span>  COPY<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mono_read_FD mono_write_FD<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span>range left <span class="main">∪</span> range right <span class="main">→</span>  <span class="main">⊓</span><span class="bound">x</span><span class="main">∈</span>range left <span class="main">∪</span> range right <span class="main">→</span>  <span class="skolem">P</span><span class="main">)</span> <span class="main">≤</span> COPY"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> 6 7  COPY_rec dual_order.trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹ An Alternative Approach: Using the fixrec-Package ›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Channels and Synchronisation Sets ›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ As before. ›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Process Definitions via fixrec-Package  ›</span></span>

<span class="keyword1"><span class="command">fixrec</span></span>
  <span class="entity">COPY'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> channel<span class="main">)</span> process"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
  <span class="entity">SEND'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> channel<span class="main">)</span> process"</span></span>
<span class="keyword2"><span class="keyword">and</span></span>
  <span class="entity">REC'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> channel<span class="main">)</span> process"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>
   COPY'_rec<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">COPY'</span> <span class="main">=</span> <span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>right<span class="main">`!`</span><span class="bound">x</span> <span class="main">→</span> <span class="free">COPY'</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span>  SEND'_rec<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span><span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">SEND'</span> <span class="main">=</span> <span class="main">(</span>left<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>mid<span class="main">`!`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>ack <span class="main">→</span> <span class="free">SEND'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="main">|</span>  REC'_rec<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">del</span></span></span><span class="main">]</span> <span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">REC'</span>  <span class="main">=</span> <span class="main">(</span>mid<span class="main">`?`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>right<span class="main">`!`</span><span class="bound">x</span> <span class="main">→</span> <span class="main">(</span>ack <span class="main">→</span> <span class="free">REC'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SYSTEM'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> channel<span class="main">)</span> process"</span></span>
<span class="keyword2"><span class="keyword">where</span></span>     <span class="quoted"><span class="quoted">"<span class="free">SYSTEM'</span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span>SEND' <span class="main">⟦</span> SYN <span class="main">⟧</span> REC'<span class="main">)</span> \<span class="main">\</span> SYN<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹ Another Refinement Proof on fixrec-infrastructure ›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹ Third part: No comes the proof by fixpoint induction. 
       Not too bad in automation considering what is inferred,
       but wouldn't scale for large examples. ›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> impl_refines_spec' <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>COPY'<span class="main">::</span><span class="tfree">'a</span> channel process<span class="main">)</span> <span class="main">⊑</span> SYSTEM'"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> SYSTEM'_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">a</span> <span class="main">⊑</span> <span class="main">(</span>SEND' <span class="main">⟦</span>SYN<span class="main">⟧</span> REC'<span class="main">)</span> \<span class="main">\</span> SYN"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> COPY'_SEND'_REC'.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> SEND'_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> REC'_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sync_rules hide_rules mono_rules<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> spec_refines_impl' <span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span>  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>SYN<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> channel<span class="main">)</span>set<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>         <span class="quoted"><span class="quoted">"SYSTEM' <span class="main">⊑</span> <span class="main">(</span>COPY'<span class="main">::</span><span class="tfree">'a</span> channel process<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> SYSTEM'_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">b</span> <span class="main">⟦</span>SYN<span class="main">⟧</span> REC'<span class="main">)</span> \<span class="main">\</span> SYN<span class="main">)</span> <span class="main">⊑</span> COPY'"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> COPY'_SEND'_REC'.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword1"><span class="command">have</span></span> aa<span class="main">:</span><span class="quoted"><span class="quoted">"adm <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span> channel process<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="bound">a</span> <span class="main">⟦</span>SYN<span class="main">⟧</span> REC'<span class="main">)</span> \<span class="main">\</span> SYN<span class="main">)</span> <span class="main">⊑</span> COPY'<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> contI cont_left_sync chain_Sync1 thelubE fin<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> adm_subst<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> <span class="bound">b</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> aa<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>split_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hide_set_bot par_Int_bot sync_commute<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">a</span> <span class="skolem">aa</span> <span class="skolem">b</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> COPY'_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> REC'_rec<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sync_rules hide_rules mono_rules<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> spec_equal_impl' <span class="main">:</span> 
<span class="keyword2"><span class="keyword">assumes</span></span> fin<span class="main">:</span>  <span class="quoted"><span class="quoted">"finite <span class="main">(</span>SYN<span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> channel<span class="main">)</span>set<span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>         <span class="quoted"><span class="quoted">"SYSTEM' <span class="main">=</span> <span class="main">(</span>COPY'<span class="main">::</span><span class="tfree">'a</span> channel process<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Porder.po_class.below_antisym<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> spec_refines_impl'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> fin<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impl_refines_spec'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>