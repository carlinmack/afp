<div id="Separata">
<div class="head">
<h1>Theory Separata</h1>
</div>
<pre class="source"><span class="comment1">(*
 * Copyright 2016, NTU
 *
 * This software may be distributed and modified according to the terms of
 * the BSD 2-Clause license. Note that NO WARRANTY is provided.
 * See "LICENSE_BSD2.txt" for details.
 *
 * Author: Zhe Hou, David Sanan.
 *)</span>

<span class="keyword1"><span class="command">theory</span></span> Separata
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <a href="../Separation_Algebra/Separation_Algebra.html">Separation_Algebra.Separation_Algebra</a> <span class="quoted">"<a href="../../HOL/HOL-Eisbach/Eisbach_Tools.html">HOL-Eisbach.Eisbach_Tools</a>"</span>
 <span class="quoted">"<a href="../../HOL/HOL-Library/Multiset.html">HOL-Library.Multiset</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The tactics in this file are a simple proof search procedure based on
  the labelled sequent calculus LS\_PASL for Propositional Abstract Separation Logic 
  in Zhe's PhD thesis.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define a class which is an extension to cancellative\_sep\_algebra 
  with other useful properties in separation algebra, including:
  indivisible unit, disjointness, and cross-split. 
  We also add a property about the (reverse) distributivity of the disjointness.›</span></span>

<span class="keyword1"><span class="command">class</span></span> heap_sep_algebra <span class="main">=</span> cancellative_sep_algebra <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sep_add_ind_unit<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span><span class="main">;</span> <span class="free">x</span> <span class="main">##</span> <span class="free">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> sep_add_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">##</span><span class="free">x</span> <span class="main">⟹</span><span class="free">x</span><span class="main">=</span> <span class="main">0</span> "</span></span>   
  <span class="keyword2"><span class="keyword">assumes</span></span> sep_add_cross_split<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span> <span class="main">=</span> <span class="free">w</span><span class="main">;</span> <span class="free">c</span> <span class="main">+</span> <span class="free">d</span> <span class="main">=</span> <span class="free">w</span><span class="main">;</span> <span class="free">a</span> <span class="main">##</span> <span class="free">b</span><span class="main">;</span> <span class="free">c</span> <span class="main">##</span> <span class="free">d</span><span class="main">⟧</span> <span class="main">⟹</span>
    <span class="main">∃</span> <span class="bound">e</span> <span class="bound">f</span> <span class="bound">g</span> <span class="bound">h</span><span class="main">.</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">f</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">+</span> <span class="bound">h</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">g</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">+</span> <span class="bound">h</span> <span class="main">=</span> <span class="free">d</span> <span class="main">∧</span> 
    <span class="bound">e</span> <span class="main">##</span> <span class="bound">f</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">##</span> <span class="bound">h</span> <span class="main">∧</span> <span class="bound">e</span> <span class="main">##</span> <span class="bound">g</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">##</span> <span class="bound">h</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> disj_dstri<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">x</span> <span class="main">##</span> <span class="free">y</span><span class="main">;</span> <span class="free">y</span> <span class="main">##</span> <span class="free">z</span><span class="main">;</span> <span class="free">x</span> <span class="main">##</span> <span class="free">z</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">##</span> <span class="main">(</span><span class="free">y</span> <span class="main">+</span> <span class="free">z</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Lemmas about the labelled sequent calculus.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹An abbreviation of the + and \#\# operators in Separation\_Algebra.thy. 
  This notion is closer to the ternary relational atoms used in the literature. 
  This will be the main data structure which our labelled sequent calculus works on.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tern_rel</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword1">,</span>_<span class="keyword1">▹</span>_<span class="keyword3">)</span>"</span> 25<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tern_rel</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">##</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> exist_comb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">##</span> <span class="free">y</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">▹</span><span class="bound">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> disj_comb<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">▹</span><span class="free">z</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">##</span> <span class="free">w</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">##</span> <span class="free">w</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">##</span> <span class="free">w</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">##</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a2 a3
    <span class="keyword1"><span class="command">using</span></span> local.disj_dstri local.sep_disj_commuteI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following lemmas corresponds to inference rules in LS\_PASL. 
  Thus these lemmas prove the soundness of LS\_PASL. 
  We also show the invertibility of those rules.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> -<span class="main">)</span> lspasl_id<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> -<span class="main">)</span> lspasl_botl<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span>sep_false <span class="free">h</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> -<span class="main">)</span> lspasl_topr<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">gamma</span> <span class="main">⟹</span> <span class="main">(</span>sep_true <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_empl<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span> 
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span>sep_empty <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.sep_empty_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_empl_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span>sep_empty <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>  
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following two lemmas are the same as applying 
  simp add: sep\_empty\_def.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_empl_der<span class="main">:</span> <span class="quoted"><span class="quoted">"sep_empty <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.sep_empty_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_empl_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sep_empty <span class="free">h</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">h</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.sep_empty_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_empr<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span>sep_empty <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_notl<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span> <span class="main">⟹</span> 
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="free">A</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_notl_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="free">A</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_notr<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span> 
  <span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="free">A</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_notr_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="free">A</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_andl<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span> 
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">and</span> <span class="free">B</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_andl_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">and</span> <span class="free">B</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span> 
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_andr<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span><span class="main">;</span> <span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">B</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">and</span> <span class="free">B</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_andr_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">and</span> <span class="free">B</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">B</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_orl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span><span class="main">;</span> <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">or</span> <span class="free">B</span><span class="main">)</span> <span class="free">h</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_orl_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">or</span> <span class="free">B</span><span class="main">)</span> <span class="free">h</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_orr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">B</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">or</span> <span class="free">B</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_orr_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">or</span> <span class="free">B</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="free">B</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_impl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span><span class="main">;</span> <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">imp</span> <span class="free">B</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_impl_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">imp</span> <span class="free">B</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span><span class="main">)</span>"</span></span>    
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_impr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">B</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">imp</span> <span class="free">B</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_impr_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">imp</span> <span class="free">B</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">B</span> <span class="free">h</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">context</span></span> heap_sep_algebra
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We don't provide lemmas for derivations for the classical connectives,
  as Isabelle proof methods can easily deal with them.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_starl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">h1</span> <span class="bound">h2</span><span class="main">.</span> <span class="main">(</span><span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h1</span><span class="main">,</span><span class="bound">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="bound">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="bound">h2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_starl_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">h1</span> <span class="bound">h2</span><span class="main">.</span> <span class="main">(</span><span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h1</span><span class="main">,</span><span class="bound">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="bound">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="bound">h2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.sep_conjI <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_starl_der<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">h1</span> <span class="bound">h2</span><span class="main">.</span> <span class="main">(</span><span class="bound">h1</span><span class="main">,</span><span class="bound">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="bound">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="bound">h2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lspasl_starl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_starl_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">h1</span> <span class="bound">h2</span><span class="main">.</span> <span class="main">(</span><span class="bound">h1</span><span class="main">,</span><span class="bound">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="bound">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="bound">h2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lspasl_starl lspasl_starl_inv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_starr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">A</span> <span class="free">h1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span><span class="main">;</span> 
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">B</span> <span class="free">h2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.sep_conjI <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_starr_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">A</span> <span class="free">h1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span><span class="main">)</span> <span class="main">∧</span> 
  <span class="main">(</span><span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">B</span> <span class="free">h2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For efficiency we only apply *R on a pair of a ternary relational atom
  and a formula ONCE. To achieve this, we create a special predicate to indicate that
  a pair of a ternary relational atom and a formula has already been used in
  a *R application. 
  Note that the predicate is true even if the *R rule hasn't been applied. 
  We will not infer the truth of this predicate in proof search, but only
  check its syntactical appearance, which is only generated by the lemma lspasl\_starr\_der. 
  We need to ensure that this predicate is not generated elsewhere
  in the proof search.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">starr_applied</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">starr_applied</span> <span class="free"><span class="bound"><span class="entity">h1</span></span></span> <span class="free"><span class="bound"><span class="entity">h2</span></span></span> <span class="free"><span class="bound"><span class="entity">h0</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">h1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">h2</span></span></span><span class="main">▹</span><span class="free"><span class="bound"><span class="entity">h0</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">h0</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> lspasl_starr_der<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="free">h1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>starr_applied <span class="free">h1</span> <span class="free">h2</span> <span class="free">h0</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
  <span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">B</span> <span class="free">h2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>starr_applied <span class="free">h1</span> <span class="free">h2</span> <span class="free">h0</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lspasl_starl_eq starr_applied_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> lspasl_starr_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="free">h1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">B</span> <span class="free">h2</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="free">h0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_starr_der <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_magicl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">A</span> <span class="free">h1</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span><span class="main">;</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span><span class="main">⟧</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.sep_add_commute local.sep_disj_commuteI local.sep_implD tern_rel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_magicl_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">A</span> <span class="free">h1</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span><span class="main">)</span> <span class="main">∧</span> 
  <span class="main">(</span><span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For efficiency we only apply -*L on a pair of a ternary relational atom
  and a formula ONCE. To achieve this, we create a special predicate to indicate that
  a pair of a ternary relational atom and a formula has already been used in
  a *R application. 
  Note that the predicate is true even if the *R rule hasn't been applied. 
  We will not infer the truth of this predicate in proof search, but only
  check its syntactical appearance, which is only generated by the lemma lspasl\_magicl\_der.
  We need to ensure that in the proof search of Separata, this predicate is 
  not generated elsewhere.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">magicl_applied</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">magicl_applied</span> <span class="free"><span class="bound"><span class="entity">h1</span></span></span> <span class="free"><span class="bound"><span class="entity">h2</span></span></span> <span class="free"><span class="bound"><span class="entity">h0</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">h1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">h2</span></span></span><span class="main">▹</span><span class="free"><span class="bound"><span class="entity">h0</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">h2</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> lspasl_magicl_der<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="free">A</span> <span class="free">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>magicl_applied <span class="free">h1</span> <span class="free">h2</span> <span class="free">h0</span> <span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
  <span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>magicl_applied <span class="free">h1</span> <span class="free">h2</span> <span class="free">h0</span> <span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lspasl_magicl magicl_applied_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_magicl_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="main">(</span><span class="free">A</span> <span class="free">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">B</span> <span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_magicl_der <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_magicr<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">h1</span> <span class="bound">h0</span><span class="main">.</span> <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="bound">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="bound">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="free">B</span><span class="main">)</span> <span class="bound">h0</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.sep_add_commute local.sep_disj_commute local.sep_impl_def tern_rel_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_magicr_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">h1</span> <span class="bound">h0</span><span class="main">.</span> <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="bound">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="bound">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="free">B</span><span class="main">)</span> <span class="bound">h0</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lspasl_magicl<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_magicr_der<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="main">∃</span><span class="bound">h1</span> <span class="bound">h0</span><span class="main">.</span> <span class="main">(</span><span class="bound">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="bound">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="bound">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="free">B</span><span class="main">)</span> <span class="bound">h0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lspasl_magicr<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_magicr_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="free">h2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">h1</span> <span class="bound">h0</span><span class="main">.</span> <span class="main">(</span><span class="bound">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="bound">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">A</span> <span class="bound">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="free">B</span><span class="main">)</span> <span class="bound">h0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lspasl_magicl lspasl_magicr<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">=</span> <span class="free">h2</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_eq_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">=</span> <span class="free">h2</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_eq_der<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">=</span> <span class="free">h2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_eq_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span> <span class="main">=</span> <span class="free">h2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_u<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_u_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="free">h</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_u_der<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_u <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_e<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h2</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.sep_add_commute local.sep_disj_commute tern_rel_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_e_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h2</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_e_der<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h2</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_e <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>           

<span class="keyword1"><span class="command">lemma</span></span> lspasl_e_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h2</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_e <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_a_der<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">h5</span><span class="main">.</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="bound">h5</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h2</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="bound">h5</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">##</span> <span class="free">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>    
  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h3</span> <span class="main">##</span> <span class="free">h4</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>    
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h3</span> <span class="main">+</span> <span class="free">h4</span> <span class="main">=</span> <span class="free">h1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>    
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h3</span> <span class="main">##</span> <span class="free">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.sep_disj_addD1 local.sep_disj_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="main">##</span> <span class="free">h3</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.sep_disj_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">h2</span> <span class="main">+</span> <span class="free">h4</span> <span class="main">##</span> <span class="free">h3</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f3 f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> local.sep_add_commute local.sep_add_disjI1<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h4</span> <span class="main">##</span> <span class="free">h2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f3 f2 f1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.sep_add_commute local.sep_disj_addD1 local.sep_disj_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> f5 f4 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> assms tern_rel_def local.sep_add_assoc local.sep_add_commute local.sep_disj_commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_a<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">h5</span><span class="main">.</span> <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="bound">h5</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h2</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="bound">h5</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_a_der <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_a_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">h5</span><span class="main">.</span> <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="bound">h5</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h2</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="bound">h5</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_a_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">∃</span><span class="bound">h5</span><span class="main">.</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="bound">h5</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h2</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="bound">h5</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_a_der <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_p<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h0</span> <span class="main">=</span> <span class="free">h3</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h3</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_p_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h3</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h0</span> <span class="main">=</span> <span class="free">h3</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_p_der<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h3</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h0</span> <span class="main">=</span> <span class="free">h3</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_p_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h3</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h0</span> <span class="main">=</span> <span class="free">h3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_p_der <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_c<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h2</span> <span class="main">=</span> <span class="free">h3</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h3</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> local.sep_add_cancelD local.sep_add_commute tern_rel_def
      local.sep_disj_commuteI<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_c_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h3</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h2</span> <span class="main">=</span> <span class="free">h3</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_c_der<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h3</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h2</span> <span class="main">=</span> <span class="free">h3</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_c <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_c_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h3</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h2</span> <span class="main">=</span> <span class="free">h3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_c_der <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_iu<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.sep_add_ind_unit tern_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_iu_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_iu_der<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">h2</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_eq_der lspasl_iu <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span> 

<span class="keyword1"><span class="command">lemma</span></span> lspasl_iu_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">h2</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_iu_der <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1"><span class="command">lemma</span></span> lspasl_d<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> local.sep_add_disj tern_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_d_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_d_der<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">h2</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_d lspasl_eq_der <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_d_eq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">h2</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_d_der <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_cs_der<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">h5</span> <span class="bound">h6</span> <span class="bound">h7</span> <span class="bound">h8</span><span class="main">.</span> <span class="main">(</span><span class="bound">h5</span><span class="main">,</span><span class="bound">h6</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h7</span><span class="main">,</span><span class="bound">h8</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span><span class="bound">h5</span><span class="main">,</span><span class="bound">h7</span><span class="main">▹</span><span class="free">h3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h6</span><span class="main">,</span><span class="bound">h8</span><span class="main">▹</span><span class="free">h4</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> a1 a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">h1</span> <span class="main">+</span> <span class="free">h2</span> <span class="main">=</span> <span class="free">h0</span> <span class="main">∧</span> <span class="free">h3</span> <span class="main">+</span> <span class="free">h4</span> <span class="main">=</span> <span class="free">h0</span> <span class="main">∧</span> <span class="free">h1</span> <span class="main">##</span> <span class="free">h2</span> <span class="main">∧</span> <span class="free">h3</span> <span class="main">##</span> <span class="free">h4</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h5</span> <span class="bound">h6</span> <span class="bound">h7</span> <span class="bound">h8</span><span class="main">.</span> <span class="bound">h5</span> <span class="main">+</span> <span class="bound">h6</span> <span class="main">=</span> <span class="free">h1</span> <span class="main">∧</span> <span class="bound">h7</span> <span class="main">+</span> <span class="bound">h8</span> <span class="main">=</span> <span class="free">h2</span> <span class="main">∧</span>
    <span class="bound">h5</span> <span class="main">+</span> <span class="bound">h7</span> <span class="main">=</span> <span class="free">h3</span> <span class="main">∧</span> <span class="bound">h6</span> <span class="main">+</span> <span class="bound">h8</span> <span class="main">=</span> <span class="free">h4</span> <span class="main">∧</span> <span class="bound">h5</span> <span class="main">##</span> <span class="bound">h6</span> <span class="main">∧</span> <span class="bound">h7</span> <span class="main">##</span> <span class="bound">h8</span> <span class="main">∧</span>
    <span class="bound">h5</span> <span class="main">##</span> <span class="bound">h7</span> <span class="main">∧</span> <span class="bound">h6</span> <span class="main">##</span> <span class="bound">h8</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> local.sep_add_cross_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h5</span> <span class="bound">h6</span> <span class="bound">h7</span> <span class="bound">h8</span><span class="main">.</span> <span class="main">(</span><span class="bound">h5</span><span class="main">,</span><span class="bound">h6</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">h7</span> <span class="main">+</span> <span class="bound">h8</span> <span class="main">=</span> <span class="free">h2</span> <span class="main">∧</span>
    <span class="bound">h5</span> <span class="main">+</span> <span class="bound">h7</span> <span class="main">=</span> <span class="free">h3</span> <span class="main">∧</span> <span class="bound">h6</span> <span class="main">+</span> <span class="bound">h8</span> <span class="main">=</span> <span class="free">h4</span> <span class="main">∧</span> <span class="bound">h7</span> <span class="main">##</span> <span class="bound">h8</span> <span class="main">∧</span>
    <span class="bound">h5</span> <span class="main">##</span> <span class="bound">h7</span> <span class="main">∧</span> <span class="bound">h6</span> <span class="main">##</span> <span class="bound">h8</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h5</span> <span class="bound">h6</span> <span class="bound">h7</span> <span class="bound">h8</span><span class="main">.</span> <span class="main">(</span><span class="bound">h5</span><span class="main">,</span><span class="bound">h6</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h7</span><span class="main">,</span><span class="bound">h8</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">∧</span>
    <span class="bound">h5</span> <span class="main">+</span> <span class="bound">h7</span> <span class="main">=</span> <span class="free">h3</span> <span class="main">∧</span> <span class="bound">h6</span> <span class="main">+</span> <span class="bound">h8</span> <span class="main">=</span> <span class="free">h4</span> <span class="main">∧</span> <span class="bound">h5</span> <span class="main">##</span> <span class="bound">h7</span> <span class="main">∧</span> <span class="bound">h6</span> <span class="main">##</span> <span class="bound">h8</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">h5</span> <span class="bound">h6</span> <span class="bound">h7</span> <span class="bound">h8</span><span class="main">.</span> <span class="main">(</span><span class="bound">h5</span><span class="main">,</span><span class="bound">h6</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h7</span><span class="main">,</span><span class="bound">h8</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">∧</span>
    <span class="main">(</span><span class="bound">h5</span><span class="main">,</span><span class="bound">h7</span><span class="main">▹</span><span class="free">h3</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">h6</span> <span class="main">+</span> <span class="bound">h8</span> <span class="main">=</span> <span class="free">h4</span> <span class="main">∧</span> <span class="bound">h6</span> <span class="main">##</span> <span class="bound">h8</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tern_rel_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a1 a2 tern_rel_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_cs<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">h5</span> <span class="bound">h6</span> <span class="bound">h7</span> <span class="bound">h8</span><span class="main">.</span> <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h5</span><span class="main">,</span><span class="bound">h6</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h7</span><span class="main">,</span><span class="bound">h8</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span><span class="bound">h5</span><span class="main">,</span><span class="bound">h7</span><span class="main">▹</span><span class="free">h3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h6</span><span class="main">,</span><span class="bound">h8</span><span class="main">▹</span><span class="free">h4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_cs_der <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_cs_inv<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span> <span class="main">⟹</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">h5</span> <span class="bound">h6</span> <span class="bound">h7</span> <span class="bound">h8</span><span class="main">.</span> <span class="free">Gamma</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h5</span><span class="main">,</span><span class="bound">h6</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h7</span><span class="main">,</span><span class="bound">h8</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span><span class="bound">h5</span><span class="main">,</span><span class="bound">h7</span><span class="main">▹</span><span class="free">h3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h6</span><span class="main">,</span><span class="bound">h8</span><span class="main">▹</span><span class="free">h4</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">Delta</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> lspasl_cs_eq<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">∃</span><span class="bound">h5</span> <span class="bound">h6</span> <span class="bound">h7</span> <span class="bound">h8</span><span class="main">.</span> <span class="main">(</span><span class="bound">h5</span><span class="main">,</span><span class="bound">h6</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h7</span><span class="main">,</span><span class="bound">h8</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span><span class="bound">h5</span><span class="main">,</span><span class="bound">h7</span><span class="main">▹</span><span class="free">h3</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">h6</span><span class="main">,</span><span class="bound">h8</span><span class="main">▹</span><span class="free">h4</span><span class="main">)</span> <span class="main">∧</span> 
  <span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_cs_der <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The above proves the soundness and invertibility of LS\_PASL.›</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Lemmas David proved for separation algebra.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> sep_substate_tran<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≼</span> <span class="free">y</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">≼</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≼</span> <span class="free">z</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> sep_substate_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="free">x</span> <span class="main">##</span> <span class="bound">z</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">+</span> <span class="bound">z</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">za</span><span class="main">.</span> <span class="free">y</span> <span class="main">##</span> <span class="bound">za</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">+</span> <span class="bound">za</span> <span class="main">=</span> <span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="skolem"><span class="skolem">y'</span></span> <span class="keyword2"><span class="keyword">where</span></span>  fixed<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">##</span> <span class="skolem">x'</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">+</span> <span class="skolem">x'</span> <span class="main">=</span> <span class="free">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">y</span> <span class="main">##</span> <span class="skolem">y'</span> <span class="main">∧</span> <span class="free">y</span> <span class="main">+</span> <span class="skolem">y'</span> <span class="main">=</span> <span class="free">z</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> disj_x<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">##</span> <span class="skolem">y'</span> <span class="main">∧</span> <span class="skolem">x'</span> <span class="main">##</span> <span class="skolem">y'</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> sep_disj_addD sep_disj_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">##</span> <span class="main">(</span><span class="skolem">x'</span> <span class="main">+</span> <span class="skolem">y'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fixed sep_disj_commute sep_disj_addI3 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">x'</span> <span class="main">+</span> <span class="skolem">y'</span><span class="main">)</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> disj_x <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> fixed sep_add_assoc<span class="main">)</span> 
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">za</span><span class="main">.</span> <span class="free">x</span> <span class="main">##</span> <span class="bound">za</span> <span class="main">∧</span> <span class="free">x</span> <span class="main">+</span> <span class="bound">za</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> precise_sep_conj<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"precise <span class="free">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    a2<span class="main">:</span><span class="quoted"><span class="quoted">"precise <span class="free">I'</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"precise <span class="main">(</span><span class="free">I</span> <span class="main">∧*</span> <span class="free">I'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>  <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> precise_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">hp</span> <span class="skolem">hp'</span> <span class="skolem">h</span>
  <span class="keyword3"><span class="command">assume</span></span> hp<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="skolem">hp</span> <span class="main">≼</span> <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> hp'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hp'</span> <span class="main">≼</span> <span class="skolem">h</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ihp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">∧*</span> <span class="free">I'</span><span class="main">)</span> <span class="skolem">hp</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ihp'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">I</span> <span class="main">∧*</span> <span class="free">I'</span><span class="main">)</span> <span class="skolem">hp'</span>"</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hp1</span></span> <span class="skolem"><span class="skolem">hp2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ihpex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hp1</span> <span class="main">##</span> <span class="skolem">hp2</span> <span class="main">∧</span> <span class="skolem">hp</span> <span class="main">=</span> <span class="skolem">hp1</span> <span class="main">+</span> <span class="skolem">hp2</span> <span class="main">∧</span> <span class="free">I</span> <span class="skolem">hp1</span> <span class="main">∧</span> <span class="free">I'</span> <span class="skolem">hp2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ihp sep_conjD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">hp1'</span></span> <span class="skolem"><span class="skolem">hp2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> ihpex'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hp1'</span> <span class="main">##</span> <span class="skolem">hp2'</span> <span class="main">∧</span> <span class="skolem">hp'</span> <span class="main">=</span> <span class="skolem">hp1'</span> <span class="main">+</span> <span class="skolem">hp2'</span> <span class="main">∧</span> <span class="free">I</span> <span class="skolem">hp1'</span> <span class="main">∧</span> <span class="free">I'</span> <span class="skolem">hp2'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ihp' sep_conjD <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hp2'</span> <span class="main">##</span> <span class="skolem">hp1'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ihpex' sep_disj_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> f4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">hp2</span> <span class="main">##</span> <span class="skolem">hp1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ihpex sep_disj_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> f5<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">a</span> <span class="main">≼</span> <span class="skolem">hp</span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">≼</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hp sep_substate_tran <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> f6<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">a</span> <span class="main">≼</span> <span class="skolem">hp'</span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">≼</span> <span class="skolem">h</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> hp' sep_substate_tran <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">hp</span> <span class="main">=</span> <span class="skolem">hp'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> f4 f3 f5 a2 a1 a1 a2 ihpex ihpex' 
    <span class="keyword1"><span class="command">unfolding</span></span> precise_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sep_add_commute sep_substate_disj_add'<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> unique_subheap<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ1</span><span class="main">,</span><span class="free">σ2</span><span class="main">▹</span><span class="free">σ</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃!</span><span class="bound">σ2'</span><span class="main">.</span><span class="main">(</span><span class="free">σ1</span><span class="main">,</span><span class="bound">σ2'</span><span class="main">▹</span><span class="free">σ</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> lspasl_c_der <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">lemma</span></span> sep_split_substate<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ1</span><span class="main">,</span> <span class="free">σ2</span><span class="main">▹</span> <span class="free">σ</span><span class="main">)</span> <span class="main">⟹</span> 
  <span class="main">(</span><span class="free">σ1</span>  <span class="main">≼</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">σ2</span>  <span class="main">≼</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ1</span><span class="main">,</span> <span class="free">σ2</span><span class="main">▹</span> <span class="free">σ</span><span class="main">)</span>"</span></span>  
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">σ1</span>  <span class="main">≼</span> <span class="free">σ</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">σ2</span>  <span class="main">≼</span> <span class="free">σ</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_disj_commute 
        tern_rel_def 
        sep_substate_disj_add 
        sep_substate_disj_add'<span class="main">)</span>   
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">sep_septraction</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>sep_algebra<span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⟶⊕</span>"</span> 25<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">⟶⊕</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span>  <span class="keyword1">not</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟶*</span> <span class="keyword1">not</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Below we integrate the inference rules in proof search.›</span></span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_empl <span class="main">=</span> <span class="main">(</span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> P<span class="main"><span class="main">[</span></span><span class="operator">thin</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"sep_empty <span class="var">?h</span>"</span></span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">insert</span> lspasl_empl_der<span class="main">[</span><span class="operator">OF</span> P<span class="main">]</span>›</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_starl <span class="main">=</span> <span class="main">(</span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> P<span class="main"><span class="main">[</span></span><span class="operator">thin</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?A</span> <span class="main">**</span> <span class="var">?B</span><span class="main">)</span> <span class="var">?h</span>"</span></span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">insert</span> lspasl_starl_der<span class="main">[</span><span class="operator">OF</span> P<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>›</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_magicr <span class="main">=</span> <span class="main">(</span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> P<span class="main"><span class="main">[</span></span><span class="operator">thin</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="var">?A</span> <span class="main">⟶*</span> <span class="var">?B</span><span class="main">)</span> <span class="var">?h</span>"</span></span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">insert</span> lspasl_magicr_der<span class="main">[</span><span class="operator">OF</span> P<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>›</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Only apply the rule Eq on (0,h1,h2) where h1 and h2
  are not syntactically the same.›</span></span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_eq <span class="main">=</span> <span class="main">(</span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> P<span class="main"><span class="main">[</span></span><span class="operator">thin</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="var">?h1</span><span class="main">▹</span><span class="var">?h2</span><span class="main">)</span>"</span></span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">match</span> P <span class="quasi_keyword">in</span> 
    <span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h</span><span class="main">▹</span><span class="free">h</span><span class="main">)</span>"</span> <span class="quasi_keyword">for</span> <span class="free">h</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›     
    <span class="main">¦</span><span class="quoted"><span class="main">_</span></span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_eq_der<span class="main">[</span><span class="operator">OF</span> P<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>››</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We restrict that the rule IU can't be applied 
  on (0,0,0).›</span></span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_iu <span class="main">=</span> <span class="main">(</span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> P<span class="main"><span class="main">[</span></span><span class="operator">thin</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?h1</span><span class="main">,</span><span class="var">?h2</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">match</span> P <span class="quasi_keyword">in</span>
    <span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted"><span class="main">_</span></span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_iu_der<span class="main">[</span><span class="operator">OF</span> P<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>››</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We restrict that the rule D can't be applied 
  on (0,0,0).›</span></span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_d <span class="main">=</span> <span class="main">(</span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> P<span class="main"><span class="main">[</span></span><span class="operator">thin</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">h1</span> <span class="free">h2</span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">match</span> P <span class="quasi_keyword">in</span> 
    <span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted"><span class="main">_</span></span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_d_der<span class="main">[</span><span class="operator">OF</span> P<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>››</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We restrict that the rule P can't be applied to
  two syntactically identical ternary relational atoms.›</span></span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_p <span class="main">=</span> <span class="main">(</span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> P<span class="main"><span class="main">[</span></span><span class="operator">thin</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">h0</span> <span class="free">h1</span> <span class="free">h2</span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span> <span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span>P'<span class="main">[</span><span class="operator">thin</span><span class="main">]</span><span class="main">:</span><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="var">?h3</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_p_der<span class="main">[</span><span class="operator">OF</span> P P'<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>››</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We restrict that the rule C can't be applied to
  two syntactically identical ternary relational atoms.›</span></span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_c <span class="main">=</span> <span class="main">(</span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> P<span class="main"><span class="main">[</span></span><span class="operator">thin</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">h0</span> <span class="free">h1</span> <span class="free">h2</span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span> <span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span>P'<span class="main">[</span><span class="operator">thin</span><span class="main">]</span><span class="main">:</span><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="var">?h3</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_c_der<span class="main">[</span><span class="operator">OF</span> P P'<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>››</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We restrict that *R only applies to a pair of 
  a ternary relational and a formula once. 
  Here, we need to first try simp to unify heaps. 
  In the end, we try simp\_all to simplify all branches. 
  A similar strategy is used in -*L.›</span></span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_starr <span class="main">=</span> <span class="main">(</span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> P<span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P'<span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">h1</span> <span class="free">h2</span> <span class="free">h</span> <span class="free">A</span> <span class="free">B</span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span> <span class="quoted">"starr_applied <span class="free">h1</span> <span class="free">h2</span> <span class="free">h</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>› 
    <span class="main">¦</span><span class="quoted"><span class="main">_</span></span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_starr_der<span class="main">[</span><span class="operator">OF</span> P P'<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>››</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp_all</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We restrict that -*L only applies to a pair of 
  a ternary relational and a formula once.›</span></span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_magicl <span class="main">=</span> <span class="main">(</span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> P<span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P'<span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">h1</span> <span class="free">h2</span> <span class="free">h</span> <span class="free">A</span> <span class="free">B</span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span> <span class="quoted">"magicl_applied <span class="free">h1</span> <span class="free">h</span> <span class="free">h2</span> <span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>› 
    <span class="main">¦</span><span class="quoted"><span class="main">_</span></span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_magicl_der<span class="main">[</span><span class="operator">OF</span> P P'<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>››</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp_all</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We restrict that the U rule is only applicable to a world h
  when (h,0,h) is not in the premises. There are two cases:
  (1) We pick a ternary relational atom (h1,h2,h0),
  and check if (h1,0,h1) occurs in the premises, if not, 
  apply U on h1. Otherwise, check other ternary relational atoms.
  (2) We pick a labelled formula (A h), 
  and check if (h,0,h) occurs in the premises, if not,
  apply U on h. Otherwise, check other labelled formulae.›</span></span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_u_tern <span class="main">=</span> <span class="main">(</span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> 
    P<span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="main">(</span><span class="free">h0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">h1</span> <span class="free">h2</span> <span class="free">h0</span> <span class="main"><span class="main">⇒</span></span>
    <span class="quoted">‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span> 
    <span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span> 
    <span class="quoted">"<span class="main">(</span><span class="free">h2</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span> 
    I1<span class="main">:</span><span class="quoted">"<span class="main">(</span><span class="free">h0</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted"><span class="main">_</span></span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_u_der<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">h0</span></span><span class="main">]</span>››
    <span class="main">¦</span><span class="quoted"><span class="main">_</span></span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_u_der<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">h2</span></span><span class="main">]</span>››
    <span class="main">¦</span><span class="quoted"><span class="main">_</span></span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_u_der<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">h1</span></span><span class="main">]</span>››</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_u_form <span class="main">=</span> <span class="main">(</span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> 
    P'<span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">h</span> <span class="main"><span class="main">⇒</span></span>
    <span class="quoted">‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span> <span class="quoted">"<span class="main">(</span><span class="free">h</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="free">h</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span>"</span> <span class="quasi_keyword">and</span> <span class="quoted">"<span class="free">h</span> <span class="main">=</span> <span class="main">0</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span>"</span> <span class="quasi_keyword">and</span> <span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="free">h</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted"><span class="main">_</span></span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_u_der<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">h</span></span><span class="main">]</span>››</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We restrict that the E rule is only applicable to
  (h1,h2,h0) when (h2,h1,h0) is not in the premises.›</span></span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_e <span class="main">=</span> <span class="main">(</span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> P<span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">h1</span> <span class="free">h2</span> <span class="free">h0</span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span> <span class="quoted">"<span class="main">(</span><span class="free">h2</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted"><span class="main">_</span></span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_e_der<span class="main">[</span><span class="operator">OF</span> P<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>››</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We restrict that the A rule is only applicable to 
  (h1,h2,h0) and (h3,h4,h1) when (h3,h,h0) and (h2,h4,h) 
  or any commutative variants of the two 
  do not occur in the premises, for some h. 
  Additionally, we do not allow A to be applied to two identical 
  ternary relational atoms. 
  We further restrict that the leaves must not be 0, 
  because otherwise this application does not gain anything.›</span></span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_a <span class="main">=</span> <span class="main">(</span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">h0</span> <span class="free">h1</span> <span class="free">h2</span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span> 
    <span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="main">0</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span>P<span class="main">[</span><span class="operator">thin</span><span class="main">]</span><span class="main">:</span><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span> <span class="main">⇒</span> 
    ‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span>
    P'<span class="main">:</span><span class="quoted">"<span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span>"</span> <span class="quasi_keyword">for</span> <span class="free">h3</span> <span class="free">h4</span> <span class="main">⇒</span> ‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span>
    <span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted">"<span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="main">0</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted">"<span class="main">(</span><span class="main">_</span><span class="main">,</span><span class="free">h3</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted">"<span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="main">_</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted">"<span class="main">(</span><span class="free">h2</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="main">_</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted">"<span class="main">(</span><span class="free">h4</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="main">_</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›       
    <span class="main">¦</span><span class="quoted"><span class="main">_</span></span> <span class="main">⇒</span> ‹<span class="operator">insert</span> P P'<span class="keyword3">,</span> <span class="operator">drule</span> lspasl_a_der<span class="keyword3">,</span> <span class="operator">auto</span>››››</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹I don't have a good heuristics for CS right now. 
  I simply forbid CS to be applied on the same pair twice.›</span></span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_cs <span class="main">=</span> <span class="main">(</span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> P<span class="main"><span class="main">[</span></span><span class="operator">thin</span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">h0</span> <span class="free">h1</span> <span class="free">h2</span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span> <span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>› 
    <span class="main">¦</span><span class="quoted">"<span class="main">(</span><span class="free">h2</span><span class="main">,</span><span class="free">h1</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span>P'<span class="main">:</span><span class="quoted">"<span class="main">(</span><span class="free">h3</span><span class="main">,</span><span class="free">h4</span><span class="main">▹</span><span class="free">h0</span><span class="main">)</span>"</span> <span class="quasi_keyword">for</span> <span class="free">h3</span> <span class="free">h4</span> <span class="main">⇒</span> ‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span> 
    <span class="quoted">"<span class="main">(</span><span class="free">h5</span><span class="main">,</span><span class="free">h6</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span>"</span> <span class="quasi_keyword">and</span> <span class="quoted">"<span class="main">(</span><span class="free">h7</span><span class="main">,</span><span class="free">h8</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span>"</span> <span class="quasi_keyword">and</span> <span class="quoted">"<span class="main">(</span><span class="free">h5</span><span class="main">,</span><span class="free">h7</span><span class="main">▹</span><span class="free">h3</span><span class="main">)</span>"</span> <span class="quasi_keyword">and</span> <span class="quoted">"<span class="main">(</span><span class="free">h6</span><span class="main">,</span><span class="free">h8</span><span class="main">▹</span><span class="free">h4</span><span class="main">)</span>"</span> <span class="quasi_keyword">for</span> <span class="free">h5</span> <span class="free">h6</span> <span class="free">h7</span> <span class="free">h8</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted">"<span class="main">(</span><span class="free">i5</span><span class="main">,</span><span class="free">i6</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span>"</span> <span class="quasi_keyword">and</span> <span class="quoted">"<span class="main">(</span><span class="free">i7</span><span class="main">,</span><span class="free">i8</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span>"</span> <span class="quasi_keyword">and</span> <span class="quoted">"<span class="main">(</span><span class="free">i5</span><span class="main">,</span><span class="free">i7</span><span class="main">▹</span><span class="free">h3</span><span class="main">)</span>"</span> <span class="quasi_keyword">and</span> <span class="quoted">"<span class="main">(</span><span class="free">i6</span><span class="main">,</span><span class="free">i8</span><span class="main">▹</span><span class="free">h4</span><span class="main">)</span>"</span> <span class="quasi_keyword">for</span> <span class="free">i5</span> <span class="free">i6</span> <span class="free">i7</span> <span class="free">i8</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted">"<span class="main">(</span><span class="free">j5</span><span class="main">,</span><span class="free">j6</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span>"</span> <span class="quasi_keyword">and</span> <span class="quoted">"<span class="main">(</span><span class="free">j7</span><span class="main">,</span><span class="free">j8</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span>"</span> <span class="quasi_keyword">and</span> <span class="quoted">"<span class="main">(</span><span class="free">j5</span><span class="main">,</span><span class="free">j7</span><span class="main">▹</span><span class="free">h4</span><span class="main">)</span>"</span> <span class="quasi_keyword">and</span> <span class="quoted">"<span class="main">(</span><span class="free">j6</span><span class="main">,</span><span class="free">j8</span><span class="main">▹</span><span class="free">h3</span><span class="main">)</span>"</span> <span class="quasi_keyword">for</span> <span class="free">j5</span> <span class="free">j6</span> <span class="free">j7</span> <span class="free">j8</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted">"<span class="main">(</span><span class="free">k5</span><span class="main">,</span><span class="free">k6</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span>"</span> <span class="quasi_keyword">and</span> <span class="quoted">"<span class="main">(</span><span class="free">k7</span><span class="main">,</span><span class="free">k8</span><span class="main">▹</span><span class="free">h1</span><span class="main">)</span>"</span> <span class="quasi_keyword">and</span> <span class="quoted">"<span class="main">(</span><span class="free">k5</span><span class="main">,</span><span class="free">k7</span><span class="main">▹</span><span class="free">h4</span><span class="main">)</span>"</span> <span class="quasi_keyword">and</span> <span class="quoted">"<span class="main">(</span><span class="free">k6</span><span class="main">,</span><span class="free">k8</span><span class="main">▹</span><span class="free">h3</span><span class="main">)</span>"</span> <span class="quasi_keyword">for</span> <span class="free">k5</span> <span class="free">k6</span> <span class="free">k7</span> <span class="free">k8</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>›
    <span class="main">¦</span><span class="quoted"><span class="main">_</span></span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_cs_der<span class="main">[</span><span class="operator">OF</span> P P'<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>›››</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_starr_guided <span class="main">=</span> <span class="main">(</span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> P<span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h2</span><span class="main">▹</span><span class="free">h</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P'<span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">h1</span> <span class="free">h2</span> <span class="free">h</span> <span class="free">A</span> <span class="free">B</span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span> <span class="quoted">"starr_applied <span class="free">h1</span> <span class="free">h2</span> <span class="free">h</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>› 
    <span class="main">¦</span><span class="quoted">"<span class="free">A</span> <span class="free">h1</span>"</span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_starr_der<span class="main">[</span><span class="operator">OF</span> P P'<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>›
    <span class="main">¦</span><span class="quoted">"<span class="free">B</span> <span class="free">h2</span>"</span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_starr_der<span class="main">[</span><span class="operator">OF</span> P P'<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>››</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp_all</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> try_lspasl_magicl_guided <span class="main">=</span> <span class="main">(</span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">premises</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> P<span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">h1</span><span class="main">,</span><span class="free">h</span><span class="main">▹</span><span class="free">h2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P'<span class="main"><span class="main">:</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="free">h1</span> <span class="free">h2</span> <span class="free">h</span> <span class="free">A</span> <span class="free">B</span> <span class="main"><span class="main">⇒</span></span> 
    <span class="quoted">‹<span class="operator">match</span> <span class="quasi_keyword">premises</span> <span class="quasi_keyword">in</span> <span class="quoted">"magicl_applied <span class="free">h1</span> <span class="free">h</span> <span class="free">h2</span> <span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">fail</span>› 
    <span class="main">¦</span><span class="quoted">"<span class="free">A</span> <span class="free">h1</span>"</span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_magicl_der<span class="main">[</span><span class="operator">OF</span> P P'<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>›
    <span class="main">¦</span><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">B</span> <span class="free">h2</span><span class="main">)</span>"</span> <span class="main">⇒</span> ‹<span class="operator">insert</span> lspasl_magicl_der<span class="main">[</span><span class="operator">OF</span> P P'<span class="main">]</span><span class="keyword3">,</span> <span class="operator">auto</span>››</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp_all</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In case the conclusion is not False, we normalise the goal as below.›</span></span>

<span class="keyword1"><span class="command">method</span></span> norm_goal <span class="main">=</span> <span class="main">(</span>
    <span class="operator">match</span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">conclusion</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="main"><span class="main">⇒</span></span> <span class="quoted">‹<span class="operator">fail</span>›</span>
    <span class="main"><span class="main">¦</span></span><span class="quoted"><span class="main">_</span></span> <span class="main"><span class="main">⇒</span></span> <span class="quoted">‹<span class="operator">rule</span> ccontr›</span><span class="main"><span class="keyword3">,</span></span>
    <span class="operator">simp</span><span class="main"><span class="keyword3">?</span></span>
    <span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The tactic for separata. We first try to simplify the problem
  with auto simp add: sep\_conj\_ac, which ought to solve many problems.
  Then we apply the "true" invertible rules and structural rules 
  which unify worlds as much as possible, followed by auto to simplify the goals. 
  Then we apply *R and -*L and other structural rules.
  The rule CS is only applied when nothing else is applicable. We try not
  to use it.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  *****
  Note, (try\_lspasl\_u
  |try\_lspasl\_e)
  |try\_lspasl\_a)+
  may cause infinite loops.
  *****
›</span></span>

<span class="keyword1"><span class="command">method</span></span> separata <span class="main">=</span>
  <span class="main">(</span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span>
    <span class="main"><span class="keyword3">|</span></span><span class="main">(</span><span class="operator">norm_goal</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">,</span></span>
        <span class="main">(</span><span class="main">(</span><span class="operator">try_lspasl_empl</span> <span class="comment1">(* This section contains invertible rules. Apply as often as possible. *)</span>
          <span class="main"><span class="keyword3">|</span></span><span class="operator">try_lspasl_starl</span>
          <span class="main"><span class="keyword3">|</span></span><span class="operator">try_lspasl_magicr</span>
          <span class="main"><span class="keyword3">|</span></span><span class="operator">try_lspasl_iu</span>
          <span class="main"><span class="keyword3">|</span></span><span class="operator">try_lspasl_d</span>
          <span class="main"><span class="keyword3">|</span></span><span class="operator">try_lspasl_eq</span>     
          <span class="main"><span class="keyword3">|</span></span><span class="operator">try_lspasl_p</span>
          <span class="main"><span class="keyword3">|</span></span><span class="operator">try_lspasl_c</span>
          <span class="main"><span class="keyword3">|</span></span><span class="operator">try_lspasl_starr_guided</span>
          <span class="main"><span class="keyword3">|</span></span><span class="operator">try_lspasl_magicl_guided</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span><span class="main"><span class="keyword3">,</span></span>
          <span class="operator">auto</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>
      <span class="main"><span class="keyword3">|</span></span><span class="main">(</span><span class="operator">try_lspasl_u_tern</span> <span class="comment1">(* This section contains structural rules. *)</span>
        <span class="main"><span class="keyword3">|</span></span><span class="operator">try_lspasl_e</span>
        <span class="main"><span class="keyword3">|</span></span><span class="operator">try_lspasl_a</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="main"><span class="keyword3">|</span></span><span class="main">(</span><span class="operator">try_lspasl_starr</span> <span class="comment1">(* This section contains *R and -*L. *)</span>
        <span class="main"><span class="keyword3">|</span></span><span class="operator">try_lspasl_magicl</span><span class="main">)</span>
        <span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="main"><span class="keyword3">|</span></span><span class="operator">try_lspasl_u_form</span><span class="main"><span class="keyword3">+</span></span> <span class="comment1">(* This rule is rarely used. *)</span>
    <span class="main"><span class="keyword3">|</span></span><span class="operator">try_lspasl_cs</span> <span class="comment1">(* Cross-split adds too much complication. Try not to use it. *)</span>
      <span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Some examples.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Let's prove something that abstract separation logic provers struggle to prove. 
  This can be proved easily in Isabelle, proof found by Sledgehammer.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> fm_hard<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>sep_empty <span class="keyword1">imp</span> <span class="main">(</span><span class="free">p0</span> <span class="main">⟶*</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="main">**</span> <span class="main">(</span><span class="free">p0</span> <span class="main">⟶*</span> <span class="free">p1</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span><span class="keyword1">not</span> <span class="free">p1</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span> 
  <span class="main">(</span><span class="free">p0</span> <span class="main">**</span> <span class="main">(</span><span class="free">p0</span> <span class="main">**</span> <span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="main">⟶*</span> <span class="free">p1</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span><span class="keyword1">not</span> <span class="free">p1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>sep_empty <span class="main">**</span> <span class="free">p0</span><span class="main">)</span> <span class="main">**</span> 
  <span class="main">(</span><span class="free">p0</span> <span class="main">**</span> <span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="main">⟶*</span> <span class="free">p1</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span><span class="keyword1">not</span> <span class="free">p1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="main">**</span> <span class="free">p0</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span><span class="free">p0</span> <span class="main">⟶*</span> <span class="free">p1</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> 
  <span class="main">(</span><span class="keyword1">not</span> <span class="free">p1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> sep_empty<span class="main">)</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following formula can only be proved in partial-deterministic 
  separation algebras. 
  Sledgehammer took a rather long time to find a proof.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> fm_partial<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span>sep_true <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> sep_empty<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> 
  <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span>sep_true <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> sep_empty<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span> 
  <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span>sep_true <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> sep_empty<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following is the axiom of indivisible unit. 
  Sledgehammer finds a proof easily.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> ax_iu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>sep_empty <span class="keyword1">and</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="free">A</span><span class="main">)</span> 
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer fails to find a proof in 300s for this one.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="free">C</span> <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and</span> <span class="main">(</span><span class="keyword1">not</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span> 

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof easily.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>sep_empty <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="free">A</span><span class="main">)</span> <span class="main">**</span> sep_empty<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="free">A</span><span class="main">)</span> 
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof in 46 seconds.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="keyword1">not</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer easily finds a proof.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>sep_empty <span class="keyword1">and</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer fails to find a proof in 300s.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="free">C</span> <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and</span> <span class="main">(</span><span class="keyword1">not</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof easily.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>sep_empty <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="free">A</span><span class="main">)</span> <span class="main">**</span> sep_empty<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="free">A</span><span class="main">)</span> 
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof easily.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sep_empty <span class="keyword1">imp</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟶*</span> <span class="main">(</span><span class="free">B</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer takes a while to find a proof, although the proof is by smt and is fast.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sep_empty <span class="keyword1">imp</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="free">B</span> <span class="keyword1">and</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">and</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer takes a long time to find a smt proof, but the smt proves it quickly.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sep_empty <span class="keyword1">imp</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="main">(</span><span class="free">B</span> <span class="keyword1">imp</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof quickly.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sep_empty <span class="keyword1">imp</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="keyword1">imp</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟶*</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">A</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds proofs in a while.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="free">B</span><span class="main">)</span> <span class="keyword1">and</span> <span class="main">(</span>sep_true <span class="main">**</span> <span class="main">(</span>sep_empty <span class="keyword1">and</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="free">B</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds proofs easily.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>sep_empty <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="free">A</span><span class="main">)</span> <span class="main">**</span> sep_true<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="free">A</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer takes a while to find a proof.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="free">A</span><span class="main">)</span> <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer takes a long time to find a smt proof, although smt proves it quickly.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sep_empty <span class="keyword1">imp</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="main">(</span><span class="free">B</span> <span class="main">⟶*</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="main">⟶*</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds proofs easily.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sep_empty <span class="keyword1">imp</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span>  <span class="main">**</span>  <span class="main">(</span><span class="free">B</span> <span class="main">**</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span> <span class="main">**</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds proofs in a few seconds.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sep_empty <span class="keyword1">imp</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="main">(</span><span class="free">B</span> <span class="main">⟶*</span> <span class="free">D</span><span class="main">)</span> <span class="main">**</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="free">B</span> <span class="main">⟶*</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer fails to find a proof in 300s.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="free">D</span> <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="free">C</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and</span> <span class="free">C</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span><span class="free">D</span> <span class="keyword1">and</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">B</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer takes a while to find a proof.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="free">C</span> <span class="main">**</span> <span class="main">(</span><span class="free">D</span> <span class="main">**</span> <span class="free">E</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="free">B</span> <span class="main">⟶*</span> <span class="keyword1">not</span> <span class="main">(</span><span class="free">D</span> <span class="main">**</span> <span class="main">(</span><span class="free">E</span> <span class="main">**</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> 
  <span class="main">(</span><span class="free">B</span> <span class="keyword1">and</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> sep_true<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer fails to find a proof in 300s.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="free">D</span> <span class="main">⟶*</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="main">(</span><span class="free">C</span> <span class="main">**</span> <span class="free">E</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span><span class="free">B</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">and</span> <span class="free">C</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span><span class="free">D</span> <span class="keyword1">and</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="free">B</span> <span class="main">**</span> <span class="free">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof easily.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="free">B</span> <span class="main">**</span> <span class="main">(</span><span class="free">C</span> <span class="main">**</span> <span class="main">(</span><span class="free">D</span> <span class="main">**</span> <span class="free">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="free">E</span> <span class="main">**</span> <span class="main">(</span><span class="free">B</span> <span class="main">**</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="free">C</span> <span class="main">**</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="free">B</span> <span class="main">**</span> <span class="main">(</span><span class="free">C</span> <span class="main">**</span> <span class="main">(</span><span class="free">D</span> <span class="main">**</span> <span class="main">(</span><span class="free">E</span> <span class="main">**</span> <span class="main">(</span><span class="free">F</span> <span class="main">**</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="free">G</span> <span class="main">**</span> <span class="main">(</span><span class="free">E</span> <span class="main">**</span> <span class="main">(</span><span class="free">B</span> <span class="main">**</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="free">C</span> <span class="main">**</span> <span class="main">(</span><span class="free">D</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof in a few seconds.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sep_empty <span class="keyword1">imp</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">(</span><span class="main">(</span><span class="free">B</span> <span class="main">⟶*</span> <span class="free">E</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span><span class="free">C</span> <span class="main">**</span> <span class="free">D</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span> <span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="free">D</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span><span class="free">C</span> <span class="main">**</span> <span class="main">(</span><span class="free">B</span> <span class="main">⟶*</span> <span class="free">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This is the odd BBI formula that I personally can't 
  prove using any other methods. I only know of a derivation in 
  my labelled sequent calculus for BBI.  
  Sledgehammer takes a while to find a proof.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span>sep_empty <span class="keyword1">and</span> <span class="free">A</span> <span class="keyword1">and</span> <span class="main">(</span><span class="free">B</span> <span class="main">**</span> <span class="main">(</span><span class="keyword1">not</span> <span class="main">(</span><span class="free">C</span> <span class="main">⟶*</span> <span class="main">(</span>sep_empty <span class="keyword1">imp</span> <span class="free">A</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof easily.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span>sep_true <span class="keyword1">imp</span> <span class="free">p0</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="main">**</span> <span class="free">p0</span><span class="main">)</span> <span class="main">⟶*</span> <span class="main">(</span><span class="main">(</span>sep_true <span class="keyword1">imp</span> <span class="free">p0</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span><span class="free">p0</span> <span class="main">**</span> <span class="free">p0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span> 
  <span class="main">(</span><span class="free">p1</span> <span class="main">⟶*</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>sep_true <span class="keyword1">imp</span> <span class="free">p0</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="main">**</span> <span class="free">p0</span><span class="main">)</span> <span class="main">⟶*</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span>sep_true <span class="keyword1">imp</span> <span class="free">p0</span><span class="main">)</span> <span class="main">**</span> <span class="free">p0</span><span class="main">)</span> <span class="main">**</span> <span class="free">p0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="free">p1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following are some randomly generated BBI formulae.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof easily.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="main">⟶*</span>   <span class="free">p3</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p5</span> <span class="main">⟶*</span>   <span class="free">p2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p7</span> <span class="main">**</span>   <span class="free">p4</span><span class="main">)</span> <span class="keyword1">and</span>   <span class="main">(</span><span class="free">p3</span> <span class="main">⟶*</span>   <span class="free">p2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   
  <span class="main">(</span><span class="main">(</span><span class="free">p7</span> <span class="main">**</span>   <span class="free">p4</span><span class="main">)</span> <span class="keyword1">and</span>   <span class="main">(</span><span class="free">p3</span> <span class="main">⟶*</span>   <span class="free">p2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="main">⟶*</span>   <span class="free">p3</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p5</span> <span class="main">⟶*</span>   <span class="free">p2</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span>   
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p4</span> <span class="main">**</span>   <span class="free">p7</span><span class="main">)</span> <span class="keyword1">and</span>   <span class="main">(</span><span class="free">p3</span> <span class="main">⟶*</span>   <span class="free">p2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="free">p4</span> <span class="main">**</span>   <span class="free">p7</span><span class="main">)</span> <span class="keyword1">and</span>   <span class="main">(</span><span class="free">p3</span> <span class="main">⟶*</span>   <span class="free">p2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof easily.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p0</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="keyword1">imp</span>   
  <span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="main">**</span>   <span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p4</span> <span class="main">⟶*</span>   <span class="free">p1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="main">**</span>   
  <span class="main">(</span><span class="free">p0</span> <span class="main">**</span>   <span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p4</span> <span class="main">⟶*</span>   <span class="free">p1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="main">**</span>   <span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p4</span> <span class="main">⟶*</span>   <span class="free">p1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span>   
  <span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="main">**</span>   <span class="main">(</span><span class="free">p1</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span><span class="main">)</span> <span class="main">**</span>   <span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p4</span> <span class="main">⟶*</span>   <span class="free">p1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   
  <span class="main">(</span><span class="free">p1</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p0</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof easily.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="main">**</span>   <span class="free">p0</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p1</span> <span class="main">**</span>   <span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="main">**</span>   
  <span class="free">p0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="main">**</span>   <span class="free">p0</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="main">**</span>   <span class="free">p0</span><span class="main">)</span> <span class="main">**</span>   <span class="main">(</span><span class="free">p0</span> <span class="keyword1">imp</span>   
  sep_false <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof in a while.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sep_empty  <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p4</span> <span class="main">**</span>   <span class="free">p1</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="main">(</span><span class="free">p8</span> <span class="main">**</span>   sep_empty <span class="main">)</span> <span class="main">⟶*</span>   <span class="free">p0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   
  <span class="main">(</span><span class="free">p1</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p1</span> <span class="main">**</span>   <span class="main">(</span><span class="main">(</span><span class="free">p4</span> <span class="main">**</span>   <span class="free">p1</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="main">(</span><span class="free">p8</span> <span class="main">**</span>   sep_empty <span class="main">)</span> <span class="main">⟶*</span>   <span class="free">p0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span>   
  <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p4</span> <span class="main">**</span>   <span class="free">p1</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="main">(</span><span class="free">p8</span> <span class="main">**</span>   sep_empty <span class="main">)</span> <span class="main">⟶*</span>   <span class="free">p0</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="free">p1</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="main">**</span>   <span class="free">p4</span><span class="main">)</span> <span class="main">⟶*</span>   
  <span class="main">(</span><span class="main">(</span><span class="free">p8</span> <span class="main">**</span>   sep_empty <span class="main">)</span> <span class="main">⟶*</span>   <span class="free">p0</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span>   <span class="free">p1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof easily.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p3</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="free">p0</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p3</span> <span class="main">**</span>   <span class="free">p0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="free">p1</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   
  <span class="main">(</span><span class="free">p1</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="free">p3</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="free">p0</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p0</span> <span class="main">**</span>   <span class="free">p3</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof in a few seconds.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">p7</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p4</span> <span class="main">**</span>   <span class="main">(</span><span class="free">p6</span> <span class="main">⟶*</span>   <span class="free">p1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="free">p4</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="free">p1</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="main">(</span>sep_empty  <span class="main">**</span>   
  <span class="free">p1</span><span class="main">)</span> <span class="main">**</span>   <span class="free">p4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="free">p4</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p4</span> <span class="main">**</span>   <span class="main">(</span>sep_empty  <span class="main">**</span>   <span class="free">p1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span>   <span class="main">(</span><span class="free">p7</span> <span class="main">⟶*</span>   
  <span class="main">(</span><span class="main">(</span><span class="free">p6</span> <span class="main">⟶*</span>   <span class="free">p1</span><span class="main">)</span> <span class="main">**</span>   <span class="free">p4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof easily.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p2</span> <span class="keyword1">imp</span>   <span class="free">p0</span><span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="main">**</span>   sep_true <span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p0</span> <span class="main">**</span>   <span class="main">(</span>sep_true  <span class="main">**</span>   
  <span class="main">(</span><span class="free">p2</span> <span class="keyword1">imp</span>   <span class="free">p0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="free">p2</span> <span class="keyword1">imp</span>   <span class="free">p0</span><span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span>sep_true  <span class="main">**</span>   <span class="free">p0</span><span class="main">)</span> <span class="main">⟶*</span>   
  <span class="main">(</span><span class="free">p0</span> <span class="main">**</span>   <span class="main">(</span><span class="main">(</span><span class="free">p2</span> <span class="keyword1">imp</span>   <span class="free">p0</span><span class="main">)</span> <span class="main">**</span>   sep_true <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof easily.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>sep_empty  <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p2</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="main">**</span>   <span class="free">p0</span><span class="main">)</span> <span class="main">**</span>   <span class="free">p8</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span>   
  <span class="main">(</span><span class="free">p1</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="main">(</span><span class="free">p2</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="main">**</span>   <span class="main">(</span><span class="free">p0</span> <span class="main">**</span>   <span class="free">p8</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="main">**</span>   sep_empty <span class="main">)</span> <span class="main">⟶*</span>   
  <span class="main">(</span><span class="main">(</span>sep_empty  <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="free">p1</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="main">**</span>   <span class="main">(</span><span class="free">p2</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span><span class="main">)</span> <span class="main">**</span>   <span class="free">p8</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p1</span> <span class="main">⟶*</span>   
  <span class="main">(</span><span class="main">(</span><span class="free">p2</span> <span class="keyword1">imp</span>   sep_false <span class="main">)</span> <span class="main">**</span>   <span class="main">(</span><span class="free">p0</span> <span class="main">**</span>   <span class="free">p8</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span>   <span class="main">(</span><span class="free">p0</span> <span class="main">**</span>   sep_empty <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Sledgehammer finds a proof in a while.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">p0</span> <span class="main">⟶*</span>   sep_empty <span class="main">)</span> <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span>sep_empty  <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span>sep_empty  <span class="main">**</span>   <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p8</span> <span class="main">**</span>   <span class="free">p7</span><span class="main">)</span> <span class="main">**</span>   
  <span class="main">(</span><span class="free">p8</span> <span class="keyword1">imp</span>   <span class="free">p4</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="free">p8</span><span class="main">)</span> <span class="main">**</span>   <span class="main">(</span><span class="free">p2</span> <span class="main">**</span>   <span class="free">p1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="free">p2</span> <span class="main">**</span>   <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p7</span> <span class="main">**</span>   <span class="main">(</span><span class="main">(</span><span class="free">p8</span> <span class="keyword1">imp</span>   <span class="free">p4</span><span class="main">)</span> <span class="main">**</span>   
  <span class="free">p8</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="free">p8</span><span class="main">)</span> <span class="main">**</span>   <span class="free">p1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="main">(</span>sep_empty  <span class="keyword1">imp</span>   <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p7</span> <span class="main">**</span>   <span class="main">(</span><span class="free">p8</span> <span class="main">**</span>   <span class="main">(</span><span class="free">p8</span> <span class="keyword1">imp</span>   <span class="free">p4</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span>   
  <span class="free">p8</span><span class="main">)</span> <span class="main">**</span>   sep_empty <span class="main">)</span> <span class="main">**</span>   <span class="main">(</span><span class="free">p1</span> <span class="main">**</span>   <span class="free">p2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">p7</span> <span class="main">**</span>   <span class="main">(</span><span class="main">(</span><span class="free">p8</span> <span class="keyword1">imp</span>   <span class="free">p4</span><span class="main">)</span> <span class="main">**</span>   <span class="free">p8</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶*</span>   <span class="free">p8</span><span class="main">)</span> <span class="main">**</span>   
  <span class="main">(</span><span class="free">p1</span> <span class="main">**</span>   <span class="free">p2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span>   <span class="main">(</span><span class="free">p0</span> <span class="main">⟶*</span>   sep_empty <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="free">h</span><span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>heap_sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">separata</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>