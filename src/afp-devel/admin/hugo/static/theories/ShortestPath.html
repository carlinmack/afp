<div id="ShortestPath">
<div class="head">
<h1>Theory ShortestPath</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ShortestPath
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="../Graph_Theory/Graph_Theory.html">Graph_Theory.Graph_Theory</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Shortest Path (with non-negative edge costs)›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The following theory is used in the verification of a certifying algorithm's checker for shortest path. For more information see \cite{FrameworkVerificationofCertifyingComputations}.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> basic_sp <span class="main">=</span> 
  fin_digraph <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">dist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> general_source_val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">s</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> trian<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> 
      <span class="free">dist</span> <span class="main">(</span>head <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">≤</span> <span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">+</span> <span class="free">c</span> <span class="bound">e</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> basic_just_sp <span class="main">=</span> 
  basic_sp <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">num</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> enat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> just<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">v</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">;</span> <span class="bound">v</span> <span class="main">≠</span> <span class="free">s</span><span class="main">;</span> <span class="free">num</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">∞</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">∃</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">.</span> <span class="bound">v</span> <span class="main">=</span> head <span class="free">G</span> <span class="bound">e</span> <span class="main">∧</span>
        <span class="free">dist</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">+</span> <span class="free">c</span> <span class="bound">e</span>  <span class="main">∧</span>
        <span class="free">num</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">num</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>enat <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> shortest_path_pos_cost <span class="main">=</span>
  basic_just_sp <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s_in_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tail_val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> no_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="free">dist</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> <span class="free">num</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pos_cost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">c</span> <span class="bound">e</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> basic_just_sp_pred <span class="main">=</span> 
  basic_sp <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">num</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> enat"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">pred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> option"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> just<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="main">⟦</span><span class="bound">v</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">;</span> <span class="bound">v</span> <span class="main">≠</span> <span class="free">s</span><span class="main">;</span> <span class="free">num</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">∞</span><span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">∃</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">.</span> 
        <span class="bound">e</span> <span class="main">=</span> the <span class="main">(</span><span class="free">pred</span> <span class="bound">v</span><span class="main">)</span> <span class="main">∧</span> 
        <span class="bound">v</span> <span class="main">=</span> head <span class="free">G</span> <span class="bound">e</span> <span class="main">∧</span>
        <span class="free">dist</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">+</span> <span class="free">c</span> <span class="bound">e</span>  <span class="main">∧</span>
        <span class="free">num</span> <span class="bound">v</span> <span class="main">=</span> <span class="free">num</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>enat <span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> basic_just_sp_pred <span class="main">⊆</span> basic_just_sp  
<span class="keyword1"><span class="command">using</span></span> basic_just_sp_pred_axioms 
<span class="keyword1"><span class="command">unfolding</span></span> basic_just_sp_pred_def
   basic_just_sp_pred_axioms_def
<span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="main">(</span><span class="operator">blast</span><span class="main">)</span>

<span class="keyword1"><span class="command">locale</span></span> shortest_path_pos_cost_pred <span class="main">=</span>
  basic_just_sp_pred <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s_in_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> tail_val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> no_path<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="free">dist</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟷</span> <span class="free">num</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> pos_cost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">≤</span> <span class="free">c</span> <span class="bound">e</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> shortest_path_pos_cost_pred <span class="main">⊆</span> shortest_path_pos_cost
<span class="keyword1"><span class="command">using</span></span> shortest_path_pos_cost_pred_axioms 
<span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> 
   <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> shortest_path_pos_cost_pred_def 
   shortest_path_pos_cost_pred_axioms_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> tail_value_helper<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"hd <span class="free">p</span> <span class="main">=</span> last <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">p</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">[</span>hd <span class="free">p</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms distinct.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> list.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> neq_Nil_conv last_ConsR last_in_set<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> basic_sp<span class="main">)</span> dist_le_cost<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> list"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="free">p</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">≤</span> awalk_cost <span class="free">c</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"length <span class="free">p</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">p</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 0<span class="main">(</span>1<span class="main">)</span> general_source_val
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> awalk_cost_Nil length_0_conv zero_ereal_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> p'e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">=</span> <span class="skolem">p'</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">p</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> rev_cases<span class="main">)</span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> ewu<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="skolem">p'</span> <span class="skolem">u</span> <span class="main">∧</span> awalk <span class="skolem">u</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="skolem">v</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> awalk_append_iff Suc<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> du<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">u</span> <span class="main">≤</span> ereal <span class="main">(</span>awalk_cost <span class="free">c</span> <span class="skolem">p'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc p'e <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> ewu <span class="keyword1"><span class="command">have</span></span> ust<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> tail <span class="free">G</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> head <span class="free">G</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">v</span> <span class="main">≤</span> <span class="free">dist</span> <span class="skolem">u</span> <span class="main">+</span> <span class="free">c</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ewu du ust trian<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">e</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">with</span></span> du <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">v</span> <span class="main">≤</span> ereal <span class="main">(</span>awalk_cost <span class="free">c</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">+</span> <span class="free">c</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_right_mono order_trans<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">v</span> <span class="main">≤</span> awalk_cost <span class="free">c</span> <span class="skolem">p</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> awalk_cost_append p'e <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> fin_digraph<span class="main">)</span> witness_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> ereal <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">p</span><span class="main">.</span> apath <span class="free">s</span> <span class="bound">p</span> <span class="free">v</span> <span class="main">∧</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> awalk_cost <span class="free">c</span> <span class="bound">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> sv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> shortest_path_inf<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">c</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">{</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> no_neg_cyc<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∃</span><span class="bound">w</span> <span class="bound">q</span><span class="main">.</span> awalk <span class="bound">w</span> <span class="bound">q</span> <span class="bound">w</span> <span class="main">∧</span> <span class="bound">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">s</span> <span class="skolem">p</span><span class="main">)</span> <span class="main">∧</span> awalk_cost <span class="free">c</span> <span class="bound">q</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> neg_cycle_imp_inf_μ assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> no_neg_cyc_reach_imp_path<span class="main">[</span><span class="operator">OF</span> sv<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> basic_sp<span class="main">)</span>  dist_le_μ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">≤</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> nt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?thesis</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> ereal <span class="bound">r</span> <span class="main">⟹</span> False"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">r</span> <span class="keyword3"><span class="command">assume</span></span> r_asm<span class="main">:</span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> ereal <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> sv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> shortest_path_inf<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> u<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">s</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> v<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">v</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> 
        <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> awalk_cost <span class="free">c</span> <span class="skolem">p</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> witness_path<span class="main">[</span><span class="operator">OF</span> r_asm<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> apath_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> nt dist_le_cost <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> nt <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> <span class="main">-</span> <span class="main">∞</span> <span class="main">⟹</span> False"</span></span> <span class="keyword1"><span class="command">using</span></span> dist_le_cost
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> asm<span class="main">:</span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> <span class="main">-</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">(</span>awalk_cost <span class="free">c</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="main">{</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">s</span> <span class="bound">p</span> <span class="free">v</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> <span class="var">?C</span><span class="main">.</span> <span class="bound">x</span> <span class="main">&lt;</span> <span class="free">dist</span> <span class="free">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> nt <span class="keyword1"><span class="command">unfolding</span></span> μ_def not_le INF_less_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span>  
        <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="skolem">p</span> <span class="free">v</span>"</span></span> 
        <span class="quoted"><span class="quoted">"awalk_cost <span class="free">c</span> <span class="skolem">p</span> <span class="main">&lt;</span> <span class="free">dist</span> <span class="free">v</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> dist_le_cost <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> basic_just_sp<span class="main">)</span> dist_ge_μ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">s</span> <span class="main">=</span> ereal <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span><span class="main">∈</span>verts <span class="free">G</span> <span class="main">⟹</span> <span class="bound">u</span><span class="main">≠</span><span class="free">s</span> <span class="main">⟹</span>
            <span class="free">num</span> <span class="bound">u</span> <span class="main">≠</span> <span class="main">∞</span> <span class="main">⟹</span> <span class="free">num</span> <span class="bound">u</span> <span class="main">≠</span> enat <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">≥</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">=</span> <span class="free">num</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="free">s</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="free">s</span>"</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_assms<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> head <span class="free">G</span> <span class="skolem">e</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">+</span> ereal <span class="main">(</span><span class="free">c</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">num</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">+</span> enat <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> just<span class="main">[</span><span class="operator">OF</span> Suc<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> False Suc<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nsinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> enat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> enat_1 plus_enat_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ns<span class="main">:</span><span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">=</span> <span class="free">num</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> e_assms<span class="main">(</span>4<span class="main">)</span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span>  ds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">=</span> μ <span class="free">c</span> <span class="free">s</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ns tail_in_verts<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e_assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> nsinf<span class="main">]</span> 
        Suc<span class="main">(</span>5-8<span class="main">)</span> e_assms<span class="main">(</span>3<span class="main">)</span> dist_le_μ<span class="main">[</span><span class="operator">OF</span> tail_in_verts<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e_assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> dmuc<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">v</span> <span class="main">≥</span> μ <span class="free">c</span> <span class="free">s</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">+</span> ereal <span class="main">(</span><span class="free">c</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> e_assms<span class="main">(</span>3<span class="main">)</span> ds  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"arc_to_ends <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">,</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> arc_to_ends_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e_assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span>  μr<span class="main">:</span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">=</span> ereal <span class="skolem">r</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> e_assms<span class="main">(</span>3<span class="main">)</span> Suc<span class="main">(</span>5<span class="main">)</span> ds False
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
          <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="skolem">p</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          μs<span class="main">:</span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">=</span> ereal <span class="main">(</span>awalk_cost <span class="free">c</span> <span class="skolem">p</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> witness_path<span class="main">[</span><span class="operator">OF</span> μr<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> apath_def 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pe<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="main">(</span><span class="skolem">p</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span> <span class="skolem">v</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> e_assms<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> muc<span class="main">:</span><span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="skolem">v</span> <span class="main">≤</span> μ <span class="free">c</span> <span class="free">s</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">+</span> ereal <span class="main">(</span><span class="free">c</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> μs min_cost_le_walk_cost<span class="main">[</span><span class="operator">OF</span> pe<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword3"><span class="command">thus</span></span>  <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">v</span> <span class="main">≥</span> μ <span class="free">c</span> <span class="free">s</span> <span class="skolem">v</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> dmuc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_path_pos_cost<span class="main">)</span> tail_value_check<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">s</span> <span class="main">=</span> ereal <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="main">[]</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> awalk_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">s</span> <span class="main">≤</span> ereal <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> min_cost_le_walk_cost<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">p</span><span class="main">.</span> awalk <span class="free">s</span> <span class="bound">p</span> <span class="free">s</span> <span class="main">⟹</span> ereal<span class="main">(</span>awalk_cost <span class="free">c</span> <span class="bound">p</span><span class="main">)</span> <span class="main">≥</span> ereal <span class="main">0</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> pos_cost pos_cost_pos_awalk_cost <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">s</span> <span class="main">≥</span> ereal <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> μ_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> INF_greatest<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_path_pos_cost<span class="main">)</span> num_not0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="free">v</span> <span class="main">≠</span> enat <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ku</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="free">v</span> <span class="main">=</span> <span class="skolem">ku</span> <span class="main">+</span> enat <span class="main">1</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms just <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">ku</span></span><span class="main">)</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_path_pos_cost<span class="main">)</span> dist_ne_ninf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">-</span><span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="free">v</span> <span class="main">=</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> False 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">=</span> <span class="free">num</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms False
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> 0 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> num_not0 tail_val <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="free">s</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">=</span><span class="free">s</span>"</span></span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> True 
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> tail_val <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_assms<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">+</span> ereal <span class="main">(</span><span class="free">c</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">num</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">+</span> enat <span class="main">1</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> just<span class="main">[</span><span class="operator">OF</span> Suc<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> False Suc<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> nsinf<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> enat.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> enat_1 plus_enat_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ns<span class="main">:</span><span class="quoted"><span class="quoted">"enat <span class="skolem">n</span> <span class="main">=</span> <span class="free">num</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> e_assms<span class="main">(</span>3<span class="main">)</span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">)</span> <span class="main">≠</span> <span class="main">-</span> <span class="main">∞</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Suc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ns tail_in_verts<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e_assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> nsinf<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> e_assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> True 
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> no_path<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_path_pos_cost<span class="main">)</span> correct_shortest_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">=</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> no_path<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> dist_le_μ<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
    dist_ge_μ<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> _ dist_ne_ninf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> 
    tail_value_check<span class="main"><span class="main">[</span></span><span class="operator">OF</span> s_in_G<span class="main"><span class="main">]</span></span> tail_val num_not0<span class="main">]</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_path_pos_cost_pred<span class="main">)</span> correct_shortest_path_pred<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">=</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> correct_shortest_path assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ShortestPathNeg">
<div class="head">
<h1>Theory ShortestPathNeg</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ShortestPathNeg

<span class="comment1">(*
  This theory uses the graph library and  
  several lemmas that were proven in the 
  shortest path theory
*)</span>
<span class="keyword2"><span class="keyword">imports</span></span> <a href="ShortestPath.html">ShortestPath</a>

<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Shortest Path (with general edge costs)›</span></span>
<span class="comment1">(* 
  In this locale we assume we are given a 
  wellformed directed graph $G = (V,E)$ with 
  finite $V$ and $E$ (this is the assumption 
  $graphG$). Moreover, a source vertex $s$ in 
  $V$ . In addition, a cost function c, a function
 $num:V\to \Nat$, $parent\dash edge:V\to E \cup $*)</span>
<span class="keyword1"><span class="command">locale</span></span> shortest_paths_locale_step1 <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">,</span> <span class="tfree">'b</span><span class="main">)</span> pre_digraph"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">structure</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">s</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'b</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">num</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">parent_edge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> option"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">dist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>  <span class="main">⇒</span> ereal"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> graphG<span class="main">:</span> <span class="quoted"><span class="quoted">"fin_digraph <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> s_assms<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">s</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">parent_edge</span> <span class="free">s</span> <span class="main">=</span> None"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  parent_num_assms<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span>  <span class="main">⟦</span><span class="bound">v</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">;</span> <span class="bound">v</span> <span class="main">≠</span> <span class="free">s</span><span class="main">;</span> <span class="free">dist</span> <span class="bound">v</span> <span class="main">≠</span> <span class="main">∞</span><span class="main">⟧</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">∃</span><span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span><span class="main">.</span> <span class="free">parent_edge</span> <span class="bound">v</span> <span class="main">=</span> Some <span class="bound">e</span> <span class="main">∧</span> 
    head <span class="free">G</span> <span class="bound">e</span> <span class="main">=</span> <span class="bound">v</span> <span class="main">∧</span> <span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span> <span class="main">∧</span>
    <span class="free">num</span> <span class="bound">v</span>  <span class="main">=</span> <span class="free">num</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> noPedge<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span><span class="main">∈</span>arcs <span class="free">G</span> <span class="main">⟹</span> 
    <span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span> <span class="main">⟹</span> <span class="free">dist</span> <span class="main">(</span>head <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>

<span class="keyword1"><span class="command">sublocale</span></span> shortest_paths_locale_step1 <span class="main">⊆</span> fin_digraph <span class="quoted"><span class="free">G</span></span>
  <span class="keyword1"><span class="command">using</span></span> graphG <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_paths_locale_step1<span class="main">)</span> <span class="entity">enum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> enat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">enum</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">dist</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">∞</span> <span class="main">∨</span> <span class="free">dist</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">-</span> <span class="main">∞</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">∞</span> <span class="keyword1">else</span> <span class="free">num</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> shortest_paths_locale_step2 <span class="main">=</span> 
  shortest_paths_locale_step1 <span class="main">+</span>
  basic_just_sp <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">dist</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted">enum</span> <span class="main">+</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> source_val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">.</span> enum <span class="bound">v</span> <span class="main">≠</span> <span class="main">∞</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">dist</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> no_edge_Vm_Vf<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">∞</span> <span class="main">⟹</span> <span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="free">dist</span> <span class="main">(</span>head <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">≠</span> ereal <span class="bound">r</span>"</span></span>

<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_paths_locale_step1<span class="main">)</span> <span class="entity">pwalk</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> list"</span></span> 
<span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pwalk</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> 
    <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="free">s</span> <span class="main">∨</span> <span class="free">dist</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">∞</span> <span class="main">∨</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∉</span> verts <span class="free">G</span><span class="main">)</span>
      <span class="keyword1">then</span> <span class="main">[]</span> 
      <span class="keyword1">else</span> <span class="free">pwalk</span> <span class="main">(</span>tail <span class="free">G</span> <span class="main">(</span>the <span class="main">(</span><span class="free">parent_edge</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>the <span class="main">(</span><span class="free">parent_edge</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">]</span>
    <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">termination</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_paths_locale_step1<span class="main">)</span> 
  <span class="keyword1"><span class="command">using</span></span> parent_num_assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">relation</span> <span class="quoted"><span class="quoted">"measure <span class="free">num</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_paths_locale_step1<span class="main">)</span> pwalk_simps<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">s</span> <span class="main">∨</span> <span class="free">dist</span> <span class="free">v</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">∨</span> <span class="free">v</span> <span class="main">∉</span> verts <span class="free">G</span> <span class="main">⟹</span> pwalk <span class="free">v</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">s</span> <span class="main">⟹</span> <span class="free">dist</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">∞</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> 
    pwalk <span class="free">v</span> <span class="main">=</span> pwalk <span class="main">(</span>tail <span class="free">G</span> <span class="main">(</span>the <span class="main">(</span><span class="free">parent_edge</span> <span class="free">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span>the <span class="main">(</span><span class="free">parent_edge</span> <span class="free">v</span><span class="main">)</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_paths_locale_step1<span class="main">)</span> <span class="entity">pwalk_verts</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>  <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">pwalk_verts</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">u</span><span class="main">.</span> <span class="bound">u</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">s</span> <span class="main">(</span>pwalk <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> 

<span class="keyword1"><span class="command">locale</span></span> shortest_paths_locale_step3 <span class="main">=</span>
  shortest_paths_locale_step2 <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">C</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span><span class="main">(</span><span class="tfree">'b</span> awalk<span class="main">)</span><span class="main">)</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> C_se<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">u</span><span class="main">,</span> <span class="bound">p</span><span class="main">)</span><span class="main">.</span> <span class="free">dist</span> <span class="bound">u</span> <span class="main">≠</span> <span class="main">∞</span> <span class="main">∧</span> awalk <span class="bound">u</span> <span class="bound">p</span> <span class="bound">u</span> <span class="main">∧</span> awalk_cost <span class="free">c</span> <span class="bound">p</span> <span class="main">&lt;</span> <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> int_neg_cyc<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="free">dist</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span> <span class="main">⟹</span> 
      <span class="main">(</span>fst <span class="main">`</span> <span class="free">C</span><span class="main">)</span> <span class="main">∩</span> pwalk_verts <span class="bound">v</span>  <span class="main">≠</span> <span class="main">{}</span>"</span></span>

<span class="keyword1"><span class="command">locale</span></span> shortest_paths_locale_step2_pred <span class="main">=</span> 
  shortest_paths_locale_step1 <span class="main">+</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">pred</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> option"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> bj<span class="main">:</span> <span class="quoted"><span class="quoted">"basic_just_sp_pred <span class="free">G</span> <span class="free">dist</span> <span class="free">c</span> <span class="free">s</span> enum <span class="free">pred</span>"</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> source_val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> verts <span class="free">G</span><span class="main">.</span> enum <span class="bound">v</span> <span class="main">≠</span> <span class="main">∞</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">dist</span> <span class="free">s</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> no_edge_Vm_Vf<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">⟹</span> <span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">-</span> <span class="main">∞</span> <span class="main">⟹</span> <span class="main">∀</span> <span class="bound">r</span><span class="main">.</span> <span class="free">dist</span> <span class="main">(</span>head <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">≠</span> ereal <span class="bound">r</span>"</span></span>
<span class="comment1">(*
sublocale shortest_paths_locale_step2_pred ⊆ shortest_paths_locale_step2
using shortest_paths_locale_step2_pred_axioms 
unfolding shortest_paths_locale_step2_pred_def 
   shortest_paths_locale_step2_pred_axioms_def 
   shortest_paths_locale_step2_def 
   shortest_paths_locale_step2_axioms_def
try0
*)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_paths_locale_step1<span class="main">)</span> num_s_is_min<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="free">v</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> parent_num_assms<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_paths_locale_step1<span class="main">)</span> path_from_root_Vr_ex<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> tail <span class="free">G</span> <span class="bound">e</span> <span class="main">∧</span>
          <span class="bound">e</span> <span class="main">∈</span> arcs <span class="free">G</span> <span class="main">∧</span> head <span class="free">G</span> <span class="bound">e</span> <span class="main">=</span> <span class="free">v</span> <span class="main">∧</span> <span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span> <span class="main">∧</span>
          <span class="free">parent_edge</span> <span class="free">v</span> <span class="main">=</span> Some <span class="bound">e</span> <span class="main">∧</span> <span class="free">num</span> <span class="free">v</span> <span class="main">=</span> <span class="free">num</span> <span class="main">(</span>tail <span class="free">G</span> <span class="bound">e</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="free">v</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="quasi_keyword">arbitrary</span> <span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> 0
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> ee<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">parent_edge</span> <span class="skolem">v</span> <span class="main">=</span> Some <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">num</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> parent_num_assms<span class="main">[</span><span class="operator">OF</span> 0<span class="main"><span class="main">(</span></span>2-4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="free">s</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> num_s_is_min<span class="main">[</span><span class="operator">OF</span> tail_in_verts <span class="main"><span class="main">[</span></span><span class="operator">OF</span> ee<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> _ ee<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> 
    ee<span class="main">(</span>5<span class="main">)</span> 0<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ee <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> ee<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">parent_edge</span> <span class="skolem">v</span> <span class="main">=</span> Some <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">num</span> <span class="skolem">v</span> <span class="main">=</span> <span class="free">num</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> parent_num_assms<span class="main">[</span><span class="operator">OF</span> Suc<span class="main"><span class="main">(</span></span>3-5<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ss<span class="main">:</span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">≠</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> num_s_is_min tail_in_verts
    Suc<span class="main">(</span>2<span class="main">)</span> s_assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> nst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">=</span> <span class="free">num</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ee<span class="main">(</span>5<span class="main">)</span> Suc<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> reach<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> tail <span class="free">G</span> <span class="skolem">e'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    e'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="skolem">e'</span> <span class="main">=</span> tail <span class="free">G</span> <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e'</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> nst tail_in_verts<span class="main"><span class="main">[</span></span><span class="operator">OF</span> ee<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span> ss ee<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> tail <span class="free">G</span> <span class="skolem">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> arc_implies_awalk reachable_awalk reachable_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> e' ee <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_paths_locale_step1<span class="main">)</span> path_from_root_Vr<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">=</span> <span class="free">s</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> tail <span class="free">G</span> <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> arcs <span class="free">G</span>"</span></span> <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> path_from_root_Vr_ex<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> False assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">→<span class="hidden">⇧</span><sup>*</sup></span> tail <span class="free">G</span> <span class="skolem">e</span>"</span></span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="skolem">e</span> <span class="main">→</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> in_arcs_imp_in_arcs_ends<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> reachable_adj_trans<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_paths_locale_step1<span class="main">)</span> μ_V_less_inf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms path_from_root_Vr μ_reach_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_paths_locale_step2<span class="main">)</span> enum_not0<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">≠</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"enum <span class="free">v</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"enum <span class="free">v</span> <span class="main">≠</span> enat <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> parent_num_assms<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">,</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">unfolding</span></span> enum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_paths_locale_step2<span class="main">)</span> dist_Vf_μ<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> vG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="free">dist</span> <span class="free">v</span> <span class="main">=</span> ereal <span class="bound">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">=</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> ds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">s</span> <span class="main">=</span>  <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms source_val <span class="keyword1"><span class="command">unfolding</span></span> enum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> ews<span class="main">:</span><span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="main">[]</span> <span class="free">s</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> s_assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> awalk_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> mu<span class="main">:</span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">s</span> <span class="main">=</span> ereal <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> min_cost_le_walk_cost<span class="main">[</span><span class="operator">OF</span> ews<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> c<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">c</span></span><span class="main">]</span> 
    awalk_cost_Nil ds  dist_le_μ<span class="main">[</span><span class="operator">OF</span> s_assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> zero_ereal_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> ds assms dist_le_μ<span class="main">[</span><span class="operator">OF</span> vG<span class="main">]</span> 
    dist_ge_μ<span class="main">[</span><span class="operator">OF</span> vG _ _ mu ds enum_not0<span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> enum_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_paths_locale_step1<span class="main">)</span> pwalk_awalk<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="main">(</span>pwalk <span class="free">v</span><span class="main">)</span> <span class="free">v</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">=</span><span class="free">s</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">using</span></span> assms pwalk.simps<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">v</span></span><span class="main">]</span> 
    awalk_Nil_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span> 
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> pwalk.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"the <span class="main">(</span><span class="free">parent_edge</span> <span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?u</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"tail <span class="free">G</span> <span class="var">?e</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> ewu<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">=</span> <span class="free">s</span> <span class="main">∨</span> <span class="free">dist</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">∨</span> <span class="skolem">v</span> <span class="main">∉</span> verts <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> 
                 <span class="var">?u</span> <span class="main">∈</span> verts <span class="free">G</span> <span class="main">⟹</span> <span class="free">dist</span> <span class="var">?u</span> <span class="main">≠</span> <span class="main">∞</span> <span class="main">⟹</span> 
                 awalk <span class="free">s</span> <span class="main">(</span>pwalk <span class="var">?u</span><span class="main">)</span> <span class="var">?u</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> vG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> dv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="skolem">v</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="main">(</span>pwalk <span class="skolem">v</span><span class="main">)</span> <span class="skolem">v</span> "</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="free">s</span> <span class="main">∨</span> <span class="free">dist</span> <span class="skolem">v</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">∨</span> <span class="skolem">v</span> <span class="main">∉</span> verts <span class="free">G</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command">using</span></span> pwalk.simps vG dv 
        awalk_Nil_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span>  <span class="keyword2"><span class="keyword">where</span></span> ee<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span>arcs <span class="free">G</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="free">parent_edge</span> <span class="skolem">v</span> <span class="main">=</span> Some <span class="skolem">e</span>"</span></span> 
        <span class="quoted"><span class="quoted">"head <span class="free">G</span> <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> 
        <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> parent_num_assms False <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="main">(</span>pwalk <span class="var">?u</span><span class="main">)</span> <span class="var">?u</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ewu<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> tail_in_verts <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="main">(</span>pwalk <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ee<span class="main">(</span>1-3<span class="main">)</span> vG
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> awalk_simps <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> pwalk.simps<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pwalk <span class="main">(</span>tail <span class="free">G</span> <span class="skolem">e</span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="skolem">e</span><span class="main">]</span> <span class="main">=</span> pwalk <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> False ee<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> pwalk.simps<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> v<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">v</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_paths_locale_step3<span class="main">)</span> μ_ninf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">=</span> <span class="main">-</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span> <span class="main">=</span> <span class="main">-</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"awalk <span class="free">s</span> <span class="main">(</span>pwalk <span class="free">v</span><span class="main">)</span> <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> pwalk_awalk assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> ww<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="free">C</span> <span class="main">∩</span> pwalk_verts <span class="free">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> int_neg_cyc<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
     <span class="quoted"><span class="quoted">"awalk <span class="skolem">w</span> <span class="skolem">q</span> <span class="skolem">w</span>"</span></span> 
     <span class="quoted"><span class="quoted">"awalk_cost <span class="free">c</span> <span class="skolem">q</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> C_se <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">moreover</span></span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">∈</span> set <span class="main">(</span>awalk_verts <span class="free">s</span> <span class="main">(</span>pwalk <span class="free">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ww <span class="keyword1"><span class="command">unfolding</span></span> pwalk_verts_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span>  neg_cycle_imp_inf_μ <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> shortest_paths_locale_step3<span class="main">)</span> correct_shortest_path<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">v</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> verts <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">=</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span>"</span></span><span class="main">)</span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">⋀</span><span class="bound">r</span><span class="main">.</span> <span class="free">dist</span> <span class="free">v</span> <span class="main">=</span> ereal <span class="bound">r</span> <span class="main">⟹</span> <span class="free">dist</span> <span class="free">v</span> <span class="main">=</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> dist_Vf_μ<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟹</span> <span class="free">dist</span> <span class="free">v</span> <span class="main">=</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> μ_V_less_inf<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> 
  dist_le_μ<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">dist</span> <span class="free">v</span> <span class="main">=</span> <span class="main">-</span><span class="main">∞</span> <span class="main">⟹</span> <span class="free">dist</span> <span class="free">v</span> <span class="main">=</span> μ <span class="free">c</span> <span class="free">s</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> μ_ninf<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div>