<div id="Functional_Spaces">
<div class="head">
<h1>Theory Functional_Spaces</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:  Sébastien Gouëzel   sebastien.gouezel@univ-rennes1.fr
    License: BSD
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Functional_Spaces
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../../HOL/HOL-Analysis/Analysis.html">HOL-Analysis.Analysis</a>"</span> <a href="../Ergodic_Theory/SG_Library_Complement.html">Ergodic_Theory.SG_Library_Complement</a>
<span class="keyword2"><span class="keyword">begin</span></span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Functions as a real vector space›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Many functional spaces are spaces of functions. To be able to use the following
framework, spaces of functions thus need to be endowed with a vector space
structure, coming from pointwise addition and multiplication.

Some instantiations for \verb+fun+ are already given in \verb+Lattices.thy+, we add several.›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> <span class="quoted">"fun"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">,</span> <span class="quoted">plus</span><span class="main">)</span> <span class="quoted">plus</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> plus_fun_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> plus_apply <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span> <span class="main">+</span> <span class="free">g</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">f</span> <span class="free">x</span> <span class="main">+</span> <span class="free">g</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹\verb+minus_fun+ is already defined, in \verb+Lattices.thy+, but under the strange name
\verb+fun_Compl_def+. We restate the definition so that \verb+unfolding minus_fun_def+ works.
Same thing for \verb+minus_fun_def+. A better solution would be to have a coherent naming scheme
in \verb+Lattices.thy+.›</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> uminus_fun_def <span class="main">=</span> fun_Compl_def
<span class="keyword1"><span class="command">lemmas</span></span> minus_fun_def <span class="main">=</span> fun_diff_def

<span class="keyword1"><span class="command">instantiation</span></span> <span class="quoted">"fun"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">,</span> <span class="quoted">zero</span><span class="main">)</span> <span class="quoted">zero</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> zero_fun_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_fun <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">code</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_fun_def<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span><span class="keyword1"><span class="command">..</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span><span class="main">::</span><span class="main">(</span><span class="quoted">type</span><span class="main">,</span> <span class="quoted">semigroup_add</span><span class="main">)</span> <span class="quoted">semigroup_add</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.assoc<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span><span class="main">::</span><span class="main">(</span><span class="quoted">type</span><span class="main">,</span> <span class="quoted">ab_semigroup_add</span><span class="main">)</span> <span class="quoted">ab_semigroup_add</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_ac<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span><span class="main">::</span><span class="main">(</span><span class="quoted">type</span><span class="main">,</span> <span class="quoted">monoid_add</span><span class="main">)</span> <span class="quoted">monoid_add</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span><span class="main">::</span><span class="main">(</span><span class="quoted">type</span><span class="main">,</span> <span class="quoted">comm_monoid_add</span><span class="main">)</span> <span class="quoted">comm_monoid_add</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> fun_sum_apply<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">u</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>comm_monoid_add<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>sum <span class="free">u</span> <span class="free">I</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="free">u</span> <span class="bound">i</span> <span class="free">x</span><span class="main">)</span> <span class="free">I</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span><span class="main">::</span><span class="main">(</span><span class="quoted">type</span><span class="main">,</span> <span class="quoted">cancel_semigroup_add</span><span class="main">)</span> <span class="quoted">cancel_semigroup_add</span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span> <span class="main">=</span> <span class="skolem">a</span> <span class="main">+</span> <span class="skolem">c</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">b</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">a</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">c</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> plus_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">a</span> <span class="skolem">c</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">+</span> <span class="skolem">a</span> <span class="main">=</span> <span class="skolem">c</span> <span class="main">+</span> <span class="skolem">a</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">a</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">c</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">a</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> plus_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span><span class="main">::</span><span class="main">(</span><span class="quoted">type</span><span class="main">,</span> <span class="quoted">cancel_ab_semigroup_add</span><span class="main">)</span> <span class="quoted">cancel_ab_semigroup_add</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ext<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_diff_add<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span><span class="main">::</span><span class="main">(</span><span class="quoted">type</span><span class="main">,</span> <span class="quoted">cancel_comm_monoid_add</span><span class="main">)</span> <span class="quoted">cancel_comm_monoid_add</span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">standard</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span><span class="main">::</span><span class="main">(</span><span class="quoted">type</span><span class="main">,</span> <span class="quoted">group_add</span><span class="main">)</span> <span class="quoted">group_add</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="quoted">"fun"</span><span class="main">::</span><span class="main">(</span><span class="quoted">type</span><span class="main">,</span> <span class="quoted">ab_group_add</span><span class="main">)</span> <span class="quoted">ab_group_add</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">instantiation</span></span> <span class="quoted">"fun"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">type</span><span class="main">,</span> <span class="quoted">real_vector</span><span class="main">)</span> <span class="quoted">real_vector</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">scaleR_fun</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"real <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">scaleR_fun</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">c</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> scaleR_apply <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="free">f</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_fun_def<span class="main">)</span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_add_right scaleR_add_left<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">lemmas</span></span> divideR_apply <span class="main">=</span> scaleR_apply

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> zero_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> borel_measurable_const_scaleR' <span class="main">[</span><span class="operator">measurable</span> <span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">raw</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>real_normed_vector<span class="main">)</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="free">M</span> <span class="main">⟹</span> <span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> scaleR_fun_def <span class="keyword1"><span class="command">using</span></span> borel_measurable_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> borel_measurable_add'<span class="main">[</span><span class="operator">measurable</span> <span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">raw</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>second_countable_topology<span class="main">,</span> real_normed_vector<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">+</span> <span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> plus_fun_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> borel_measurable_uminus'<span class="main">[</span><span class="operator">measurable</span> <span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">raw</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>second_countable_topology<span class="main">,</span> real_normed_vector<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fun_Compl_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> borel_measurable_diff'<span class="main">[</span><span class="operator">measurable</span> <span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">raw</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span> <span class="free">g</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>second_countable_topology<span class="main">,</span> real_normed_vector<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">-</span> <span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> fun_diff_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> borel_measurable_sum'<span class="main">[</span><span class="operator">measurable</span> <span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="quasi_keyword"><span class="quasi_keyword"><span class="quasi_keyword">raw</span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'i</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span><span class="main">{</span>second_countable_topology<span class="main">,</span> real_normed_vector<span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">f</span> <span class="bound">i</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">f</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> borel_measurable_sum<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">I</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">,</span> <span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> fun_sum_apply<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_applied_to <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>real_vector<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> zero_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Quasinorms on function spaces›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A central feature of modern analysis is the use of various functional
spaces, and of results of functional analysis on them. Think for instance of
$L^p$ spaces, of Sobolev or Besov spaces, or variations around them. Here are
several relevant facts about this point of view:
\begin{itemize}
\item These spaces typically depend on one or several parameters.
This makes it difficult to play with type classes in a system without dependent
types.
\item The $L^p$ spaces are not spaces of functions (their elements are
equivalence classes of functions, where two functions are identified if they
coincide almost everywhere). However, in usual analysis proofs, one takes a
definite representative and works with it, never going to the equivalence class
point of view (which only becomes relevant when one wants to use the fact that
one has a Banach space at our disposal, to apply functional analytic tools).
\item It is important to describe how the spaces are related to each other,
with respect to inclusions or compact inclusions. For instance, one of the most
important theorems in analysis is Sobolev embedding theorem, describing when
one Sobolev space is included in another one. One also needs to be able to
take intersections or sums of Banach spaces, for instance to develop
interpolation theory.
\item Some other spaces play an important role in analysis, for instance the
weak $L^1$ space. This space only has a quasi-norm (i.e., its norm satisfies the
triangular inequality up to a fixed multiplicative constant). A general enough setting
should also encompass this kind of space. (One could argue that one should also consider more
general topologies such as Frechet spaces, to deal with Gevrey or analytic functions.
This is true, but considering quasi-norms already gives a wealth of applications).
\end{itemize}

Given these points, it seems that the most effective way of formalizing this
kind of question in Isabelle/HOL is to think of such a functional space not as
an abstract space or type, but as a subset of the space of all functions or of
all distributions. Functions that do not belong to the functional space
under consideration will then have infinite norm. Then inclusions, intersections,
and so on, become trivial to implement. Since the same object contains both the information
about the norm and the space where the norm is finite, it conforms to the customary habit in
mathematics of identifying the two of them, talking for instance about the $L^p$ space and the
$L^p$ norm.

All in all, this approach seems quite promising for ``real life analysis''.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of quasinorms›</span></span>

<span class="keyword1"><span class="command">typedef</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">overloaded</span></span><span class="main">)</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span><span class="quoted">real_vector</span><span class="main">)</span> quasinorm <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">C</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">N</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> ennreal<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">N</span> <span class="main">(</span><span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="main">¦</span><span class="bound">c</span><span class="main">¦</span> <span class="main">*</span> <span class="bound">N</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">N</span><span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">C</span> <span class="main">*</span> <span class="bound">N</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">C</span> <span class="main">*</span> <span class="bound">N</span> <span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">morphisms</span></span> Rep_quasinorm quasinorm_of
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">(</span><span class="bound">C</span><span class="main">::</span>real<span class="main">,</span> <span class="bound">N</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> ennreal<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">C</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span>
      <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">c</span><span class="main">.</span> <span class="bound">N</span> <span class="main">(</span><span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="main">¦</span><span class="bound">c</span><span class="main">¦</span> <span class="main">*</span> <span class="bound">N</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">N</span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">C</span> <span class="main">*</span> <span class="bound">N</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">C</span> <span class="main">*</span> <span class="bound">N</span> <span class="bound">y</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">eNorm</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> quasinorm <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> <span class="main">⇒</span> ennreal"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">eNorm</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span>snd <span class="main">(</span>Rep_quasinorm <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">defect</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> quasinorm <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">defect</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> fst <span class="main">(</span>Rep_quasinorm <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> eNorm_triangular_ineq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> defect <span class="free">N</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="free">x</span> <span class="main">+</span> defect <span class="free">N</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> eNorm_def defect_def <span class="keyword1"><span class="command">using</span></span> Rep_quasinorm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> defect_ge_1<span class="main">:</span>
  <span class="quoted"><span class="quoted">"defect <span class="free">N</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> defect_def <span class="keyword1"><span class="command">using</span></span> Rep_quasinorm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> eNorm_cmult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="main">¦</span><span class="free">c</span><span class="main">¦</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> eNorm_def <span class="keyword1"><span class="command">using</span></span> Rep_quasinorm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> eNorm_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eNorm_cmult abs_zero ennreal_0 mult_zero_left real_vector.scale_zero_left<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eNorm_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> eNorm <span class="free">N</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> eNorm_cmult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> eNorm_sum<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">=</span><span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="bound">v</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="bound">v</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="skolem">n</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="bound">v</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="skolem">n</span> <span class="main">*</span> ennreal<span class="main">(</span>defect <span class="free">N</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> defect_ge_1 ennreal_le_iff ennreal_neg ennreal_power less_le not_less not_one_le_zero semiring_normalization_rules<span class="main"><span class="main">(</span></span>28<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">i</span> <span class="main">=</span> <span class="skolem">n</span> <span class="keyword1">then</span> <span class="skolem">v</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="skolem">v</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..</span>Suc <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">v</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">v</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">v</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lessThan_Suc_atMost sum.lessThan_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">w</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">w</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> w_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..</span>Suc <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">v</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">w</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> lessThan_Suc_atMost sum.lessThan_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..</span>Suc <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">v</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">w</span> <span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">w</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="skolem">n</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Suc.IH <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="skolem">n</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> w_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>
          <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span>defect <span class="free">N</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> defect <span class="free">N</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> add_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> mult_left_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eNorm_triangular_ineq<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>
        <span class="main">+</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left semiring_normalization_rules<span class="main"><span class="main">(</span></span>18<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span>Suc <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..</span>Suc <span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">v</span> <span class="bound">i</span><span class="main">)</span>
            <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span>Suc <span class="skolem">n</span><span class="main">.</span> ennreal <span class="main">(</span>defect <span class="free">N</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> ennreal <span class="main">(</span>defect <span class="free">N</span> <span class="main">^</span> Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span>Suc <span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="free">u</span> <span class="bound">i</span><span class="main">)</span>
      <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="skolem">m</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lessThan_Suc_atMost <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">m</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> mult_right_mono ennreal_leI<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> defect_ge_1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> atMost_iff le_less lessThan_Suc_atMost lessThan_iff power_Suc power_increasing<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span>Suc <span class="skolem">m</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">&lt;</span><span class="free">n</span><span class="main">.</span> ennreal <span class="main">(</span>defect <span class="free">N</span> <span class="main">^</span> Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">n</span> <span class="main">=</span> Suc <span class="skolem">m</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Quasinorms are often defined by taking a meaningful formula on a vector subspace,
and then extending by infinity elsewhere. Let us show that this results in a quasinorm on the
whole space.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quasinorm_on</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> set<span class="main">)</span> <span class="main">⇒</span> real <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> <span class="main">⇒</span> ennreal<span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">quasinorm_on</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">(</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">(</span><span class="bound">x</span><span class="main">+</span><span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="bound">x</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="bound">y</span><span class="main">)</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">⟶</span> <span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span><span class="main">(</span><span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span><span class="bound">c</span><span class="main">¦</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="bound">x</span><span class="main">)</span>
    <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">≥</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">0</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_of<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> <span class="main">⇒</span> ennreal"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">C</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"quasinorm_on UNIV <span class="free">C</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>quasinorm_of <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">N</span> <span class="free">x</span>"</span></span>
        <span class="quoted"><span class="quoted">"defect <span class="main">(</span>quasinorm_of <span class="main">(</span><span class="free">C</span><span class="main">,</span><span class="free">N</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> eNorm_def defect_def quasinorm_on_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quasinorm_of_inverse<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_onI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">N</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> <span class="main">⇒</span> ennreal"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">C</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="free">F</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">N</span> <span class="main">(</span><span class="bound">x</span> <span class="main">+</span> <span class="bound">y</span><span class="main">)</span> <span class="main">≤</span> <span class="free">C</span> <span class="main">*</span> <span class="free">N</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">C</span> <span class="main">*</span> <span class="free">N</span> <span class="bound">y</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">N</span> <span class="main">(</span><span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">¦</span><span class="bound">c</span><span class="main">¦</span> <span class="main">*</span> <span class="free">N</span> <span class="bound">x</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quasinorm_on <span class="free">F</span> <span class="free">C</span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">*</span> <span class="free">N</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">N</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span><span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">(</span>abs <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">N</span> <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">c</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">N</span><span class="main">(</span><span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">¦</span><span class="bound">c</span><span class="main">¦</span> <span class="main">*</span> <span class="free">N</span> <span class="bound">x</span>›</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> False assms that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="skolem">x</span> <span class="main">≤</span> ennreal <span class="main">(</span>abs <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">N</span> <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">*</span> <span class="free">N</span> <span class="skolem">x</span> <span class="main">≤</span> ennreal <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">*</span> ennreal <span class="main">(</span>abs <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="free">N</span> <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc mult_left_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="free">N</span> <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ennreal_mult' abs_mult False
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_ge_zero abs_one comm_monoid_mult_class.mult_1 ennreal_1 eq_divide_eq_1 field_class.field_divide_inverse<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">c</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">c</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">⟹</span> <span class="free">N</span><span class="main">(</span><span class="bound">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">¦</span><span class="bound">c</span><span class="main">¦</span> <span class="main">*</span> <span class="free">N</span> <span class="bound">x</span>›</span></span><span class="main">[</span><span class="operator">OF</span> False <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">F</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> quasinorm_on_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> real_vector.scale_zero_left<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> extend_quasinorm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"quasinorm_on <span class="free">F</span> <span class="free">C</span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"quasinorm_on UNIV <span class="free">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="keyword1">then</span> <span class="free">N</span> <span class="bound">x</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">F</span> <span class="keyword1">then</span> <span class="free">N</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span>
    <span class="main">≤</span> ennreal <span class="free">C</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="keyword1">then</span> <span class="free">N</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span> <span class="main">+</span> ennreal <span class="free">C</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">F</span> <span class="keyword1">then</span> <span class="free">N</span> <span class="skolem">y</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="main">∧</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">F</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> quasinorm_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> quasinorm_on_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"ennreal <span class="free">C</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="free">F</span> <span class="keyword1">then</span> <span class="free">N</span> <span class="skolem">x</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span> <span class="main">+</span> ennreal <span class="free">C</span> <span class="main">*</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">y</span> <span class="main">∈</span> <span class="free">F</span> <span class="keyword1">then</span> <span class="free">N</span> <span class="skolem">y</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ennreal_mult_eq_top_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> quasinorm_onI<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms * <span class="keyword1"><span class="command">unfolding</span></span> quasinorm_on_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ennreal_top_mult mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_zero ennreal_0 mult_zero_right real_vector.scale_zero_right<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The space and the zero space of a quasinorm›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The space of a quasinorm is the vector subspace where it is meaningful, i.e., finite.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">space<span class="hidden">⇩</span><sub>N</sub></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> quasinorm <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">space<span class="hidden">⇩</span><sub>N</sub></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="bound">f</span> <span class="main">&lt;</span> <span class="main">∞</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> spaceN_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="main">⟷</span> eNorm <span class="free">N</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> spaceN_cmult <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> spaceN_iff <span class="keyword1"><span class="command">using</span></span> eNorm_cmult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ennreal_mult_less_top<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> spaceN_add <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="free">x</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defect <span class="free">N</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="free">x</span> <span class="main">+</span> defect <span class="free">N</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="free">y</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ennreal_mult_less_top<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">using</span></span> eNorm_triangular_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> le_less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> spaceN_diff <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> spaceN_add<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> spaceN_cmult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> spaceN_contains_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> spaceN_sum <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">I</span> <span class="main">⟹</span> <span class="free">x</span> <span class="bound">i</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="free">I</span><span class="main">.</span> <span class="free">x</span> <span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">I</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> infinite_finite_induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The zero space of a quasinorm is the vector subspace of vectors with zero norm. If one wants
to get a true metric space, one should quotient the space by the zero space.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">zero_space<span class="hidden">⇩</span><sub>N</sub></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> quasinorm <span class="main">⇒</span> <span class="tfree">'a</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">zero_space<span class="hidden">⇩</span><sub>N</sub></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="bound">f</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_spaceN_iff<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="main">⟷</span> eNorm <span class="free">N</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> zero_space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_spaceN_cmult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> zero_spaceN_iff <span class="keyword1"><span class="command">using</span></span> eNorm_cmult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_spaceN_add<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> zero_space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defect <span class="free">N</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="free">x</span> <span class="main">+</span> defect <span class="free">N</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="free">y</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> zero_spaceN_iff <span class="keyword1"><span class="command">using</span></span> eNorm_triangular_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> zero_spaceN_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">-</span> <span class="free">y</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> zero_spaceN_add<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> zero_spaceN_cmult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_spaceN_subset_spaceN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="main">⊆</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spaceN_iff zero_spaceN_iff subset_eq<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹On the space, the norms are finite. Hence, it is much more convenient to work there with
a real valued version of the norm. We use Norm with a capital N to distinguish it from norms
in a (type class) banach space.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Norm</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> quasinorm <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Norm</span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> enn2real <span class="main">(</span>eNorm <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Norm_nonneg <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Norm <span class="free">N</span> <span class="free">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Norm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Norm_zero <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Norm <span class="free">N</span> <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Norm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Norm_uminus <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"Norm <span class="free">N</span> <span class="main">(</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> Norm <span class="free">N</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Norm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> eNorm_Norm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="free">x</span> <span class="main">=</span> ennreal <span class="main">(</span>Norm <span class="free">N</span> <span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Norm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spaceN_iff<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> eNorm_Norm'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Norm <span class="free">N</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Norm_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spaceN_iff<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> top.not_eq_extremum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> Norm_cmult<span class="main">:</span>
  <span class="quoted"><span class="quoted">"Norm <span class="free">N</span> <span class="main">(</span><span class="free">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> abs <span class="free">c</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> Norm_def <span class="keyword1"><span class="command">unfolding</span></span> eNorm_cmult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enn2real_mult<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Norm_triangular_ineq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Norm <span class="free">N</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> defect <span class="free">N</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="free">x</span> <span class="main">+</span> defect <span class="free">N</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"defect <span class="free">N</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="free">x</span> <span class="main">+</span> defect <span class="free">N</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="free">y</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">*</span> <span class="main">0</span> <span class="main">+</span> <span class="main">1</span> <span class="main">*</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_mono<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> defect_ge_1 Norm_nonneg<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span>Norm <span class="free">N</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> spaceN_add<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms True<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> defect <span class="free">N</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="free">x</span> <span class="main">+</span> defect <span class="free">N</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="free">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eNorm_triangular_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> defect <span class="free">N</span> <span class="main">*</span> ennreal<span class="main">(</span>Norm <span class="free">N</span> <span class="free">x</span><span class="main">)</span> <span class="main">+</span> defect <span class="free">N</span> <span class="main">*</span> ennreal<span class="main">(</span>Norm <span class="free">N</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eNorm_Norm assms True <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ennreal<span class="main">(</span>defect <span class="free">N</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="free">x</span> <span class="main">+</span> defect <span class="free">N</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="free">y</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ennreal_mult ennreal_plus Norm_nonneg defect_ge_1
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> ennreal_eq_0_iff less_le ennreal_ge_1 ennreal_mult' le_less_linear not_one_le_zero semiring_normalization_rules<span class="main"><span class="main">(</span></span>34<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_le_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">∉</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">∉</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> spaceN_diff<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">x</span> <span class="main">+</span> <span class="free">y</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>›</span></span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="free">N</span> <span class="main">(</span><span class="free">x</span><span class="main">+</span><span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Norm_def <span class="keyword1"><span class="command">using</span></span> spaceN_iff top.not_eq_extremum <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"defect <span class="free">N</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="free">x</span> <span class="main">+</span> defect <span class="free">N</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="free">y</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">*</span> <span class="main">0</span> <span class="main">+</span> <span class="main">1</span> <span class="main">*</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_mono<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> defect_ge_1 Norm_nonneg<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Norm_triangular_ineq_diff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Norm <span class="free">N</span> <span class="main">(</span><span class="free">x</span> <span class="main">-</span> <span class="free">y</span><span class="main">)</span> <span class="main">≤</span> defect <span class="free">N</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="free">x</span> <span class="main">+</span> defect <span class="free">N</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="free">y</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> Norm_triangular_ineq<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">-</span><span class="free">y</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> zero_spaceN_iff'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="main">∧</span> Norm <span class="free">N</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> eNorm_Norm <span class="keyword1"><span class="command">unfolding</span></span> space<span class="hidden">⇩</span><sub>N</sub>_def zero_space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Norm_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Norm_sum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> <span class="bound">i</span> <span class="main">&lt;</span> <span class="free">n</span> <span class="main">⟹</span> <span class="free">u</span> <span class="bound">i</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Norm <span class="free">N</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> defect <span class="free">N</span> <span class="main">*</span> defect <span class="free">N</span> <span class="main">^</span> <span class="skolem">i</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">i</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> Norm_nonneg defect_ge_1 dual_order.trans linear mult_nonneg_nonneg not_one_le_zero zero_le_power<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span>Norm <span class="free">N</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">u</span> <span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eNorm_Norm<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> spaceN_sum<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eNorm_sum <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> ennreal <span class="main">(</span>Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> ennreal<span class="main">(</span><span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_mult''<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sum_ennreal <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span>Norm <span class="free">N</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="free">n</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span>defect <span class="free">N</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">i</span><span class="main">)</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_le_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> sum_nonneg<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹An example: the ambient norm in a normed vector space›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">N_of_norm</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span><span class="main">::</span>real_normed_vector quasinorm"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">N_of_norm</span> <span class="main">=</span> quasinorm_of <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">f</span><span class="main">.</span> norm <span class="bound">f</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> N_of_norm<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eNorm N_of_norm <span class="free">f</span> <span class="main">=</span> ennreal <span class="main">(</span>norm <span class="free">f</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"Norm N_of_norm <span class="free">f</span> <span class="main">=</span> norm <span class="free">f</span>"</span></span>
  <span class="quoted"><span class="quoted">"defect <span class="main">(</span>N_of_norm<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"quasinorm_on UNIV <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> norm <span class="bound">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quasinorm_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ennreal_mult'<span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> ennreal_leI ennreal_plus norm_imp_pos_and_ge norm_triangle_ineq<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm N_of_norm <span class="free">f</span> <span class="main">=</span> ennreal <span class="main">(</span>norm <span class="free">f</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"defect <span class="main">(</span>N_of_norm<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> N_of_norm_def <span class="keyword1"><span class="command">using</span></span> quasinorm_of<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm N_of_norm <span class="free">f</span> <span class="main">=</span> norm <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Norm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> N_of_norm_space <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> N_of_norm <span class="main">=</span> UNIV"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">unfolding</span></span> N_of_norm<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> N_of_norm_zero_space <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"zero_space<span class="hidden">⇩</span><sub>N</sub> N_of_norm <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> zero_space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">unfolding</span></span> N_of_norm<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹An example: the space of bounded continuous functions from a topological space to a normed
real vector space›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The Banach space of bounded continuous functions is defined in
\verb+Bounded_Continuous_Function.thy+, as a type \verb+bcontfun+. We import very quickly the
results proved in this file to the current framework.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">bcontfun<span class="hidden">⇩</span><sub>N</sub></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>topological_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>real_normed_vector<span class="main">)</span> quasinorm"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">bcontfun<span class="hidden">⇩</span><sub>N</sub></span> <span class="main">=</span> quasinorm_of <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">f</span> <span class="main">∈</span> bcontfun <span class="keyword1">then</span> norm<span class="main">(</span>Bcontfun <span class="bound">f</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">∞</span><span class="main">::</span>ennreal<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub><span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>topological_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>real_normed_vector<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eNorm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">f</span> <span class="main">∈</span> bcontfun <span class="keyword1">then</span> norm<span class="main">(</span>Bcontfun <span class="free">f</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">∞</span><span class="main">::</span>ennreal<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">f</span> <span class="main">∈</span> bcontfun <span class="keyword1">then</span> norm<span class="main">(</span>Bcontfun <span class="free">f</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"defect <span class="main">(</span>bcontfun<span class="hidden">⇩</span><sub>N</sub><span class="main">::</span><span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> quasinorm<span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"quasinorm_on bcontfun <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> norm<span class="main">(</span>Bcontfun <span class="bound">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> quasinorm_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> bcontfun"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> bcontfun"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">∈</span> bcontfun"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> plus_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_cont<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Bcontfun<span class="main">(</span><span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> Bcontfun <span class="skolem">f</span> <span class="main">+</span> Bcontfun <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_onp_def plus_fun_def bcontfun_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> plus_bcontfun.abs_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span>norm <span class="main">(</span>Bcontfun <span class="main">(</span><span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">(</span>norm <span class="main">(</span>Bcontfun <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> ennreal <span class="main">(</span>norm <span class="main">(</span>Bcontfun <span class="skolem">g</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">using</span></span> ennreal_leI<span class="main">[</span><span class="operator">OF</span> norm_triangle_ineq<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> bcontfun"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f</span> <span class="main">∈</span> bcontfun"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> scaleR_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> scaleR_cont<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Bcontfun<span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> Bcontfun <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eq_onp_def scaleR_fun_def bcontfun_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> scaleR_bcontfun.abs_eq<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span>norm <span class="main">(</span>Bcontfun <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">*</span> ennreal <span class="main">(</span>norm <span class="main">(</span>Bcontfun <span class="skolem">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ennreal_mult''<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'b</span><span class="main">)</span> <span class="main">∈</span> bcontfun"</span></span> <span class="quoted"><span class="quoted">"Bcontfun <span class="main">0</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> zero_fun_def zero_bcontfun_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> const_bcontfun<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"quasinorm_on UNIV <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span><span class="tfree">'b</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">f</span> <span class="main">∈</span> bcontfun <span class="keyword1">then</span> norm<span class="main">(</span>Bcontfun <span class="bound">f</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">∞</span><span class="main">::</span>ennreal<span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> extend_quasinorm<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">f</span> <span class="main">∈</span> bcontfun <span class="keyword1">then</span> norm<span class="main">(</span>Bcontfun <span class="free">f</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">∞</span><span class="main">::</span>ennreal<span class="main">)</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"defect <span class="main">(</span>bcontfun<span class="hidden">⇩</span><sub>N</sub><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> quasinorm<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> quasinorm_of<span class="main">[</span><span class="operator">OF</span> **<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">f</span> <span class="main">∈</span> bcontfun <span class="keyword1">then</span> norm<span class="main">(</span>Bcontfun <span class="free">f</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Norm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub>_space<span class="main">:</span>
  <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="main">=</span> bcontfun"</span></span>
<span class="keyword1"><span class="command">using</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub><span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Collect_cong bcontfun_def enn2real_top ennreal_0
  ennreal_enn2real ennreal_less_top ennreal_zero_neq_top infinity_ennreal_def mem_Collect_eq space<span class="hidden">⇩</span><sub>N</sub>_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub>_zero_space<span class="main">:</span>
  <span class="quoted"><span class="quoted">"zero_space<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_spaceN_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Bcontfun_inject bcontfun<span class="hidden">⇩</span><sub>N</sub><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eNorm_zero ennreal_eq_zero_iff ennreal_zero_neq_top infinity_ennreal_def norm_eq_zero norm_imp_pos_and_ge<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub>D<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="free">f</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> norm<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> Norm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> bcontfun"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub>_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bcontfun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> norm<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> Norm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> norm_bounded bcontfun<span class="hidden">⇩</span><sub>N</sub><span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> bcontfun›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Bcontfun_inverse<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub>I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="free">f</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> norm<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub>"</span></span>
        <span class="quoted"><span class="quoted">"Norm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="free">f</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> bcontfun"</span></span> <span class="keyword1"><span class="command">using</span></span> assms bcontfun_normI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub>_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="free">f</span> <span class="main">≤</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> bcontfun›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> apply_bcontfun_cases apply_bcontfun_inverse norm_bound<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Continuous inclusions between functional spaces›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Continuous inclusions between functional spaces are now defined›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> quasinorm<span class="main">::</span> <span class="main">(</span><span class="quoted">real_vector</span><span class="main">)</span> <span class="quoted">preorder</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_eq_quasinorm</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> quasinorm <span class="main">⇒</span> <span class="tfree">'a</span> quasinorm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_eq_quasinorm</span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">C</span></span><span class="main">≥</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="bound">f</span> <span class="main">≤</span> <span class="bound">C</span> <span class="main">*</span> eNorm <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="bound">f</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">less_quasinorm</span></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> quasinorm <span class="main">⇒</span> <span class="tfree">'a</span> quasinorm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">less_quasinorm</span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">=</span> <span class="main">(</span>less_eq <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> less_eq <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">≤</span> <span class="skolem">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">N</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> quasinorm"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_eq_quasinorm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N1</span> <span class="main">≤</span> <span class="skolem">N3</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N1</span> <span class="main">≤</span> <span class="skolem">N2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N2</span> <span class="main">≤</span> <span class="skolem">N3</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">N1</span> <span class="skolem">N2</span> <span class="skolem">N3</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> quasinorm"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="skolem">N2</span> <span class="bound">f</span> <span class="main">≤</span> ennreal <span class="skolem">C</span> <span class="main">*</span> eNorm <span class="skolem">N1</span> <span class="bound">f</span>"</span></span>
                         <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="skolem">N3</span> <span class="bound">f</span> <span class="main">≤</span> ennreal <span class="skolem">C'</span> <span class="main">*</span> eNorm <span class="skolem">N2</span> <span class="bound">f</span>"</span></span>
                         <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C'</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N1</span> <span class="main">≤</span> <span class="skolem">N2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N2</span> <span class="main">≤</span> <span class="skolem">N3</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> less_eq_quasinorm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="skolem">N3</span> <span class="skolem">f</span> <span class="main">≤</span> ennreal <span class="skolem">C'</span> <span class="main">*</span> ennreal <span class="skolem">C</span> <span class="main">*</span> eNorm <span class="skolem">N1</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> *<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> *<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span></span></span><span class="main"><span class="main">]</span></span> mult.commute mult.left_commute mult_left_mono order_trans zero_le<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ennreal<span class="main">(</span><span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="skolem">N1</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C'</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> ennreal_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="skolem">N3</span> <span class="skolem">f</span> <span class="main">≤</span> ennreal<span class="main">(</span><span class="skolem">C'</span> <span class="main">*</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="skolem">N1</span> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> less_eq_quasinorm_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C'</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> zero_le_mult_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">OFCLASS</span><span class="main">(</span><span class="tfree">'a</span> quasinorm<span class="main">,</span> preorder_class<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>
    <span class="keyword1"><span class="command">unfolding</span></span> less_quasinorm_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">using</span></span> E <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">quasinorm_subset</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> quasinorm <span class="main">⇒</span> <span class="tfree">'a</span> quasinorm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">quasinorm_subset</span> <span class="main">≡</span> less"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">quasinorm_subset_eq</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> quasinorm <span class="main">⇒</span> <span class="tfree">'a</span> quasinorm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">quasinorm_subset_eq</span> <span class="main">≡</span> less_eq"</span></span>

<span class="keyword1"><span class="command">notation</span></span>
  quasinorm_subset <span class="main">(</span><span class="quoted">"<span class="keyword1">'(⊂<span class="hidden">⇩</span><sub>N</sub>')</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  quasinorm_subset <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">⊂<span class="hidden">⇩</span><sub>N</sub></span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  quasinorm_subset_eq <span class="main">(</span><span class="quoted">"<span class="keyword1">'(⊆<span class="hidden">⇩</span><sub>N</sub>')</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">and</span></span>
  quasinorm_subset_eq <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_<span class="keyword3">/ </span><span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>51<span class="main">,</span> 51<span class="main">]</span> 50<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> quasinorm_subsetD<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">C</span></span><span class="main">≥</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="free">N2</span> <span class="bound">f</span> <span class="main">≤</span> <span class="bound">C</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="bound">f</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> less_eq_quasinorm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_subsetI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span> <span class="main">⟹</span> eNorm <span class="free">N2</span> <span class="bound">f</span> <span class="main">≤</span> ennreal <span class="free">C</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="bound">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N2</span> <span class="skolem">f</span> <span class="main">≤</span> ennreal <span class="main">(</span>max <span class="free">C</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> dual_order.trans ennreal_leI max.cobounded2 max.commute
      mult.commute ordered_comm_semiring_class.comm_mult_left_mono zero_le<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> spaceN_iff
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ennreal_ge_1 ennreal_mult_less_top infinity_ennreal_def max.cobounded1
      max.commute not_le not_one_le_zero top.not_eq_extremum<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> less_eq_quasinorm_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ennreal_max_0' max.cobounded2<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_subsetI'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span> <span class="main">⟹</span> <span class="bound">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N2</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span> <span class="main">⟹</span> Norm <span class="free">N2</span> <span class="bound">f</span> <span class="main">≤</span> <span class="free">C</span> <span class="main">*</span> Norm <span class="free">N1</span> <span class="bound">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> quasinorm_subsetI<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N2</span> <span class="skolem">f</span> <span class="main">=</span> ennreal<span class="main">(</span>Norm <span class="free">N2</span> <span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eNorm_Norm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> ennreal<span class="main">(</span><span class="free">C</span> <span class="main">*</span> Norm <span class="free">N1</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span>›</span></span><span class="main">]</span> ennreal_leI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ennreal <span class="free">C</span> <span class="main">*</span> ennreal<span class="main">(</span>Norm <span class="free">N1</span> <span class="skolem">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ennreal_mult'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ennreal <span class="free">C</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N2</span> <span class="skolem">f</span> <span class="main">≤</span> ennreal <span class="free">C</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="skolem">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_subset_space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span> <span class="main">⊆</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> space<span class="hidden">⇩</span><sub>N</sub>_def less_eq_quasinorm_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> ennreal_mult_eq_top_iff ennreal_neq_top less_le top.extremum_strict top.not_eq_extremum<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_subset_Norm_eNorm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span> <span class="main">⟹</span> Norm <span class="free">N2</span> <span class="free">f</span> <span class="main">≤</span> <span class="free">C</span> <span class="main">*</span> Norm <span class="free">N1</span> <span class="free">f</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N2</span> <span class="free">f</span> <span class="main">≤</span> ennreal <span class="free">C</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quasinorm_subset_space<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">N1</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> eNorm_Norm assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Norm_nonneg ennreal_leI ennreal_mult''<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ennreal_eq_zero_iff ennreal_mult_eq_top_iff infinity_ennreal_def less_imp_le neq_top_trans not_le spaceN_iff<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_subset_zero_space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span> <span class="main">⊆</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> zero_space<span class="hidden">⇩</span><sub>N</sub>_def less_eq_quasinorm_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> le_zero_eq mult_zero_right<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We would like to define the equivalence relation associated to the above order, i.e., the
equivalence between norms. This is not equality, so we do not have a true order, but nevertheless
this is handy, and not standard in a preorder in Isabelle. The file Library/Preorder.thy defines
such an equivalence relation, but including it breaks some proofs so we go the naive way.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quasinorm_equivalent</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> quasinorm <span class="main">⇒</span> <span class="tfree">'a</span> quasinorm <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">=<span class="hidden">⇩</span><sub>N</sub></span>"</span> 60<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">quasinorm_equivalent</span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_equivalent_sym <span class="main">[</span><span class="operator">sym</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">N2</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N1</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> quasinorm_equivalent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_equivalent_trans <span class="main">[</span><span class="operator">trans</span><span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N2</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N3</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N3</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms order_trans <span class="keyword1"><span class="command">unfolding</span></span> quasinorm_equivalent_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The intersection and the sum of two functional spaces›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this paragraph, we define the intersection and the sum of two functional spaces.
In terms of the order introduced above, this corresponds to the minimum and the maximum.
More important, these are the first two examples of interpolation spaces between two
functional spaces, and they are central as all the other ones are built using them.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quasinorm_intersection</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> quasinorm <span class="main">⇒</span> <span class="tfree">'a</span> quasinorm <span class="main">⇒</span> <span class="tfree">'a</span> quasinorm"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">quasinorm_intersection</span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">=</span> quasinorm_of <span class="main">(</span>max <span class="main">(</span>defect <span class="free"><span class="bound"><span class="entity">N1</span></span></span><span class="main">)</span> <span class="main">(</span>defect <span class="free"><span class="bound"><span class="entity">N2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="bound">f</span> <span class="main">+</span> eNorm <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="bound">f</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_intersection<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span><span class="free">N1</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> eNorm <span class="free">N1</span> <span class="free">f</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="free">f</span>"</span></span>
  <span class="quoted"><span class="quoted">"defect <span class="main">(</span><span class="free">N1</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span>
    ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>eNorm <span class="free">N1</span> <span class="skolem">x</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>eNorm <span class="free">N1</span> <span class="skolem">y</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="skolem">x</span> <span class="main">+</span> ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eNorm_triangular_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N1</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> max_def distrib_left ennreal_leI mult_right_mono order_trans zero_le<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N2</span> <span class="skolem">x</span> <span class="main">+</span> ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N2</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eNorm_triangular_ineq<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N2</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="skolem">y</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> max_def max.commute distrib_left ennreal_leI mult_right_mono order_trans zero_le<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>eNorm <span class="free">N1</span> <span class="skolem">x</span> <span class="main">+</span> eNorm <span class="free">N1</span> <span class="skolem">y</span> <span class="main">+</span> <span class="main">(</span>eNorm <span class="free">N2</span> <span class="skolem">x</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mono_thms_linordered_semiring<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ab_semigroup_add_class.add_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add.left_commute distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">x</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">*</span> <span class="main">(</span>eNorm <span class="free">N1</span> <span class="skolem">x</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eNorm_cmult<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">N1</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span> eNorm_cmult<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free">N2</span></span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span> distrib_left<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"quasinorm_on UNIV <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="free">N1</span> <span class="bound">f</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> quasinorm_onI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> T H defect_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N1</span></span><span class="main">]</span> defect_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"defect <span class="main">(</span><span class="free">N1</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span><span class="free">N1</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> eNorm <span class="free">N1</span> <span class="free">f</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> quasinorm_intersection_def <span class="keyword1"><span class="command">using</span></span> quasinorm_of<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_intersection_commute<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span> <span class="main">=</span> <span class="free">N2</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N1</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> quasinorm_intersection_def max.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"defect <span class="free">N1</span>"</span></span><span class="main">]</span> add.commute<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N1</span> <span class="main">_</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_intersection_space<span class="main">:</span>
  <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span><span class="free">N1</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="main">=</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span> <span class="main">∩</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">unfolding</span></span> quasinorm_intersection<span class="main">(</span>1<span class="main">)</span> spaceN_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_intersection_zero_space<span class="main">:</span>
  <span class="quoted"><span class="quoted">"zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span><span class="free">N1</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="main">=</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span> <span class="main">∩</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N2</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">unfolding</span></span> quasinorm_intersection<span class="main">(</span>1<span class="main">)</span> zero_spaceN_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_eq_0_iff_both_eq_0<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_intersection_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quasinorm_subsetI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quasinorm_intersection<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_intersection_minimum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">N</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N1</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">C2</span></span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="free">N1</span> <span class="bound">f</span> <span class="main">≤</span> <span class="skolem">C1</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="bound">f</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="free">N2</span> <span class="bound">f</span> <span class="main">≤</span> <span class="skolem">C2</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="bound">f</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> quasinorm_subsetD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> quasinorm_subsetD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span><span class="free">N1</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">C1</span> <span class="main">+</span> <span class="skolem">C2</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
    <span class="keyword1"><span class="command">unfolding</span></span> quasinorm_intersection<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> add_mono<span class="main">[</span><span class="operator">OF</span> *<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> *<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_right *<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> quasinorm_subsetI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_intersection_assoc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">N1</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N3</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N1</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="main">(</span><span class="free">N2</span> <span class="keyword1">∩<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N3</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> quasinorm_equivalent_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> order_trans quasinorm_intersection_minimum quasinorm_intersection_subset<span class="main">)</span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">quasinorm_sum</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> quasinorm <span class="main">⇒</span> <span class="tfree">'a</span> quasinorm <span class="main">⇒</span> <span class="tfree">'a</span> quasinorm"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span>"</span> 70<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">quasinorm_sum</span> <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="main">=</span> quasinorm_of <span class="main">(</span>max <span class="main">(</span>defect <span class="free"><span class="bound"><span class="entity">N1</span></span></span><span class="main">)</span> <span class="main">(</span>defect <span class="free"><span class="bound"><span class="entity">N2</span></span></span><span class="main">)</span><span class="main">,</span> <span class="main">λ</span><span class="bound">f</span><span class="main">.</span> Inf <span class="main">{</span>eNorm <span class="free"><span class="bound"><span class="entity">N1</span></span></span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free"><span class="bound"><span class="entity">N2</span></span></span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="bound">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_sum<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="free">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span>"</span></span>
  <span class="quoted"><span class="quoted">"defect <span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="bound">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">(</span><span class="skolem">f</span><span class="main">+</span><span class="skolem">g</span><span class="main">)</span> <span class="main">≤</span>
    ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">N</span> <span class="skolem">f</span> <span class="main">+</span> ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">N</span> <span class="skolem">g</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">g</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">u</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">⇢</span> Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_as_limit<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uf</span></span> <span class="keyword2"><span class="keyword">where</span></span> uf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">uf</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span>"</span></span>
                             <span class="quoted"><span class="quoted">"<span class="skolem">uf</span> <span class="main">⇢</span> Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">uf</span> <span class="bound">n</span> <span class="main">=</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="bound">f1</span> <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="bound">f2</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">f2</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SMT.choices<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> uf<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f1</span></span> <span class="skolem"><span class="skolem">f2</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">uf</span> <span class="bound">n</span> <span class="main">=</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">f1</span> <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">f2</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f1</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">f2</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">u</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">g1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">g2</span><span class="main">|</span> <span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">=</span> <span class="bound">g1</span> <span class="main">+</span> <span class="bound">g2</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">⇢</span> Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">g1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">g2</span><span class="main">|</span> <span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">=</span> <span class="bound">g1</span> <span class="main">+</span> <span class="bound">g2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_as_limit<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">g</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ug</span></span> <span class="keyword2"><span class="keyword">where</span></span> ug<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ug</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">g1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">g2</span><span class="main">|</span> <span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">=</span> <span class="bound">g1</span> <span class="main">+</span> <span class="bound">g2</span><span class="main">}</span>"</span></span>
                             <span class="quoted"><span class="quoted">"<span class="skolem">ug</span> <span class="main">⇢</span> Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">g1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">g2</span><span class="main">|</span> <span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">=</span> <span class="bound">g1</span> <span class="main">+</span> <span class="bound">g2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g1</span> <span class="bound">g2</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ug</span> <span class="bound">n</span> <span class="main">=</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="bound">g1</span> <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="bound">g2</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">g</span> <span class="main">=</span> <span class="bound">g1</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">g2</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SMT.choices<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ug<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g1</span></span> <span class="skolem"><span class="skolem">g2</span></span> <span class="keyword2"><span class="keyword">where</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">ug</span> <span class="bound">n</span> <span class="main">=</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">g1</span> <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">g2</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">g1</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">g2</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h1</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f1</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">g1</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f2</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">g2</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">=</span> <span class="skolem">h1</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">h2</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">unfolding</span></span> h1_def h2_def <span class="keyword1"><span class="command">using</span></span> F<span class="main">(</span>2<span class="main">)</span> G<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">(</span><span class="skolem">f</span><span class="main">+</span><span class="skolem">g</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">uf</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">ug</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">(</span><span class="skolem">f</span><span class="main">+</span><span class="skolem">g</span><span class="main">)</span> <span class="main">≤</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">h1</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">h2</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Inf_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">h1</span></span> <span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">h2</span></span> <span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> ennreal <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">f1</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> ennreal <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">n</span><span class="main">)</span>
                      <span class="main">+</span> <span class="main">(</span>ennreal <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">f2</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> ennreal <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> h1_def h2_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_mono<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> eNorm_triangular_ineq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span>ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">f1</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">g1</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>
                      <span class="main">+</span> <span class="main">(</span>ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">f2</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">g2</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> add_mono mult_mono ennreal_leI<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">uf</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">ug</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> F<span class="main">(</span>1<span class="main">)</span> G<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⇢</span> ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">N</span> <span class="skolem">f</span> <span class="main">+</span> <span class="skolem">N</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uf<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> ug<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">(</span><span class="skolem">f</span><span class="main">+</span><span class="skolem">g</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">N</span> <span class="skolem">f</span> <span class="main">+</span> <span class="skolem">N</span> <span class="skolem">g</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> LIMSEQ_le_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">*</span> <span class="skolem">N</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span> <span class="skolem">f</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">u</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">⇢</span> Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_as_limit<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem"><span class="skolem">f</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uf</span></span> <span class="keyword2"><span class="keyword">where</span></span> uf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">uf</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span>"</span></span>
                             <span class="quoted"><span class="quoted">"<span class="skolem">uf</span> <span class="main">⇢</span> Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">uf</span> <span class="bound">n</span> <span class="main">=</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="bound">f1</span> <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="bound">f2</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">f2</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SMT.choices<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> uf<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f1</span></span> <span class="skolem"><span class="skolem">f2</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">uf</span> <span class="bound">n</span> <span class="main">=</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">f1</span> <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">f2</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f1</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">f2</span> <span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">*</span> <span class="skolem">uf</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="main">≤</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f1</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f2</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Inf_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">c</span></span> <span class="keyword1"><span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span></span> <span class="skolem"><span class="skolem">f1</span></span> <span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">c</span></span> <span class="keyword1"><span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span></span> <span class="skolem"><span class="skolem">f2</span></span> <span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> F<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> scaleR_add_right <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">*</span> <span class="main">(</span>eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">f1</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">f2</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> eNorm_cmult<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> F<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⇢</span> <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">*</span> <span class="skolem">N</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uf<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> LIMSEQ_le_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Z<span class="main">:</span> <span class="quoted"><span class="quoted">"Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="main">0</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"quasinorm_on UNIV <span class="main">(</span>max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="bound">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> quasinorm_onI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> T H Z defect_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N1</span></span><span class="main">]</span> defect_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> N_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"defect <span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="main">=</span> max <span class="main">(</span>defect <span class="free">N1</span><span class="main">)</span> <span class="main">(</span>defect <span class="free">N2</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="free">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> quasinorm_sum_def <span class="keyword1"><span class="command">using</span></span> quasinorm_of<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_sum_limit<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">f2</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="bound">f1</span> <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="bound">f2</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> eNorm <span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">u</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="free">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">u</span> <span class="main">⇢</span> Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="free">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_as_limit<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">f</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">uf</span></span> <span class="keyword2"><span class="keyword">where</span></span> uf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">uf</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="free">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span>"</span></span>
                           <span class="quoted"><span class="quoted">"<span class="skolem">uf</span> <span class="main">⇢</span> Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="free">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">uf</span> <span class="bound">n</span> <span class="main">=</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="bound">f1</span> <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="bound">f2</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">f</span> <span class="main">=</span> <span class="bound">f1</span> <span class="bound">n</span> <span class="main">+</span> <span class="bound">f2</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SMT.choices<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> uf<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f1</span></span> <span class="skolem"><span class="skolem">f2</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">uf</span> <span class="bound">n</span> <span class="main">=</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">f1</span> <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">f2</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">=</span> <span class="skolem">f1</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">f2</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">f1</span> <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">f2</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> eNorm <span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> F<span class="main">(</span>1<span class="main">)</span> uf<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> quasinorm_sum<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> F<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_sum_space<span class="main">:</span>
  <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span> <span class="main">+</span> <span class="bound">g</span><span class="main">|</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N2</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">g</span><span class="main">|</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">+</span> <span class="bound">g</span><span class="main">}</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> quasinorm_sum<span class="main">(</span>1<span class="main">)</span> spaceN_iff<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span> <span class="main">∈</span> <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">g</span><span class="main">|</span> <span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">+</span> <span class="bound">g</span><span class="main">}</span><span class="main">.</span> <span class="bound">z</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Inf_less_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">=</span> <span class="bound">f</span> <span class="main">+</span> <span class="bound">g</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> spaceN_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N2</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">u</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">v</span><span class="main">|</span> <span class="bound">u</span> <span class="bound">v</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">=</span> <span class="bound">u</span> <span class="main">+</span> <span class="bound">v</span><span class="main">}</span> <span class="main">≤</span> eNorm <span class="free">N1</span> <span class="skolem">f</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="skolem">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> spaceN_iff H <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> spaceN_iff quasinorm_sum<span class="main">(</span>1<span class="main">)</span><span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_sum_zerospace<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">f</span> <span class="main">+</span> <span class="bound">g</span> <span class="main">|</span><span class="bound">f</span> <span class="bound">g</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N1</span> <span class="main">∧</span> <span class="bound">g</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N2</span><span class="main">}</span> <span class="main">⊆</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> zero_spaceN_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N1</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N2</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Inf <span class="main">{</span>eNorm <span class="free">N1</span> <span class="bound">f1</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="bound">f2</span><span class="main">|</span> <span class="bound">f1</span> <span class="bound">f2</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">=</span> <span class="bound">f1</span> <span class="main">+</span> <span class="bound">f2</span><span class="main">}</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Inf_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> H<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="main">(</span><span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> quasinorm_sum<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_sum_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N2</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> quasinorm_subsetI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> quasinorm_sum<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Inf_lower<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span>
  <span class="operator">metis</span> add.commute add.left_neutral eNorm_zero<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_sum_maximum<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">N2</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">C2</span></span><span class="main">::</span><span class="quoted">real</span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="bound">f</span> <span class="main">≤</span> <span class="skolem">C1</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="bound">f</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="bound">f</span> <span class="main">≤</span> <span class="skolem">C2</span> <span class="main">*</span> eNorm <span class="free">N2</span> <span class="bound">f</span>"</span></span>
                              <span class="quoted"><span class="quoted">"<span class="skolem">C1</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C2</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> quasinorm_subsetD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> quasinorm_subsetD<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="skolem">f</span> <span class="main">≤</span> <span class="main">(</span>defect <span class="free">N</span> <span class="main">*</span> max <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f1</span></span> <span class="skolem"><span class="skolem">f2</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f1</span> <span class="bound">n</span> <span class="main">+</span> <span class="skolem">f2</span> <span class="bound">n</span>"</span></span>
                          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">f1</span> <span class="bound">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">f2</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> eNorm <span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> quasinorm_sum_limit <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="skolem">f</span> <span class="main">≤</span> ennreal <span class="main">(</span>defect <span class="free">N</span> <span class="main">*</span> max <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">f1</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">f2</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="skolem">f</span> <span class="main">≤</span> ennreal<span class="main">(</span>defect <span class="free">N</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">f1</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> ennreal<span class="main">(</span>defect <span class="free">N</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">f2</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">=</span> <span class="skolem">f1</span> <span class="skolem">n</span> <span class="main">+</span> <span class="skolem">f2</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> eNorm_triangular_ineq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> ennreal<span class="main">(</span>defect <span class="free">N</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">C1</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">f1</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> ennreal<span class="main">(</span>defect <span class="free">N</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">C2</span> <span class="main">*</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">f2</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_mono<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> ennreal<span class="main">(</span>defect <span class="free">N</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>max <span class="skolem">C1</span> <span class="skolem">C2</span> <span class="main">*</span> eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">f1</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> ennreal<span class="main">(</span>defect <span class="free">N</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>max <span class="skolem">C1</span> <span class="skolem">C2</span> <span class="main">*</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">f2</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>add_mono mult_mono ennreal_leI<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ennreal <span class="main">(</span>defect <span class="free">N</span> <span class="main">*</span> max <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>eNorm <span class="free">N1</span> <span class="main">(</span><span class="skolem">f1</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> eNorm <span class="free">N2</span> <span class="main">(</span><span class="skolem">f2</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_mult'<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> defect_ge_1 order_trans zero_le_one <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">⇢</span> <span class="main">(</span>defect <span class="free">N</span> <span class="main">*</span> max <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span> <span class="main">*</span> eNorm <span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_intros</span></span> F<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> LIMSEQ_le_const <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> quasinorm_subsetI <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> quasinorm_sum_assoc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N2</span><span class="main">)</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N3</span> <span class="keyword1">=<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N1</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="main">(</span><span class="free">N2</span> <span class="keyword1">+<span class="hidden">⇩</span><sub>N</sub></span> <span class="free">N3</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> quasinorm_equivalent_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> order_trans quasinorm_sum_maximum quasinorm_sum_subset<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Topology›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">topology<span class="hidden">⇩</span><sub>N</sub></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> quasinorm <span class="main">⇒</span> <span class="tfree">'a</span> topology"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">topology<span class="hidden">⇩</span><sub>N</sub></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> topology <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> eNorm <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">(</span><span class="bound">y</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> istopology_topology<span class="hidden">⇩</span><sub>N</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"istopology <span class="main">(</span><span class="main">λ</span><span class="bound">U</span><span class="main">.</span> <span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="bound">y</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="bound">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> istopology_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> dual_order.strict_trans less_linear<span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> openin_topology<span class="hidden">⇩</span><sub>N</sub><span class="main">:</span>
  <span class="quoted"><span class="quoted">"openin <span class="main">(</span>topology<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">)</span> <span class="free">U</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">U</span><span class="main">.</span> <span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="bound">y</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">U</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> topology<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">using</span></span> istopology_topology<span class="hidden">⇩</span><sub>N</sub><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> topology_inverse'<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> openin_topology<span class="hidden">⇩</span><sub>N</sub>_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="bound">y</span><span class="main">-</span><span class="bound">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"openin <span class="main">(</span>topology<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">)</span> <span class="free">U</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> openin_topology<span class="hidden">⇩</span><sub>N</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> openin_topology<span class="hidden">⇩</span><sub>N</sub>_D<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"openin <span class="main">(</span>topology<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">)</span> <span class="free">U</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">y</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="bound">y</span><span class="main">-</span><span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span> <span class="main">⟶</span> <span class="bound">y</span> <span class="main">∈</span> <span class="free">U</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> openin_topology<span class="hidden">⇩</span><sub>N</sub> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹One should then use this topology to define limits and so on. This is not something
specific to quasinorms, but to all topologies defined in this way, not using type classes.
However, there is no such body of material (yet?) in Isabelle-HOL, where topology is
essentially done with type classes. So, we do not go any further for now.

One exception is the notion of completeness, as it is so important in functional analysis.
We give a naive definition, which will be sufficient for the proof of completeness
of several spaces. Usually, the most convenient criterion to prove completeness of
a normed vector space is in terms of converging series. This criterion
is the only nontrivial thing we prove here. We will apply it to prove the
completeness of $L^p$ spaces.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cauchy_ine<span class="hidden">⇩</span><sub>N</sub></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> quasinorm <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cauchy_ine<span class="hidden">⇩</span><sub>N</sub></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∃</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> eNorm <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="bound">n</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tendsto_ine<span class="hidden">⇩</span><sub>N</sub></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> quasinorm <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tendsto_ine<span class="hidden">⇩</span><sub>N</sub></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="bound">n</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">complete<span class="hidden">⇩</span><sub>N</sub></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> quasinorm <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">complete<span class="hidden">⇩</span><sub>N</sub></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">u</span><span class="main">.</span> cauchy_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="bound">u</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> tendsto_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="bound">u</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The above definitions are in terms of eNorms, but usually the nice definitions
only make sense on the space of the norm, and are expressed in terms of Norms. We formulate
the same definitions with norms, they will be more convenient for the proofs.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cauchy_in<span class="hidden">⇩</span><sub>N</sub></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> quasinorm <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cauchy_in<span class="hidden">⇩</span><sub>N</sub></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">e</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∃</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> Norm <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="bound">n</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">tendsto_in<span class="hidden">⇩</span><sub>N</sub></span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>real_vector<span class="main">)</span> quasinorm <span class="main">⇒</span> <span class="main">(</span>nat <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">=&gt;</span> bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">tendsto_in<span class="hidden">⇩</span><sub>N</sub></span> <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Norm <span class="free"><span class="bound"><span class="entity">N</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">u</span></span></span> <span class="bound">n</span> <span class="main">-</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cauchy_ine<span class="hidden">⇩</span><sub>N</sub>_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">u</span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cauchy_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> cauchy_ine<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cauchy_in<span class="hidden">⇩</span><sub>N</sub>_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">u</span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cauchy_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> cauchy_in<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> cauchy_ine_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">u</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"cauchy_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span> <span class="main">⟷</span> cauchy_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cauchy_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cauchy_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cauchy_ine<span class="hidden">⇩</span><sub>N</sub>_I<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">ennreal</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">=</span> min <span class="skolem">e</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">=</span> ennreal <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> e2_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ennreal_eq_1 ennreal_less_zero_iff le_ennreal_iff le_numeral_extra<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> min_def zero_less_one<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="skolem">M</span><span class="main">.</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">u</span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cauchy_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cauchy_in<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="skolem">M</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">u</span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">r</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms eNorm_Norm <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">r</span>›</span></span> ennreal_lessI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="skolem">M</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">u</span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e2</span> <span class="main">=</span> ennreal <span class="skolem">r</span>›</span></span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> e2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">u</span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cauchy_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"cauchy_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cauchy_in<span class="hidden">⇩</span><sub>N</sub>_I<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="skolem">M</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">u</span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cauchy_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> ennreal_less_zero_iff <span class="keyword1"><span class="command">unfolding</span></span> cauchy_ine<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="skolem">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="skolem">M</span><span class="main">.</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">u</span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> Norm_def <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">e</span>›</span></span> eNorm_Norm eNorm_Norm' enn2real_nonneg ennreal_less_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">u</span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> tendsto_ine_in<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">u</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tendsto_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span> <span class="free">x</span> <span class="main">⟷</span> tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> assms eNorm_Norm spaceN_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_def tendsto_ine<span class="hidden">⇩</span><sub>N</sub>_def *
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Norm_nonneg ennreal_0 eventually_sequentiallyI order_refl tendsto_ennreal_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> tendsto_ennrealI <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> complete<span class="hidden">⇩</span><sub>N</sub>_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> cauchy_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="bound">u</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">u</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">.</span> tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="bound">u</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"complete<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> tendsto_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">u</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"cauchy_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">u</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">M</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">≥</span> <span class="skolem">M</span> <span class="main">⟹</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="skolem">u</span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cauchy_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">u</span>›</span></span> ennreal_zero_less_one <span class="keyword1"><span class="command">unfolding</span></span> cauchy_ine<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">(</span><span class="bound">n</span><span class="main">+</span><span class="skolem">M</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">u</span> <span class="skolem">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">unfolding</span></span> v_def <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="skolem">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">using</span></span> spaceN_iff<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dual_order.strict_trans ennreal_1 ennreal_less_top infinity_ennreal_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cauchy_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> cauchy_ine<span class="hidden">⇩</span><sub>N</sub>_I<span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span><span class="main">::</span><span class="quoted">ennreal</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">P</span> <span class="main">⟹</span> <span class="bound">m</span> <span class="main">≥</span> <span class="skolem">P</span> <span class="main">⟹</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="skolem">u</span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cauchy_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">u</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cauchy_ine<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">v</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≥</span> <span class="skolem">P</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">unfolding</span></span> v_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> that<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> eNorm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="bound">n</span> <span class="main">-</span> <span class="skolem">v</span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"cauchy_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cauchy_ine_in<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">v</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">v</span> <span class="skolem">y</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">v</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"tendsto_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">v</span> <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> tendsto_ine_in <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">v</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tendsto_ine<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">u</span> <span class="main">(</span><span class="skolem">y</span> <span class="main">+</span> <span class="skolem">u</span> <span class="skolem">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> tendsto_ine<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_offset<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">M</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> v_def tendsto_ine<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> complete<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> cauchy_tendsto_in_subseq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">u</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
          <span class="quoted"><span class="quoted">"cauchy_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span>"</span></span>
          <span class="quoted"><span class="quoted">"strict_mono <span class="free">r</span>"</span></span>
          <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="keyword1">o</span> <span class="free">r</span><span class="main">)</span> <span class="free">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span><span class="main">≥</span><span class="bound">M</span><span class="main">.</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">e</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">/</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> defect <span class="free">N</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> defect_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M1</span></span> <span class="keyword2"><span class="keyword">where</span></span> M1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≥</span> <span class="skolem">M1</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">M1</span> <span class="main">⟹</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">u</span> <span class="bound">m</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cauchy_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="free">u</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cauchy_in<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M2</span></span> <span class="keyword2"><span class="keyword">where</span></span> M2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">M2</span> <span class="main">⟹</span> Norm <span class="free">N</span> <span class="main">(</span><span class="main">(</span><span class="free">u</span> <span class="keyword1">o</span> <span class="free">r</span><span class="main">)</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="keyword1">o</span> <span class="free">r</span><span class="main">)</span> <span class="free">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_def order_tendsto_iff eventually_sequentially <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M</span> <span class="main">=</span> max <span class="skolem">M1</span> <span class="skolem">M2</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">e</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span> <span class="main">=</span> Norm <span class="free">N</span> <span class="main">(</span><span class="main">(</span><span class="free">u</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">u</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">M</span><span class="main">)</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> defect <span class="free">N</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">u</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">M</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> defect <span class="free">N</span> <span class="main">*</span> Norm <span class="free">N</span> <span class="main">(</span><span class="free">u</span> <span class="main">(</span><span class="free">r</span> <span class="skolem">M</span><span class="main">)</span> <span class="main">-</span> <span class="free">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Norm_triangular_ineq<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">u</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">&lt;</span> defect <span class="free">N</span> <span class="main">*</span> <span class="skolem">f</span> <span class="main">+</span> defect <span class="free">N</span> <span class="main">*</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> add_strict_mono mult_mono <span class="quasi_keyword">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> defect_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">≥</span> <span class="skolem">M</span>›</span></span> seq_suble<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹strict_mono <span class="free">r</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">]</span> M1 M2 o_def <span class="keyword1"><span class="command">unfolding</span></span> M_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> f_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> defect_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">N</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_def order_tendsto_iff eventually_sequentially <span class="keyword1"><span class="command">using</span></span> Norm_nonneg less_le_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> complete<span class="hidden">⇩</span><sub>N</sub>_I'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">c</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">u</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> Norm <span class="free">N</span> <span class="main">(</span><span class="bound">u</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">c</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">.</span> tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="bound">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"complete<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> complete<span class="hidden">⇩</span><sub>N</sub>_I<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cauchy_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">v</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">v</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">y</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">≥</span><span class="bound">y</span><span class="main">.</span> Norm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="bound">m</span> <span class="main">-</span> <span class="skolem">v</span> <span class="bound">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">&lt;</span> <span class="bound">y</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="skolem">x</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">≥</span><span class="skolem">x</span><span class="main">.</span> Norm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="bound">m</span> <span class="main">-</span> <span class="skolem">v</span> <span class="bound">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">M</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="skolem">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">≥</span><span class="skolem">M</span><span class="main">.</span> Norm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="bound">m</span> <span class="main">-</span> <span class="skolem">v</span> <span class="bound">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cauchy_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> cauchy_in<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> zero_less_power<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"max <span class="skolem"><span class="skolem">M</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">x</span></span><span class="main"><span class="main">+</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="bound">r</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">≥</span><span class="bound">r</span> <span class="bound">n</span><span class="main">.</span> Norm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="bound">m</span> <span class="main">-</span> <span class="skolem">v</span> <span class="bound">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">r</span> <span class="bound">n</span> <span class="main">&lt;</span> <span class="bound">r</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> dependent_nat_choice<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹cauchy_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">c</span> <span class="bound">n</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> cauchy_in<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">m</span></span><span class="main">≥</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">p</span></span><span class="main">≥</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">.</span> Norm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="bound">m</span> <span class="main">-</span> <span class="skolem">v</span> <span class="bound">p</span><span class="main">)</span> <span class="main">&lt;</span> <span class="free">c</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strict_mono_Suc_iff<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">v</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">v</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">v</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="free">N</span> <span class="main">(</span><span class="skolem">u</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">c</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">using</span></span> r <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_imp_le strict_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">i</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">v</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">(</span><span class="skolem">r</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> Norm <span class="free">N</span> <span class="main">(</span><span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">(</span><span class="skolem">r</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">i</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">v</span> <span class="main">(</span><span class="skolem">r</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">unfolding</span></span> u_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> x_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_diff_cancel_right<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Norm <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> y<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="main">(</span><span class="skolem">v</span> <span class="keyword1">o</span> <span class="skolem">r</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_def comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">v</span> <span class="skolem">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">v</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">intro</span> cauchy_tendsto_in_subseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹cauchy_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">v</span>›</span></span> <span class="quoted"><span class="quoted">‹strict_mono <span class="skolem">r</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span><span class="main">.</span> tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span> <span class="skolem">v</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="free">N</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Next, we show when the two examples of norms we have introduced before, the ambient norm
in a Banach space, and the norm on bounded continuous functions, are complete. We just have to
translate in our setting the already known completeness of these spaces.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> complete_N_of_norm<span class="main">:</span>
  <span class="quoted"><span class="quoted">"complete<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>N_of_norm<span class="main">::</span><span class="tfree">'a</span><span class="main">::</span>banach quasinorm<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> complete<span class="hidden">⇩</span><sub>N</sub>_I<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"cauchy_in<span class="hidden">⇩</span><sub>N</sub> N_of_norm <span class="skolem">u</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Cauchy <span class="skolem">u</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Cauchy_def cauchy_in<span class="hidden">⇩</span><sub>N</sub>_def N_of_norm<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dist_norm<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="main">⇢</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> convergent_eq_Cauchy <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> N_of_norm <span class="skolem">u</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_def N_of_norm<span class="main">(</span>2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Lim_null tendsto_norm_zero_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> N_of_norm"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>space<span class="hidden">⇩</span><sub>N</sub> N_of_norm<span class="main">.</span> tendsto_in<span class="hidden">⇩</span><sub>N</sub> N_of_norm <span class="skolem">u</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the next statement, the assumption that \verb+'a+ is a metric space is not necessary,
a topological space would be enough, but a statement about uniform convergence is not available
in this setting.
TODO: fix it.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> complete_bcontfunN<span class="main">:</span>
  <span class="quoted"><span class="quoted">"complete<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>bcontfun<span class="hidden">⇩</span><sub>N</sub><span class="main">::</span><span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>metric_space <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">::</span>banach<span class="main">)</span> quasinorm<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> complete<span class="hidden">⇩</span><sub>N</sub>_I<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span>"</span></span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"cauchy_in<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="skolem">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> H2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">n</span> <span class="main">∈</span> bcontfun"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">using</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub>_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"Bcontfun<span class="main">(</span><span class="skolem">u</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">u</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> Bcontfun <span class="main">(</span><span class="skolem">u</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> Bcontfun <span class="main">(</span><span class="skolem">u</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">m</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">unfolding</span></span> minus_fun_def minus_bcontfun_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bcontfun_inverse<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Norm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span><span class="skolem">u</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">u</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">=</span> norm <span class="main">(</span>Bcontfun <span class="main">(</span><span class="skolem">u</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">u</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">m</span>
    <span class="keyword1"><span class="command">unfolding</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> H<span class="main">(</span>2<span class="main">)</span> bcontfun<span class="hidden">⇩</span><sub>N</sub>_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Cauchy <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Bcontfun <span class="main">(</span><span class="skolem">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> H<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Cauchy_def cauchy_in<span class="hidden">⇩</span><sub>N</sub>_def dist_norm * ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Bcontfun <span class="main">(</span><span class="skolem">u</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> convergent_eq_Cauchy <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> v_space<span class="main">:</span> <span class="quoted"><span class="quoted">"apply_bcontfun <span class="skolem">v</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub>_space <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> apply_bcontfun<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"Norm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span><span class="skolem">u</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> norm<span class="main">(</span>Bcontfun <span class="main">(</span><span class="skolem">u</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span><span class="skolem">u</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> norm <span class="main">(</span>Bcontfun<span class="main">(</span><span class="skolem">u</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub><span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> H<span class="main">(</span>2<span class="main">)</span> bcontfun<span class="hidden">⇩</span><sub>N</sub>_space v_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Bcontfun<span class="main">(</span><span class="skolem">u</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> Bcontfun <span class="main">(</span><span class="skolem">u</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> minus_fun_def minus_bcontfun_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Bcontfun_inverse H2<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="skolem">u</span> <span class="skolem">v</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_def *** <span class="keyword1"><span class="command">using</span></span> v Lim_null tendsto_norm_zero_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span><span class="main">∈</span>space<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub><span class="main">.</span> tendsto_in<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="skolem">u</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> v_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Lp">
<div class="head">
<h1>Theory Lp</h1>
</div>
<pre class="source"><span class="comment1">(*  Author:  Sébastien Gouëzel   sebastien.gouezel@univ-rennes1.fr
    License: BSD
*)</span>

<span class="keyword1"><span class="command">theory</span></span> Lp
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Functional_Spaces.html">Functional_Spaces</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The material in this file is essentially of analytic nature. However, one of the central
proofs (the proof of Holder inequality below) uses a probability space, and Jensen's inequality
there. Hence, we need to import \verb+Probability+. Moreover, we use several lemmas from
\verb+SG_Library_Complement+.›</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Conjugate exponents›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Two numbers $p$ and $q$ are \emph{conjugate} if $1/p + 1/q = 1$. This relation keeps
appearing in the theory of $L^p$ spaces, as the dual of $L^p$ is $L^q$ where $q$ is the conjugate
of $p$. This relation makes sense for real numbers, but also for ennreals
(where the case $p=1$ and $q=\infty$ is most important). Unfortunately, manipulating the
previous relation with ennreals is tedious as there is no good simproc involving addition and
division there. To mitigate this difficulty, we prove once and for all most useful properties
of such conjugates exponents in this paragraph.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_cases_1_PInf<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>ennreal<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>gr<span class="main">)</span> <span class="free">p2</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> ennreal <span class="free">p2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
    <span class="main">|</span> <span class="main">(</span>one<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="main">|</span> <span class="main">(</span>PInf<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> antisym_conv ennreal_cases ennreal_le_1 infinity_ennreal_def not_le<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_cases<span class="main">:</span>
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>real_pos<span class="main">)</span> <span class="free">p2</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> ennreal <span class="free">p2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="main">|</span> <span class="main">(</span>zero<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="main">|</span> <span class="main">(</span>PInf<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> enn2real_positive_iff ennreal_enn2real_if infinity_ennreal_def not_gr_zero top.not_eq_extremum<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">conjugate_exponent</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">1</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conjugate_exponent_real<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>conjugate_exponent <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="quoted"><span class="quoted">"conjugate_exponent <span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span>
        <span class="quoted"><span class="quoted">"conjugate_exponent<span class="main">(</span>conjugate_exponent <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> conjugate_exponent <span class="free">p</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">-</span> <span class="free">p</span> <span class="main">/</span> conjugate_exponent <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> conjugate_exponent_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conjugate_exponent_real_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> conjugate_exponent <span class="free">p</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> conjugate_exponent_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conjugate_exponent_real_2 <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"conjugate_exponent <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> conjugate_exponent_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conjugate_exponent_realI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> conjugate_exponent <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> conjugate_exponent <span class="free">q</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> conjugate_exponent_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> divide_less_eq_1_pos less_add_same_cancel1 zero_less_divide_1_iff<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> mult_less_cancel_left_pos <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword1"><span class="command">lemma</span></span> conjugate_exponent_real_ennreal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">&gt;</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"conjugate_exponent<span class="main">(</span>ennreal <span class="free">p</span><span class="main">)</span> <span class="main">=</span> ennreal<span class="main">(</span>conjugate_exponent <span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> conjugate_exponent_def <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> diff_gt_0_iff_gt divide_ennreal ennreal_1 ennreal_minus zero_le_one<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conjugate_exponent_ennreal_1_2_PInf <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"conjugate_exponent <span class="main">(</span><span class="main">1</span><span class="main">::</span>ennreal<span class="main">)</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
  <span class="quoted"><span class="quoted">"conjugate_exponent <span class="main">(</span><span class="main">∞</span><span class="main">::</span>ennreal<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="quoted"><span class="quoted">"conjugate_exponent <span class="main">(</span><span class="main">⊤</span><span class="main">::</span>ennreal<span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
  <span class="quoted"><span class="quoted">"conjugate_exponent <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>ennreal<span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> conjugate_exponent_real_ennreal<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="numeral">2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> conjugate_exponent_def<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conjugate_exponent_ennreal<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>ennreal<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>conjugate_exponent <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="quoted"><span class="quoted">"conjugate_exponent <span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
        <span class="quoted"><span class="quoted">"conjugate_exponent<span class="main">(</span>conjugate_exponent <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>conjugate_exponent <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span>conjugate_exponent <span class="free">p</span> <span class="main">≥</span> <span class="main">1</span><span class="main">)</span> <span class="main">∧</span> conjugate_exponent<span class="main">(</span>conjugate_exponent <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lp_cases_1_PInf<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>gr <span class="skolem">p2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"conjugate_exponent <span class="free">p</span> <span class="main">=</span> ennreal <span class="main">(</span>conjugate_exponent <span class="skolem">p2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_real_ennreal<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"conjugate_exponent <span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * conjugate_exponent_real<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">p2</span></span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main"><span class="main">&gt;</span></span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main"><span class="main">1</span></span></span></span></span>›</span></span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"conjugate_exponent<span class="main">(</span>conjugate_exponent <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_real<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span><span class="main">]</span> conjugate_exponent_real_ennreal<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span><span class="main">]</span>
      conjugate_exponent_real_ennreal<span class="main">[</span><span class="operator">OF</span> conjugate_exponent_real<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> * <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="free">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> conjugate_exponent <span class="free">p</span> <span class="main">=</span> ennreal<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>conjugate_exponent <span class="skolem">p2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_real<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_plus<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> divide_ennreal<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> divide_ennreal_def inverse_ennreal inverse_eq_divide <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">/</span> <span class="free">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">/</span> conjugate_exponent <span class="free">p</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_real<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">p2</span></span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main"><span class="main">&gt;</span></span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main"><span class="main">1</span></span></span></span></span>›</span></span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a b c <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="main">(</span>conjugate_exponent <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
            <span class="quoted"><span class="quoted">"conjugate_exponent <span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
            <span class="quoted"><span class="quoted">"conjugate_exponent<span class="main">(</span>conjugate_exponent <span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> conjugate_exponent_ennreal_iff<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>ennreal<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> conjugate_exponent <span class="free">p</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> conjugate_exponent_ennreal<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> ennreal_add_diff_cancel_left ennreal_add_eq_top ennreal_top_neq_one one_divide_one_divide_ennreal<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> conjugate_exponent_ennrealI<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>ennreal<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> conjugate_exponent <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> conjugate_exponent <span class="free">p</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">using</span></span> le_iff_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms divide_ennreal_def ennreal_add_eq_top ennreal_divide_self ennreal_divide_zero ennreal_le_epsilon ennreal_one_neq_top mult.left_neutral mult_left_le zero_le<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> conjugate_exponent <span class="free">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_ennreal_iff assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_ennreal<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free">p</span></span></span> <span class="main"><span class="main"><span class="main">≥</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>›</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> conjugate_exponent <span class="free">q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_ennreal_iff<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">≥</span><span class="main">1</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Convexity inequalities and integration›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this paragraph, we describe the basic inequalities relating the integral of a function
and of its $p$-th power, for $p &gt; 0$. These inequalities imply in particular that the $L^p$ norm
satisfies the triangular inequality, a feature we will need when defining the $L^p$ spaces below.
In particular, we prove the Hölder and Minkowski inequalities. The Hölder inequality,
especially, is the basis of all further inequalities for $L^p$ spaces.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prob_space<span class="main">)</span> bound_L1_Lp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
          <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="free">f</span>"</span></span>
        <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"norm <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span>norm <span class="skolem">x</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">real</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"norm <span class="skolem">x</span> <span class="main">≤</span> <span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">meson</span> le_add_same_cancel1 order.trans powr_ge_pzero<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> add_le_same_cancel2 assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> less_le_trans linear not_less not_one_le_zero powr_le_cancel_iff powr_one_gt_zero_iff<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">1</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">¦</span></span><span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">¦</span></span> <span class="keyword1"><span class="keyword1">powr</span></span> <span class="free"><span class="free">p</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> jensens_inequality<span class="main"><span class="main">[</span></span><span class="operator">OF</span> * _ _ assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> convex_abs_powr<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>abs<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> powr_mono2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">theorem</span></span> Holder_inequality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
          <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">q</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_realI<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span><span class="main">&gt;</span><span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">+</span><span class="main">1</span><span class="main">/</span><span class="free">q</span><span class="main">=</span><span class="main">1</span>›</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">y</span> <span class="keyword1">powr</span> <span class="free">q</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">y</span> <span class="keyword1">powr</span> <span class="free">q</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> powr_powr that<span class="main">(</span>1<span class="main">)</span> that<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span>max <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y</span> <span class="keyword1">powr</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>max <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y</span> <span class="keyword1">powr</span> <span class="free">q</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> powr_mono2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> max <span class="main">(</span><span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">(</span><span class="skolem">y</span> <span class="keyword1">powr</span> <span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> max_def mult.right_neutral powr_add powr_powr assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="skolem">y</span> <span class="keyword1">powr</span> <span class="free">q</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">¦</span></span><span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">¦</span></span> <span class="keyword1"><span class="keyword1">powr</span></span> <span class="free"><span class="free">p</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">¦</span></span><span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">¦</span></span> <span class="keyword1"><span class="keyword1">powr</span></span> <span class="free"><span class="free">q</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integrable_add<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms * abs_mult<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The proof of the main inequality is done by applying the inequality
        $(\int |h| d\mu \leq \int |h|^p d\mu)^{1/p}$ to the right function $h$ in the right
        probability space. One should take $h = f \cdot |g|^{1-q}$, and $d\mu = |g|^q dM / I$,
        where $I = \int |g|^q$. This readily gives the result.›</span></span>

  <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> integral_nonneg_eq_0_iff_AE<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integral_cong_AE<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≥</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integral_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_less<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_def <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">M2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">M2</span> <span class="main">=</span> density <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span> <span class="main">/</span> <span class="skolem">I</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">interpret</span></span> prob_space <span class="quoted"><span class="skolem">M2</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">standard</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> M2_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> emeasure_density<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> divide_ennreal<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> nn_integral_divide<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> nn_integral_eq_integral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> I_def<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">-</span> <span class="free">q</span><span class="main">)</span> <span class="main">*</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">-</span> <span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">f2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">{</span><span class="bound"><span class="bound">y</span></span><span class="main">∈</span> space <span class="free">M</span><span class="main">.</span> <span class="free">g</span> <span class="bound">y</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f2</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> f2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f2</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="free">q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> borel_measurable <span class="skolem">M2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> M2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> Eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¦</span><span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span> <span class="main">/</span> <span class="skolem">I</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">¦</span><span class="skolem">h</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">f2</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">/</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> h_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_nonneg_pos <span class="dynamic"><span class="dynamic">divide_simps</span></span> powr_mult powr_powr powr_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> A<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> f2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="skolem">M2</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> M2_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> integrable_density<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Eq<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> integrable_divide<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Bochner_Integration.integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">¦</span></span><span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">¦</span></span> <span class="keyword1"><span class="keyword1">powr</span></span> <span class="free"><span class="free">p</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> f2_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">unfold</span> indicator_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="skolem">M2</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bound_L1_Lp<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹random_variable borel <span class="skolem">h</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> integrable_abs le_less<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="skolem">M2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span> <span class="main">/</span> <span class="skolem">I</span><span class="main">)</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="main">(</span><span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> M2_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integral_density<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">¦</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">h</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">¦</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">powr</span></span></span> <span class="free"><span class="free"><span class="free">p</span></span></span>"</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">¦</span></span></span><span class="free"><span class="free"><span class="free">g</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">¦</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">powr</span></span></span> <span class="free"><span class="free"><span class="free">q</span></span></span> <span class="main"><span class="main"><span class="main">/</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">I</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f2</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">/</span> <span class="skolem">I</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integral_cong<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">/</span> <span class="skolem">I</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integral_mono'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> integrable_divide<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> f2_def indicator_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">I</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="skolem">M2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">/</span> <span class="skolem">I</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">/</span> <span class="skolem">I</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f2</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">/</span> <span class="skolem">I</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Bochner_Integration.integral_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> f2_def indicator_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="skolem">M2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> M2_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> integral_density<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integral_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> h_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span> powr_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> abs_mult<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> abs <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="skolem">M2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> abs<span class="main">(</span><span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="skolem">M2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bound_L1_Lp<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">¦</span></span><span class="skolem"><span class="skolem">h</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">¦</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹integrable <span class="skolem">M2</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">/</span> <span class="skolem">I</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono2<span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> C<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">/</span> <span class="skolem">I</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono2<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">I</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_imp_le powr_divide powr_minus_divide<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">I</span> <span class="main">*</span> <span class="skolem">I</span> <span class="keyword1">powr</span><span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">I</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">-</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_mult_base less_imp_le<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> I_def <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">q</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">q</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Minkowski_inequality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
          <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>
          <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="main">¦</span><span class="skolem">y</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">y</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">+</span> <span class="main">¦</span><span class="skolem">y</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span>max <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">¦</span><span class="skolem">y</span><span class="main">¦</span><span class="main">)</span> <span class="main">+</span> max <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">¦</span><span class="skolem">y</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">*</span> max <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">¦</span><span class="skolem">y</span><span class="main">¦</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> max <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">¦</span><span class="skolem">y</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> powr_mono2 <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span>max <span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="main">¦</span><span class="skolem">y</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> powr_mult <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">*</span> <span class="main">(</span><span class="main">¦</span><span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="main">¦</span><span class="skolem">y</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> max_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="numeral"><span class="numeral"><span class="numeral">2</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">powr</span></span></span> <span class="free"><span class="free"><span class="free">p</span></span></span> <span class="main"><span class="main"><span class="main">*</span></span></span> <span class="main"><span class="main"><span class="main">(</span></span></span><span class="main"><span class="main"><span class="main">¦</span></span></span><span class="free"><span class="free"><span class="free">f</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">¦</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">powr</span></span></span> <span class="free"><span class="free"><span class="free">p</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="main"><span class="main"><span class="main">¦</span></span></span><span class="free"><span class="free"><span class="free">g</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">¦</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">powr</span></span></span> <span class="free"><span class="free"><span class="free">p</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> Bochner_Integration.integral_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> integral_mono'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> conjugate_exponent <span class="free">p</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">q</span> <span class="main">=</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_real<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free"><span class="free"><span class="free">p</span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">&gt;</span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">1</span></span></span></span></span>›</span></span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">z</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">q</span> <span class="main">=</span> <span class="skolem">z</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_mult_base<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integral_mono'<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> Bochner_Integration.integrable_add<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Holder_inequality<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Holder_inequality<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> abs_ge_zero abs_triangle_ineq comm_semiring_class.distrib le_less mult_mono' powr_ge_pzero<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integral_add<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Holder_inequality<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> abs <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">+</span> abs <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> abs<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> abs<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">q</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">q</span><span class="main">)</span>
                      <span class="main">+</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> abs<span class="main">(</span><span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> abs<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">q</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> add_mono<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Holder_inequality<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Holder_inequality<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">q</span><span class="main">)</span> <span class="main">*</span>
            <span class="main">(</span><span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> abs<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> abs<span class="main">(</span><span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">q</span><span class="main">)</span> <span class="main">*</span>
        <span class="main">(</span><span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> abs<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> abs<span class="main">(</span><span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">q</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>
              <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_add<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> add.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">q</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">≤</span>
              <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">q</span><span class="main">)</span> <span class="main">*</span>
              <span class="main">(</span><span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> abs<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> abs<span class="main">(</span><span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹When $p&lt;1$, the function $x \mapsto |x|^p$ is not convex any more. Hence, the $L^p$ ``norm''
is not a norm any more, but a quasinorm. This is proved using a different convexity argument, as
follows.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Minkowski_inequality_le_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">,</span> <span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
          <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>
          <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">a</span> <span class="main">+</span> <span class="skolem">b</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">¦</span><span class="skolem">a</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="main">¦</span><span class="skolem">b</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword1"><span class="command">using</span></span> x_plus_y_p_le_xp_plus_yp<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">a</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">b</span><span class="main">¦</span>"</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">meson</span> abs_ge_zero abs_triangle_ineq assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> le_less order.trans powr_mono2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">λ</span></span></span><span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">.</span></span></span> <span class="main"><span class="main"><span class="main">¦</span></span></span><span class="free"><span class="free"><span class="free">f</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">¦</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">powr</span></span></span> <span class="free"><span class="free"><span class="free">p</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="main"><span class="main"><span class="main">¦</span></span></span><span class="free"><span class="free"><span class="free">g</span></span></span> <span class="bound"><span class="bound"><span class="bound">x</span></span></span><span class="main"><span class="main"><span class="main">¦</span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1">powr</span></span></span> <span class="free"><span class="free"><span class="free">p</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">+</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> less_imp_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> integral_mono'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> add_divide_distrib<span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> mult_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> convex_on_mean_ineq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> convex_powr<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">p</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff<span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">+</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>
      <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹$L^p$ spaces›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We define $L^p$ spaces by giving their defining quasinorm. It is a norm for $p\in [1, \infty]$,
and a quasinorm for $p \in (0,1)$. The construction of a quasinorm from a formula only makes sense
if this formula is indeed a quasinorm, i.e., it is homogeneous and satisfies the triangular
inequality with the given multiplicative defect. Thus, we have to show that this is indeed
the case to be able to use the definition.›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Lp_space</span><span class="main">::</span><span class="quoted"><span class="quoted">"ennreal <span class="main">⇒</span> <span class="tfree">'a</span> measure <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> real<span class="main">)</span> quasinorm"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Lp_space</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">(</span>
    <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">=</span> <span class="main">0</span> <span class="keyword1">then</span> quasinorm_of <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> borel_measurable <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="keyword1">then</span> quasinorm_of <span class="main">(</span>
        <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">&lt;</span> <span class="main">1</span> <span class="keyword1">then</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span>enn2real <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">1</span><span class="main">,</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> borel_measurable <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">∧</span> integrable <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span>enn2real <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
              <span class="keyword1">then</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span>enn2real <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="main">∂</span><span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>enn2real <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span><span class="main">)</span>
              <span class="keyword1">else</span> <span class="main">(</span><span class="main">∞</span><span class="main">::</span>ennreal<span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword1">else</span> quasinorm_of <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">f</span> <span class="main">∈</span> borel_measurable <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="keyword1">then</span> esssup <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">∞</span><span class="main">::</span>ennreal<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">𝔏</span> <span class="main">==</span> Lp_space"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹$L^\infty$›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Let us check that, for $L^\infty$, the above definition makes sense.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L_infinity<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span> <span class="keyword1">then</span> esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span><span class="main">∞</span><span class="main">::</span>ennreal<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"defect <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="main">(</span><span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">≤</span> e2ennreal <span class="main">(</span>esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">g</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="main">(</span>esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="main">(</span><span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> esssup_zero_space<span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e2ennreal_neg<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">h</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> esssup_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> esssup_const<span class="main">[</span><span class="operator">OF</span> False<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>ereal"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="main">(</span><span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">≤</span> esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">+</span> ereal <span class="main">¦</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> esssup_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">+</span> esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> esssup_add<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e2ennreal_mono eq_onp_def plus_ennreal.abs_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">*</span> esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="skolem">c</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs <span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"ereal <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> abs<span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> abs <span class="skolem">c</span> <span class="main">*</span> esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> esssup_cmult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹abs <span class="skolem">c</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> ereal <span class="main"><span class="main">¦</span></span><span class="skolem"><span class="skolem">f</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">¦</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> times_ereal.simps<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> e2ennreal_mult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹ereal <span class="main">¦</span><span class="skolem">c</span><span class="main">¦</span> <span class="main">≥</span> <span class="main">0</span>›</span></span><span class="main">]</span> * scaleR_fun_def
      <span class="keyword1"><span class="command">using</span></span> ennreal.abs_eq ennreal.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> esssup_I <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Z<span class="main">:</span> <span class="quoted"><span class="quoted">"e2ennreal <span class="main">(</span>esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e2ennreal_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"quasinorm_on <span class="main">(</span>borel_measurable <span class="free">M</span><span class="main">)</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span>real<span class="main">)</span><span class="main">.</span> e2ennreal<span class="main">(</span>esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> quasinorm_onI<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> T H Z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"quasinorm_on UNIV <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span>real<span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span> <span class="keyword1">then</span> e2ennreal<span class="main">(</span>esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> extend_quasinorm<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span> <span class="keyword1">then</span> e2ennreal<span class="main">(</span>esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"defect <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Lp_space_def <span class="keyword1"><span class="command">using</span></span> quasinorm_of<span class="main">[</span><span class="operator">OF</span> **<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L_infinity_space<span class="main">:</span>
  <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="free">M</span><span class="main">.</span> <span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="bound">C</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> infinity_ennreal_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">using</span></span> L_infinity<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> top.not_eq_extremum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">unfolding</span></span> space<span class="hidden">⇩</span><sub>N</sub>_def L_infinity<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e2ennreal_infty<span class="main">)</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> real_of_ereal<span class="main">(</span>esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> ereal <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> ereal <span class="skolem">C</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="main">(</span>space <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> emeasure_0_AE <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> esssup_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span><span class="main">]</span> esssup_const<span class="main">[</span><span class="operator">OF</span> False<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">::</span>ereal"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">=</span> ereal <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> C_def <span class="keyword1"><span class="command">using</span></span> * ereal_real <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> esssup_AE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="bound">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">C</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> esssup_I <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">≤</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_infinity<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> H<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> antisym e2ennreal_mono enn2ereal_ennreal ennreal.abs_eq ennreal.rep_eq ennreal_eq_0_iff ereal_less_eq<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> linear order.trans zero_ereal_def<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> spaceN_iff le_less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L_infinity_zero_space<span class="main">:</span>
  <span class="quoted"><span class="quoted">"zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="free">M</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> infinity_ennreal_def<span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> zero_space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">using</span></span> L_infinity<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> top.not_eq_extremum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"e2ennreal<span class="main">(</span>esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">unfolding</span></span> zero_space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">using</span></span> L_infinity<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> e2ennreal_infty <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> e2ennreal_infty e2ennreal_mult ennreal_top_neq_zero ereal_mult_infty leI linear mult_zero_left<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"ereal <span class="main">¦</span><span class="skolem">f</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">using</span></span> that order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> esssup_AE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span>"</span></span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> esssup_I <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_infinity<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> H<span class="main">(</span>1<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e2ennreal_neg<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zero_spaceN_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L_infinity_AE_ebound<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> ennreal <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> L_infinity<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">unfolding</span></span> L_infinity<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> that e2ennreal_mono ennreal.abs_eq ennreal.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> esssup_AE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L_infinity_AE_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> L_infinity_AE_ebound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In the next lemma, the assumption $C \geq 0$ that might seem useless is in fact
necessary for the second statement when the space has zero measure. Indeed, any function is
then almost surely bounded by any constant!›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L_infinity_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≥</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> L_infinity_space assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">≤</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> assms<span class="main">(</span>2<span class="main">)</span> esssup_I <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">≤</span> ereal <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> L_infinity<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> e2ennreal_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> assms<span class="main">(</span>3<span class="main">)</span> ennreal.abs_eq ennreal.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">≤</span> <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L_infinity_I'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> ennreal <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">≤</span> enn2ereal <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> esssup_I<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> less_eq_ennreal.rep_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_infinity <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">using</span></span> e2ennreal_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L_infinity_pos_measure<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free">C</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> space <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="free">C</span><span class="main">}</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> ereal <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">&gt;</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> L_infinity
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"ennreal <span class="free">C</span> <span class="main">&lt;</span> e2ennreal <span class="main">(</span>esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> ereal <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> e2ennreal <span class="main">(</span>esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ereal <span class="main">¦</span><span class="free">f</span> <span class="bound">a</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> e2ennreal <span class="main">(</span>ereal <span class="free">C</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">C</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> e2ennreal_enn2ereal enn2ereal_ennreal leD leI<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"e2ennreal <span class="main">(</span>esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ereal <span class="main">¦</span><span class="free">f</span> <span class="bound">a</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> e2ennreal <span class="main">(</span>ereal <span class="free">C</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">e</span></span><span class="main">≤</span>esssup <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> ereal <span class="main">¦</span><span class="free">f</span> <span class="bound">a</span><span class="main">¦</span><span class="main">)</span><span class="main">.</span> ereal <span class="free">C</span> <span class="main">&lt;</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a1 e2ennreal_neg <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> e2ennreal_mono leI less_le_trans<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> space <span class="free">M</span><span class="main">.</span> ereal<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">&gt;</span> <span class="free">C</span><span class="main">}</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> esssup_pos_measure<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ *<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L_infinity_tendsto_AE<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="free">f</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> L_infinity_AE_bound<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms spaceN_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="free">f</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AE_all_countable<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="free">f</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="free">f</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_sandwich<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">0</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> Norm <span class="main"><span class="main">(</span></span>𝔏 <span class="main"><span class="main">∞</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">n</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">g</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> that <span class="quoted"><span class="quoted">‹tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>›</span></span> LIM_zero_cancel tendsto_rabs_zero_cancel<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As an illustration of the mechanism of spaces inclusion, let us show that bounded
continuous functions belong to $L^\infty$.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bcontfun_subset_L_infinity<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sets <span class="free">M</span> <span class="main">=</span> sets borel"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="main">⊆</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="main">⟹</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="bound">f</span> <span class="main">≤</span> Norm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="bound">f</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="bound">f</span> <span class="main">≤</span> eNorm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="bound">f</span>"</span></span>
        <span class="quoted"><span class="quoted">"bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> 𝔏 <span class="main">∞</span> <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="main">∧</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">≤</span> Norm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"continuous_on UNIV <span class="skolem">f</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> abs<span class="main">(</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> Norm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bcontfun<span class="hidden">⇩</span><sub>N</sub>D<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">f</span></span> <span class="main"><span class="main">∈</span></span> space<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable borel"</span></span> <span class="keyword1"><span class="command">using</span></span> borel_measurable_continuous_onI <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> H<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> L_infinity_I<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">f</span></span> <span class="main"><span class="main">∈</span></span> borel_measurable <span class="free"><span class="free">M</span></span>›</span></span></span> * Norm_nonneg<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="main">⊆</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="main">⟹</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="bound">f</span> <span class="main">≤</span> Norm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="bound">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> 𝔏 <span class="main">∞</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> quasinorm_subsetI'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">≤</span> ennreal <span class="main">1</span> <span class="main">*</span> eNorm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> quasinorm_subset_Norm_eNorm<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">≤</span> eNorm bcontfun<span class="hidden">⇩</span><sub>N</sub> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹$L^p$ for $0 &lt; p &lt; \infty$›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span> <span class="main">∧</span> integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>
                            <span class="keyword1">then</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>
                            <span class="keyword1">else</span> <span class="main">(</span><span class="main">∞</span><span class="main">::</span>ennreal<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"defect <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="free">M</span><span class="main">.</span> integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"quasinorm_on <span class="skolem">F</span> <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span>real<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> quasinorm_onI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> F_def plus_fun_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Minkowski_inequality<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span><span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>
          <span class="main">≤</span> ennreal <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> ennreal <span class="main">1</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> ennreal_plus<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ennreal_leI<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> plus_fun_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Minkowski_inequality<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">F</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">c</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> scaleR_fun_def F_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult powr_mult<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">≤</span> ennreal<span class="main">(</span>abs<span class="main">(</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eq_refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> ennreal_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ennreal_cong<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> scaleR_fun_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult powr_mult powr_powr<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> zero_fun_def F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"𝔏 <span class="free">p</span> <span class="free">M</span> <span class="main">=</span> quasinorm_of <span class="main">(</span><span class="main">1</span><span class="main">,</span>
              <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span> <span class="main">∧</span> integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>
              <span class="keyword1">then</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>
              <span class="keyword1">else</span> <span class="main">(</span><span class="main">∞</span><span class="main">::</span>ennreal<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Lp_space_def <span class="keyword1"><span class="command">using</span></span> enn2real_ennreal<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">using</span></span> enn2real_ennreal<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span> <span class="main">∧</span> integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>
                            <span class="keyword1">then</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>
                            <span class="keyword1">else</span> <span class="main">(</span><span class="main">∞</span><span class="main">::</span>ennreal<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"defect <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ** <span class="keyword1"><span class="command">using</span></span> quasinorm_of<span class="main">[</span><span class="operator">OF</span> extend_quasinorm<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> *<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_le_1<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span> <span class="main">∧</span> integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>
                            <span class="keyword1">then</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>
                            <span class="keyword1">else</span> <span class="main">(</span><span class="main">∞</span><span class="main">::</span>ennreal<span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"defect <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="free">M</span><span class="main">.</span> integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"quasinorm_on <span class="skolem">F</span> <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span>real<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> quasinorm_onI<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> F_def plus_fun_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Minkowski_inequality_le_1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span><span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="skolem">f</span> <span class="main">+</span> <span class="skolem">g</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span><span class="main">)</span>
          <span class="main">≤</span> ennreal <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">+</span> ennreal <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_plus<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ennreal_leI<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> plus_fun_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Minkowski_inequality_le_1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">f</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> <span class="skolem">F</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">c</span><span class="main">::</span><span class="quoted">real</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> <span class="skolem">F</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> scaleR_fun_def F_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult powr_mult<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span><span class="skolem">c</span> <span class="keyword1">*<span class="hidden">⇩</span><sub>R</sub></span> <span class="skolem">f</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">≤</span> ennreal<span class="main">(</span>abs<span class="main">(</span><span class="skolem">c</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> eq_refl<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> ennreal_mult<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> ennreal_cong<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> scaleR_fun_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult powr_mult powr_powr<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> zero_fun_def F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> <span class="free">p</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ge_one_powr_ge_zero<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"𝔏 <span class="free">p</span> <span class="free">M</span> <span class="main">=</span> quasinorm_of <span class="main">(</span><span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="main">λ</span><span class="bound">f</span><span class="main">.</span> <span class="keyword1">if</span> <span class="main">(</span><span class="bound">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span> <span class="main">∧</span> integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>
              <span class="keyword1">then</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>
              <span class="keyword1">else</span> <span class="main">(</span><span class="main">∞</span><span class="main">::</span>ennreal<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> Lp_space_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> enn2real_ennreal<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">insert</span> enn2real_ennreal<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">presburger</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span> <span class="main">∧</span> integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">)</span>
                            <span class="keyword1">then</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>
                            <span class="keyword1">else</span> <span class="main">(</span><span class="main">∞</span><span class="main">::</span>ennreal<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"defect <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> ** <span class="keyword1"><span class="command">using</span></span> quasinorm_of<span class="main">[</span><span class="operator">OF</span> extend_quasinorm<span class="main"><span class="main"><span class="main">[</span></span></span><span class="operator"><span class="operator">OF</span></span> *<span class="main"><span class="main"><span class="main">]</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> F_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="free">M</span><span class="main">.</span> integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spaceN_iff<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> Lp<span class="main">(</span>1<span class="main">)</span> Lp_le_1<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> infinity_ennreal_def less_le not_less<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> Lp<span class="main">(</span>1<span class="main">)</span> Lp_le_1<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> infinity_ennreal_def less_le not_less<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> Lp<span class="main">(</span>1<span class="main">)</span> Lp_le_1<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ennreal_neq_top linear top.not_eq_extremum<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> assms<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lp_le_1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Lp<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> Norm_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> **<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_D<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
        <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
          <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lp_space<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lp_I<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free">p</span></span></span> <span class="main"><span class="main"><span class="main">&gt;</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>›</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_Norm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Lp_I<span class="main">[</span><span class="operator">OF</span> assms True<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∉</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_space<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> eNorm_Norm' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_integrable_integral_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">using</span></span> powr_powr <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_zero_space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="free">M</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="free">M</span><span class="main">.</span> integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="bound">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lp_space<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> zero_spaceN_subset_spaceN <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> * <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lp_le_1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Lp<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> H <span class="keyword1"><span class="command">unfolding</span></span> zero_space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> integral_nonneg_eq_0_iff_AE<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> *<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> H <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="skolem">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integrable_cong_AE<span class="main">[</span><span class="operator">OF</span> _ _ *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> integral_cong_AE<span class="main">[</span><span class="operator">OF</span> _ _ *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">insert</span> H<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lp_le_1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Lp<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> zero_spaceN_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_tendsto_AE_subseq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">&gt;</span><span class="main">(</span><span class="main">0</span><span class="main">::</span>real<span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> strict_mono <span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="bound">r</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> spaceN_diff<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> int<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> Lp_D<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">-</span> <span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lp_D<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_zero_powrI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> powr_powr <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">r</span><span class="main">.</span> strict_mono <span class="bound">r</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="bound">r</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_L1_AE_subseq<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> int ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">r</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_zero_powrI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">p</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> powr_powr <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>›</span></span> Limits.LIM_zero_cancel tendsto_rabs_zero_cancel<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹strict_mono <span class="skolem">r</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Specialization to $L^1$›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L1_space<span class="main">:</span>
  <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> integrable <span class="free">M</span> <span class="bound">f</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> one_ereal_def <span class="keyword1"><span class="command">using</span></span> Lp_space<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">1</span></span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> integrable_abs_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> L1_I<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="free">f</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> one_ereal_def <span class="keyword1"><span class="command">using</span></span> Lp_I<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span><span class="main">,</span> <span class="operator">OF</span> _ borel_measurable_integrable<span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span><span class="operator"><span class="operator"><span class="operator">OF</span></span></span> assms<span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span><span class="main">]</span> assms powr_to_1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> L1_D<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
        <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="free">f</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L1_space L1_I<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L1_int_ineq<span class="main">:</span>
  <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="free">f</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> L1_I<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> True<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> not_integrable_integral_eq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Norm_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In $L^1$, one can give a direct formula for the eNorm of a measurable function, using a
nonnegative integral. The same formula holds in $L^p$ for $p &gt; 0$, with additional powers $p$ and
$1/p$, but one can not write it down since \verb+powr+ is not defined on \verb+ennreal+.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L1_Norm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Lp_Norm<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main">,</span> <span class="operator">OF</span> _ assms<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> one_ereal_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="free">f</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> L1_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> ennreal <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> eNorm_Norm <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> * AE_I2 True abs_ge_zero integrable_abs nn_integral_eq_integral<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> L1_space space<span class="hidden">⇩</span><sub>N</sub>_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ennreal_add_eq_top infinity_ennreal_def le_iff_add le_less_linear mem_Collect_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nn_integral_nonneg_infinite<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> integrable_abs_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L1_indicator<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span>indicator <span class="free">A</span><span class="main">)</span> <span class="main">=</span> emeasure <span class="free">M</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> L1_Norm<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">metis</span> assms ennreal_indicator nn_integral_cong nn_integral_indicator<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> L1_indicator'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"indicator <span class="free">A</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span>indicator <span class="free">A</span><span class="main">)</span> <span class="main">=</span> measure <span class="free">M</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> space<span class="hidden">⇩</span><sub>N</sub>_def Norm_def <span class="keyword1"><span class="command">using</span></span> L1_indicator<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">A</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹emeasure <span class="free">M</span> <span class="free">A</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top.not_eq_extremum Sigma_Algebra.measure_def<span class="main">)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹$L^0$›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We have defined $L^p$ for all exponents $p$, although it does not really make sense for $p = 0$.
We have chosen a definition in this case (the space of all measurable functions) so that many
statements are true for all exponents. In this paragraph, we show the consistency of this definition.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L_zero<span class="main">:</span>
  <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">0</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"defect <span class="main">(</span>𝔏 <span class="main">0</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"quasinorm_on UNIV <span class="main">1</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">f</span><span class="main">::</span><span class="tfree">'a</span><span class="main">⇒</span>real<span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> extend_quasinorm<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> quasinorm_onI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">0</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span>"</span></span>
       <span class="quoted"><span class="quoted">"defect <span class="main">(</span>𝔏 <span class="main">0</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> quasinorm_of<span class="main">[</span><span class="operator">OF</span> *<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> Lp_space_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> L_zero_space <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">0</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> borel_measurable <span class="free">M</span>"</span></span>
  <span class="quoted"><span class="quoted">"zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">0</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> borel_measurable <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> spaceN_iff zero_spaceN_iff L_zero<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> top.not_eq_extremum <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic results on $L^p$ for general $p$›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_measurable_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">⊆</span> borel_measurable <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lp_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> zero
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> L_zero_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>real_pos <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Lp_space<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> PInf
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> L_infinity_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_measurable<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms Lp_measurable_subset <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_infinity_zero_space<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>ennreal<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="free">M</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lp_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> PInf
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> L_infinity_zero_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>real_pos <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Lp_zero_space<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> zero
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> prob_space<span class="main">)</span> Lp_subset_Lq<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="free">q</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="bound">f</span> <span class="main">≤</span> eNorm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">f</span>"</span></span>
        <span class="quoted"><span class="quoted">"𝔏 <span class="free">q</span> <span class="free">M</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> 𝔏 <span class="free">p</span> <span class="free">M</span>"</span></span>
        <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="main">⊆</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="bound">f</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">≤</span> eNorm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> spaceN_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f_meas <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_measurable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">q</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">p</span> <span class="main">&lt;</span> <span class="free">q</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≤</span> <span class="free">q</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top.not_eq_extremum<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> not_less_iff_gr_or_eq order.order_iff_strict <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L_zero<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 3
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> 3 enn2real_positive_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> L_infinity_AE_bound <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span>Norm <span class="main"><span class="main">(</span></span>𝔏 <span class="main"><span class="main">∞</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> <span class="skolem"><span class="skolem">f</span></span><span class="main"><span class="main">)</span></span> <span class="keyword1"><span class="keyword1">powr</span></span> <span class="skolem"><span class="skolem">p2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> * powr_mono2 <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Lp_I<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> f_meas<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ennreal_leI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> powr_mono2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> less_imp_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integral_mono_AE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> **<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> * powr_mono2 <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> prob_space powr_powr<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 4
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> enn2real_positive_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> ennreal <span class="skolem">q2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> enn2real_positive_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">&lt;</span> <span class="skolem">q2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 4 <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> ennreal <span class="skolem">q2</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> ennreal_less_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">=</span> <span class="skolem">q2</span> <span class="main">/</span> <span class="skolem">p2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r2</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r2_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&lt;</span> <span class="skolem">q2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"abs <span class="main">(</span><span class="main">¦</span><span class="skolem">z</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">r2</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">z</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">q2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span><span class="main">::</span><span class="quoted">real</span>
        <span class="keyword1"><span class="command">unfolding</span></span> r2_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> abs<span class="main">(</span><span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> ennreal <span class="skolem">q2</span>›</span></span> Lp_D<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> J<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> bound_L1_Lp<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> _ I<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lp_I<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> _ J<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span><span class="main">)</span> <span class="main">=</span> abs<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> abs <span class="main">(</span><span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">r2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">r2</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> powr_mono2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> less_imp_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> bound_L1_Lp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">≥</span> <span class="main">1</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> ennreal <span class="skolem">q2</span>›</span></span> Lp_D<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">q2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">q2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr r2_def<span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>›</span></span> Lp_D<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> ennreal_leI
        <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> ennreal <span class="skolem">q2</span>›</span></span> Lp_D<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> top.not_eq_extremum <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"𝔏 <span class="free">q</span> <span class="free">M</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> 𝔏 <span class="free">p</span> <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quasinorm_subsetI<span class="main">[</span><span class="operator">of</span> <span class="main">_</span> <span class="main">_</span> <span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="main">⊆</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> quasinorm_subset_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
    <span class="keyword1"><span class="command">using</span></span> eNorm_Norm that <span class="quoted"><span class="quoted">‹eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">≤</span> eNorm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span>›</span></span> ennreal_le_iff Norm_nonneg
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rev_subsetD<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">proposition</span></span> Lp_domination<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_measurable<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">∧</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lp_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> zero
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Norm_def <span class="keyword1"><span class="command">using</span></span> L_zero<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Norm_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>›</span></span> L_zero_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>real_pos <span class="skolem">p2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_D<span class="main">(</span>2<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">¦</span></span><span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">¦</span></span> <span class="keyword1"><span class="keyword1">powr</span></span> <span class="skolem"><span class="skolem">p2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> powr_mono2 <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_imp_le<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_space<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lp_I<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> _ **<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> less_imp_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integral_mono_AE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> * **<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> less_imp_le powr_mono2 assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lp_I<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> _ *<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> PInf
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> L_infinity_AE_bound <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> L_infinity_I<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main"><span class="main">(</span></span></span>1<span class="main"><span class="main"><span class="main">)</span></span></span> *<span class="main">]</span> Norm_nonneg <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_Banach_lattice<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">=</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_measurable<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lp_domination<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lp_domination<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ assms<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lp_domination<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">¦</span></span><span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">¦</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">=</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_bounded_bounded_support<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
          <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> space <span class="free">M</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">0</span><span class="main">}</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub><span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lp_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> zero
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> L_zero_space assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> PInf
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> L_infinity_space assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>real_pos <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integrableI_bounded_set<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="bound"><span class="bound"><span class="bound"><span class="bound">x</span></span></span></span> <span class="main"><span class="main">∈</span></span> space <span class="free"><span class="free">M</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">≠</span></span> <span class="main"><span class="main">0</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">C</span></span> <span class="keyword1"><span class="keyword1">powr</span></span> <span class="skolem"><span class="skolem">p2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms powr_mono2<span class="main">[</span><span class="operator">OF</span> less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top.not_eq_extremum<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_I<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem">p2</span></span></span> <span class="main"><span class="main"><span class="main">&gt;</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>›</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹$L^p$ versions of the main theorems in integration theory›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The space $L^p$ is stable under almost sure convergence, for sequence with bounded norm.
This is a version of Fatou's lemma (and it indeed follows from this lemma in the only
nontrivial situation where $p \in (0, +\infty)$.›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> Lp_AE_limit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">le</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">le</span> <span class="main">=</span> liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">le</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top.not_eq_extremum<span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">r0</span></span> <span class="keyword2"><span class="keyword">where</span></span> r0<span class="main">:</span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">r0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r0</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">le</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> liminf_subseq_lim <span class="keyword1"><span class="command">unfolding</span></span> comp_def le_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eventually <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r0</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span><span class="main">)</span> sequentially"</span></span>
    <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">unfolding</span></span> order_tendsto_iff le_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top.not_eq_extremum<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">N</span></span> <span class="keyword2"><span class="keyword">where</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">≥</span> <span class="skolem">N</span> <span class="main">⟹</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r0</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eventually_sequentially <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">r</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">r</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">r0</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"strict_mono <span class="skolem">r</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹strict_mono <span class="skolem">r0</span>›</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strict_mono_Suc_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">le</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">using</span></span> LIMSEQ_ignore_initial_segment<span class="main">[</span><span class="operator">OF</span> r0<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">N</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> N spaceN_iff <span class="keyword1"><span class="command">unfolding</span></span> r_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">using</span></span> Lp_measurable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">l</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">=</span> enn2real <span class="skolem">le</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">le</span> <span class="main">=</span> ennreal <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">le</span> <span class="main">&lt;</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> l_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">tendsto_intros</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">l</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_ennrealD<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="quoted"><span class="quoted">‹<span class="skolem">le</span> <span class="main">&lt;</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> l_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lp_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> zero
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L_zero<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>real_pos <span class="skolem">p2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub><span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ennreal<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span><span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> lim_imp_Liminf<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">tendsto_intros</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> LIMSEQ_subseq_LIMSEQ<span class="main">[</span><span class="operator">OF</span> that <span class="quoted"><span class="quoted">‹strict_mono <span class="skolem">r</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ennreal<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> ennreal<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> ennreal<span class="main">(</span><span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> ennreal<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nn_integral_eq_integral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lp_D<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ennreal<span class="main">(</span><span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Lp_D<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> powr_powr <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ennreal<span class="main">(</span><span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> ennreal<span class="main">(</span><span class="skolem">l</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_intros</span></span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> ennreal<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> ennreal<span class="main">(</span><span class="skolem">l</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> lim_imp_Liminf <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ennreal<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nn_integral_cong_AE<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> ennreal<span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nn_integral_liminf<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> ennreal<span class="main">(</span><span class="skolem">l</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> intg<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">intro</span> integrableI_nonneg<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_I<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="main">_</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal<span class="main">(</span><span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">=</span> ennreal<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Lp_D<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> powr_powr <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nn_integral_eq_integral<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> intg<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal<span class="main">(</span><span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">≤</span> ennreal<span class="main">(</span><span class="skolem">l</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> ennreal<span class="main">(</span><span class="skolem">l</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">l</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ennreal_le_iff <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> powr_mono2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> <span class="skolem">le</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">le</span> <span class="main">=</span> ennreal <span class="skolem">l</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ennreal_leI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> le_def <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> PInf
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AE_all_countable<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> L_infinity_AE_bound <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that LIMSEQ_subseq_LIMSEQ<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹strict_mono <span class="skolem">r</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> comp_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">¦</span><span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> *<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>1<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">(</span><span class="skolem">r</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">l</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> PInf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> <span class="skolem">l</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> L_infinity_I<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">g</span></span> <span class="main"><span class="main">∈</span></span> borel_measurable <span class="free"><span class="free">M</span></span>›</span></span></span> _ <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">l</span></span> <span class="main"><span class="main">≥</span></span> <span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> <span class="skolem">le</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">le</span> <span class="main">=</span> ennreal <span class="skolem">l</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> ennreal_leI <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> le_def <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_AE_limit'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_le_const<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">l</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> ennreal <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">l</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"ennreal <span class="free">l</span> <span class="main">=</span> liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> lim_imp_Liminf<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> trivial_limit_sequentially <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> ennreal <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> * <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_AE_limit<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> spaceN_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> <span class="free">l</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> ennreal <span class="free">l</span>›</span></span> ennreal_le_iff<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">l</span> <span class="main">≥</span> <span class="main">0</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_AE_limit''<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> order_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Norm_nonneg<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"𝔏 <span class="free"><span class="free"><span class="free">p</span></span></span> <span class="free"><span class="free"><span class="free">M</span></span></span>"</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">f</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="free">C</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> ennreal <span class="free">C</span><span class="main">)</span> <span class="main">=</span> ennreal <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Liminf_const trivial_limit_at_top_linorder <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">unfolding</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ennreal_leI<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Liminf_mono<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">C</span>"</span></span> <span class="quoted">sequentially</span><span class="main">]</span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> ennreal <span class="free">C</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>
    Lp_AE_limit<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="bound">x</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> spaceN_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">≤</span> ennreal <span class="free">C</span>›</span></span> ennreal_le_iff<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">C</span> <span class="main">≥</span> <span class="main">0</span>›</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">unfolding</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We give the version of Lebesgue dominated convergence theorem in the setting of
$L^p$ spaces.›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> Lp_domination_limit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span><span class="main">::</span><span class="quoted">real</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="bound">x</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">m</span> <span class="bound">x</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_measurable<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub><span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_domination<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">m</span></span> <span class="main"><span class="main">∈</span></span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">m</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">m</span> <span class="bound">x</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> AE_all_countable<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">m</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">m</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">m</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_le_const2<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">¦</span></span><span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">n</span></span> <span class="skolem"><span class="skolem">x</span></span><span class="main"><span class="main">¦</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span><span class="dynamic"><span class="dynamic">tendsto_intros</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">m</span> <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub><span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_domination<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">m</span></span> <span class="main"><span class="main">∈</span></span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≤</span> <span class="main">0</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="free">p</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ennreal_eq_0_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> Norm_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L_zero<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="main">0</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> integral_dominated_convergence<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">¦</span></span><span class="numeral"><span class="numeral">2</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">m</span></span> <span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">¦</span></span> <span class="keyword1"><span class="keyword1">powr</span></span> <span class="free"><span class="free">p</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> abs_mult <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> powr_mult<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Lp_D<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">m</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">¦</span><span class="main">0</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_powr'<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Lim_null tendsto_rabs_zero_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">g</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">n</span> <span class="skolem">x</span> <span class="main">-</span> <span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">¦</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">n</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">m</span> <span class="skolem">x</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">g</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">m</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="skolem">x</span>
        <span class="keyword1"><span class="command">using</span></span> powr_mono2 <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">n</span> <span class="bound">x</span> <span class="main">-</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span> <span class="main">≤</span> <span class="main">¦</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">m</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">m</span> <span class="bound">x</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">m</span> <span class="bound">x</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Lp_D<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free"><span class="free">p</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">&gt;</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>›</span></span></span></span></span> spaceN_diff<span class="main"><span class="main"><span class="main"><span class="main"><span class="main">[</span></span></span></span></span><span class="operator"><span class="operator"><span class="operator"><span class="operator">OF</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="main"><span class="main"><span class="main"><span class="main">⋀</span></span></span></span><span class="bound"><span class="bound"><span class="bound"><span class="bound">n</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">.</span></span></span></span> <span class="free"><span class="free"><span class="free"><span class="free">f</span></span></span></span> <span class="bound"><span class="bound"><span class="bound"><span class="bound">n</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">∈</span></span></span></span> space<span class="hidden">⇩</span><sub>N</sub><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>𝔏 <span class="free"><span class="free"><span class="free"><span class="free">p</span></span></span></span> <span class="free"><span class="free"><span class="free"><span class="free">M</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span>›</span></span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free"><span class="free">g</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">∈</span></span></span></span> space<span class="hidden">⇩</span><sub>N</sub><span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span>𝔏 <span class="free"><span class="free"><span class="free"><span class="free">p</span></span></span></span> <span class="free"><span class="free"><span class="free"><span class="free">M</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span>›</span></span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">]</span></span></span></span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">g</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span><span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="free">p</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="free">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_powr'<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> powr_powr <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We give the version of the monotone convergence theorem in the setting of
$L^p$ spaces.›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> Lp_monotone_limit<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">f</span><span class="main">::</span><span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> real"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">(</span><span class="main">0</span><span class="main">::</span>ennreal<span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> convergent <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> lim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> lim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">using</span></span> Lp_measurable<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> convergent <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lp_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> PInf
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="skolem">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> L_infinity_AE_bound<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">C</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">=</span><span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> AE_all_countable<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> LIMSEQ_incseq_SUP<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> that<span class="main">(</span>2<span class="main">)</span> abs_le_D1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convergent <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="free">C</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">unfolding</span></span> convergent_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span>›</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>real_pos <span class="skolem">p2</span><span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">-</span> <span class="free">f</span> <span class="main">0</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> incseq_def<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="skolem">n</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">using</span></span> Lp_measurable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">D</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">D</span> <span class="main">=</span> defect <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span> <span class="main">+</span> defect <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">*</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">D</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> defect <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> defect <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> Norm_triangular_ineq_diff<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="skolem">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">D</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> D_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> add_mono<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> mult_left_mono defect_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"𝔏 <span class="skolem">p2</span> <span class="free">M</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="free">f</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="free">C</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> g_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">g</span> <span class="skolem">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> ennreal<span class="main">(</span><span class="skolem">D</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">g</span> <span class="skolem">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> ennreal<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">g</span> <span class="skolem">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> nn_integral_eq_integral<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Lp_D<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="skolem">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ennreal<span class="main">(</span><span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Lp_Norm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">g</span></span> <span class="skolem"><span class="skolem">n</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> ennreal<span class="main">(</span><span class="skolem">D</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> powr_mono2 <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span> <span class="quoted"><span class="quoted">‹Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">g</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">D</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> incseq_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> ennreal<span class="main">(</span><span class="main">¦</span><span class="skolem">g</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="skolem">n</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">H</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> H_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">n</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">h</span> <span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="skolem">x</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span>powr_mono2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> less_imp_le<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> that incseq_SucD <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="skolem">h</span> <span class="skolem">n</span> <span class="bound">x</span> <span class="main">≤</span> <span class="skolem">h</span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="skolem">H</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">n</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> H_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nn_integral_monotone_convergence_SUP_AE<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> ennreal<span class="main">(</span><span class="skolem">D</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> H_def h_def <span class="keyword1"><span class="command">using</span></span> g_bound <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SUP_least<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="skolem">H</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_less_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="skolem">H</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>›</span></span> infinity_ennreal_def nn_integral_noteq_infinite top.not_eq_extremum<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"convergent <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="quoted"><span class="quoted">"incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> enn2real<span class="main">(</span><span class="skolem">H</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">H</span> <span class="skolem">x</span> <span class="main">=</span> ennreal <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="skolem">x</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ennreal_enn2real_if<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="skolem">n</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="free">f</span> <span class="main">0</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">A</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal<span class="main">(</span><span class="main">¦</span><span class="skolem">g</span> <span class="skolem">n</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="skolem">A</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">H</span> <span class="skolem">x</span> <span class="main">=</span> ennreal <span class="skolem">A</span>›</span></span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> H_def h_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> SUP_upper2 UNIV_I order_refl<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">g</span> <span class="skolem">n</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">≤</span> <span class="skolem">A</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> ennreal_le_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">g</span> <span class="skolem">n</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">=</span> <span class="main">(</span><span class="main">¦</span><span class="skolem">g</span> <span class="skolem">n</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_powr<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="skolem">A</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¦</span><span class="skolem">g</span> <span class="skolem">n</span> <span class="skolem">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">≤</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">g</span> <span class="skolem">n</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">A</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"convergent <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> LIMSEQ_incseq_SUP<span class="main">[</span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted">‹incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span>›</span></span><span class="main">]</span> convergent_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> bdd_aboveI2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> convergent <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="skolem">H</span> <span class="bound">x</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> incseq <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">insert</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span><span class="main">&gt;</span><span class="main">0</span>›</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> lim<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> lim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> convergent_LIMSEQ_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> lim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_AE_limit''<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">⋀</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">n</span></span> <span class="main"><span class="main">∈</span></span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span>›</span></span></span> lim <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">⋀</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> Norm <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">≤</span></span> <span class="free"><span class="free">C</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> lim <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">C</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_AE_limit''<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span></span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> _ <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">⋀</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">n</span></span> <span class="main"><span class="main">∈</span></span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span>›</span></span></span> lim <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">⋀</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> Norm <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">≤</span></span> <span class="free"><span class="free">C</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness of $L^p$›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We prove the completeness of $L^p$.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Lp_complete<span class="main">:</span>
  <span class="quoted"><span class="quoted">"complete<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lp_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> zero
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> complete<span class="hidden">⇩</span><sub>N</sub>_I<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">u</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_def Norm_def <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>›</span></span> L_zero<span class="main">(</span>1<span class="main">)</span> L_zero_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">u</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>real_pos <span class="skolem">p2</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> complete<span class="hidden">⇩</span><sub>N</sub>_I'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">^</span></span><span class="bound"><span class="bound">n</span></span> <span class="main"><span class="main">*</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="main"><span class="main">(</span></span>defect <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">^</span></span><span class="main"><span class="main">(</span></span>Suc <span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">/</span> defect <span class="main">(</span>𝔏 <span class="main">(</span>ennreal <span class="skolem">p2</span><span class="main">)</span> <span class="free">M</span><span class="main">)</span> <span class="main">^</span> Suc <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> defect_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"𝔏 <span class="main">(</span>ennreal <span class="skolem">p2</span><span class="main">)</span> <span class="free">M</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>

    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>defect <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>"</span></span>
                 <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>defect <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">n</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">using</span></span> Lp_measurable<span class="main">[</span><span class="operator">OF</span> H<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="bound">N</span><span class="main">}</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> w2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> sum <span class="main">(</span><span class="main">λ</span><span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">{..&lt;</span><span class="bound">N</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> w_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> sum.cong fun_sum_apply<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"incseq <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="skolem">w</span> <span class="bound">N</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">unfolding</span></span> w2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> incseq_SucI<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> wN_inc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> incseq <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="skolem">w</span> <span class="bound">N</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> abs_u_space<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="skolem">n</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lp_Banach_lattice<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="main"><span class="main">∈</span></span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main"><span class="main">(</span></span>𝔏 <span class="skolem"><span class="skolem">p2</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> wN_space<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="skolem">N</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">N</span> <span class="keyword1"><span class="command">unfolding</span></span> w2 <span class="keyword1"><span class="command">using</span></span> H<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> abs_u_Norm<span class="main">:</span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="skolem">n</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="skolem">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>defect <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> Lp_Banach_lattice<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">u</span> <span class="skolem">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> H<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> wN_Norm<span class="main">:</span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">≤</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">N</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>defect <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>defect <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> defect_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"𝔏 <span class="skolem">p2</span> <span class="free">M</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">N</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="skolem">N</span><span class="main">.</span> <span class="main">(</span>defect <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">¦</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> w2 lessThan_Suc_atMost<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Norm_sum<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_u_space<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="skolem">N</span><span class="main">.</span> <span class="main">(</span>defect <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="main">(</span>defect <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">^</span><span class="main">(</span>Suc <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> mult_left_mono<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> abs_u_Norm * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">&lt;</span><span class="skolem">N</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> *<span class="main">(</span>2<span class="main">)</span> defect_ge_1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"𝔏 <span class="skolem">p2</span> <span class="free">M</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> lessThan_Suc_atMost<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> sum_le_suminf<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> summable_geometric<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="numeral"><span class="numeral"><span class="numeral">2</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> suminf_geometric<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> convergent <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="skolem">w</span> <span class="bound">N</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_monotone_limit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free">p</span></span></span> <span class="main"><span class="main"><span class="main">&gt;</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>›</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> wN_inc wN_Norm wN_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> lim <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="skolem">w</span> <span class="bound">N</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> m_space<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> m_def <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_monotone_limit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free">p</span></span></span> <span class="main"><span class="main"><span class="main">&gt;</span></span></span> <span class="main"><span class="main"><span class="main">0</span></span></span>›</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span></span></span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">unfold</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> wN_inc wN_Norm wN_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> v_meas<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> v_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> u_meas<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>sum <span class="skolem">u</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"convergent <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="skolem">w</span> <span class="bound">N</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> w_def <span class="keyword1"><span class="command">using</span></span> summable_iff_convergent <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m_def w_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> suminf_eq_lim<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> summable_rabs_cancel<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>sum <span class="skolem">u</span> <span class="main">{..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">v</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> v_def fun_sum_apply <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> convergent_LIMSEQ_iff suminf_eq_lim summable_iff_convergent<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span>sum <span class="skolem">u</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="main">(</span>sum <span class="skolem">u</span> <span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">∈</span><span class="main">{..&lt;</span><span class="skolem">n</span><span class="main">}</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="bound">i</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> fun_sum_apply <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">i</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="bound">i</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sum_le_suminf<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="skolem">x</span> <span class="main">=</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span>sum <span class="skolem">u</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>sum <span class="skolem">u</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">v</span> <span class="skolem">x</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> atLeast0LessThan <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> m_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="main">(</span>sum <span class="skolem">u</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">m</span> <span class="bound">x</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> u_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span>sum <span class="skolem">u</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="skolem">v</span> <span class="bound">x</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> convergent <span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="skolem">w</span> <span class="bound">N</span> <span class="bound">x</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum <span class="skolem">u</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lp_domination_limit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> v_meas u_meas m_space u_conv m_bound<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lp_domination_limit<span class="main"><span class="main">[</span></span><span class="operator">OF</span> v_meas u_meas m_space u_conv m_bound<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum <span class="skolem">u</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="bound">v</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> PInf
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> complete<span class="hidden">⇩</span><sub>N</sub>_I'<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">^</span></span><span class="bound"><span class="bound">n</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">u</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">n</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">u</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> PInf <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u</span> <span class="skolem">n</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">using</span></span> Lp_measurable<span class="main">[</span><span class="operator">OF</span> H<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> v_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">w</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">N</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">N</span><span class="main">}</span><span class="main">.</span> <span class="skolem">u</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="skolem">N</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">N</span> <span class="keyword1"><span class="command">unfolding</span></span> w_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="skolem">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
      <span class="keyword1"><span class="command">using</span></span> L_infinity_AE_bound<span class="main">[</span><span class="operator">OF</span> H<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> H<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">n</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> AE_all_countable<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">w</span> <span class="skolem">N</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">v</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="skolem">N</span> <span class="main">*</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">N</span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> summable_norm_cancel<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> summable_comparison_test'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> summable_geometric<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="skolem">w</span> <span class="skolem">N</span> <span class="skolem">x</span> <span class="main">-</span> <span class="skolem">v</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">=</span> <span class="main">¦</span><span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">u</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> v_def w_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> suminf_split_initial_segment<span class="main"><span class="main">[</span></span><span class="operator">OF</span> summable_rabs_cancel<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="bound">n</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">N</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> lessThan_atLeast0<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> summable_rabs<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> summable_iff_shift<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> suminf_le<span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">+</span> <span class="skolem">N</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">u</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span> <span class="skolem">x</span><span class="main">¦</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> ** <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> summable_iff_shift<span class="main">)</span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"summable <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span> <span class="main">^</span> <span class="main">(</span><span class="bound">n</span> <span class="main">+</span> <span class="skolem">N</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> summable_geometric <span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> summable_iff_shift<span class="main">)</span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="skolem">N</span> <span class="main">*</span> <span class="main">(</span><span class="main">∑</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="bound">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> power_add<span class="main"><span class="keyword3">,</span></span> <span class="operator">subst</span> suminf_mult2<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> summable_geometric<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="skolem">N</span> <span class="main">*</span> <span class="numeral">2</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> suminf_geometric<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">w</span> <span class="skolem">N</span> <span class="bound">x</span> <span class="main">-</span> <span class="skolem">v</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="skolem">N</span> <span class="main">*</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">N</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">w</span> <span class="skolem">N</span> <span class="main">-</span> <span class="skolem">v</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">w</span> <span class="skolem">N</span> <span class="main">-</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="skolem">N</span> <span class="main">*</span> <span class="numeral">2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">N</span>
      <span class="keyword1"><span class="command">unfolding</span></span> fun_diff_def <span class="keyword1"><span class="command">using</span></span> L_infinity_I<span class="main">[</span><span class="operator">OF</span> _ *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">N</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="numeral">2</span><span class="main">)</span><span class="main">^</span><span class="bound">N</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>real<span class="main">)</span><span class="main">)</span> <span class="main">⇢</span> <span class="main">0</span> <span class="main">*</span> <span class="numeral">2</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_mult<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> LIMSEQ_realpow_zero<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="numeral">2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">w</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> tendsto_in<span class="hidden">⇩</span><sub>N</sub>_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> tendsto_sandwich<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">0</span></span>"</span></span></span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">n</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">^</span></span><span class="bound"><span class="bound">n</span></span> <span class="main"><span class="main">*</span></span> <span class="numeral"><span class="numeral">2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> l **<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">=</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">w</span> <span class="main">0</span> <span class="main">-</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> w_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> **<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="main">0</span></span><span class="main">]</span> spaceN_add spaceN_diff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">v</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> sum <span class="skolem">u</span> <span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span> <span class="bound">v</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹tendsto_in<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">w</span> <span class="skolem">v</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> w_def fun_sum_apply<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Multiplication of functions, duality›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next theorem asserts that the multiplication of two functions in $L^p$ and $L^q$ belongs to
$L^r$, where $r$ is determined by the equality $1/r = 1/p + 1/q$. This is essentially a case by case
analysis, depending on the kind of $L^p$ space we are considering. The only nontrivial case is
when $p$, $q$ (and $r$) are finite and nonzero. In this case, it reduces to H\"older inequality.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Lp_Lq_mult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="free">r</span><span class="main">::</span><span class="quoted">ennreal</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="free">r</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_measurable assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span> <span class="main">∧</span> Norm <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lp_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> zero
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> L_zero<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> Norm_def zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Norm_nonneg <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> zero <span class="keyword1"><span class="command">using</span></span> * L_zero_space<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>real_pos <span class="skolem">r2</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="free">r</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ennreal_add_eq_top ennreal_divide_eq_top_iff ennreal_top_neq_one gr_zeroI zero_neq_one<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">∧</span> <span class="free">q</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> top.not_eq_extremum <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="free">r</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ennreal_divide_top infinity_ennreal_def one_divide_one_divide_ennreal semiring_normalization_rules<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> L_infinity_AE_bound <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span>Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> abs_mult <span class="keyword1"><span class="command">using</span></span> Norm_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"𝔏 <span class="free">p</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> mult_right_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> spaceN_cmult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="free">r</span>›</span></span> scaleR_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Norm_cmult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"𝔏 <span class="free">r</span> <span class="free">M</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="free">r</span>›</span></span> scaleR_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Lp_domination<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> Norm <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">f</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="free">r</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> * ** *** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="free">r</span>›</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.right_neutral ennreal_divide_top infinity_ennreal_def one_divide_one_divide_ennreal<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>›</span></span> L_infinity_AE_bound <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span>Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">¦</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span>"</span></span> <span class="main"><span class="main">_</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">unfolding</span></span> abs_mult <span class="keyword1"><span class="command">using</span></span> mult_left_mono Norm_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"𝔏 <span class="free">q</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="free">g</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> spaceN_cmult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="free">r</span>›</span></span> scaleR_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Norm_cmult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"𝔏 <span class="free">r</span> <span class="free">M</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="free">r</span>›</span></span> scaleR_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> Lp_domination<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> Norm <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">q</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">g</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="free">r</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> * ** *** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 3
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> enn2real_positive_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> 3 <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> ennreal <span class="skolem">q2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> enn2real_positive_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">q</span></span><span class="main">]</span> 3 <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">q</span></span><span class="main">)</span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">r2</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="free">r</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">=</span> ennreal <span class="skolem">r2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> divide_ennreal zero_le_one <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> ennreal<span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="skolem">q2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> ennreal <span class="skolem">q2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> divide_ennreal ennreal_1<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ennreal_plus<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">p2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">q2</span>"</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">r2</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="skolem">p2</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="skolem">q2</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> ennreal_inj <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> divide_pos_pos ennreal_less_zero_iff le_less zero_less_one<span class="main">)</span>

      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="skolem">p2</span> <span class="main">/</span> <span class="skolem">r2</span>"</span></span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">=</span> <span class="skolem">q2</span> <span class="main">/</span> <span class="skolem">r2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="skolem">P</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="skolem">Q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> P_def Q_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> Pa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¦</span><span class="skolem">z</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">r2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">P</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">z</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
        <span class="keyword1"><span class="command">unfolding</span></span> P_def powr_powr <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> Qa<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¦</span><span class="skolem">z</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">r2</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">Q</span> <span class="main">=</span> <span class="main">¦</span><span class="skolem">z</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">q2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">z</span>
        <span class="keyword1"><span class="command">unfolding</span></span> Q_def powr_powr <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">r2</span> <span class="main">*</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">r2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Holder_inequality<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem">P</span></span></span><span class="main"><span class="main"><span class="main">&gt;</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span>›</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem">Q</span></span></span><span class="main"><span class="main"><span class="main">&gt;</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span>›</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">P</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">Q</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>›</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pa Qa<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_space<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> ennreal <span class="skolem">q2</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_space<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">=</span> ennreal <span class="skolem">r2</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_space<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">M</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> * abs_mult powr_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">r2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">r2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">=</span> ennreal <span class="skolem">r2</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">r2</span></span> <span class="main"><span class="main">&gt;</span></span> <span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">,</span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> abs <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">r2</span> <span class="main">*</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">r2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">r2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_mult abs_mult<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">r2</span> <span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">P</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">P</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">r2</span> <span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">Q</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">Q</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">r2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> powr_mono2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> less_imp_le<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Holder_inequality<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem">P</span></span></span><span class="main"><span class="main"><span class="main">&gt;</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span>›</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem">Q</span></span></span><span class="main"><span class="main"><span class="main">&gt;</span></span></span><span class="main"><span class="main"><span class="main">0</span></span></span>›</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">P</span></span></span> <span class="main"><span class="main"><span class="main">+</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span><span class="main"><span class="main"><span class="main">/</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">Q</span></span></span> <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>›</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Pa Qa<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_space<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> ennreal <span class="skolem">q2</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_space<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">p2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">q2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="main">1</span><span class="main">/</span><span class="skolem">q2</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_mult powr_powr<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> P_def Q_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">r2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> ennreal <span class="skolem">q2</span>›</span></span>
        <span class="keyword1"><span class="command">using</span></span> Lp_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">p2</span></span> <span class="main"><span class="main">&gt;</span></span> <span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">,</span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span><span class="main">]</span> Lp_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">q2</span></span> <span class="main"><span class="main">&gt;</span></span> <span class="main"><span class="main">0</span></span>›</span></span></span><span class="main">,</span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> PInf
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="free">r</span>›</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_eq_0_iff_both_eq_0 ennreal_divide_eq_0_iff infinity_ennreal_def not_one_le_zero order.order_iff_strict<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> L_infinity_AE_bound <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="main">¦</span>Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">¦</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> abs_mult <span class="keyword1"><span class="command">using</span></span> Norm_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"𝔏 <span class="free">p</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> mult_right_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> spaceN_cmult<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="free">r</span>›</span></span> scaleR_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> ***<span class="main">:</span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Norm_cmult<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"𝔏 <span class="free">r</span> <span class="free">M</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="free">r</span>›</span></span> scaleR_fun_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Lp_domination<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="free"><span class="free">f</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> Norm <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">f</span></span> <span class="main"><span class="main">*</span></span> <span class="free"><span class="free">g</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="free">r</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> * ** *** <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span>"</span></span>
            <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The previous theorem admits an eNorm version in which one does not assume a priori
that the functions under consideration belong to $L^p$ or $L^q$.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Lp_Lq_emult<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span> <span class="free">r</span><span class="main">::</span><span class="quoted">ennreal</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="free">r</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> eNorm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> L_zero<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_gr_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span><span class="main">/</span><span class="free">r</span>›</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ennreal_add_eq_top ennreal_divide_eq_top_iff ennreal_top_neq_one gr_zeroI zero_neq_one<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Z<span class="main">:</span> <span class="quoted"><span class="quoted">"zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="free">M</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
               <span class="quoted"><span class="quoted">"zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="free">M</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
               <span class="quoted"><span class="quoted">"zero_space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">f</span></span> <span class="main">∈</span> borel_measurable <span class="free">M</span><span class="main">.</span> <span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="bound">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">r</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> Lp_infinity_zero_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">consider</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∨</span> eNorm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
         <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">&gt;</span> <span class="main">0</span> <span class="main">∧</span> eNorm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> <span class="main">∞</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span>eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">∧</span> eNorm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">&gt;</span> <span class="main">0</span><span class="main">)</span>"</span></span>
         <span class="main">|</span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">∧</span> eNorm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> less_top <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Z <span class="keyword1"><span class="command">unfolding</span></span> zero_space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Z <span class="keyword1"><span class="command">unfolding</span></span> zero_space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> eNorm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ennreal_mult_eq_top_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">r</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_Lq_mult<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">using</span></span> Lp_Lq_mult<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> *<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eNorm_Norm * ennreal_mult'<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_Lq_duality_bound<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted">ennreal</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_Lq_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">∈</span></span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span>›</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">g</span></span> <span class="main"><span class="main">∈</span></span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">q</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> L1_space <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> L1_int_ineq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_Lq_mult<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">∈</span></span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span>›</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">g</span></span> <span class="main"><span class="main">∈</span></span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">q</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"abs<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="free">g</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The next theorem asserts that the norm of an $L^p$ function $f$ can be obtained by estimating
the integrals of $fg$ over all $L^q$ functions $g$, where $1/p + 1/q = 1$. When $p = \infty$, it is
necessary to assume that the space is sigma-finite: for instance, if the space is one single atom
of infinite mass, then there is no nonzero $L^1$ function, so taking for $f$ the constant function
equal to $1$, it has $L^\infty$ norm equal to $1$, but $\int fg = 0$ for all $L^1$ function $g$.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Lp_Lq_duality<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted">ennreal</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟹</span> sigma_finite_measure <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"bdd_above <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_measurable<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">g</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> abs<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">*</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lp_Lq_duality_bound<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> g<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> g<span class="main">(</span>2<span class="main">)</span> Norm_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"𝔏 <span class="free">p</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> mult_left_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"bdd_above <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">g</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bdd_aboveI2<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> antisym<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> cSUP_least<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_ennrealI<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lp_cases_1_PInf<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> PInf
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub><span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_eq_1_ennreal<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&lt;</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">c</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">&lt;</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">0</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cSUP_upper<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_fun_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bdd_aboveI2<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="skolem">c</span> <span class="main">&lt;</span> eNorm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> that ennreal_less_iff <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> space <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="skolem">c</span><span class="main">}</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> L_infinity_pos_measure<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">f</span></span> <span class="quoted"><span class="free">M</span></span> <span class="quoted"><span class="skolem">c</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="main">(</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">n</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> space <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">i</span><span class="main">.</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> sigma_finite_measure.sigma_finite<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span> <span class="main">⟹</span> sigma_finite_measure <span class="free">M</span>›</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> UNIV_I sets_range<span class="main">)</span>
        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="skolem">c</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="skolem">n</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> space <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">&gt;</span> <span class="skolem">c</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⋃</span><span class="bound">i</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">i</span><span class="main">)</span> <span class="main">=</span> space <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> emeasure_pos_unionE<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">Y</span></span><span class="main">,</span> <span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">n</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≤</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="skolem">A</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> emeasure_mono<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"emeasure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹emeasure <span class="free">M</span> <span class="main">(</span><span class="skolem">A</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> infinity_ennreal_def neq_top_trans<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹emeasure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> measure_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> enn2real_positive_iff top.not_eq_extremum<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≥</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">using</span></span> that less_imp_le <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> sgn<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span> measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_domination<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"indicator <span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">Y</span></span></span></span> <span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span> <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">/<span class="hidden">⇩</span><sub>R</sub></span></span></span></span> measure <span class="free"><span class="free"><span class="free"><span class="free">M</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">(</span></span></span></span><span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">Y</span></span></span></span> <span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">n</span></span></span></span><span class="main"><span class="main"><span class="main"><span class="main">)</span></span></span></span>"</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> g_def
          <span class="keyword1"><span class="command">using</span></span> L1_indicator'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">Y</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="main"><span class="main">∈</span></span> sets <span class="free"><span class="free">M</span></span>›</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹emeasure <span class="free"><span class="free">M</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">Y</span></span> <span class="skolem"><span class="skolem">n</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">≠</span></span> <span class="main"><span class="main">∞</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult indicator_def abs_sgn_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">=</span> Norm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> sgn<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> abs<span class="main">(</span>measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> g_def Norm_cmult <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> divide_inverse<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span>indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="main">/</span> abs<span class="main">(</span>measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_domination<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> L1_indicator'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">Y</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="main"><span class="main">∈</span></span> sets <span class="free"><span class="free">M</span></span>›</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹emeasure <span class="free"><span class="free">M</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">Y</span></span> <span class="skolem"><span class="skolem">n</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">≠</span></span> <span class="main"><span class="main">∞</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult indicator_def abs_sgn_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">/</span> abs<span class="main">(</span>measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> L1_indicator'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">Y</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="main"><span class="main">∈</span></span> sets <span class="free"><span class="free">M</span></span>›</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹emeasure <span class="free"><span class="free">M</span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">Y</span></span> <span class="skolem"><span class="skolem">n</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">≠</span></span> <span class="main"><span class="main">∞</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult indicator_def abs_sgn_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">*</span> measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">c</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹emeasure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integral_mono<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹emeasure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> Sigma_Algebra.measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span>›</span></span> not_integrable_integral_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Bochner_Integration.integrable_bound<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> Norm <span class="main"><span class="main">(</span></span>𝔏 <span class="main"><span class="main">∞</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">f</span></span> <span class="main"><span class="main">*</span></span> indicator <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">Y</span></span> <span class="skolem"><span class="skolem">n</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹emeasure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">0</span> <span class="main">&lt;</span> Sigma_Algebra.measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span>›</span></span> not_integrable_integral_eq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">using</span></span> L_infinity_AE_bound<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> indicator_def Y_def<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">/</span> measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">divide_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> sgn<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">/</span> measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹measure <span class="free">M</span> <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_sgn mult.commute mult.left_commute<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> divide_inverse g_def divideR_apply <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">algebra_simps</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cSUP_upper<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Norm <span class="main">(</span>𝔏 <span class="main">1</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">using</span></span> B <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bdd_aboveI2<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> dense_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> one
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn <span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> L_infinity_I<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_sgn_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> L_infinity_I<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span></span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free"><span class="quoted"><span class="free">M</span></span></span></span></span></span></span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_sgn_eq<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> L1_D<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_sgn<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cSUP_upper<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">using</span></span> B <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>gr <span class="skolem">p2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">=</span> conjugate_exponent <span class="skolem">p2</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_real<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> q2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">q</span> <span class="main">=</span> ennreal <span class="skolem">q2</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> q2_def conjugate_exponent_real_ennreal<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span><span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span><span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_ennreal_iff<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">≥</span> <span class="main">1</span>›</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">0</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">≤</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">0</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cSUP_upper<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_fun_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> bdd_aboveI2<span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> Norm_nonneg<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"𝔏 <span class="skolem">p2</span> <span class="free">M</span>"</span></span> <span class="quoted"><span class="free">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>

        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> sgn<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">p2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">q2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">p2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">q2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nn_integral_cong<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult abs_sgn_eq<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> powr_powr q2_def <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_real<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">p2</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Lp_Norm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nn_integral_eq_integral<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Lp_D<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">q2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">p2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">q2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> integrableI_bounded<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">q2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫<span class="hidden">⇧</span><sup>+</sup></span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">q2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> nn_integral_eq_integral<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> **<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">q2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">p2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">h</span> <span class="bound">x</span> <span class="main">/</span> <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">p2</span> <span class="main">/</span> <span class="skolem">q2</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> intg<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">q2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult powr_divide powr_powr<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">h</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">q2</span><span class="main">)</span>›</span></span> integrable_divide_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">q2</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lp_I<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> _ intg<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">g</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">q2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> g_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">q2</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_mult powr_divide powr_powr **<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="skolem">q2</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Lp_D<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">q2</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">&gt;</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>›</span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">q2</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> sgn<span class="main">(</span><span class="free">f</span> <span class="bound">x</span><span class="main">)</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">p2</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">p2</span> <span class="main">/</span> <span class="skolem">q2</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> g_def h_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">*</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">p2</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">p2</span> <span class="main">/</span> <span class="skolem">q2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> abs_sgn<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">/</span> <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">p2</span> <span class="main">/</span> <span class="skolem">q2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> powr_mult_base<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="skolem">p2</span> <span class="main">/</span> <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">p2</span> <span class="main">/</span> <span class="skolem">q2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> Lp_Norm<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span>Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span><span class="main">)</span> <span class="keyword1">powr</span> <span class="main">(</span><span class="skolem">p2</span> <span class="main">-</span> <span class="skolem">p2</span><span class="main">/</span><span class="skolem">q2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> powr_diff <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> Norm <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> q2_def <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_real<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">1</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> ennreal <span class="skolem">q2</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cSUP_upper<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">q2</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹Norm <span class="main">(</span>𝔏 <span class="skolem">q2</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">using</span></span> B <span class="quoted"><span class="quoted">‹<span class="free">q</span> <span class="main">=</span> ennreal <span class="skolem">q2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The previous theorem admits a version in which one does not assume a priori that the
function under consideration belongs to $L^p$. This gives an efficient criterion to check
if a function is indeed in $L^p$. In this case, it is always necessary to assume that the
measure is sigma-finite.

Note that, in the statement, the Bochner integral $\int fg$ vanishes by definition if
$fg$ is not integrable. Hence, the statement really says that the eNorm can be estimated
using functions $g$ for which $fg$ is integrable. It is precisely the construction of such
functions $g$ that requires the space to be sigma-finite.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> Lp_Lq_duality'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">p</span> <span class="free">q</span><span class="main">::</span><span class="quoted">ennreal</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span>
          <span class="quoted"><span class="quoted">"sigma_finite_measure <span class="free">M</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> space<span class="hidden">⇩</span><sub>N</sub>_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top.not_eq_extremum<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> Lp_Lq_duality<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">∈</span></span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span>›</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">p</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">q</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">1</span></span>›</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹sigma_finite_measure <span class="free"><span class="free">M</span></span>›</span></span></span><span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SUP_real_ennreal<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lp_Lq_duality<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">∈</span></span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span>›</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">p</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">/</span></span><span class="free"><span class="free">q</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">1</span></span>›</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">‹sigma_finite_measure <span class="free"><span class="free">M</span></span>›</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">≥</span> <span class="skolem">C</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">C</span><span class="main">::</span><span class="quoted">ennreal</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Cr</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">C</span> <span class="main">=</span> ennreal <span class="skolem">Cr</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Cr</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">&lt;</span> <span class="main">∞</span>›</span></span> ennreal_cases less_irrefl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">A</span> <span class="bound">n</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"incseq <span class="skolem">A</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> space <span class="free">M</span>"</span></span>
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> emeasure <span class="free">M</span> <span class="main">(</span><span class="skolem">A</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sigma_finite_measure.sigma_finite_incseq<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹sigma_finite_measure <span class="free">M</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> range_subsetD<span class="main">)</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Y</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> <span class="skolem">A</span> <span class="bound">n</span><span class="main">.</span> <span class="main">¦</span><span class="free">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="bound">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">Y</span> <span class="bound">n</span> <span class="main">∈</span> sets <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">.</span> <span class="skolem">A</span> <span class="bound">n</span> <span class="main">∈</span> sets <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"incseq <span class="skolem">Y</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> incseq_SucI<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">using</span></span> incseq_SucD<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹incseq <span class="skolem">A</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">N</span><span class="main">.</span> <span class="main">∀</span><span class="bound"><span class="bound">n</span></span> <span class="main">≥</span> <span class="bound">N</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> space <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n0</span></span> <span class="keyword2"><span class="keyword">where</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">A</span> <span class="skolem">n0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> space <span class="free">M</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">⋃</span><span class="bound">n</span><span class="main">.</span> <span class="skolem">A</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> space <span class="free">M</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n1</span></span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¦</span><span class="free">f</span> <span class="skolem">x</span><span class="main">¦</span> <span class="main">≤</span> <span class="skolem">n1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> real_arch_simple <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="main">(</span>max <span class="skolem">n0</span> <span class="skolem">n1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Y_def <span class="keyword1"><span class="command">using</span></span> n1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">using</span></span> n0 <span class="quoted"><span class="quoted">‹incseq <span class="skolem">A</span>›</span></span> incseq_def max.cobounded1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">Y</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≥</span> max <span class="skolem">n0</span> <span class="skolem">n1</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n</span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹incseq <span class="skolem">Y</span>›</span></span> that incseq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"max <span class="skolem"><span class="skolem"><span class="skolem">n0</span></span></span> <span class="skolem"><span class="skolem"><span class="skolem">n1</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> *<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> <span class="free">f</span> <span class="skolem">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> <span class="main">⇢</span> <span class="free">f</span> <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> space <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span>
      <span class="keyword1"><span class="command">using</span></span> *<span class="main">[</span><span class="operator">OF</span> that<span class="main">]</span> <span class="keyword1"><span class="command">unfolding</span></span> eventually_sequentially<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tendsto_eventually<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_AE_limit<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"liminf <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">Cr</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> False neq_top_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"limsup <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="bound">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">Cr</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Liminf_le_Limsup less_le_trans trivial_limit_sequentially <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">Cr</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Limsup_obtain <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_bounded_bounded_support<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">n</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> Y_def indicator_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> A<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> A<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> emeasure_mono infinity_ennreal_def mem_Collect_eq neq_top_trans subsetI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">Cr</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> n <span class="keyword1"><span class="command">unfolding</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> ennreal_leI not_le<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">Cr</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lp_Lq_duality<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹sigma_finite_measure <span class="free">M</span>›</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">g</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">Cr</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> less_cSUP_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Lp_Lq_duality<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="free">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹sigma_finite_measure <span class="free">M</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">g</span></span> <span class="keyword2"><span class="keyword">where</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">Cr</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_measurable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">h</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> indicator <span class="main">(</span><span class="skolem">Y</span> <span class="skolem">n</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">h</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">g</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_domination<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> h_def indicator_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">h</span> <span class="main">≤</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">≤</span> <span class="main">1</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_domination<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">g</span></span></span></span></span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> h_def indicator_def <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">Cr</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h_def <span class="keyword1"><span class="command">using</span></span> g<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.assoc<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">h</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span> <span class="main">&gt;</span> <span class="skolem">C</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">C</span> <span class="main">=</span> ennreal <span class="skolem">Cr</span>›</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Cr</span> <span class="main">≥</span> <span class="main">0</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ennreal_less_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="free">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> dense_le<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> B <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> SUP_upper2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> False neq_top_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Conditional expectations and $L^p$›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The $L^p$ space with respect to a subalgebra is included in the whole $L^p$ space.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_subalgebra<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"subalgebra <span class="free">M</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="bound">f</span> <span class="main">≤</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="bound">f</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> 𝔏 <span class="free">p</span> <span class="free">M</span>"</span></span>
        <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span><span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span><span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="bound">f</span> <span class="main">=</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="bound">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="main">∧</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">=</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
       <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that Lp_measurable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms measurable_from_subalg measurable_in_subalg' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> Lp_cases<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> zero
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">0</span>›</span></span> L_zero_space Norm_def L_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> PInf
      <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> that Lp_measurable <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="free">F</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms measurable_in_subalg' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms measurable_from_subalg <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> L_infinity_AE_bound that <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms AE_restr_to_subalg <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> L_infinity_I<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">f</span></span> <span class="main"><span class="main">∈</span></span> borel_measurable <span class="free"><span class="free">M</span></span>›</span></span></span> a<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="free">M</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> L_infinity_AE_bound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">AE</span> <span class="bound">x</span> <span class="keyword1">in</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> AE_restr_to_subalg2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="main">∞</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> L_infinity_I<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem">f</span></span> <span class="main"><span class="main">∈</span></span> borel_measurable <span class="main"><span class="main">(</span></span>restr_to_subalg <span class="free"><span class="free">M</span></span> <span class="free"><span class="free">F</span></span><span class="main"><span class="main">)</span></span>›</span></span></span> c<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> <span class="main">∞</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>real_pos <span class="skolem">p2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> that <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">p2</span> <span class="free">M</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> Lp_space<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="skolem">p2</span> <span class="main">&gt;</span> <span class="main">0</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> integrable_from_subalg<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> <span class="quoted"><span class="quoted">‹<span class="free">p</span> <span class="main">=</span> ennreal <span class="skolem">p2</span>›</span></span> Lp_D<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">p2</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">&gt;</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>›</span></span></span></span></span> a<span class="main">]</span> Lp_D<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="skolem"><span class="skolem"><span class="skolem"><span class="skolem">p2</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">&gt;</span></span></span></span> <span class="main"><span class="main"><span class="main"><span class="main">0</span></span></span></span>›</span></span></span></span></span> b<span class="main">]</span>
        <span class="keyword1"><span class="command">using</span></span> integral_subalgebra2<span class="main">[</span><span class="operator">OF</span> assms<span class="main">,</span> <span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> b<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹integrable <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">¦</span><span class="skolem">f</span> <span class="bound">x</span><span class="main">¦</span> <span class="keyword1">powr</span> <span class="skolem">p2</span><span class="main">)</span>›</span></span> assms integrableD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> integral_subalgebra2 measurable_in_subalg'<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span><span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">=</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span><span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
    <span class="keyword1"><span class="command">using</span></span> * that <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">f</span> <span class="main">≤</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="skolem">f</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">f</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted">"*"</span> eNorm_Norm eq_iff infinity_ennreal_def less_imp_le spaceN_iff top.not_eq_extremum<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">⊆<span class="hidden">⇩</span><sub>N</sub></span> 𝔏 <span class="free">p</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ennreal_1 mult.left_neutral quasinorm_subsetI<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For $p \geq 1$, the conditional expectation of an $L^p$ function still belongs to $L^p$,
with an $L^p$ norm which is bounded by the norm of the original function. This is wrong for
$p &lt; 1$. One can prove this separating the cases and using the conditional version of Jensen's
inequality, but it is much more efficient to do it with duality arguments, as follows.›</span></span>

<span class="keyword1"><span class="command">proposition</span></span> Lp_real_cond_exp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"subalgebra <span class="free">M</span> <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>ennreal<span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"sigma_finite_measure <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"real_cond_exp <span class="free">M</span> <span class="free">F</span> <span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>real_cond_exp <span class="free">M</span> <span class="free">F</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Lp_measurable assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">q</span> <span class="main">=</span> conjugate_exponent <span class="free">p</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> q_def <span class="keyword1"><span class="command">using</span></span> conjugate_exponent_ennreal<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free"><span class="free">p</span></span></span> <span class="main"><span class="main"><span class="main">≥</span></span></span> <span class="main"><span class="main"><span class="main">1</span></span></span>›</span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>real_cond_exp <span class="free">M</span> <span class="free">F</span> <span class="free">f</span><span class="main">)</span>
    <span class="main">=</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">q</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="skolem">q</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>real_cond_exp <span class="free">M</span> <span class="free">F</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Lp_Lq_duality'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹sigma_finite_measure <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">SUP</span> <span class="bound">g</span><span class="main">∈</span><span class="main">{</span><span class="bound"><span class="bound">g</span></span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">q</span> <span class="free">M</span><span class="main">)</span><span class="main">.</span> Norm <span class="main">(</span>𝔏 <span class="skolem">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">g</span> <span class="main">≤</span> <span class="main">1</span><span class="main">}</span><span class="main">.</span> ennreal<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> SUP_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">g</span> <span class="keyword3"><span class="command">assume</span></span> H<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">q</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
                    <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="skolem">q</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> H2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">q</span> <span class="free">M</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="skolem">q</span> <span class="free">M</span><span class="main">)</span> <span class="skolem">g</span> <span class="main">≤</span> <span class="main">1</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lp_subalgebra<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">‹subalgebra <span class="free"><span class="free"><span class="free"><span class="free">M</span></span></span></span> <span class="free"><span class="free"><span class="free"><span class="free">F</span></span></span></span>›</span></span></span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subset_iff<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">measurable</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> borel_measurable <span class="free">M</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">g</span> <span class="main">∈</span> borel_measurable <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lp_measurable<span class="main">[</span><span class="operator">OF</span> H<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> Lp_measurable<span class="main">[</span><span class="operator">OF</span> H2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> int<span class="main">:</span> <span class="quoted"><span class="quoted">"integrable <span class="free">M</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Lp_Lq_duality_bound<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> H2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span><span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>real_cond_exp <span class="free">M</span> <span class="free">F</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="main">(</span>real_cond_exp <span class="free">M</span> <span class="free">F</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> mult.commute<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> integral_subalgebra2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹subalgebra <span class="free">M</span> <span class="free">F</span>›</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">*</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sigma_finite_subalgebra.real_cond_exp_intg<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int mult.commute<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> sigma_finite_subalgebra_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ennreal <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="main">(</span>real_cond_exp <span class="free">M</span> <span class="free">F</span> <span class="free">f</span><span class="main">)</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">(</span><span class="main">∫</span><span class="bound">x</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span> <span class="main">∂</span><span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ennreal_leI <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="skolem">q</span> <span class="free">M</span><span class="main">)</span> <span class="main">∧</span> Norm <span class="main">(</span>𝔏 <span class="skolem">q</span> <span class="free">M</span><span class="main">)</span> <span class="bound">m</span> <span class="main">≤</span> <span class="main">1</span>
        <span class="main">∧</span> ennreal <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">.</span> real_cond_exp <span class="free">M</span> <span class="free">F</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="skolem">g</span> <span class="bound">x</span><span class="main">)</span> <span class="main">≤</span> ennreal <span class="main">(</span><span class="keyword1">LINT</span> <span class="bound">x</span><span class="main">|</span><span class="free">M</span><span class="main">.</span> <span class="free">f</span> <span class="bound">x</span> <span class="main">*</span> <span class="bound">m</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> H2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">...</span> <span class="main">=</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Lp_Lq_duality'<span class="main"><span class="main">[</span></span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="main">1</span><span class="main">/</span><span class="free">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">/</span><span class="skolem">q</span> <span class="main">=</span> <span class="main">1</span>›</span></span><span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> sigma_finite_subalgebra_is_sigma_finite<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="free">F</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> sigma_finite_subalgebra_def <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>real_cond_exp <span class="free">M</span> <span class="free">F</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"real_cond_exp <span class="free">M</span> <span class="free">F</span> <span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> spaceN_iff<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> space<span class="hidden">⇩</span><sub>N</sub>_def<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>real_cond_exp <span class="free">M</span> <span class="free">F</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> Norm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> * <span class="keyword1"><span class="command">unfolding</span></span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">]</span> eNorm_Norm<span class="main">[</span><span class="operator">OF</span> a<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> Lp_real_cond_exp_eNorm<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"subalgebra <span class="free">M</span> <span class="free">F</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">≥</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>ennreal<span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"sigma_finite_measure <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="main">(</span>restr_to_subalg <span class="free">M</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>real_cond_exp <span class="free">M</span> <span class="free">F</span> <span class="free">f</span><span class="main">)</span> <span class="main">≤</span> eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"eNorm <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span> <span class="free">f</span> <span class="main">=</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> spaceN_iff <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> top.not_eq_extremum<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> Lp_real_cond_exp<span class="main">[</span><span class="operator">OF</span> assms <span class="quoted"><span class="quoted"><span class="quoted">‹<span class="free"><span class="free">f</span></span> <span class="main"><span class="main">∈</span></span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main"><span class="main">(</span></span>𝔏 <span class="free"><span class="free">p</span></span> <span class="free"><span class="free">M</span></span><span class="main"><span class="main">)</span></span>›</span></span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> eNorm_Norm<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹<span class="free">f</span> <span class="main">∈</span> space<span class="hidden">⇩</span><sub>N</sub> <span class="main">(</span>𝔏 <span class="free">p</span> <span class="free">M</span><span class="main">)</span>›</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div>